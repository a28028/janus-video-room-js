{"version":3,"sources":["webpack://janus-video-room-js/./node_modules/bluebird/js/browser/bluebird.js","webpack://janus-video-room-js/./node_modules/es5-ext/global.js","webpack://janus-video-room-js/./node_modules/eventemitter2/lib/eventemitter2.js","webpack://janus-video-room-js/./node_modules/janus-gateway-js/node_modules/webrtc-adapter/src/js/adapter_core.js","webpack://janus-video-room-js/./node_modules/janus-gateway-js/node_modules/webrtc-adapter/src/js/chrome/chrome_shim.js","webpack://janus-video-room-js/./node_modules/janus-gateway-js/node_modules/webrtc-adapter/src/js/chrome/getusermedia.js","webpack://janus-video-room-js/./node_modules/janus-gateway-js/node_modules/webrtc-adapter/src/js/edge/edge_sdp.js","webpack://janus-video-room-js/./node_modules/janus-gateway-js/node_modules/webrtc-adapter/src/js/edge/edge_shim.js","webpack://janus-video-room-js/./node_modules/janus-gateway-js/node_modules/webrtc-adapter/src/js/firefox/firefox_shim.js","webpack://janus-video-room-js/./node_modules/janus-gateway-js/node_modules/webrtc-adapter/src/js/firefox/getusermedia.js","webpack://janus-video-room-js/./node_modules/janus-gateway-js/node_modules/webrtc-adapter/src/js/safari/safari_shim.js","webpack://janus-video-room-js/./node_modules/janus-gateway-js/node_modules/webrtc-adapter/src/js/utils.js","webpack://janus-video-room-js/./node_modules/janus-gateway-js/src/client.js","webpack://janus-video-room-js/./node_modules/janus-gateway-js/src/connection.js","webpack://janus-video-room-js/./node_modules/janus-gateway-js/src/error.js","webpack://janus-video-room-js/./node_modules/janus-gateway-js/src/event-emitter.js","webpack://janus-video-room-js/./node_modules/janus-gateway-js/src/helpers.js","webpack://janus-video-room-js/./node_modules/janus-gateway-js/src/index.js","webpack://janus-video-room-js/./node_modules/janus-gateway-js/src/janus-message.js","webpack://janus-video-room-js/./node_modules/janus-gateway-js/src/janus-plugin-message.js","webpack://janus-video-room-js/./node_modules/janus-gateway-js/src/plugin.js","webpack://janus-video-room-js/./node_modules/janus-gateway-js/src/session.js","webpack://janus-video-room-js/./node_modules/janus-gateway-js/src/timer.js","webpack://janus-video-room-js/./node_modules/janus-gateway-js/src/traits/t-transaction-gateway.js","webpack://janus-video-room-js/./node_modules/janus-gateway-js/src/transaction.js","webpack://janus-video-room-js/./node_modules/janus-gateway-js/src/transactions.js","webpack://janus-video-room-js/./node_modules/janus-gateway-js/src/webrtc/media-audio-plugin.js","webpack://janus-video-room-js/./node_modules/janus-gateway-js/src/webrtc/media-devices-shim.js","webpack://janus-video-room-js/./node_modules/janus-gateway-js/src/webrtc/media-entity-plugin.js","webpack://janus-video-room-js/./node_modules/janus-gateway-js/src/webrtc/media-plugin.js","webpack://janus-video-room-js/./node_modules/janus-gateway-js/src/webrtc/media-stream-plugin.js","webpack://janus-video-room-js/./node_modules/janus-gateway-js/src/webrtc/plugin/audiobridge-plugin.js","webpack://janus-video-room-js/./node_modules/janus-gateway-js/src/webrtc/plugin/audioroom-plugin.js","webpack://janus-video-room-js/./node_modules/janus-gateway-js/src/webrtc/plugin/rtpbroadcast-plugin.js","webpack://janus-video-room-js/./node_modules/janus-gateway-js/src/webrtc/plugin/streaming-plugin.js","webpack://janus-video-room-js/./node_modules/janus-gateway-js/src/websocket-connection.js","webpack://janus-video-room-js/./node_modules/rtcpeerconnection-shim/rtcpeerconnection.js","webpack://janus-video-room-js/./node_modules/sdp/sdp.js","webpack://janus-video-room-js/./src/Room.ts","webpack://janus-video-room-js/./src/attachmediastream.ts","webpack://janus-video-room-js/./src/janus-plugin-videoroom.ts","webpack://janus-video-room-js/./node_modules/webrtc-adapter/src/js/utils.js","webpack://janus-video-room-js/./node_modules/webrtc-adapter/src/js/chrome/getusermedia.js","webpack://janus-video-room-js/./node_modules/webrtc-adapter/src/js/chrome/getdisplaymedia.js","webpack://janus-video-room-js/./node_modules/webrtc-adapter/src/js/chrome/chrome_shim.js","webpack://janus-video-room-js/./node_modules/webrtc-adapter/src/js/edge/getusermedia.js","webpack://janus-video-room-js/./node_modules/webrtc-adapter/src/js/edge/getdisplaymedia.js","webpack://janus-video-room-js/./node_modules/webrtc-adapter/src/js/edge/edge_shim.js","webpack://janus-video-room-js/./node_modules/webrtc-adapter/src/js/edge/filtericeservers.js","webpack://janus-video-room-js/./node_modules/webrtc-adapter/src/js/firefox/getusermedia.js","webpack://janus-video-room-js/./node_modules/webrtc-adapter/src/js/firefox/getdisplaymedia.js","webpack://janus-video-room-js/./node_modules/webrtc-adapter/src/js/firefox/firefox_shim.js","webpack://janus-video-room-js/./node_modules/webrtc-adapter/src/js/safari/safari_shim.js","webpack://janus-video-room-js/./node_modules/webrtc-adapter/src/js/common_shim.js","webpack://janus-video-room-js/./node_modules/webrtc-adapter/src/js/adapter_core.js","webpack://janus-video-room-js/./node_modules/webrtc-adapter/src/js/adapter_factory.js","webpack://janus-video-room-js/./node_modules/webrtcsupport/index-browser.js","webpack://janus-video-room-js/./node_modules/websocket/lib/browser.js","webpack://janus-video-room-js/./node_modules/websocket/lib/version.js","webpack://janus-video-room-js/webpack/bootstrap","webpack://janus-video-room-js/webpack/runtime/compat get default export","webpack://janus-video-room-js/webpack/runtime/define property getters","webpack://janus-video-room-js/webpack/runtime/global","webpack://janus-video-room-js/webpack/runtime/hasOwnProperty shorthand","webpack://janus-video-room-js/webpack/runtime/make namespace object","webpack://janus-video-room-js/./src/index.ts"],"names":["e","t","n","r","s","o","u","a","_dereq_","i","f","Error","code","l","exports","call","length","1","module","Promise","SomePromiseArray","_SomePromiseArray","any","promises","ret","promise","setHowMany","setUnwrap","init","prototype","this","2","firstLineError","schedule","Queue","Async","_customScheduler","_isTickUsed","_lateQueue","_normalQueue","_haveDrainedQueues","self","drainQueues","_drainQueues","_schedule","_drainQueue","queue","_drainQueueStep","fn","shift","_settlePromises","receiver","arg","setScheduler","prev","hasCustomScheduler","haveItemsQueued","fatalError","isNode","process","stderr","write","stack","exit","throwLater","arguments","setTimeout","invokeLater","push","_queueTick","invoke","settlePromises","_pushOne","_reset","3","INTERNAL","tryConvertToPromise","debug","calledBind","rejectThis","_","_reject","targetRejected","context","promiseRejectionQueued","bindingPromise","_then","bindingResolved","thisArg","_bitField","_resolveCallback","target","bindingRejected","bind","_propagateFrom","propagateFromFunction","_boundValue","boundValueFunction","maybePromise","_target","_setBoundTo","undefined","_setOnCancel","obj","_boundTo","_isBound","value","resolve","4","old","bluebird","noConflict","5","cr","Object","create","callerCache","getterCache","util","canEvaluate","caller","methodName","message","classString","toString","TypeError","ensureMethod","pop","apply","namedGetter","indexedGetter","index","Math","max","isIdentifier","args","slice","get","propertyName","getter","maybeGetter","getGetter","6","PromiseArray","apiRejection","tryCatch","errorObj","async","_async","cancel","cancellation","_warn","child","_isCancellable","_cancelBy","_isFollowing","_followee","_cancelBranched","parent","_cancellationParent","_setWillBeCancelled","_branchHasCancelled","_branchesRemainingToCancel","_enoughBranchesHaveCancelled","canceller","_invokeOnCancel","_cancel","_setCancelled","_cancelPromises","_length","_unsetOnCancel","_onCancelField","isPending","_isCancelled","isCancellable","isCancelled","_doInvokeOnCancel","onCancelCallback","internalOnly","isArray","_attachExtraTrace","_resultCancelled","_onCancel","_invokeInternalOnCancel","7","NEXT_FILTER","getKeys","keys","instances","cb","boundTo","predicateLoop","item","matchesPredicate","isObject","j","key","8","longStackTraces","contextStack","Context","_trace","CapturedTrace","peekContext","lastIndex","_promiseCreated","_pushContext","_popContext","_peekContext","trace","deactivateLongStackTraces","activateLongStackTraces","Promise_pushContext","Promise_popContext","Promise_PeekContext","Promise_peekContext","Promise_promiseCreated","ctx","9","enableAsyncHooks","disableAsyncHooks","unhandledRejectionHandled","possiblyUnhandledRejection","printWarning","deferUnhandledRejectionCheck","Warning","es5","canAttachTrace","bluebirdFramePattern","nodeFramePattern","parseLinePattern","stackFramePattern","formatStack","indentStackFrames","debugging","env","warnings","wForgottenReturn","unhandledRejectionCheck","_notifyUnhandledRejection","unhandledRejectionClear","defineProperty","suppressUnhandledRejections","_ensurePossibleRejectionHandled","_setRejectionIsUnhandled","_notifyUnhandledRejectionIsHandled","fireRejectionEvent","_setReturnedNonUndefined","_returnedNonUndefined","_isRejectionUnhandled","reason","_settledValue","_setUnhandledRejectionIsNotified","_unsetUnhandledRejectionIsNotified","_isUnhandledRejectionNotified","_unsetRejectionIsUnhandled","shouldUseOwnTrace","warn","onPossiblyUnhandledRejection","_getContext","contextBind","onUnhandledRejectionHandled","disableLongStackTraces","config","longStackTracesIsSupported","Promise_captureStackTrace","_captureStackTrace","Promise_attachExtraTrace","Promise_dereferenceTrace","_dereferenceTrace","longStackTracesCaptureStackTrace","longStackTracesAttachExtraTrace","longStackTracesDereferenceTrace","hasLongStackTraces","legacyHandlers","unhandledrejection","before","global","onunhandledrejection","after","rejectionhandled","onrejectionhandled","fireDomEvent","dispatch","legacy","dispatchEvent","CustomEvent","event","name","toLowerCase","domEvent","detail","cancelable","Event","document","createEvent","initCustomEvent","fireGlobalEvent","emit","method","generatePromiseLifecycleEventObject","eventToObjectGenerator","promiseCreated","promiseFulfilled","promiseRejected","promiseResolved","promiseCancelled","promiseChained","warning","unhandledRejection","rejectionHandled","activeFireEvent","globalEventFired","domEventFired","defaultFireEvent","cancellationExecute","executor","reject","onCancel","_attachCancellationCallback","cancellationAttachCancellationCallback","previousOnCancel","cancellationOnCancel","cancellationSetOnCancel","cancellationClearCancellationData","cancellationPropagateFrom","flags","branchesRemainingToCancel","opts","warningsOption","_clearCancellationData","_execute","monitoring","_fireEvent","nodeSupportsAsyncResource","asyncHooks","cur","handler","isFulfilled","error","ignoreSelf","_parent","attachExtraTrace","__stackCleaned__","parsed","parseStackAndMessage","notEnumerableProp","join","formatAndLogError","cleanStack","line","isTraceLine","test","isInternalFrame","shouldIgnore","charAt","replace","split","stackFramesAsArray","title","isSoft","console","String","log","localHandler","localEventFired","formatNonError","str","JSON","stringify","substr","maxChars","snip","captureStackTrace","parseLineInfoRegex","parseLineInfo","matches","match","fileName","parseInt","_promisesCreated","uncycle","inherits","nodes","stackToIndex","node","cycleEdgeNode","currentChildLength","stacks","current","currentLastIndex","currentLastLine","commonRootMeetPoint","removeCommonRoots","splice","removeDuplicateOrEmptyJumps","reconstructStack","v8stackFramePattern","v8stackFormatter","stackTraceLimit","ignoreUntil","hasStackAfterThrow","err","indexOf","isTTY","color","checkForgottenReturns","returnValue","handlerLine","creatorLine","traceLines","lineMatches","firstUserLine","msg","setBounds","lastLineError","firstFileName","lastFileName","firstStackLines","lastStackLines","firstIndex","result","info","deprecated","replacement","10","returner","thrower","thenReturn","thenThrow","catchThrow","_reason","caught","catchReturn","_value","11","PromiseReduce","reduce","PromiseAll","all","promiseAllThis","each","mapSeries","12","_TypeError","_RangeError","Objectfreeze","freeze","subError","nameProperty","defaultMessage","SubError","constructor","CancellationError","TimeoutError","AggregateError","RangeError","methods","Array","configurable","writable","enumerable","level","OperationalError","cause","indent","lines","errorTypes","RejectionError","13","isES5","getDescriptor","getOwnPropertyDescriptor","names","getOwnPropertyNames","getPrototypeOf","propertyIsWritable","prop","descriptor","set","has","hasOwnProperty","proto","ObjectKeys","desc","14","PromiseMap","map","filter","options","15","catchFilter","PassThroughHandlerContext","type","called","cancelPromise","FinallyHandlerCancelReaction","finallyHandler","checkCancel","succeed","fail","reasonOrValue","isFinallyHandler","isRejected","_passThrough","success","then","lastly","tap","tapCatch","handlerOrPredicate","len","catchInstances","16","Proxyable","yieldHandlers","PromiseSpawn","generatorFunction","yieldHandler","internal","_finallyPromise","_promise","_stack","_generatorFunction","_receiver","_generator","_yieldHandlers","concat","_yieldedPromise","_cancellationPhase","_isResolved","_cleanup","_fulfill","_promiseCancelled","coroutine","returnSentinel","_continue","_promiseFulfilled","next","_promiseRejected","_run","_rejectCallback","done","traceParent","promiseFromYieldHandler","bitField","_proxy","PromiseSpawn$","generator","spawn","addYieldHandler","17","last","spread","18","MappingPromiseArray","limit","_filter","constructor$","_callback","_preservedValues","_limit","_inFlight","_queue","_asyncInit","concurrency","isFinite","_init$","_init","values","_values","preservedValues","callback","_totalResolved","_resolve","booleans","19","_resolveFromSyncValue","attempt","20","maybeWrapAsError","rErrorKey","wrapAsOperationalError","isUntypedError","markAsOriginatingFromRejection","multiArgs","wrapped","21","spreadAdapter","val","nodeback","successAdapter","errorAdapter","newReason","asCallback","nodeify","adapter","22","makeSelfResolutionError","reflectHandler","PromiseInspection","UNDEFINED_BINDING","setReflectHandler","getDomain","domain","getContextDomain","AsyncResource","getContextAsyncHooks","getContext","errors","APPLY","createContext","nodebackForPromise","check","_fulfillmentHandler0","_rejectionHandler0","_promise0","_receiver0","_resolveFromExecutor","deferResolve","v","deferReject","fillTypes","p","reflect","didFulfill","didReject","_setIsFinal","toJSON","fulfillmentValue","rejectionReason","originatesFromRejection","getNewLibraryCopy","is","fromNode","fromCallback","_isFateSealed","_setAsyncGuaranteed","cast","_setFulfilled","fulfilled","rejected","internalData","haveInternalData","settler","_settlePromiseCtx","_settlePromiseLateCancellationObserver","_addCallbacks","_setLength","_setRejected","_setFollowing","_isFinal","_unsetCancelled","_setNoAsyncGuarantee","_receiverAt","_promiseAt","_fulfillmentHandlerAt","_rejectionHandlerAt","_migrateCallback0","follower","fulfill","_migrateCallbackAt","base","proxyable","shouldBind","_setFollowee","synchronous","ignoreNonErrorWarnings","ensureErrorObject","hasStack","_settlePromiseFromHandler","x","_settlePromise","isPromise","asyncGuaranteed","_settlePromise0","_clearCallbackDataAtIndex","_fulfillPromises","_rejectPromises","Symbol","toStringTag","defer","pending","version","toFastProperties","b","c","23","resolveValueIfEmpty","asArray","_iterate","_resolveEmptyArray","Map","toResolutionValue","getActualLength","shouldCopyValues","isResolved","24","THIS","withAppended","defaultPromisified","__isPromisified__","noCopyPropsPattern","RegExp","defaultFilter","propsFilter","isPromisified","hasPromisified","suffix","getDataPropertyOrDefault","makeNodePromisified","makeNodePromisifiedEval","__","defaultThis","promisified","promisifyAll","promisifier","suffixRegexp","inheritedDataKeys","passesDefaultFilter","keyWithoutAsyncSuffix","checkValid","promisifiableMethods","promisifiedKey","promisify","copyDescriptors","isClass","25","Es6Map","mapToEntries","size","extractEntry","forEach","PropertiesPromiseArray","entries","isMap","_isMap","props","castValue","entriesToMap","keyOffset","26","capacity","_capacity","_front","_willBeOverCapacity","_checkCapacity","wrapMask","front","_resizeTo","oldCapacity","src","srcIndex","dst","dstIndex","arrayMove","27","race","array","28","ReductionPromiseArray","initialValue","_each","_fn","_initialValue","_currentCancellable","_eachValues","completed","valueOrReason","gotAccum","accum","_gotAccum","gotValue","_eachComplete","sender","_resultCancelled$","29","div","toggleScheduled","div2","NativePromise","getNativePromise","MutationObserver","GlobalSetImmediate","g","setImmediate","ProcessNextTick","nextTick","isRecentNode","nativePromise","window","navigator","standalone","cordova","documentElement","createElement","attributes","classList","toggle","observe","disconnect","30","SettledPromiseArray","_promiseResolved","inspection","_settledValueField","settle","allSettled","31","CANCELLATION","_howMany","_unwrap","_initialized","some","howMany","isArrayResolved","_canPossiblyFulfill","_getRangeError","count","_addFulfilled","_fulfilled","_addRejected","_checkOutcome","_rejected","32","__isCancelled","33","hasProp","doGetThen","getThen","isAnyBluebirdPromise","doThenable","34","HandleWrapper","handle","clearTimeout","afterValue","delay","ms","successClear","failureClear","timeout","handleWrapper","afterTimeout","35","NULL","dispose","resources","iterator","thenable","_isDisposable","_getDisposer","_setDisposable","castPreservingDisposable","tryDispose","Disposer","data","_data","_context","FunctionDisposer","maybeUnwrapDisposer","isDisposer","ResourceList","resource","doDispose","_unsetDisposable","d","using","input","spreadArgs","disposer","reflectedResources","resultPromise","inspections","_disposer","36","tryCatchTarget","globalObject","tryCatcher","isPrimitive","excludedPrototypes","Function","isExcludedProto","visitedKeys","enumeration","thisAssignmentPattern","rident","safeToString","isError","ArrayFrom","from","itResult","it","hasEnvVariables","hasMethods","hasMethodsOtherThanConstructor","hasThisAssignmentAndStaticMethods","defaultValue","Child","Parent","T","appendee","maybeError","FakeConstructor","ic","foo","filledRange","prefix","ignore","to","runInAsyncScope","versions","Number","supportsAsync","P","naiveFallback","globalThis","__global__","_events","_conf","configure","conf","delimiter","maxListeners","wildcard","newListener","verboseMemoryLeak","listenerTree","logPossibleMemoryLeak","eventName","errorMsg","EventEmitter","searchListenerTree","handlers","tree","leaf","branch","xTree","xxTree","isolatedBranch","endReached","listeners","typeLength","currentType","nextType","_listeners","growListenerTree","listener","warned","EventEmitter2","setMaxListeners","once","many","ttl","off","_origin","on","al","_all","ns","emitAsync","onAny","addListener","leafs","iLeaf","position","recursivelyGarbageCollect","root","offAny","fns","removeListener","removeAllListeners","listenerCount","listenersAny","logging","browserDetails","extractVersion","disableLog","chromeShim","edgeShim","firefoxShim","safariShim","browser","shimPeerConnection","browserShim","shimGetUserMedia","shimSourceObject","shimOnTrack","RTCPeerConnection","_ontrack","removeEventListener","_ontrackpoly","addEventListener","stream","te","track","streams","getTracks","HTMLMediaElement","_srcObject","URL","revokeObjectURL","createObjectURL","pcConfig","pcConstraints","iceTransportPolicy","iceTransports","pc","webkitRTCPeerConnection","origGetStats","getStats","selector","successCallback","errorCallback","fixChromeStats_","response","standardReport","report","standardStats","id","timestamp","stat","successCallbackWrapper_","generateCertificate","nativeMethod","RTCIceCandidate","RTCSessionDescription","attachMediaStream","element","srcObject","reattachMediaStream","constraintsToChrome_","mandatory","optional","cc","ideal","exact","min","oldname_","toUpperCase","oc","mix","advanced","getUserMedia","constraints","onSuccess","onError","parse","audio","video","webkitGetUserMedia","getUserMediaPromise_","mediaDevices","enumerateDevices","kinds","MediaStreamTrack","getSources","devices","device","label","kind","deviceId","groupId","origGetUserMedia","SDPUtils","random","localCName","generateIdentifier","splitLines","blob","trim","splitSections","part","matchPrefix","parseCandidate","parts","candidate","foundation","substring","component","protocol","priority","ip","port","relatedAddress","relatedPort","tcpType","writeCandidate","sdp","parseRtpMap","payloadType","clockRate","numChannels","writeRtpMap","codec","pt","preferredPayloadType","parseExtmap","uri","writeExtmap","headerExtension","preferredId","parseFmtp","kv","writeFmtp","parameters","params","param","parseRtcpFb","parameter","writeRtcpFb","rtcpFeedback","fb","parseSsrcMedia","sp","ssrc","colon","attribute","getDtlsParameters","mediaSection","sessionpart","fpLine","role","fingerprints","algorithm","writeDtlsParameters","setupType","fp","getIceParameters","usernameFragment","password","writeIceParameters","parseRtpParameters","description","codecs","headerExtensions","fecMechanisms","rtcp","mline","rtpmapline","fmtps","writeRtpDescription","caps","parseRtpEncodingParameters","secondarySsrc","encodingParameters","hasRed","hasUlpfec","ssrcs","primarySsrc","flows","apt","encParam","codecPayloadType","rtx","fec","mechanism","bandwidth","maxBitrate","writeSessionBoilerplate","writeMediaSection","transceiver","iceGatherer","getLocalParameters","dtlsTransport","mid","rtpSender","rtpReceiver","msid","sendEncodingParameters","getDirection","RTCIceGatherer","_eventTarget","createDocumentFragment","onicecandidate","onaddstream","ontrack","onremovestream","onsignalingstatechange","oniceconnectionstatechange","onnegotiationneeded","ondatachannel","localStreams","remoteStreams","getLocalStreams","getRemoteStreams","localDescription","remoteDescription","signalingState","iceConnectionState","iceGatheringState","iceOptions","gatherPolicy","iceServers","server","urls","url","transceivers","_localIceCandidatesBuffer","_emitBufferedCandidates","sections","sdpMLineIndex","every","state","addStream","clone","_maybeFireNegotiationNeeded","removeStream","idx","_getCommonCapabilities","localCapabilities","remoteCapabilities","commonCapabilities","lCodec","rCodec","lHeaderExtension","rHeaderExtension","_createIceAndDtlsTransports","iceTransport","RTCIceTransport","onlocalcandidate","evt","sdpMid","cand","end","complete","onicestatechange","_updateConnectionState","RTCDtlsTransport","ondtlsstatechange","onerror","_transceive","send","recv","encodings","cname","recvEncodingParameters","receive","setLocalDescription","_pendingOffer","remoteIceParameters","start","remoteDtlsParameters","_updateSignalingState","hasCallback","setRemoteDescription","MediaStream","receiverList","direction","remoteSsrc","isComplete","cands","setRemoteCandidates","addTrack","transports","RTCRtpReceiver","getCapabilities","localtrack","RTCRtpSender","trackEvent","close","stop","newState","states","closed","connecting","checking","connected","failed","disconnected","new","createOffer","offerOptions","tracks","numAudioTracks","numVideoTracks","getAudioTracks","getVideoTracks","offerToReceiveAudio","offerToReceiveVideo","wantReceive","createAnswer","addIceCandidate","mLineIndex","addRemoteCandidate","results","res","mozSrcObject","newIceServers","newServer","username","credential","mozRTCPeerConnection","mozRTCSessionDescription","mozRTCIceCandidate","constraintsToFF37_","require","mozGetUserMedia","orgEnumerateDevices","logDisabled_","utils","bool","uastring","expr","pos","detectBrowser","userAgent","minVersion","Connection","Client","address","_address","_options","createConnection","open","Helpers","TTransactionGateway","JanusError","Transaction","WebsocketConnection","Session","JanusMessage","super_","_id","_sessions","_websocketConnection","_installWebsocketListeners","extend","processIncomeMessage","catch","getId","getAddress","getOptions","return","isOpened","getSessionList","session","cleanup","createSession","sendSync","janus","hasSession","sessionId","getSession","isClosed","addSession","removeSession","token","apisecret","generateRandomId","processOutcomeMessage","_onCreate","incomeMessage","try","defaultProcessIncomeMessage","outcomeMessage","addTransaction","janusMessage","janusError","getError","destination","source","sources","ctor","superCtor","Plugin","MediaPlugin","AudiobridgePlugin","AudioroomPlugin","StreamingPlugin","RtpbroadcastPlugin","plainMessage","_plainMessage","getPlainMessage","JanusPluginMessage","plugin","_plugin","getPluginData","unshift","getResultText","getResponseAlias","_session","_name","_detach","_types","aClass","register","getName","detach","sendWithTransaction","_onDetached","transactionId","transaction","sendPromise","Timer","connection","_connection","_plugins","_startKeepAlive","_destroy","_keepAliveTimer","reset","attachPlugin","destroy","hasPlugin","pluginId","getPlugin","getPluginList","addPlugin","removePlugin","_onAttach","_onDestroy","_onTimeout","_stopKeepAlive","finally","_isNaturalNumber","isNaN","parseFloat","keepAlive","_keepAlivePeriod","_ms","_timeoutId","Transactions","getTransactions","_transactions","add","find","hasTransaction","executeTransaction","execute","timeoutPeriod","timeoutRejection","_isExecuted","list","_find","remove","MediaEntityPlugin","MediaAudioPlugin","_join","body","request","setCurrentEntity","leave","resetCurrentEntity","_change","_connect","hasCurrentEntity","_list","jsep","offerStream","configureOptions","createPeerConnection","sendSDP","setRemoteSDP","_listParticipants","webrtc","MediaDevicesShim","getSharedScreen","location","_getSharedScreenChrome","_getSharedScreenFirefox","chromever","maxver","googLeakyBucket","maxWidth","screen","width","maxHeight","height","maxFrameRate","chromeMediaSource","timeoutRejectId","messageListener","origin","sourceId","googTemporalLayeredScreencast","chromeMediaSourceId","postMessage","mozMediaSource","mediaSource","lastStreamTime","currentTime","inderval","setInterval","clearInterval","onended","_currentEntityId","_create","_onHangup","webrtcsupport","_pcListeners","_pc","PeerConnection","_addPcEventListeners","getPeerConnection","hangup","_createSDP","SessionDescription","party","_onTrickle","IceCandidate","closePeerConnection","_stopLocalMedia","_removePcEventListener","_addPcEventListener","MediaStreamPlugin","_watch","watchOptions","answerOptions","_offerAnswer","_start","_stop","_pause","_switch","connect","NAME","roomId","room","change","listParticipants","watch","watchUDP","pause","switch","switchSource","superuser","enabled","mountpointId","enable","disable","recording","WebSocket","webSocket","_webSocket","_onOpen","onclose","onopen","readyState","_installW3cListeners","_installNodeListeners","onmessage","parsedMessage","onMessage","_close","OPEN","CLOSED","CLOSING","terminate","_send","CONNECTING","dtlsRole","trackId","_initialTrackId","getCommonCapabilities","findCodecByPayloadType","rtxCapabilityMatches","lRtx","rRtx","lCodecs","rCodecs","isActionAllowedInSignalingState","action","offer","answer","maybeAddCandidate","alreadyAdded","getRemoteCandidates","remoteCandidate","makeError","NotSupportedError","InvalidStateError","InvalidAccessError","OperationError","edgeVersion","addTrackToStreamAndFireEvent","MediaStreamTrackEvent","fireAddTrack","_dispatchEvent","canTrickleIceCandidates","needNegotiation","_localDescription","_remoteDescription","connectionState","usingBundle","bundlePolicy","rtcpMuxPolicy","hasTurn","isString","filterIceServers","_iceGatherers","iceCandidatePoolSize","_config","_sdpSessionId","generateSessionId","_sdpSessionVersion","_dtlsRole","_isClosed","onconnectionstatechange","onicegatheringstatechange","_emitGatheringStateChange","getConfiguration","_createTransceiver","doNotAdd","hasBundleTransport","associatedRemoteMediaStreams","clonedStream","clonedTrack","removeTrack","getSenders","getReceivers","_createIceGatherer","bufferedCandidateEvents","bufferCandidates","_gather","ufrag","serializedCandidate","assign","getMediaSections","getDescription","_updateIceConnectionState","_disposeIceAndDtlsTransports","compound","rtcpParameters","isIceLite","getKind","remoteMsid","parseMsid","getMid","parseRtcpParameters","setTransport","default","isNewTrack","nativeTrack","removeTrackFromStreamAndFireEvent","sid","remoteCodec","hdrExt","rHdrExt","getLocalCandidates","mediaSectionsInOffer","localTrack","reducedSize","candidateString","senderOrReceiver","allStats","stats","ortcObjectName","nativeGetstats","nativeStats","mapStats","inboundrtp","outboundrtp","candidatepair","localcandidate","remotecandidate","parseIceOptions","channels","parseSsrcGroup","semantics","parseFingerprint","parseCryptoLine","tag","cryptoSuite","keyParams","sessionParams","writeCryptoLine","writeCryptoKeyParams","parseCryptoKeyParams","keyMethod","keySalt","lifeTime","mkiValue","mkiLength","getCryptoParameters","pwd","maxptime","extension","rsize","mux","spec","planB","msidParts","parseSctpDescription","maxMessageSize","parseMLine","maxSizeLine","sctpPort","fmt","writeSctpDescription","media","sctp","output","sessId","sessVer","sessUser","parseOLine","sessionVersion","netType","addressType","isValidSDP","h","trigger","expose","onRoomjoined","LiteEvent","onRemoteRoomAttached","onRoomCreated","onNeedVideoLocal","onNeedVideoRemote","onUnpublished","onLeaving","remoteCreateVideoroomPlugin","_self","feedInfo","VideoroomPlugin","videoroomPlugin","elementinfo","newRoom","publishers","createVideoRoomPlugin","plugindata","joinRoom","display","joinedInfo","processLocalVideo","remoteJoinRoomSubscriber","feed","private_id","dataAttached","keepalive","JanusClient","trackInfo","videoroomRremoteFeedPublishers","feedId","dataResult","mediaConstraints","jsepResult","publishOwnFeed","JanusRoom","el","autoplay","mirror","muted","disableContextMenu","tagName","oncontextmenu","preventDefault","styleName","style","setAttribute","Janus","option","processIncomeMessagePublishers","processRemoteVideo","attachedJsep","JoinOptions","ptype","createPeerConnection2","videoroom","onRemoteFeedAttached","onEvent","deprecationWarnings_","wrapPeerConnectionEvent","eventNameToWrap","wrapper","nativeAddEventListener","nativeEventName","wrappedCallback","modifiedEvent","handleEvent","_eventMap","nativeRemoveEventListener","unwrappedCb","delete","disableWarnings","oldMethod","newMethod","isSecureContext","supportsUnifiedPlan","RTCRtpTransceiver","compactObject","accumulator","isObj","isEmptyObject","walkStats","resultSet","endsWith","filterStats","outbound","streamStatsType","filteredResult","trackStats","trackIdentifier","trackStat","shimConstraints_","func","remap","face","facingMode","getSupportedFacingModeLies","getSupportedConstraints","dev","includes","shimError_","PermissionDeniedError","PermissionDismissedError","DevicesNotFoundError","ConstraintNotSatisfiedError","TrackStartError","MediaDeviceFailedDueToShutdown","MediaDeviceKillSwitchOn","TabCaptureError","ScreenCaptureError","DeviceCaptureError","constraint","constraintName","cs","DOMException","shimGetDisplayMedia","getSourceId","getDisplayMedia","widthSpecified","heightSpecified","frameRateSpecified","frameRate","shimMediaStream","webkitMediaStream","origSetRemoteDescription","shimGetSendersWithDtmf","shimSenderWithDtmf","_dtmf","createDTMFSender","_senders","origAddTrack","origRemoveTrack","origAddStream","origRemoveStream","origGetSenders","senders","shimGetStats","onSucc","onErr","makeMapStats","shimSenderReceiverGetStats","origGetReceivers","receivers","srcElement","shimAddTrackRemoveTrackWithNative","_shimmedLocalStreams","streamId","existingSenders","newSenders","newSender","shimAddTrackRemoveTrack","origGetLocalStreams","nativeStreams","_reverseStreams","_streams","newStream","replaceInternalStreamId","internalId","externalStream","internalStream","replaceExternalStreamId","alreadyExists","oldStream","methodObj","origSetLocalDescription","origLocalDescription","streamid","addIceCandidateNullSupported","nativeAddIceCandidate","fixNegotiationNeeded","sdpSemantics","origMSTEnabled","ev","RTCDtmfSender","RTCDTMFSender","RTCPeerConnectionShim","validTurn","startsWith","shimReplaceTrack","replaceTrack","setTrack","nativeGetUserMedia","getSettings","nativeGetSettings","applyConstraints","nativeApplyConstraints","preferredMediaSource","RTCTrackEvent","modernStatsTypes","nativeGetStats","shimSenderGetStats","shimReceiverGetStats","shimRemoveStream","shimRTCDataChannel","DataChannel","RTCDataChannel","shimAddTransceiver","origAddTransceiver","addTransceiver","setParametersPromises","initParameters","shouldPerformCheck","sendEncodings","encodingParam","rid","scaleResolutionDownBy","maxFramerate","getParameters","setParameters","shimGetParameters","origGetParameters","shimCreateOffer","origCreateOffer","shimCreateAnswer","origCreateAnswer","shimLocalStreamsAPI","_localStreams","_addTrack","shimRemoteStreamsAPI","_remoteStreams","_onaddstream","_onaddstreampoly","shimCallbacksAPI","failureCallback","withCallback","_getUserMedia","shimConstraints","errcb","shimRTCIceServerUrls","OrigPeerConnection","shimTrackEventTransceiver","shimCreateOfferLegacy","audioTransceiver","getTransceivers","setDirection","videoTransceiver","shimAudioContext","AudioContext","webkitAudioContext","shimRTCIceCandidate","NativeRTCIceCandidate","nativeCandidate","parsedCandidate","augmentedCandidate","shimMaxMessageSize","_sctp","sctpInDescription","mLine","getRemoteFirefoxVersion","getCanSendMaxMessageSize","remoteIsFirefox","canSendMaxMessageSize","getMaxMessageSize","isFirefox","canSendMMS","remoteMMS","POSITIVE_INFINITY","shimSendThrowTypeError","wrapDcSend","dc","origDataChannelSend","byteLength","origCreateDataChannel","createDataChannel","dataChannel","channel","shimConnectionState","_onconnectionstatechange","origMethod","_connectionstatechangepoly","_lastConnectionState","newEvent","removeAllowExtmapMixed","nativeSRD","shimChrome","shimFirefox","shimEdge","shimSafari","commonShim","adapterFactory","PC","screenSharing","videoEl","supportVp8","canPlayType","msGetUserMedia","browserVersion","support","supportRTCPeerConnection","supportGetUserMedia","supportDataChannel","supportWebAudio","createMediaStreamSource","supportMediaStream","supportScreenSharing","_globalThis","NativeWebSocket","MozWebSocket","websocket_version","W3CWebSocket","protocols","__webpack_module_cache__","__webpack_require__","moduleId","__webpack_modules__","__esModule","definition","sampelRoom","eventRoomjoined","eventNeedVideoLocal","getElementById","eventNeedVideoRemote","innerHTML","appendChild","spanID","elementSpan","eventOnLeaving","feedID","elementVideo","h2","eventOnUnpublished","parentNode","replaceChild"],"mappings":"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","file":"bundle.js","sourcesContent":["/* @preserve\n * The MIT License (MIT)\n * \n * Copyright (c) 2013-2018 Petka Antonov\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n * \n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n * \n */\n/**\n * bluebird build version 3.7.2\n * Features enabled: core, race, call_get, generators, map, nodeify, promisify, props, reduce, settle, some, using, timers, filter, any, each\n*/\n!function(e){if(\"object\"==typeof exports&&\"undefined\"!=typeof module)module.exports=e();else if(\"function\"==typeof define&&define.amd)define([],e);else{var f;\"undefined\"!=typeof window?f=window:\"undefined\"!=typeof global?f=global:\"undefined\"!=typeof self&&(f=self),f.Promise=e()}}(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof _dereq_==\"function\"&&_dereq_;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof _dereq_==\"function\"&&_dereq_;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise) {\nvar SomePromiseArray = Promise._SomePromiseArray;\nfunction any(promises) {\n    var ret = new SomePromiseArray(promises);\n    var promise = ret.promise();\n    ret.setHowMany(1);\n    ret.setUnwrap();\n    ret.init();\n    return promise;\n}\n\nPromise.any = function (promises) {\n    return any(promises);\n};\n\nPromise.prototype.any = function () {\n    return any(this);\n};\n\n};\n\n},{}],2:[function(_dereq_,module,exports){\n\"use strict\";\nvar firstLineError;\ntry {throw new Error(); } catch (e) {firstLineError = e;}\nvar schedule = _dereq_(\"./schedule\");\nvar Queue = _dereq_(\"./queue\");\n\nfunction Async() {\n    this._customScheduler = false;\n    this._isTickUsed = false;\n    this._lateQueue = new Queue(16);\n    this._normalQueue = new Queue(16);\n    this._haveDrainedQueues = false;\n    var self = this;\n    this.drainQueues = function () {\n        self._drainQueues();\n    };\n    this._schedule = schedule;\n}\n\nAsync.prototype.setScheduler = function(fn) {\n    var prev = this._schedule;\n    this._schedule = fn;\n    this._customScheduler = true;\n    return prev;\n};\n\nAsync.prototype.hasCustomScheduler = function() {\n    return this._customScheduler;\n};\n\nAsync.prototype.haveItemsQueued = function () {\n    return this._isTickUsed || this._haveDrainedQueues;\n};\n\n\nAsync.prototype.fatalError = function(e, isNode) {\n    if (isNode) {\n        process.stderr.write(\"Fatal \" + (e instanceof Error ? e.stack : e) +\n            \"\\n\");\n        process.exit(2);\n    } else {\n        this.throwLater(e);\n    }\n};\n\nAsync.prototype.throwLater = function(fn, arg) {\n    if (arguments.length === 1) {\n        arg = fn;\n        fn = function () { throw arg; };\n    }\n    if (typeof setTimeout !== \"undefined\") {\n        setTimeout(function() {\n            fn(arg);\n        }, 0);\n    } else try {\n        this._schedule(function() {\n            fn(arg);\n        });\n    } catch (e) {\n        throw new Error(\"No async scheduler available\\u000a\\u000a    See http://goo.gl/MqrFmX\\u000a\");\n    }\n};\n\nfunction AsyncInvokeLater(fn, receiver, arg) {\n    this._lateQueue.push(fn, receiver, arg);\n    this._queueTick();\n}\n\nfunction AsyncInvoke(fn, receiver, arg) {\n    this._normalQueue.push(fn, receiver, arg);\n    this._queueTick();\n}\n\nfunction AsyncSettlePromises(promise) {\n    this._normalQueue._pushOne(promise);\n    this._queueTick();\n}\n\nAsync.prototype.invokeLater = AsyncInvokeLater;\nAsync.prototype.invoke = AsyncInvoke;\nAsync.prototype.settlePromises = AsyncSettlePromises;\n\n\nfunction _drainQueue(queue) {\n    while (queue.length() > 0) {\n        _drainQueueStep(queue);\n    }\n}\n\nfunction _drainQueueStep(queue) {\n    var fn = queue.shift();\n    if (typeof fn !== \"function\") {\n        fn._settlePromises();\n    } else {\n        var receiver = queue.shift();\n        var arg = queue.shift();\n        fn.call(receiver, arg);\n    }\n}\n\nAsync.prototype._drainQueues = function () {\n    _drainQueue(this._normalQueue);\n    this._reset();\n    this._haveDrainedQueues = true;\n    _drainQueue(this._lateQueue);\n};\n\nAsync.prototype._queueTick = function () {\n    if (!this._isTickUsed) {\n        this._isTickUsed = true;\n        this._schedule(this.drainQueues);\n    }\n};\n\nAsync.prototype._reset = function () {\n    this._isTickUsed = false;\n};\n\nmodule.exports = Async;\nmodule.exports.firstLineError = firstLineError;\n\n},{\"./queue\":26,\"./schedule\":29}],3:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise, INTERNAL, tryConvertToPromise, debug) {\nvar calledBind = false;\nvar rejectThis = function(_, e) {\n    this._reject(e);\n};\n\nvar targetRejected = function(e, context) {\n    context.promiseRejectionQueued = true;\n    context.bindingPromise._then(rejectThis, rejectThis, null, this, e);\n};\n\nvar bindingResolved = function(thisArg, context) {\n    if (((this._bitField & 50397184) === 0)) {\n        this._resolveCallback(context.target);\n    }\n};\n\nvar bindingRejected = function(e, context) {\n    if (!context.promiseRejectionQueued) this._reject(e);\n};\n\nPromise.prototype.bind = function (thisArg) {\n    if (!calledBind) {\n        calledBind = true;\n        Promise.prototype._propagateFrom = debug.propagateFromFunction();\n        Promise.prototype._boundValue = debug.boundValueFunction();\n    }\n    var maybePromise = tryConvertToPromise(thisArg);\n    var ret = new Promise(INTERNAL);\n    ret._propagateFrom(this, 1);\n    var target = this._target();\n    ret._setBoundTo(maybePromise);\n    if (maybePromise instanceof Promise) {\n        var context = {\n            promiseRejectionQueued: false,\n            promise: ret,\n            target: target,\n            bindingPromise: maybePromise\n        };\n        target._then(INTERNAL, targetRejected, undefined, ret, context);\n        maybePromise._then(\n            bindingResolved, bindingRejected, undefined, ret, context);\n        ret._setOnCancel(maybePromise);\n    } else {\n        ret._resolveCallback(target);\n    }\n    return ret;\n};\n\nPromise.prototype._setBoundTo = function (obj) {\n    if (obj !== undefined) {\n        this._bitField = this._bitField | 2097152;\n        this._boundTo = obj;\n    } else {\n        this._bitField = this._bitField & (~2097152);\n    }\n};\n\nPromise.prototype._isBound = function () {\n    return (this._bitField & 2097152) === 2097152;\n};\n\nPromise.bind = function (thisArg, value) {\n    return Promise.resolve(value).bind(thisArg);\n};\n};\n\n},{}],4:[function(_dereq_,module,exports){\n\"use strict\";\nvar old;\nif (typeof Promise !== \"undefined\") old = Promise;\nfunction noConflict() {\n    try { if (Promise === bluebird) Promise = old; }\n    catch (e) {}\n    return bluebird;\n}\nvar bluebird = _dereq_(\"./promise\")();\nbluebird.noConflict = noConflict;\nmodule.exports = bluebird;\n\n},{\"./promise\":22}],5:[function(_dereq_,module,exports){\n\"use strict\";\nvar cr = Object.create;\nif (cr) {\n    var callerCache = cr(null);\n    var getterCache = cr(null);\n    callerCache[\" size\"] = getterCache[\" size\"] = 0;\n}\n\nmodule.exports = function(Promise) {\nvar util = _dereq_(\"./util\");\nvar canEvaluate = util.canEvaluate;\nvar isIdentifier = util.isIdentifier;\n\nvar getMethodCaller;\nvar getGetter;\nif (!true) {\nvar makeMethodCaller = function (methodName) {\n    return new Function(\"ensureMethod\", \"                                    \\n\\\n        return function(obj) {                                               \\n\\\n            'use strict'                                                     \\n\\\n            var len = this.length;                                           \\n\\\n            ensureMethod(obj, 'methodName');                                 \\n\\\n            switch(len) {                                                    \\n\\\n                case 1: return obj.methodName(this[0]);                      \\n\\\n                case 2: return obj.methodName(this[0], this[1]);             \\n\\\n                case 3: return obj.methodName(this[0], this[1], this[2]);    \\n\\\n                case 0: return obj.methodName();                             \\n\\\n                default:                                                     \\n\\\n                    return obj.methodName.apply(obj, this);                  \\n\\\n            }                                                                \\n\\\n        };                                                                   \\n\\\n        \".replace(/methodName/g, methodName))(ensureMethod);\n};\n\nvar makeGetter = function (propertyName) {\n    return new Function(\"obj\", \"                                             \\n\\\n        'use strict';                                                        \\n\\\n        return obj.propertyName;                                             \\n\\\n        \".replace(\"propertyName\", propertyName));\n};\n\nvar getCompiled = function(name, compiler, cache) {\n    var ret = cache[name];\n    if (typeof ret !== \"function\") {\n        if (!isIdentifier(name)) {\n            return null;\n        }\n        ret = compiler(name);\n        cache[name] = ret;\n        cache[\" size\"]++;\n        if (cache[\" size\"] > 512) {\n            var keys = Object.keys(cache);\n            for (var i = 0; i < 256; ++i) delete cache[keys[i]];\n            cache[\" size\"] = keys.length - 256;\n        }\n    }\n    return ret;\n};\n\ngetMethodCaller = function(name) {\n    return getCompiled(name, makeMethodCaller, callerCache);\n};\n\ngetGetter = function(name) {\n    return getCompiled(name, makeGetter, getterCache);\n};\n}\n\nfunction ensureMethod(obj, methodName) {\n    var fn;\n    if (obj != null) fn = obj[methodName];\n    if (typeof fn !== \"function\") {\n        var message = \"Object \" + util.classString(obj) + \" has no method '\" +\n            util.toString(methodName) + \"'\";\n        throw new Promise.TypeError(message);\n    }\n    return fn;\n}\n\nfunction caller(obj) {\n    var methodName = this.pop();\n    var fn = ensureMethod(obj, methodName);\n    return fn.apply(obj, this);\n}\nPromise.prototype.call = function (methodName) {\n    var args = [].slice.call(arguments, 1);;\n    if (!true) {\n        if (canEvaluate) {\n            var maybeCaller = getMethodCaller(methodName);\n            if (maybeCaller !== null) {\n                return this._then(\n                    maybeCaller, undefined, undefined, args, undefined);\n            }\n        }\n    }\n    args.push(methodName);\n    return this._then(caller, undefined, undefined, args, undefined);\n};\n\nfunction namedGetter(obj) {\n    return obj[this];\n}\nfunction indexedGetter(obj) {\n    var index = +this;\n    if (index < 0) index = Math.max(0, index + obj.length);\n    return obj[index];\n}\nPromise.prototype.get = function (propertyName) {\n    var isIndex = (typeof propertyName === \"number\");\n    var getter;\n    if (!isIndex) {\n        if (canEvaluate) {\n            var maybeGetter = getGetter(propertyName);\n            getter = maybeGetter !== null ? maybeGetter : namedGetter;\n        } else {\n            getter = namedGetter;\n        }\n    } else {\n        getter = indexedGetter;\n    }\n    return this._then(getter, undefined, undefined, propertyName, undefined);\n};\n};\n\n},{\"./util\":36}],6:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise, PromiseArray, apiRejection, debug) {\nvar util = _dereq_(\"./util\");\nvar tryCatch = util.tryCatch;\nvar errorObj = util.errorObj;\nvar async = Promise._async;\n\nPromise.prototype[\"break\"] = Promise.prototype.cancel = function() {\n    if (!debug.cancellation()) return this._warn(\"cancellation is disabled\");\n\n    var promise = this;\n    var child = promise;\n    while (promise._isCancellable()) {\n        if (!promise._cancelBy(child)) {\n            if (child._isFollowing()) {\n                child._followee().cancel();\n            } else {\n                child._cancelBranched();\n            }\n            break;\n        }\n\n        var parent = promise._cancellationParent;\n        if (parent == null || !parent._isCancellable()) {\n            if (promise._isFollowing()) {\n                promise._followee().cancel();\n            } else {\n                promise._cancelBranched();\n            }\n            break;\n        } else {\n            if (promise._isFollowing()) promise._followee().cancel();\n            promise._setWillBeCancelled();\n            child = promise;\n            promise = parent;\n        }\n    }\n};\n\nPromise.prototype._branchHasCancelled = function() {\n    this._branchesRemainingToCancel--;\n};\n\nPromise.prototype._enoughBranchesHaveCancelled = function() {\n    return this._branchesRemainingToCancel === undefined ||\n           this._branchesRemainingToCancel <= 0;\n};\n\nPromise.prototype._cancelBy = function(canceller) {\n    if (canceller === this) {\n        this._branchesRemainingToCancel = 0;\n        this._invokeOnCancel();\n        return true;\n    } else {\n        this._branchHasCancelled();\n        if (this._enoughBranchesHaveCancelled()) {\n            this._invokeOnCancel();\n            return true;\n        }\n    }\n    return false;\n};\n\nPromise.prototype._cancelBranched = function() {\n    if (this._enoughBranchesHaveCancelled()) {\n        this._cancel();\n    }\n};\n\nPromise.prototype._cancel = function() {\n    if (!this._isCancellable()) return;\n    this._setCancelled();\n    async.invoke(this._cancelPromises, this, undefined);\n};\n\nPromise.prototype._cancelPromises = function() {\n    if (this._length() > 0) this._settlePromises();\n};\n\nPromise.prototype._unsetOnCancel = function() {\n    this._onCancelField = undefined;\n};\n\nPromise.prototype._isCancellable = function() {\n    return this.isPending() && !this._isCancelled();\n};\n\nPromise.prototype.isCancellable = function() {\n    return this.isPending() && !this.isCancelled();\n};\n\nPromise.prototype._doInvokeOnCancel = function(onCancelCallback, internalOnly) {\n    if (util.isArray(onCancelCallback)) {\n        for (var i = 0; i < onCancelCallback.length; ++i) {\n            this._doInvokeOnCancel(onCancelCallback[i], internalOnly);\n        }\n    } else if (onCancelCallback !== undefined) {\n        if (typeof onCancelCallback === \"function\") {\n            if (!internalOnly) {\n                var e = tryCatch(onCancelCallback).call(this._boundValue());\n                if (e === errorObj) {\n                    this._attachExtraTrace(e.e);\n                    async.throwLater(e.e);\n                }\n            }\n        } else {\n            onCancelCallback._resultCancelled(this);\n        }\n    }\n};\n\nPromise.prototype._invokeOnCancel = function() {\n    var onCancelCallback = this._onCancel();\n    this._unsetOnCancel();\n    async.invoke(this._doInvokeOnCancel, this, onCancelCallback);\n};\n\nPromise.prototype._invokeInternalOnCancel = function() {\n    if (this._isCancellable()) {\n        this._doInvokeOnCancel(this._onCancel(), true);\n        this._unsetOnCancel();\n    }\n};\n\nPromise.prototype._resultCancelled = function() {\n    this.cancel();\n};\n\n};\n\n},{\"./util\":36}],7:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(NEXT_FILTER) {\nvar util = _dereq_(\"./util\");\nvar getKeys = _dereq_(\"./es5\").keys;\nvar tryCatch = util.tryCatch;\nvar errorObj = util.errorObj;\n\nfunction catchFilter(instances, cb, promise) {\n    return function(e) {\n        var boundTo = promise._boundValue();\n        predicateLoop: for (var i = 0; i < instances.length; ++i) {\n            var item = instances[i];\n\n            if (item === Error ||\n                (item != null && item.prototype instanceof Error)) {\n                if (e instanceof item) {\n                    return tryCatch(cb).call(boundTo, e);\n                }\n            } else if (typeof item === \"function\") {\n                var matchesPredicate = tryCatch(item).call(boundTo, e);\n                if (matchesPredicate === errorObj) {\n                    return matchesPredicate;\n                } else if (matchesPredicate) {\n                    return tryCatch(cb).call(boundTo, e);\n                }\n            } else if (util.isObject(e)) {\n                var keys = getKeys(item);\n                for (var j = 0; j < keys.length; ++j) {\n                    var key = keys[j];\n                    if (item[key] != e[key]) {\n                        continue predicateLoop;\n                    }\n                }\n                return tryCatch(cb).call(boundTo, e);\n            }\n        }\n        return NEXT_FILTER;\n    };\n}\n\nreturn catchFilter;\n};\n\n},{\"./es5\":13,\"./util\":36}],8:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise) {\nvar longStackTraces = false;\nvar contextStack = [];\n\nPromise.prototype._promiseCreated = function() {};\nPromise.prototype._pushContext = function() {};\nPromise.prototype._popContext = function() {return null;};\nPromise._peekContext = Promise.prototype._peekContext = function() {};\n\nfunction Context() {\n    this._trace = new Context.CapturedTrace(peekContext());\n}\nContext.prototype._pushContext = function () {\n    if (this._trace !== undefined) {\n        this._trace._promiseCreated = null;\n        contextStack.push(this._trace);\n    }\n};\n\nContext.prototype._popContext = function () {\n    if (this._trace !== undefined) {\n        var trace = contextStack.pop();\n        var ret = trace._promiseCreated;\n        trace._promiseCreated = null;\n        return ret;\n    }\n    return null;\n};\n\nfunction createContext() {\n    if (longStackTraces) return new Context();\n}\n\nfunction peekContext() {\n    var lastIndex = contextStack.length - 1;\n    if (lastIndex >= 0) {\n        return contextStack[lastIndex];\n    }\n    return undefined;\n}\nContext.CapturedTrace = null;\nContext.create = createContext;\nContext.deactivateLongStackTraces = function() {};\nContext.activateLongStackTraces = function() {\n    var Promise_pushContext = Promise.prototype._pushContext;\n    var Promise_popContext = Promise.prototype._popContext;\n    var Promise_PeekContext = Promise._peekContext;\n    var Promise_peekContext = Promise.prototype._peekContext;\n    var Promise_promiseCreated = Promise.prototype._promiseCreated;\n    Context.deactivateLongStackTraces = function() {\n        Promise.prototype._pushContext = Promise_pushContext;\n        Promise.prototype._popContext = Promise_popContext;\n        Promise._peekContext = Promise_PeekContext;\n        Promise.prototype._peekContext = Promise_peekContext;\n        Promise.prototype._promiseCreated = Promise_promiseCreated;\n        longStackTraces = false;\n    };\n    longStackTraces = true;\n    Promise.prototype._pushContext = Context.prototype._pushContext;\n    Promise.prototype._popContext = Context.prototype._popContext;\n    Promise._peekContext = Promise.prototype._peekContext = peekContext;\n    Promise.prototype._promiseCreated = function() {\n        var ctx = this._peekContext();\n        if (ctx && ctx._promiseCreated == null) ctx._promiseCreated = this;\n    };\n};\nreturn Context;\n};\n\n},{}],9:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise, Context,\n    enableAsyncHooks, disableAsyncHooks) {\nvar async = Promise._async;\nvar Warning = _dereq_(\"./errors\").Warning;\nvar util = _dereq_(\"./util\");\nvar es5 = _dereq_(\"./es5\");\nvar canAttachTrace = util.canAttachTrace;\nvar unhandledRejectionHandled;\nvar possiblyUnhandledRejection;\nvar bluebirdFramePattern =\n    /[\\\\\\/]bluebird[\\\\\\/]js[\\\\\\/](release|debug|instrumented)/;\nvar nodeFramePattern = /\\((?:timers\\.js):\\d+:\\d+\\)/;\nvar parseLinePattern = /[\\/<\\(](.+?):(\\d+):(\\d+)\\)?\\s*$/;\nvar stackFramePattern = null;\nvar formatStack = null;\nvar indentStackFrames = false;\nvar printWarning;\nvar debugging = !!(util.env(\"BLUEBIRD_DEBUG\") != 0 &&\n                        (true ||\n                         util.env(\"BLUEBIRD_DEBUG\") ||\n                         util.env(\"NODE_ENV\") === \"development\"));\n\nvar warnings = !!(util.env(\"BLUEBIRD_WARNINGS\") != 0 &&\n    (debugging || util.env(\"BLUEBIRD_WARNINGS\")));\n\nvar longStackTraces = !!(util.env(\"BLUEBIRD_LONG_STACK_TRACES\") != 0 &&\n    (debugging || util.env(\"BLUEBIRD_LONG_STACK_TRACES\")));\n\nvar wForgottenReturn = util.env(\"BLUEBIRD_W_FORGOTTEN_RETURN\") != 0 &&\n    (warnings || !!util.env(\"BLUEBIRD_W_FORGOTTEN_RETURN\"));\n\nvar deferUnhandledRejectionCheck;\n(function() {\n    var promises = [];\n\n    function unhandledRejectionCheck() {\n        for (var i = 0; i < promises.length; ++i) {\n            promises[i]._notifyUnhandledRejection();\n        }\n        unhandledRejectionClear();\n    }\n\n    function unhandledRejectionClear() {\n        promises.length = 0;\n    }\n\n    deferUnhandledRejectionCheck = function(promise) {\n        promises.push(promise);\n        setTimeout(unhandledRejectionCheck, 1);\n    };\n\n    es5.defineProperty(Promise, \"_unhandledRejectionCheck\", {\n        value: unhandledRejectionCheck\n    });\n    es5.defineProperty(Promise, \"_unhandledRejectionClear\", {\n        value: unhandledRejectionClear\n    });\n})();\n\nPromise.prototype.suppressUnhandledRejections = function() {\n    var target = this._target();\n    target._bitField = ((target._bitField & (~1048576)) |\n                      524288);\n};\n\nPromise.prototype._ensurePossibleRejectionHandled = function () {\n    if ((this._bitField & 524288) !== 0) return;\n    this._setRejectionIsUnhandled();\n    deferUnhandledRejectionCheck(this);\n};\n\nPromise.prototype._notifyUnhandledRejectionIsHandled = function () {\n    fireRejectionEvent(\"rejectionHandled\",\n                                  unhandledRejectionHandled, undefined, this);\n};\n\nPromise.prototype._setReturnedNonUndefined = function() {\n    this._bitField = this._bitField | 268435456;\n};\n\nPromise.prototype._returnedNonUndefined = function() {\n    return (this._bitField & 268435456) !== 0;\n};\n\nPromise.prototype._notifyUnhandledRejection = function () {\n    if (this._isRejectionUnhandled()) {\n        var reason = this._settledValue();\n        this._setUnhandledRejectionIsNotified();\n        fireRejectionEvent(\"unhandledRejection\",\n                                      possiblyUnhandledRejection, reason, this);\n    }\n};\n\nPromise.prototype._setUnhandledRejectionIsNotified = function () {\n    this._bitField = this._bitField | 262144;\n};\n\nPromise.prototype._unsetUnhandledRejectionIsNotified = function () {\n    this._bitField = this._bitField & (~262144);\n};\n\nPromise.prototype._isUnhandledRejectionNotified = function () {\n    return (this._bitField & 262144) > 0;\n};\n\nPromise.prototype._setRejectionIsUnhandled = function () {\n    this._bitField = this._bitField | 1048576;\n};\n\nPromise.prototype._unsetRejectionIsUnhandled = function () {\n    this._bitField = this._bitField & (~1048576);\n    if (this._isUnhandledRejectionNotified()) {\n        this._unsetUnhandledRejectionIsNotified();\n        this._notifyUnhandledRejectionIsHandled();\n    }\n};\n\nPromise.prototype._isRejectionUnhandled = function () {\n    return (this._bitField & 1048576) > 0;\n};\n\nPromise.prototype._warn = function(message, shouldUseOwnTrace, promise) {\n    return warn(message, shouldUseOwnTrace, promise || this);\n};\n\nPromise.onPossiblyUnhandledRejection = function (fn) {\n    var context = Promise._getContext();\n    possiblyUnhandledRejection = util.contextBind(context, fn);\n};\n\nPromise.onUnhandledRejectionHandled = function (fn) {\n    var context = Promise._getContext();\n    unhandledRejectionHandled = util.contextBind(context, fn);\n};\n\nvar disableLongStackTraces = function() {};\nPromise.longStackTraces = function () {\n    if (async.haveItemsQueued() && !config.longStackTraces) {\n        throw new Error(\"cannot enable long stack traces after promises have been created\\u000a\\u000a    See http://goo.gl/MqrFmX\\u000a\");\n    }\n    if (!config.longStackTraces && longStackTracesIsSupported()) {\n        var Promise_captureStackTrace = Promise.prototype._captureStackTrace;\n        var Promise_attachExtraTrace = Promise.prototype._attachExtraTrace;\n        var Promise_dereferenceTrace = Promise.prototype._dereferenceTrace;\n        config.longStackTraces = true;\n        disableLongStackTraces = function() {\n            if (async.haveItemsQueued() && !config.longStackTraces) {\n                throw new Error(\"cannot enable long stack traces after promises have been created\\u000a\\u000a    See http://goo.gl/MqrFmX\\u000a\");\n            }\n            Promise.prototype._captureStackTrace = Promise_captureStackTrace;\n            Promise.prototype._attachExtraTrace = Promise_attachExtraTrace;\n            Promise.prototype._dereferenceTrace = Promise_dereferenceTrace;\n            Context.deactivateLongStackTraces();\n            config.longStackTraces = false;\n        };\n        Promise.prototype._captureStackTrace = longStackTracesCaptureStackTrace;\n        Promise.prototype._attachExtraTrace = longStackTracesAttachExtraTrace;\n        Promise.prototype._dereferenceTrace = longStackTracesDereferenceTrace;\n        Context.activateLongStackTraces();\n    }\n};\n\nPromise.hasLongStackTraces = function () {\n    return config.longStackTraces && longStackTracesIsSupported();\n};\n\n\nvar legacyHandlers = {\n    unhandledrejection: {\n        before: function() {\n            var ret = util.global.onunhandledrejection;\n            util.global.onunhandledrejection = null;\n            return ret;\n        },\n        after: function(fn) {\n            util.global.onunhandledrejection = fn;\n        }\n    },\n    rejectionhandled: {\n        before: function() {\n            var ret = util.global.onrejectionhandled;\n            util.global.onrejectionhandled = null;\n            return ret;\n        },\n        after: function(fn) {\n            util.global.onrejectionhandled = fn;\n        }\n    }\n};\n\nvar fireDomEvent = (function() {\n    var dispatch = function(legacy, e) {\n        if (legacy) {\n            var fn;\n            try {\n                fn = legacy.before();\n                return !util.global.dispatchEvent(e);\n            } finally {\n                legacy.after(fn);\n            }\n        } else {\n            return !util.global.dispatchEvent(e);\n        }\n    };\n    try {\n        if (typeof CustomEvent === \"function\") {\n            var event = new CustomEvent(\"CustomEvent\");\n            util.global.dispatchEvent(event);\n            return function(name, event) {\n                name = name.toLowerCase();\n                var eventData = {\n                    detail: event,\n                    cancelable: true\n                };\n                var domEvent = new CustomEvent(name, eventData);\n                es5.defineProperty(\n                    domEvent, \"promise\", {value: event.promise});\n                es5.defineProperty(\n                    domEvent, \"reason\", {value: event.reason});\n\n                return dispatch(legacyHandlers[name], domEvent);\n            };\n        } else if (typeof Event === \"function\") {\n            var event = new Event(\"CustomEvent\");\n            util.global.dispatchEvent(event);\n            return function(name, event) {\n                name = name.toLowerCase();\n                var domEvent = new Event(name, {\n                    cancelable: true\n                });\n                domEvent.detail = event;\n                es5.defineProperty(domEvent, \"promise\", {value: event.promise});\n                es5.defineProperty(domEvent, \"reason\", {value: event.reason});\n                return dispatch(legacyHandlers[name], domEvent);\n            };\n        } else {\n            var event = document.createEvent(\"CustomEvent\");\n            event.initCustomEvent(\"testingtheevent\", false, true, {});\n            util.global.dispatchEvent(event);\n            return function(name, event) {\n                name = name.toLowerCase();\n                var domEvent = document.createEvent(\"CustomEvent\");\n                domEvent.initCustomEvent(name, false, true,\n                    event);\n                return dispatch(legacyHandlers[name], domEvent);\n            };\n        }\n    } catch (e) {}\n    return function() {\n        return false;\n    };\n})();\n\nvar fireGlobalEvent = (function() {\n    if (util.isNode) {\n        return function() {\n            return process.emit.apply(process, arguments);\n        };\n    } else {\n        if (!util.global) {\n            return function() {\n                return false;\n            };\n        }\n        return function(name) {\n            var methodName = \"on\" + name.toLowerCase();\n            var method = util.global[methodName];\n            if (!method) return false;\n            method.apply(util.global, [].slice.call(arguments, 1));\n            return true;\n        };\n    }\n})();\n\nfunction generatePromiseLifecycleEventObject(name, promise) {\n    return {promise: promise};\n}\n\nvar eventToObjectGenerator = {\n    promiseCreated: generatePromiseLifecycleEventObject,\n    promiseFulfilled: generatePromiseLifecycleEventObject,\n    promiseRejected: generatePromiseLifecycleEventObject,\n    promiseResolved: generatePromiseLifecycleEventObject,\n    promiseCancelled: generatePromiseLifecycleEventObject,\n    promiseChained: function(name, promise, child) {\n        return {promise: promise, child: child};\n    },\n    warning: function(name, warning) {\n        return {warning: warning};\n    },\n    unhandledRejection: function (name, reason, promise) {\n        return {reason: reason, promise: promise};\n    },\n    rejectionHandled: generatePromiseLifecycleEventObject\n};\n\nvar activeFireEvent = function (name) {\n    var globalEventFired = false;\n    try {\n        globalEventFired = fireGlobalEvent.apply(null, arguments);\n    } catch (e) {\n        async.throwLater(e);\n        globalEventFired = true;\n    }\n\n    var domEventFired = false;\n    try {\n        domEventFired = fireDomEvent(name,\n                    eventToObjectGenerator[name].apply(null, arguments));\n    } catch (e) {\n        async.throwLater(e);\n        domEventFired = true;\n    }\n\n    return domEventFired || globalEventFired;\n};\n\nPromise.config = function(opts) {\n    opts = Object(opts);\n    if (\"longStackTraces\" in opts) {\n        if (opts.longStackTraces) {\n            Promise.longStackTraces();\n        } else if (!opts.longStackTraces && Promise.hasLongStackTraces()) {\n            disableLongStackTraces();\n        }\n    }\n    if (\"warnings\" in opts) {\n        var warningsOption = opts.warnings;\n        config.warnings = !!warningsOption;\n        wForgottenReturn = config.warnings;\n\n        if (util.isObject(warningsOption)) {\n            if (\"wForgottenReturn\" in warningsOption) {\n                wForgottenReturn = !!warningsOption.wForgottenReturn;\n            }\n        }\n    }\n    if (\"cancellation\" in opts && opts.cancellation && !config.cancellation) {\n        if (async.haveItemsQueued()) {\n            throw new Error(\n                \"cannot enable cancellation after promises are in use\");\n        }\n        Promise.prototype._clearCancellationData =\n            cancellationClearCancellationData;\n        Promise.prototype._propagateFrom = cancellationPropagateFrom;\n        Promise.prototype._onCancel = cancellationOnCancel;\n        Promise.prototype._setOnCancel = cancellationSetOnCancel;\n        Promise.prototype._attachCancellationCallback =\n            cancellationAttachCancellationCallback;\n        Promise.prototype._execute = cancellationExecute;\n        propagateFromFunction = cancellationPropagateFrom;\n        config.cancellation = true;\n    }\n    if (\"monitoring\" in opts) {\n        if (opts.monitoring && !config.monitoring) {\n            config.monitoring = true;\n            Promise.prototype._fireEvent = activeFireEvent;\n        } else if (!opts.monitoring && config.monitoring) {\n            config.monitoring = false;\n            Promise.prototype._fireEvent = defaultFireEvent;\n        }\n    }\n    if (\"asyncHooks\" in opts && util.nodeSupportsAsyncResource) {\n        var prev = config.asyncHooks;\n        var cur = !!opts.asyncHooks;\n        if (prev !== cur) {\n            config.asyncHooks = cur;\n            if (cur) {\n                enableAsyncHooks();\n            } else {\n                disableAsyncHooks();\n            }\n        }\n    }\n    return Promise;\n};\n\nfunction defaultFireEvent() { return false; }\n\nPromise.prototype._fireEvent = defaultFireEvent;\nPromise.prototype._execute = function(executor, resolve, reject) {\n    try {\n        executor(resolve, reject);\n    } catch (e) {\n        return e;\n    }\n};\nPromise.prototype._onCancel = function () {};\nPromise.prototype._setOnCancel = function (handler) { ; };\nPromise.prototype._attachCancellationCallback = function(onCancel) {\n    ;\n};\nPromise.prototype._captureStackTrace = function () {};\nPromise.prototype._attachExtraTrace = function () {};\nPromise.prototype._dereferenceTrace = function () {};\nPromise.prototype._clearCancellationData = function() {};\nPromise.prototype._propagateFrom = function (parent, flags) {\n    ;\n    ;\n};\n\nfunction cancellationExecute(executor, resolve, reject) {\n    var promise = this;\n    try {\n        executor(resolve, reject, function(onCancel) {\n            if (typeof onCancel !== \"function\") {\n                throw new TypeError(\"onCancel must be a function, got: \" +\n                                    util.toString(onCancel));\n            }\n            promise._attachCancellationCallback(onCancel);\n        });\n    } catch (e) {\n        return e;\n    }\n}\n\nfunction cancellationAttachCancellationCallback(onCancel) {\n    if (!this._isCancellable()) return this;\n\n    var previousOnCancel = this._onCancel();\n    if (previousOnCancel !== undefined) {\n        if (util.isArray(previousOnCancel)) {\n            previousOnCancel.push(onCancel);\n        } else {\n            this._setOnCancel([previousOnCancel, onCancel]);\n        }\n    } else {\n        this._setOnCancel(onCancel);\n    }\n}\n\nfunction cancellationOnCancel() {\n    return this._onCancelField;\n}\n\nfunction cancellationSetOnCancel(onCancel) {\n    this._onCancelField = onCancel;\n}\n\nfunction cancellationClearCancellationData() {\n    this._cancellationParent = undefined;\n    this._onCancelField = undefined;\n}\n\nfunction cancellationPropagateFrom(parent, flags) {\n    if ((flags & 1) !== 0) {\n        this._cancellationParent = parent;\n        var branchesRemainingToCancel = parent._branchesRemainingToCancel;\n        if (branchesRemainingToCancel === undefined) {\n            branchesRemainingToCancel = 0;\n        }\n        parent._branchesRemainingToCancel = branchesRemainingToCancel + 1;\n    }\n    if ((flags & 2) !== 0 && parent._isBound()) {\n        this._setBoundTo(parent._boundTo);\n    }\n}\n\nfunction bindingPropagateFrom(parent, flags) {\n    if ((flags & 2) !== 0 && parent._isBound()) {\n        this._setBoundTo(parent._boundTo);\n    }\n}\nvar propagateFromFunction = bindingPropagateFrom;\n\nfunction boundValueFunction() {\n    var ret = this._boundTo;\n    if (ret !== undefined) {\n        if (ret instanceof Promise) {\n            if (ret.isFulfilled()) {\n                return ret.value();\n            } else {\n                return undefined;\n            }\n        }\n    }\n    return ret;\n}\n\nfunction longStackTracesCaptureStackTrace() {\n    this._trace = new CapturedTrace(this._peekContext());\n}\n\nfunction longStackTracesAttachExtraTrace(error, ignoreSelf) {\n    if (canAttachTrace(error)) {\n        var trace = this._trace;\n        if (trace !== undefined) {\n            if (ignoreSelf) trace = trace._parent;\n        }\n        if (trace !== undefined) {\n            trace.attachExtraTrace(error);\n        } else if (!error.__stackCleaned__) {\n            var parsed = parseStackAndMessage(error);\n            util.notEnumerableProp(error, \"stack\",\n                parsed.message + \"\\n\" + parsed.stack.join(\"\\n\"));\n            util.notEnumerableProp(error, \"__stackCleaned__\", true);\n        }\n    }\n}\n\nfunction longStackTracesDereferenceTrace() {\n    this._trace = undefined;\n}\n\nfunction checkForgottenReturns(returnValue, promiseCreated, name, promise,\n                               parent) {\n    if (returnValue === undefined && promiseCreated !== null &&\n        wForgottenReturn) {\n        if (parent !== undefined && parent._returnedNonUndefined()) return;\n        if ((promise._bitField & 65535) === 0) return;\n\n        if (name) name = name + \" \";\n        var handlerLine = \"\";\n        var creatorLine = \"\";\n        if (promiseCreated._trace) {\n            var traceLines = promiseCreated._trace.stack.split(\"\\n\");\n            var stack = cleanStack(traceLines);\n            for (var i = stack.length - 1; i >= 0; --i) {\n                var line = stack[i];\n                if (!nodeFramePattern.test(line)) {\n                    var lineMatches = line.match(parseLinePattern);\n                    if (lineMatches) {\n                        handlerLine  = \"at \" + lineMatches[1] +\n                            \":\" + lineMatches[2] + \":\" + lineMatches[3] + \" \";\n                    }\n                    break;\n                }\n            }\n\n            if (stack.length > 0) {\n                var firstUserLine = stack[0];\n                for (var i = 0; i < traceLines.length; ++i) {\n\n                    if (traceLines[i] === firstUserLine) {\n                        if (i > 0) {\n                            creatorLine = \"\\n\" + traceLines[i - 1];\n                        }\n                        break;\n                    }\n                }\n\n            }\n        }\n        var msg = \"a promise was created in a \" + name +\n            \"handler \" + handlerLine + \"but was not returned from it, \" +\n            \"see http://goo.gl/rRqMUw\" +\n            creatorLine;\n        promise._warn(msg, true, promiseCreated);\n    }\n}\n\nfunction deprecated(name, replacement) {\n    var message = name +\n        \" is deprecated and will be removed in a future version.\";\n    if (replacement) message += \" Use \" + replacement + \" instead.\";\n    return warn(message);\n}\n\nfunction warn(message, shouldUseOwnTrace, promise) {\n    if (!config.warnings) return;\n    var warning = new Warning(message);\n    var ctx;\n    if (shouldUseOwnTrace) {\n        promise._attachExtraTrace(warning);\n    } else if (config.longStackTraces && (ctx = Promise._peekContext())) {\n        ctx.attachExtraTrace(warning);\n    } else {\n        var parsed = parseStackAndMessage(warning);\n        warning.stack = parsed.message + \"\\n\" + parsed.stack.join(\"\\n\");\n    }\n\n    if (!activeFireEvent(\"warning\", warning)) {\n        formatAndLogError(warning, \"\", true);\n    }\n}\n\nfunction reconstructStack(message, stacks) {\n    for (var i = 0; i < stacks.length - 1; ++i) {\n        stacks[i].push(\"From previous event:\");\n        stacks[i] = stacks[i].join(\"\\n\");\n    }\n    if (i < stacks.length) {\n        stacks[i] = stacks[i].join(\"\\n\");\n    }\n    return message + \"\\n\" + stacks.join(\"\\n\");\n}\n\nfunction removeDuplicateOrEmptyJumps(stacks) {\n    for (var i = 0; i < stacks.length; ++i) {\n        if (stacks[i].length === 0 ||\n            ((i + 1 < stacks.length) && stacks[i][0] === stacks[i+1][0])) {\n            stacks.splice(i, 1);\n            i--;\n        }\n    }\n}\n\nfunction removeCommonRoots(stacks) {\n    var current = stacks[0];\n    for (var i = 1; i < stacks.length; ++i) {\n        var prev = stacks[i];\n        var currentLastIndex = current.length - 1;\n        var currentLastLine = current[currentLastIndex];\n        var commonRootMeetPoint = -1;\n\n        for (var j = prev.length - 1; j >= 0; --j) {\n            if (prev[j] === currentLastLine) {\n                commonRootMeetPoint = j;\n                break;\n            }\n        }\n\n        for (var j = commonRootMeetPoint; j >= 0; --j) {\n            var line = prev[j];\n            if (current[currentLastIndex] === line) {\n                current.pop();\n                currentLastIndex--;\n            } else {\n                break;\n            }\n        }\n        current = prev;\n    }\n}\n\nfunction cleanStack(stack) {\n    var ret = [];\n    for (var i = 0; i < stack.length; ++i) {\n        var line = stack[i];\n        var isTraceLine = \"    (No stack trace)\" === line ||\n            stackFramePattern.test(line);\n        var isInternalFrame = isTraceLine && shouldIgnore(line);\n        if (isTraceLine && !isInternalFrame) {\n            if (indentStackFrames && line.charAt(0) !== \" \") {\n                line = \"    \" + line;\n            }\n            ret.push(line);\n        }\n    }\n    return ret;\n}\n\nfunction stackFramesAsArray(error) {\n    var stack = error.stack.replace(/\\s+$/g, \"\").split(\"\\n\");\n    for (var i = 0; i < stack.length; ++i) {\n        var line = stack[i];\n        if (\"    (No stack trace)\" === line || stackFramePattern.test(line)) {\n            break;\n        }\n    }\n    if (i > 0 && error.name != \"SyntaxError\") {\n        stack = stack.slice(i);\n    }\n    return stack;\n}\n\nfunction parseStackAndMessage(error) {\n    var stack = error.stack;\n    var message = error.toString();\n    stack = typeof stack === \"string\" && stack.length > 0\n                ? stackFramesAsArray(error) : [\"    (No stack trace)\"];\n    return {\n        message: message,\n        stack: error.name == \"SyntaxError\" ? stack : cleanStack(stack)\n    };\n}\n\nfunction formatAndLogError(error, title, isSoft) {\n    if (typeof console !== \"undefined\") {\n        var message;\n        if (util.isObject(error)) {\n            var stack = error.stack;\n            message = title + formatStack(stack, error);\n        } else {\n            message = title + String(error);\n        }\n        if (typeof printWarning === \"function\") {\n            printWarning(message, isSoft);\n        } else if (typeof console.log === \"function\" ||\n            typeof console.log === \"object\") {\n            console.log(message);\n        }\n    }\n}\n\nfunction fireRejectionEvent(name, localHandler, reason, promise) {\n    var localEventFired = false;\n    try {\n        if (typeof localHandler === \"function\") {\n            localEventFired = true;\n            if (name === \"rejectionHandled\") {\n                localHandler(promise);\n            } else {\n                localHandler(reason, promise);\n            }\n        }\n    } catch (e) {\n        async.throwLater(e);\n    }\n\n    if (name === \"unhandledRejection\") {\n        if (!activeFireEvent(name, reason, promise) && !localEventFired) {\n            formatAndLogError(reason, \"Unhandled rejection \");\n        }\n    } else {\n        activeFireEvent(name, promise);\n    }\n}\n\nfunction formatNonError(obj) {\n    var str;\n    if (typeof obj === \"function\") {\n        str = \"[function \" +\n            (obj.name || \"anonymous\") +\n            \"]\";\n    } else {\n        str = obj && typeof obj.toString === \"function\"\n            ? obj.toString() : util.toString(obj);\n        var ruselessToString = /\\[object [a-zA-Z0-9$_]+\\]/;\n        if (ruselessToString.test(str)) {\n            try {\n                var newStr = JSON.stringify(obj);\n                str = newStr;\n            }\n            catch(e) {\n\n            }\n        }\n        if (str.length === 0) {\n            str = \"(empty array)\";\n        }\n    }\n    return (\"(<\" + snip(str) + \">, no stack trace)\");\n}\n\nfunction snip(str) {\n    var maxChars = 41;\n    if (str.length < maxChars) {\n        return str;\n    }\n    return str.substr(0, maxChars - 3) + \"...\";\n}\n\nfunction longStackTracesIsSupported() {\n    return typeof captureStackTrace === \"function\";\n}\n\nvar shouldIgnore = function() { return false; };\nvar parseLineInfoRegex = /[\\/<\\(]([^:\\/]+):(\\d+):(?:\\d+)\\)?\\s*$/;\nfunction parseLineInfo(line) {\n    var matches = line.match(parseLineInfoRegex);\n    if (matches) {\n        return {\n            fileName: matches[1],\n            line: parseInt(matches[2], 10)\n        };\n    }\n}\n\nfunction setBounds(firstLineError, lastLineError) {\n    if (!longStackTracesIsSupported()) return;\n    var firstStackLines = (firstLineError.stack || \"\").split(\"\\n\");\n    var lastStackLines = (lastLineError.stack || \"\").split(\"\\n\");\n    var firstIndex = -1;\n    var lastIndex = -1;\n    var firstFileName;\n    var lastFileName;\n    for (var i = 0; i < firstStackLines.length; ++i) {\n        var result = parseLineInfo(firstStackLines[i]);\n        if (result) {\n            firstFileName = result.fileName;\n            firstIndex = result.line;\n            break;\n        }\n    }\n    for (var i = 0; i < lastStackLines.length; ++i) {\n        var result = parseLineInfo(lastStackLines[i]);\n        if (result) {\n            lastFileName = result.fileName;\n            lastIndex = result.line;\n            break;\n        }\n    }\n    if (firstIndex < 0 || lastIndex < 0 || !firstFileName || !lastFileName ||\n        firstFileName !== lastFileName || firstIndex >= lastIndex) {\n        return;\n    }\n\n    shouldIgnore = function(line) {\n        if (bluebirdFramePattern.test(line)) return true;\n        var info = parseLineInfo(line);\n        if (info) {\n            if (info.fileName === firstFileName &&\n                (firstIndex <= info.line && info.line <= lastIndex)) {\n                return true;\n            }\n        }\n        return false;\n    };\n}\n\nfunction CapturedTrace(parent) {\n    this._parent = parent;\n    this._promisesCreated = 0;\n    var length = this._length = 1 + (parent === undefined ? 0 : parent._length);\n    captureStackTrace(this, CapturedTrace);\n    if (length > 32) this.uncycle();\n}\nutil.inherits(CapturedTrace, Error);\nContext.CapturedTrace = CapturedTrace;\n\nCapturedTrace.prototype.uncycle = function() {\n    var length = this._length;\n    if (length < 2) return;\n    var nodes = [];\n    var stackToIndex = {};\n\n    for (var i = 0, node = this; node !== undefined; ++i) {\n        nodes.push(node);\n        node = node._parent;\n    }\n    length = this._length = i;\n    for (var i = length - 1; i >= 0; --i) {\n        var stack = nodes[i].stack;\n        if (stackToIndex[stack] === undefined) {\n            stackToIndex[stack] = i;\n        }\n    }\n    for (var i = 0; i < length; ++i) {\n        var currentStack = nodes[i].stack;\n        var index = stackToIndex[currentStack];\n        if (index !== undefined && index !== i) {\n            if (index > 0) {\n                nodes[index - 1]._parent = undefined;\n                nodes[index - 1]._length = 1;\n            }\n            nodes[i]._parent = undefined;\n            nodes[i]._length = 1;\n            var cycleEdgeNode = i > 0 ? nodes[i - 1] : this;\n\n            if (index < length - 1) {\n                cycleEdgeNode._parent = nodes[index + 1];\n                cycleEdgeNode._parent.uncycle();\n                cycleEdgeNode._length =\n                    cycleEdgeNode._parent._length + 1;\n            } else {\n                cycleEdgeNode._parent = undefined;\n                cycleEdgeNode._length = 1;\n            }\n            var currentChildLength = cycleEdgeNode._length + 1;\n            for (var j = i - 2; j >= 0; --j) {\n                nodes[j]._length = currentChildLength;\n                currentChildLength++;\n            }\n            return;\n        }\n    }\n};\n\nCapturedTrace.prototype.attachExtraTrace = function(error) {\n    if (error.__stackCleaned__) return;\n    this.uncycle();\n    var parsed = parseStackAndMessage(error);\n    var message = parsed.message;\n    var stacks = [parsed.stack];\n\n    var trace = this;\n    while (trace !== undefined) {\n        stacks.push(cleanStack(trace.stack.split(\"\\n\")));\n        trace = trace._parent;\n    }\n    removeCommonRoots(stacks);\n    removeDuplicateOrEmptyJumps(stacks);\n    util.notEnumerableProp(error, \"stack\", reconstructStack(message, stacks));\n    util.notEnumerableProp(error, \"__stackCleaned__\", true);\n};\n\nvar captureStackTrace = (function stackDetection() {\n    var v8stackFramePattern = /^\\s*at\\s*/;\n    var v8stackFormatter = function(stack, error) {\n        if (typeof stack === \"string\") return stack;\n\n        if (error.name !== undefined &&\n            error.message !== undefined) {\n            return error.toString();\n        }\n        return formatNonError(error);\n    };\n\n    if (typeof Error.stackTraceLimit === \"number\" &&\n        typeof Error.captureStackTrace === \"function\") {\n        Error.stackTraceLimit += 6;\n        stackFramePattern = v8stackFramePattern;\n        formatStack = v8stackFormatter;\n        var captureStackTrace = Error.captureStackTrace;\n\n        shouldIgnore = function(line) {\n            return bluebirdFramePattern.test(line);\n        };\n        return function(receiver, ignoreUntil) {\n            Error.stackTraceLimit += 6;\n            captureStackTrace(receiver, ignoreUntil);\n            Error.stackTraceLimit -= 6;\n        };\n    }\n    var err = new Error();\n\n    if (typeof err.stack === \"string\" &&\n        err.stack.split(\"\\n\")[0].indexOf(\"stackDetection@\") >= 0) {\n        stackFramePattern = /@/;\n        formatStack = v8stackFormatter;\n        indentStackFrames = true;\n        return function captureStackTrace(o) {\n            o.stack = new Error().stack;\n        };\n    }\n\n    var hasStackAfterThrow;\n    try { throw new Error(); }\n    catch(e) {\n        hasStackAfterThrow = (\"stack\" in e);\n    }\n    if (!(\"stack\" in err) && hasStackAfterThrow &&\n        typeof Error.stackTraceLimit === \"number\") {\n        stackFramePattern = v8stackFramePattern;\n        formatStack = v8stackFormatter;\n        return function captureStackTrace(o) {\n            Error.stackTraceLimit += 6;\n            try { throw new Error(); }\n            catch(e) { o.stack = e.stack; }\n            Error.stackTraceLimit -= 6;\n        };\n    }\n\n    formatStack = function(stack, error) {\n        if (typeof stack === \"string\") return stack;\n\n        if ((typeof error === \"object\" ||\n            typeof error === \"function\") &&\n            error.name !== undefined &&\n            error.message !== undefined) {\n            return error.toString();\n        }\n        return formatNonError(error);\n    };\n\n    return null;\n\n})([]);\n\nif (typeof console !== \"undefined\" && typeof console.warn !== \"undefined\") {\n    printWarning = function (message) {\n        console.warn(message);\n    };\n    if (util.isNode && process.stderr.isTTY) {\n        printWarning = function(message, isSoft) {\n            var color = isSoft ? \"\\u001b[33m\" : \"\\u001b[31m\";\n            console.warn(color + message + \"\\u001b[0m\\n\");\n        };\n    } else if (!util.isNode && typeof (new Error().stack) === \"string\") {\n        printWarning = function(message, isSoft) {\n            console.warn(\"%c\" + message,\n                        isSoft ? \"color: darkorange\" : \"color: red\");\n        };\n    }\n}\n\nvar config = {\n    warnings: warnings,\n    longStackTraces: false,\n    cancellation: false,\n    monitoring: false,\n    asyncHooks: false\n};\n\nif (longStackTraces) Promise.longStackTraces();\n\nreturn {\n    asyncHooks: function() {\n        return config.asyncHooks;\n    },\n    longStackTraces: function() {\n        return config.longStackTraces;\n    },\n    warnings: function() {\n        return config.warnings;\n    },\n    cancellation: function() {\n        return config.cancellation;\n    },\n    monitoring: function() {\n        return config.monitoring;\n    },\n    propagateFromFunction: function() {\n        return propagateFromFunction;\n    },\n    boundValueFunction: function() {\n        return boundValueFunction;\n    },\n    checkForgottenReturns: checkForgottenReturns,\n    setBounds: setBounds,\n    warn: warn,\n    deprecated: deprecated,\n    CapturedTrace: CapturedTrace,\n    fireDomEvent: fireDomEvent,\n    fireGlobalEvent: fireGlobalEvent\n};\n};\n\n},{\"./errors\":12,\"./es5\":13,\"./util\":36}],10:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise) {\nfunction returner() {\n    return this.value;\n}\nfunction thrower() {\n    throw this.reason;\n}\n\nPromise.prototype[\"return\"] =\nPromise.prototype.thenReturn = function (value) {\n    if (value instanceof Promise) value.suppressUnhandledRejections();\n    return this._then(\n        returner, undefined, undefined, {value: value}, undefined);\n};\n\nPromise.prototype[\"throw\"] =\nPromise.prototype.thenThrow = function (reason) {\n    return this._then(\n        thrower, undefined, undefined, {reason: reason}, undefined);\n};\n\nPromise.prototype.catchThrow = function (reason) {\n    if (arguments.length <= 1) {\n        return this._then(\n            undefined, thrower, undefined, {reason: reason}, undefined);\n    } else {\n        var _reason = arguments[1];\n        var handler = function() {throw _reason;};\n        return this.caught(reason, handler);\n    }\n};\n\nPromise.prototype.catchReturn = function (value) {\n    if (arguments.length <= 1) {\n        if (value instanceof Promise) value.suppressUnhandledRejections();\n        return this._then(\n            undefined, returner, undefined, {value: value}, undefined);\n    } else {\n        var _value = arguments[1];\n        if (_value instanceof Promise) _value.suppressUnhandledRejections();\n        var handler = function() {return _value;};\n        return this.caught(value, handler);\n    }\n};\n};\n\n},{}],11:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise, INTERNAL) {\nvar PromiseReduce = Promise.reduce;\nvar PromiseAll = Promise.all;\n\nfunction promiseAllThis() {\n    return PromiseAll(this);\n}\n\nfunction PromiseMapSeries(promises, fn) {\n    return PromiseReduce(promises, fn, INTERNAL, INTERNAL);\n}\n\nPromise.prototype.each = function (fn) {\n    return PromiseReduce(this, fn, INTERNAL, 0)\n              ._then(promiseAllThis, undefined, undefined, this, undefined);\n};\n\nPromise.prototype.mapSeries = function (fn) {\n    return PromiseReduce(this, fn, INTERNAL, INTERNAL);\n};\n\nPromise.each = function (promises, fn) {\n    return PromiseReduce(promises, fn, INTERNAL, 0)\n              ._then(promiseAllThis, undefined, undefined, promises, undefined);\n};\n\nPromise.mapSeries = PromiseMapSeries;\n};\n\n\n},{}],12:[function(_dereq_,module,exports){\n\"use strict\";\nvar es5 = _dereq_(\"./es5\");\nvar Objectfreeze = es5.freeze;\nvar util = _dereq_(\"./util\");\nvar inherits = util.inherits;\nvar notEnumerableProp = util.notEnumerableProp;\n\nfunction subError(nameProperty, defaultMessage) {\n    function SubError(message) {\n        if (!(this instanceof SubError)) return new SubError(message);\n        notEnumerableProp(this, \"message\",\n            typeof message === \"string\" ? message : defaultMessage);\n        notEnumerableProp(this, \"name\", nameProperty);\n        if (Error.captureStackTrace) {\n            Error.captureStackTrace(this, this.constructor);\n        } else {\n            Error.call(this);\n        }\n    }\n    inherits(SubError, Error);\n    return SubError;\n}\n\nvar _TypeError, _RangeError;\nvar Warning = subError(\"Warning\", \"warning\");\nvar CancellationError = subError(\"CancellationError\", \"cancellation error\");\nvar TimeoutError = subError(\"TimeoutError\", \"timeout error\");\nvar AggregateError = subError(\"AggregateError\", \"aggregate error\");\ntry {\n    _TypeError = TypeError;\n    _RangeError = RangeError;\n} catch(e) {\n    _TypeError = subError(\"TypeError\", \"type error\");\n    _RangeError = subError(\"RangeError\", \"range error\");\n}\n\nvar methods = (\"join pop push shift unshift slice filter forEach some \" +\n    \"every map indexOf lastIndexOf reduce reduceRight sort reverse\").split(\" \");\n\nfor (var i = 0; i < methods.length; ++i) {\n    if (typeof Array.prototype[methods[i]] === \"function\") {\n        AggregateError.prototype[methods[i]] = Array.prototype[methods[i]];\n    }\n}\n\nes5.defineProperty(AggregateError.prototype, \"length\", {\n    value: 0,\n    configurable: false,\n    writable: true,\n    enumerable: true\n});\nAggregateError.prototype[\"isOperational\"] = true;\nvar level = 0;\nAggregateError.prototype.toString = function() {\n    var indent = Array(level * 4 + 1).join(\" \");\n    var ret = \"\\n\" + indent + \"AggregateError of:\" + \"\\n\";\n    level++;\n    indent = Array(level * 4 + 1).join(\" \");\n    for (var i = 0; i < this.length; ++i) {\n        var str = this[i] === this ? \"[Circular AggregateError]\" : this[i] + \"\";\n        var lines = str.split(\"\\n\");\n        for (var j = 0; j < lines.length; ++j) {\n            lines[j] = indent + lines[j];\n        }\n        str = lines.join(\"\\n\");\n        ret += str + \"\\n\";\n    }\n    level--;\n    return ret;\n};\n\nfunction OperationalError(message) {\n    if (!(this instanceof OperationalError))\n        return new OperationalError(message);\n    notEnumerableProp(this, \"name\", \"OperationalError\");\n    notEnumerableProp(this, \"message\", message);\n    this.cause = message;\n    this[\"isOperational\"] = true;\n\n    if (message instanceof Error) {\n        notEnumerableProp(this, \"message\", message.message);\n        notEnumerableProp(this, \"stack\", message.stack);\n    } else if (Error.captureStackTrace) {\n        Error.captureStackTrace(this, this.constructor);\n    }\n\n}\ninherits(OperationalError, Error);\n\nvar errorTypes = Error[\"__BluebirdErrorTypes__\"];\nif (!errorTypes) {\n    errorTypes = Objectfreeze({\n        CancellationError: CancellationError,\n        TimeoutError: TimeoutError,\n        OperationalError: OperationalError,\n        RejectionError: OperationalError,\n        AggregateError: AggregateError\n    });\n    es5.defineProperty(Error, \"__BluebirdErrorTypes__\", {\n        value: errorTypes,\n        writable: false,\n        enumerable: false,\n        configurable: false\n    });\n}\n\nmodule.exports = {\n    Error: Error,\n    TypeError: _TypeError,\n    RangeError: _RangeError,\n    CancellationError: errorTypes.CancellationError,\n    OperationalError: errorTypes.OperationalError,\n    TimeoutError: errorTypes.TimeoutError,\n    AggregateError: errorTypes.AggregateError,\n    Warning: Warning\n};\n\n},{\"./es5\":13,\"./util\":36}],13:[function(_dereq_,module,exports){\nvar isES5 = (function(){\n    \"use strict\";\n    return this === undefined;\n})();\n\nif (isES5) {\n    module.exports = {\n        freeze: Object.freeze,\n        defineProperty: Object.defineProperty,\n        getDescriptor: Object.getOwnPropertyDescriptor,\n        keys: Object.keys,\n        names: Object.getOwnPropertyNames,\n        getPrototypeOf: Object.getPrototypeOf,\n        isArray: Array.isArray,\n        isES5: isES5,\n        propertyIsWritable: function(obj, prop) {\n            var descriptor = Object.getOwnPropertyDescriptor(obj, prop);\n            return !!(!descriptor || descriptor.writable || descriptor.set);\n        }\n    };\n} else {\n    var has = {}.hasOwnProperty;\n    var str = {}.toString;\n    var proto = {}.constructor.prototype;\n\n    var ObjectKeys = function (o) {\n        var ret = [];\n        for (var key in o) {\n            if (has.call(o, key)) {\n                ret.push(key);\n            }\n        }\n        return ret;\n    };\n\n    var ObjectGetDescriptor = function(o, key) {\n        return {value: o[key]};\n    };\n\n    var ObjectDefineProperty = function (o, key, desc) {\n        o[key] = desc.value;\n        return o;\n    };\n\n    var ObjectFreeze = function (obj) {\n        return obj;\n    };\n\n    var ObjectGetPrototypeOf = function (obj) {\n        try {\n            return Object(obj).constructor.prototype;\n        }\n        catch (e) {\n            return proto;\n        }\n    };\n\n    var ArrayIsArray = function (obj) {\n        try {\n            return str.call(obj) === \"[object Array]\";\n        }\n        catch(e) {\n            return false;\n        }\n    };\n\n    module.exports = {\n        isArray: ArrayIsArray,\n        keys: ObjectKeys,\n        names: ObjectKeys,\n        defineProperty: ObjectDefineProperty,\n        getDescriptor: ObjectGetDescriptor,\n        freeze: ObjectFreeze,\n        getPrototypeOf: ObjectGetPrototypeOf,\n        isES5: isES5,\n        propertyIsWritable: function() {\n            return true;\n        }\n    };\n}\n\n},{}],14:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise, INTERNAL) {\nvar PromiseMap = Promise.map;\n\nPromise.prototype.filter = function (fn, options) {\n    return PromiseMap(this, fn, options, INTERNAL);\n};\n\nPromise.filter = function (promises, fn, options) {\n    return PromiseMap(promises, fn, options, INTERNAL);\n};\n};\n\n},{}],15:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise, tryConvertToPromise, NEXT_FILTER) {\nvar util = _dereq_(\"./util\");\nvar CancellationError = Promise.CancellationError;\nvar errorObj = util.errorObj;\nvar catchFilter = _dereq_(\"./catch_filter\")(NEXT_FILTER);\n\nfunction PassThroughHandlerContext(promise, type, handler) {\n    this.promise = promise;\n    this.type = type;\n    this.handler = handler;\n    this.called = false;\n    this.cancelPromise = null;\n}\n\nPassThroughHandlerContext.prototype.isFinallyHandler = function() {\n    return this.type === 0;\n};\n\nfunction FinallyHandlerCancelReaction(finallyHandler) {\n    this.finallyHandler = finallyHandler;\n}\n\nFinallyHandlerCancelReaction.prototype._resultCancelled = function() {\n    checkCancel(this.finallyHandler);\n};\n\nfunction checkCancel(ctx, reason) {\n    if (ctx.cancelPromise != null) {\n        if (arguments.length > 1) {\n            ctx.cancelPromise._reject(reason);\n        } else {\n            ctx.cancelPromise._cancel();\n        }\n        ctx.cancelPromise = null;\n        return true;\n    }\n    return false;\n}\n\nfunction succeed() {\n    return finallyHandler.call(this, this.promise._target()._settledValue());\n}\nfunction fail(reason) {\n    if (checkCancel(this, reason)) return;\n    errorObj.e = reason;\n    return errorObj;\n}\nfunction finallyHandler(reasonOrValue) {\n    var promise = this.promise;\n    var handler = this.handler;\n\n    if (!this.called) {\n        this.called = true;\n        var ret = this.isFinallyHandler()\n            ? handler.call(promise._boundValue())\n            : handler.call(promise._boundValue(), reasonOrValue);\n        if (ret === NEXT_FILTER) {\n            return ret;\n        } else if (ret !== undefined) {\n            promise._setReturnedNonUndefined();\n            var maybePromise = tryConvertToPromise(ret, promise);\n            if (maybePromise instanceof Promise) {\n                if (this.cancelPromise != null) {\n                    if (maybePromise._isCancelled()) {\n                        var reason =\n                            new CancellationError(\"late cancellation observer\");\n                        promise._attachExtraTrace(reason);\n                        errorObj.e = reason;\n                        return errorObj;\n                    } else if (maybePromise.isPending()) {\n                        maybePromise._attachCancellationCallback(\n                            new FinallyHandlerCancelReaction(this));\n                    }\n                }\n                return maybePromise._then(\n                    succeed, fail, undefined, this, undefined);\n            }\n        }\n    }\n\n    if (promise.isRejected()) {\n        checkCancel(this);\n        errorObj.e = reasonOrValue;\n        return errorObj;\n    } else {\n        checkCancel(this);\n        return reasonOrValue;\n    }\n}\n\nPromise.prototype._passThrough = function(handler, type, success, fail) {\n    if (typeof handler !== \"function\") return this.then();\n    return this._then(success,\n                      fail,\n                      undefined,\n                      new PassThroughHandlerContext(this, type, handler),\n                      undefined);\n};\n\nPromise.prototype.lastly =\nPromise.prototype[\"finally\"] = function (handler) {\n    return this._passThrough(handler,\n                             0,\n                             finallyHandler,\n                             finallyHandler);\n};\n\n\nPromise.prototype.tap = function (handler) {\n    return this._passThrough(handler, 1, finallyHandler);\n};\n\nPromise.prototype.tapCatch = function (handlerOrPredicate) {\n    var len = arguments.length;\n    if(len === 1) {\n        return this._passThrough(handlerOrPredicate,\n                                 1,\n                                 undefined,\n                                 finallyHandler);\n    } else {\n         var catchInstances = new Array(len - 1),\n            j = 0, i;\n        for (i = 0; i < len - 1; ++i) {\n            var item = arguments[i];\n            if (util.isObject(item)) {\n                catchInstances[j++] = item;\n            } else {\n                return Promise.reject(new TypeError(\n                    \"tapCatch statement predicate: \"\n                    + \"expecting an object but got \" + util.classString(item)\n                ));\n            }\n        }\n        catchInstances.length = j;\n        var handler = arguments[i];\n        return this._passThrough(catchFilter(catchInstances, handler, this),\n                                 1,\n                                 undefined,\n                                 finallyHandler);\n    }\n\n};\n\nreturn PassThroughHandlerContext;\n};\n\n},{\"./catch_filter\":7,\"./util\":36}],16:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise,\n                          apiRejection,\n                          INTERNAL,\n                          tryConvertToPromise,\n                          Proxyable,\n                          debug) {\nvar errors = _dereq_(\"./errors\");\nvar TypeError = errors.TypeError;\nvar util = _dereq_(\"./util\");\nvar errorObj = util.errorObj;\nvar tryCatch = util.tryCatch;\nvar yieldHandlers = [];\n\nfunction promiseFromYieldHandler(value, yieldHandlers, traceParent) {\n    for (var i = 0; i < yieldHandlers.length; ++i) {\n        traceParent._pushContext();\n        var result = tryCatch(yieldHandlers[i])(value);\n        traceParent._popContext();\n        if (result === errorObj) {\n            traceParent._pushContext();\n            var ret = Promise.reject(errorObj.e);\n            traceParent._popContext();\n            return ret;\n        }\n        var maybePromise = tryConvertToPromise(result, traceParent);\n        if (maybePromise instanceof Promise) return maybePromise;\n    }\n    return null;\n}\n\nfunction PromiseSpawn(generatorFunction, receiver, yieldHandler, stack) {\n    if (debug.cancellation()) {\n        var internal = new Promise(INTERNAL);\n        var _finallyPromise = this._finallyPromise = new Promise(INTERNAL);\n        this._promise = internal.lastly(function() {\n            return _finallyPromise;\n        });\n        internal._captureStackTrace();\n        internal._setOnCancel(this);\n    } else {\n        var promise = this._promise = new Promise(INTERNAL);\n        promise._captureStackTrace();\n    }\n    this._stack = stack;\n    this._generatorFunction = generatorFunction;\n    this._receiver = receiver;\n    this._generator = undefined;\n    this._yieldHandlers = typeof yieldHandler === \"function\"\n        ? [yieldHandler].concat(yieldHandlers)\n        : yieldHandlers;\n    this._yieldedPromise = null;\n    this._cancellationPhase = false;\n}\nutil.inherits(PromiseSpawn, Proxyable);\n\nPromiseSpawn.prototype._isResolved = function() {\n    return this._promise === null;\n};\n\nPromiseSpawn.prototype._cleanup = function() {\n    this._promise = this._generator = null;\n    if (debug.cancellation() && this._finallyPromise !== null) {\n        this._finallyPromise._fulfill();\n        this._finallyPromise = null;\n    }\n};\n\nPromiseSpawn.prototype._promiseCancelled = function() {\n    if (this._isResolved()) return;\n    var implementsReturn = typeof this._generator[\"return\"] !== \"undefined\";\n\n    var result;\n    if (!implementsReturn) {\n        var reason = new Promise.CancellationError(\n            \"generator .return() sentinel\");\n        Promise.coroutine.returnSentinel = reason;\n        this._promise._attachExtraTrace(reason);\n        this._promise._pushContext();\n        result = tryCatch(this._generator[\"throw\"]).call(this._generator,\n                                                         reason);\n        this._promise._popContext();\n    } else {\n        this._promise._pushContext();\n        result = tryCatch(this._generator[\"return\"]).call(this._generator,\n                                                          undefined);\n        this._promise._popContext();\n    }\n    this._cancellationPhase = true;\n    this._yieldedPromise = null;\n    this._continue(result);\n};\n\nPromiseSpawn.prototype._promiseFulfilled = function(value) {\n    this._yieldedPromise = null;\n    this._promise._pushContext();\n    var result = tryCatch(this._generator.next).call(this._generator, value);\n    this._promise._popContext();\n    this._continue(result);\n};\n\nPromiseSpawn.prototype._promiseRejected = function(reason) {\n    this._yieldedPromise = null;\n    this._promise._attachExtraTrace(reason);\n    this._promise._pushContext();\n    var result = tryCatch(this._generator[\"throw\"])\n        .call(this._generator, reason);\n    this._promise._popContext();\n    this._continue(result);\n};\n\nPromiseSpawn.prototype._resultCancelled = function() {\n    if (this._yieldedPromise instanceof Promise) {\n        var promise = this._yieldedPromise;\n        this._yieldedPromise = null;\n        promise.cancel();\n    }\n};\n\nPromiseSpawn.prototype.promise = function () {\n    return this._promise;\n};\n\nPromiseSpawn.prototype._run = function () {\n    this._generator = this._generatorFunction.call(this._receiver);\n    this._receiver =\n        this._generatorFunction = undefined;\n    this._promiseFulfilled(undefined);\n};\n\nPromiseSpawn.prototype._continue = function (result) {\n    var promise = this._promise;\n    if (result === errorObj) {\n        this._cleanup();\n        if (this._cancellationPhase) {\n            return promise.cancel();\n        } else {\n            return promise._rejectCallback(result.e, false);\n        }\n    }\n\n    var value = result.value;\n    if (result.done === true) {\n        this._cleanup();\n        if (this._cancellationPhase) {\n            return promise.cancel();\n        } else {\n            return promise._resolveCallback(value);\n        }\n    } else {\n        var maybePromise = tryConvertToPromise(value, this._promise);\n        if (!(maybePromise instanceof Promise)) {\n            maybePromise =\n                promiseFromYieldHandler(maybePromise,\n                                        this._yieldHandlers,\n                                        this._promise);\n            if (maybePromise === null) {\n                this._promiseRejected(\n                    new TypeError(\n                        \"A value %s was yielded that could not be treated as a promise\\u000a\\u000a    See http://goo.gl/MqrFmX\\u000a\\u000a\".replace(\"%s\", String(value)) +\n                        \"From coroutine:\\u000a\" +\n                        this._stack.split(\"\\n\").slice(1, -7).join(\"\\n\")\n                    )\n                );\n                return;\n            }\n        }\n        maybePromise = maybePromise._target();\n        var bitField = maybePromise._bitField;\n        ;\n        if (((bitField & 50397184) === 0)) {\n            this._yieldedPromise = maybePromise;\n            maybePromise._proxy(this, null);\n        } else if (((bitField & 33554432) !== 0)) {\n            Promise._async.invoke(\n                this._promiseFulfilled, this, maybePromise._value()\n            );\n        } else if (((bitField & 16777216) !== 0)) {\n            Promise._async.invoke(\n                this._promiseRejected, this, maybePromise._reason()\n            );\n        } else {\n            this._promiseCancelled();\n        }\n    }\n};\n\nPromise.coroutine = function (generatorFunction, options) {\n    if (typeof generatorFunction !== \"function\") {\n        throw new TypeError(\"generatorFunction must be a function\\u000a\\u000a    See http://goo.gl/MqrFmX\\u000a\");\n    }\n    var yieldHandler = Object(options).yieldHandler;\n    var PromiseSpawn$ = PromiseSpawn;\n    var stack = new Error().stack;\n    return function () {\n        var generator = generatorFunction.apply(this, arguments);\n        var spawn = new PromiseSpawn$(undefined, undefined, yieldHandler,\n                                      stack);\n        var ret = spawn.promise();\n        spawn._generator = generator;\n        spawn._promiseFulfilled(undefined);\n        return ret;\n    };\n};\n\nPromise.coroutine.addYieldHandler = function(fn) {\n    if (typeof fn !== \"function\") {\n        throw new TypeError(\"expecting a function but got \" + util.classString(fn));\n    }\n    yieldHandlers.push(fn);\n};\n\nPromise.spawn = function (generatorFunction) {\n    debug.deprecated(\"Promise.spawn()\", \"Promise.coroutine()\");\n    if (typeof generatorFunction !== \"function\") {\n        return apiRejection(\"generatorFunction must be a function\\u000a\\u000a    See http://goo.gl/MqrFmX\\u000a\");\n    }\n    var spawn = new PromiseSpawn(generatorFunction, this);\n    var ret = spawn.promise();\n    spawn._run(Promise.spawn);\n    return ret;\n};\n};\n\n},{\"./errors\":12,\"./util\":36}],17:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports =\nfunction(Promise, PromiseArray, tryConvertToPromise, INTERNAL, async) {\nvar util = _dereq_(\"./util\");\nvar canEvaluate = util.canEvaluate;\nvar tryCatch = util.tryCatch;\nvar errorObj = util.errorObj;\nvar reject;\n\nif (!true) {\nif (canEvaluate) {\n    var thenCallback = function(i) {\n        return new Function(\"value\", \"holder\", \"                             \\n\\\n            'use strict';                                                    \\n\\\n            holder.pIndex = value;                                           \\n\\\n            holder.checkFulfillment(this);                                   \\n\\\n            \".replace(/Index/g, i));\n    };\n\n    var promiseSetter = function(i) {\n        return new Function(\"promise\", \"holder\", \"                           \\n\\\n            'use strict';                                                    \\n\\\n            holder.pIndex = promise;                                         \\n\\\n            \".replace(/Index/g, i));\n    };\n\n    var generateHolderClass = function(total) {\n        var props = new Array(total);\n        for (var i = 0; i < props.length; ++i) {\n            props[i] = \"this.p\" + (i+1);\n        }\n        var assignment = props.join(\" = \") + \" = null;\";\n        var cancellationCode= \"var promise;\\n\" + props.map(function(prop) {\n            return \"                                                         \\n\\\n                promise = \" + prop + \";                                      \\n\\\n                if (promise instanceof Promise) {                            \\n\\\n                    promise.cancel();                                        \\n\\\n                }                                                            \\n\\\n            \";\n        }).join(\"\\n\");\n        var passedArguments = props.join(\", \");\n        var name = \"Holder$\" + total;\n\n\n        var code = \"return function(tryCatch, errorObj, Promise, async) {    \\n\\\n            'use strict';                                                    \\n\\\n            function [TheName](fn) {                                         \\n\\\n                [TheProperties]                                              \\n\\\n                this.fn = fn;                                                \\n\\\n                this.asyncNeeded = true;                                     \\n\\\n                this.now = 0;                                                \\n\\\n            }                                                                \\n\\\n                                                                             \\n\\\n            [TheName].prototype._callFunction = function(promise) {          \\n\\\n                promise._pushContext();                                      \\n\\\n                var ret = tryCatch(this.fn)([ThePassedArguments]);           \\n\\\n                promise._popContext();                                       \\n\\\n                if (ret === errorObj) {                                      \\n\\\n                    promise._rejectCallback(ret.e, false);                   \\n\\\n                } else {                                                     \\n\\\n                    promise._resolveCallback(ret);                           \\n\\\n                }                                                            \\n\\\n            };                                                               \\n\\\n                                                                             \\n\\\n            [TheName].prototype.checkFulfillment = function(promise) {       \\n\\\n                var now = ++this.now;                                        \\n\\\n                if (now === [TheTotal]) {                                    \\n\\\n                    if (this.asyncNeeded) {                                  \\n\\\n                        async.invoke(this._callFunction, this, promise);     \\n\\\n                    } else {                                                 \\n\\\n                        this._callFunction(promise);                         \\n\\\n                    }                                                        \\n\\\n                                                                             \\n\\\n                }                                                            \\n\\\n            };                                                               \\n\\\n                                                                             \\n\\\n            [TheName].prototype._resultCancelled = function() {              \\n\\\n                [CancellationCode]                                           \\n\\\n            };                                                               \\n\\\n                                                                             \\n\\\n            return [TheName];                                                \\n\\\n        }(tryCatch, errorObj, Promise, async);                               \\n\\\n        \";\n\n        code = code.replace(/\\[TheName\\]/g, name)\n            .replace(/\\[TheTotal\\]/g, total)\n            .replace(/\\[ThePassedArguments\\]/g, passedArguments)\n            .replace(/\\[TheProperties\\]/g, assignment)\n            .replace(/\\[CancellationCode\\]/g, cancellationCode);\n\n        return new Function(\"tryCatch\", \"errorObj\", \"Promise\", \"async\", code)\n                           (tryCatch, errorObj, Promise, async);\n    };\n\n    var holderClasses = [];\n    var thenCallbacks = [];\n    var promiseSetters = [];\n\n    for (var i = 0; i < 8; ++i) {\n        holderClasses.push(generateHolderClass(i + 1));\n        thenCallbacks.push(thenCallback(i + 1));\n        promiseSetters.push(promiseSetter(i + 1));\n    }\n\n    reject = function (reason) {\n        this._reject(reason);\n    };\n}}\n\nPromise.join = function () {\n    var last = arguments.length - 1;\n    var fn;\n    if (last > 0 && typeof arguments[last] === \"function\") {\n        fn = arguments[last];\n        if (!true) {\n            if (last <= 8 && canEvaluate) {\n                var ret = new Promise(INTERNAL);\n                ret._captureStackTrace();\n                var HolderClass = holderClasses[last - 1];\n                var holder = new HolderClass(fn);\n                var callbacks = thenCallbacks;\n\n                for (var i = 0; i < last; ++i) {\n                    var maybePromise = tryConvertToPromise(arguments[i], ret);\n                    if (maybePromise instanceof Promise) {\n                        maybePromise = maybePromise._target();\n                        var bitField = maybePromise._bitField;\n                        ;\n                        if (((bitField & 50397184) === 0)) {\n                            maybePromise._then(callbacks[i], reject,\n                                               undefined, ret, holder);\n                            promiseSetters[i](maybePromise, holder);\n                            holder.asyncNeeded = false;\n                        } else if (((bitField & 33554432) !== 0)) {\n                            callbacks[i].call(ret,\n                                              maybePromise._value(), holder);\n                        } else if (((bitField & 16777216) !== 0)) {\n                            ret._reject(maybePromise._reason());\n                        } else {\n                            ret._cancel();\n                        }\n                    } else {\n                        callbacks[i].call(ret, maybePromise, holder);\n                    }\n                }\n\n                if (!ret._isFateSealed()) {\n                    if (holder.asyncNeeded) {\n                        var context = Promise._getContext();\n                        holder.fn = util.contextBind(context, holder.fn);\n                    }\n                    ret._setAsyncGuaranteed();\n                    ret._setOnCancel(holder);\n                }\n                return ret;\n            }\n        }\n    }\n    var args = [].slice.call(arguments);;\n    if (fn) args.pop();\n    var ret = new PromiseArray(args).promise();\n    return fn !== undefined ? ret.spread(fn) : ret;\n};\n\n};\n\n},{\"./util\":36}],18:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise,\n                          PromiseArray,\n                          apiRejection,\n                          tryConvertToPromise,\n                          INTERNAL,\n                          debug) {\nvar util = _dereq_(\"./util\");\nvar tryCatch = util.tryCatch;\nvar errorObj = util.errorObj;\nvar async = Promise._async;\n\nfunction MappingPromiseArray(promises, fn, limit, _filter) {\n    this.constructor$(promises);\n    this._promise._captureStackTrace();\n    var context = Promise._getContext();\n    this._callback = util.contextBind(context, fn);\n    this._preservedValues = _filter === INTERNAL\n        ? new Array(this.length())\n        : null;\n    this._limit = limit;\n    this._inFlight = 0;\n    this._queue = [];\n    async.invoke(this._asyncInit, this, undefined);\n    if (util.isArray(promises)) {\n        for (var i = 0; i < promises.length; ++i) {\n            var maybePromise = promises[i];\n            if (maybePromise instanceof Promise) {\n                maybePromise.suppressUnhandledRejections();\n            }\n        }\n    }\n}\nutil.inherits(MappingPromiseArray, PromiseArray);\n\nMappingPromiseArray.prototype._asyncInit = function() {\n    this._init$(undefined, -2);\n};\n\nMappingPromiseArray.prototype._init = function () {};\n\nMappingPromiseArray.prototype._promiseFulfilled = function (value, index) {\n    var values = this._values;\n    var length = this.length();\n    var preservedValues = this._preservedValues;\n    var limit = this._limit;\n\n    if (index < 0) {\n        index = (index * -1) - 1;\n        values[index] = value;\n        if (limit >= 1) {\n            this._inFlight--;\n            this._drainQueue();\n            if (this._isResolved()) return true;\n        }\n    } else {\n        if (limit >= 1 && this._inFlight >= limit) {\n            values[index] = value;\n            this._queue.push(index);\n            return false;\n        }\n        if (preservedValues !== null) preservedValues[index] = value;\n\n        var promise = this._promise;\n        var callback = this._callback;\n        var receiver = promise._boundValue();\n        promise._pushContext();\n        var ret = tryCatch(callback).call(receiver, value, index, length);\n        var promiseCreated = promise._popContext();\n        debug.checkForgottenReturns(\n            ret,\n            promiseCreated,\n            preservedValues !== null ? \"Promise.filter\" : \"Promise.map\",\n            promise\n        );\n        if (ret === errorObj) {\n            this._reject(ret.e);\n            return true;\n        }\n\n        var maybePromise = tryConvertToPromise(ret, this._promise);\n        if (maybePromise instanceof Promise) {\n            maybePromise = maybePromise._target();\n            var bitField = maybePromise._bitField;\n            ;\n            if (((bitField & 50397184) === 0)) {\n                if (limit >= 1) this._inFlight++;\n                values[index] = maybePromise;\n                maybePromise._proxy(this, (index + 1) * -1);\n                return false;\n            } else if (((bitField & 33554432) !== 0)) {\n                ret = maybePromise._value();\n            } else if (((bitField & 16777216) !== 0)) {\n                this._reject(maybePromise._reason());\n                return true;\n            } else {\n                this._cancel();\n                return true;\n            }\n        }\n        values[index] = ret;\n    }\n    var totalResolved = ++this._totalResolved;\n    if (totalResolved >= length) {\n        if (preservedValues !== null) {\n            this._filter(values, preservedValues);\n        } else {\n            this._resolve(values);\n        }\n        return true;\n    }\n    return false;\n};\n\nMappingPromiseArray.prototype._drainQueue = function () {\n    var queue = this._queue;\n    var limit = this._limit;\n    var values = this._values;\n    while (queue.length > 0 && this._inFlight < limit) {\n        if (this._isResolved()) return;\n        var index = queue.pop();\n        this._promiseFulfilled(values[index], index);\n    }\n};\n\nMappingPromiseArray.prototype._filter = function (booleans, values) {\n    var len = values.length;\n    var ret = new Array(len);\n    var j = 0;\n    for (var i = 0; i < len; ++i) {\n        if (booleans[i]) ret[j++] = values[i];\n    }\n    ret.length = j;\n    this._resolve(ret);\n};\n\nMappingPromiseArray.prototype.preservedValues = function () {\n    return this._preservedValues;\n};\n\nfunction map(promises, fn, options, _filter) {\n    if (typeof fn !== \"function\") {\n        return apiRejection(\"expecting a function but got \" + util.classString(fn));\n    }\n\n    var limit = 0;\n    if (options !== undefined) {\n        if (typeof options === \"object\" && options !== null) {\n            if (typeof options.concurrency !== \"number\") {\n                return Promise.reject(\n                    new TypeError(\"'concurrency' must be a number but it is \" +\n                                    util.classString(options.concurrency)));\n            }\n            limit = options.concurrency;\n        } else {\n            return Promise.reject(new TypeError(\n                            \"options argument must be an object but it is \" +\n                             util.classString(options)));\n        }\n    }\n    limit = typeof limit === \"number\" &&\n        isFinite(limit) && limit >= 1 ? limit : 0;\n    return new MappingPromiseArray(promises, fn, limit, _filter).promise();\n}\n\nPromise.prototype.map = function (fn, options) {\n    return map(this, fn, options, null);\n};\n\nPromise.map = function (promises, fn, options, _filter) {\n    return map(promises, fn, options, _filter);\n};\n\n\n};\n\n},{\"./util\":36}],19:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports =\nfunction(Promise, INTERNAL, tryConvertToPromise, apiRejection, debug) {\nvar util = _dereq_(\"./util\");\nvar tryCatch = util.tryCatch;\n\nPromise.method = function (fn) {\n    if (typeof fn !== \"function\") {\n        throw new Promise.TypeError(\"expecting a function but got \" + util.classString(fn));\n    }\n    return function () {\n        var ret = new Promise(INTERNAL);\n        ret._captureStackTrace();\n        ret._pushContext();\n        var value = tryCatch(fn).apply(this, arguments);\n        var promiseCreated = ret._popContext();\n        debug.checkForgottenReturns(\n            value, promiseCreated, \"Promise.method\", ret);\n        ret._resolveFromSyncValue(value);\n        return ret;\n    };\n};\n\nPromise.attempt = Promise[\"try\"] = function (fn) {\n    if (typeof fn !== \"function\") {\n        return apiRejection(\"expecting a function but got \" + util.classString(fn));\n    }\n    var ret = new Promise(INTERNAL);\n    ret._captureStackTrace();\n    ret._pushContext();\n    var value;\n    if (arguments.length > 1) {\n        debug.deprecated(\"calling Promise.try with more than 1 argument\");\n        var arg = arguments[1];\n        var ctx = arguments[2];\n        value = util.isArray(arg) ? tryCatch(fn).apply(ctx, arg)\n                                  : tryCatch(fn).call(ctx, arg);\n    } else {\n        value = tryCatch(fn)();\n    }\n    var promiseCreated = ret._popContext();\n    debug.checkForgottenReturns(\n        value, promiseCreated, \"Promise.try\", ret);\n    ret._resolveFromSyncValue(value);\n    return ret;\n};\n\nPromise.prototype._resolveFromSyncValue = function (value) {\n    if (value === util.errorObj) {\n        this._rejectCallback(value.e, false);\n    } else {\n        this._resolveCallback(value, true);\n    }\n};\n};\n\n},{\"./util\":36}],20:[function(_dereq_,module,exports){\n\"use strict\";\nvar util = _dereq_(\"./util\");\nvar maybeWrapAsError = util.maybeWrapAsError;\nvar errors = _dereq_(\"./errors\");\nvar OperationalError = errors.OperationalError;\nvar es5 = _dereq_(\"./es5\");\n\nfunction isUntypedError(obj) {\n    return obj instanceof Error &&\n        es5.getPrototypeOf(obj) === Error.prototype;\n}\n\nvar rErrorKey = /^(?:name|message|stack|cause)$/;\nfunction wrapAsOperationalError(obj) {\n    var ret;\n    if (isUntypedError(obj)) {\n        ret = new OperationalError(obj);\n        ret.name = obj.name;\n        ret.message = obj.message;\n        ret.stack = obj.stack;\n        var keys = es5.keys(obj);\n        for (var i = 0; i < keys.length; ++i) {\n            var key = keys[i];\n            if (!rErrorKey.test(key)) {\n                ret[key] = obj[key];\n            }\n        }\n        return ret;\n    }\n    util.markAsOriginatingFromRejection(obj);\n    return obj;\n}\n\nfunction nodebackForPromise(promise, multiArgs) {\n    return function(err, value) {\n        if (promise === null) return;\n        if (err) {\n            var wrapped = wrapAsOperationalError(maybeWrapAsError(err));\n            promise._attachExtraTrace(wrapped);\n            promise._reject(wrapped);\n        } else if (!multiArgs) {\n            promise._fulfill(value);\n        } else {\n            var args = [].slice.call(arguments, 1);;\n            promise._fulfill(args);\n        }\n        promise = null;\n    };\n}\n\nmodule.exports = nodebackForPromise;\n\n},{\"./errors\":12,\"./es5\":13,\"./util\":36}],21:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise) {\nvar util = _dereq_(\"./util\");\nvar async = Promise._async;\nvar tryCatch = util.tryCatch;\nvar errorObj = util.errorObj;\n\nfunction spreadAdapter(val, nodeback) {\n    var promise = this;\n    if (!util.isArray(val)) return successAdapter.call(promise, val, nodeback);\n    var ret =\n        tryCatch(nodeback).apply(promise._boundValue(), [null].concat(val));\n    if (ret === errorObj) {\n        async.throwLater(ret.e);\n    }\n}\n\nfunction successAdapter(val, nodeback) {\n    var promise = this;\n    var receiver = promise._boundValue();\n    var ret = val === undefined\n        ? tryCatch(nodeback).call(receiver, null)\n        : tryCatch(nodeback).call(receiver, null, val);\n    if (ret === errorObj) {\n        async.throwLater(ret.e);\n    }\n}\nfunction errorAdapter(reason, nodeback) {\n    var promise = this;\n    if (!reason) {\n        var newReason = new Error(reason + \"\");\n        newReason.cause = reason;\n        reason = newReason;\n    }\n    var ret = tryCatch(nodeback).call(promise._boundValue(), reason);\n    if (ret === errorObj) {\n        async.throwLater(ret.e);\n    }\n}\n\nPromise.prototype.asCallback = Promise.prototype.nodeify = function (nodeback,\n                                                                     options) {\n    if (typeof nodeback == \"function\") {\n        var adapter = successAdapter;\n        if (options !== undefined && Object(options).spread) {\n            adapter = spreadAdapter;\n        }\n        this._then(\n            adapter,\n            errorAdapter,\n            undefined,\n            this,\n            nodeback\n        );\n    }\n    return this;\n};\n};\n\n},{\"./util\":36}],22:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function() {\nvar makeSelfResolutionError = function () {\n    return new TypeError(\"circular promise resolution chain\\u000a\\u000a    See http://goo.gl/MqrFmX\\u000a\");\n};\nvar reflectHandler = function() {\n    return new Promise.PromiseInspection(this._target());\n};\nvar apiRejection = function(msg) {\n    return Promise.reject(new TypeError(msg));\n};\nfunction Proxyable() {}\nvar UNDEFINED_BINDING = {};\nvar util = _dereq_(\"./util\");\nutil.setReflectHandler(reflectHandler);\n\nvar getDomain = function() {\n    var domain = process.domain;\n    if (domain === undefined) {\n        return null;\n    }\n    return domain;\n};\nvar getContextDefault = function() {\n    return null;\n};\nvar getContextDomain = function() {\n    return {\n        domain: getDomain(),\n        async: null\n    };\n};\nvar AsyncResource = util.isNode && util.nodeSupportsAsyncResource ?\n    _dereq_(\"async_hooks\").AsyncResource : null;\nvar getContextAsyncHooks = function() {\n    return {\n        domain: getDomain(),\n        async: new AsyncResource(\"Bluebird::Promise\")\n    };\n};\nvar getContext = util.isNode ? getContextDomain : getContextDefault;\nutil.notEnumerableProp(Promise, \"_getContext\", getContext);\nvar enableAsyncHooks = function() {\n    getContext = getContextAsyncHooks;\n    util.notEnumerableProp(Promise, \"_getContext\", getContextAsyncHooks);\n};\nvar disableAsyncHooks = function() {\n    getContext = getContextDomain;\n    util.notEnumerableProp(Promise, \"_getContext\", getContextDomain);\n};\n\nvar es5 = _dereq_(\"./es5\");\nvar Async = _dereq_(\"./async\");\nvar async = new Async();\nes5.defineProperty(Promise, \"_async\", {value: async});\nvar errors = _dereq_(\"./errors\");\nvar TypeError = Promise.TypeError = errors.TypeError;\nPromise.RangeError = errors.RangeError;\nvar CancellationError = Promise.CancellationError = errors.CancellationError;\nPromise.TimeoutError = errors.TimeoutError;\nPromise.OperationalError = errors.OperationalError;\nPromise.RejectionError = errors.OperationalError;\nPromise.AggregateError = errors.AggregateError;\nvar INTERNAL = function(){};\nvar APPLY = {};\nvar NEXT_FILTER = {};\nvar tryConvertToPromise = _dereq_(\"./thenables\")(Promise, INTERNAL);\nvar PromiseArray =\n    _dereq_(\"./promise_array\")(Promise, INTERNAL,\n                               tryConvertToPromise, apiRejection, Proxyable);\nvar Context = _dereq_(\"./context\")(Promise);\n /*jshint unused:false*/\nvar createContext = Context.create;\n\nvar debug = _dereq_(\"./debuggability\")(Promise, Context,\n    enableAsyncHooks, disableAsyncHooks);\nvar CapturedTrace = debug.CapturedTrace;\nvar PassThroughHandlerContext =\n    _dereq_(\"./finally\")(Promise, tryConvertToPromise, NEXT_FILTER);\nvar catchFilter = _dereq_(\"./catch_filter\")(NEXT_FILTER);\nvar nodebackForPromise = _dereq_(\"./nodeback\");\nvar errorObj = util.errorObj;\nvar tryCatch = util.tryCatch;\nfunction check(self, executor) {\n    if (self == null || self.constructor !== Promise) {\n        throw new TypeError(\"the promise constructor cannot be invoked directly\\u000a\\u000a    See http://goo.gl/MqrFmX\\u000a\");\n    }\n    if (typeof executor !== \"function\") {\n        throw new TypeError(\"expecting a function but got \" + util.classString(executor));\n    }\n\n}\n\nfunction Promise(executor) {\n    if (executor !== INTERNAL) {\n        check(this, executor);\n    }\n    this._bitField = 0;\n    this._fulfillmentHandler0 = undefined;\n    this._rejectionHandler0 = undefined;\n    this._promise0 = undefined;\n    this._receiver0 = undefined;\n    this._resolveFromExecutor(executor);\n    this._promiseCreated();\n    this._fireEvent(\"promiseCreated\", this);\n}\n\nPromise.prototype.toString = function () {\n    return \"[object Promise]\";\n};\n\nPromise.prototype.caught = Promise.prototype[\"catch\"] = function (fn) {\n    var len = arguments.length;\n    if (len > 1) {\n        var catchInstances = new Array(len - 1),\n            j = 0, i;\n        for (i = 0; i < len - 1; ++i) {\n            var item = arguments[i];\n            if (util.isObject(item)) {\n                catchInstances[j++] = item;\n            } else {\n                return apiRejection(\"Catch statement predicate: \" +\n                    \"expecting an object but got \" + util.classString(item));\n            }\n        }\n        catchInstances.length = j;\n        fn = arguments[i];\n\n        if (typeof fn !== \"function\") {\n            throw new TypeError(\"The last argument to .catch() \" +\n                \"must be a function, got \" + util.toString(fn));\n        }\n        return this.then(undefined, catchFilter(catchInstances, fn, this));\n    }\n    return this.then(undefined, fn);\n};\n\nPromise.prototype.reflect = function () {\n    return this._then(reflectHandler,\n        reflectHandler, undefined, this, undefined);\n};\n\nPromise.prototype.then = function (didFulfill, didReject) {\n    if (debug.warnings() && arguments.length > 0 &&\n        typeof didFulfill !== \"function\" &&\n        typeof didReject !== \"function\") {\n        var msg = \".then() only accepts functions but was passed: \" +\n                util.classString(didFulfill);\n        if (arguments.length > 1) {\n            msg += \", \" + util.classString(didReject);\n        }\n        this._warn(msg);\n    }\n    return this._then(didFulfill, didReject, undefined, undefined, undefined);\n};\n\nPromise.prototype.done = function (didFulfill, didReject) {\n    var promise =\n        this._then(didFulfill, didReject, undefined, undefined, undefined);\n    promise._setIsFinal();\n};\n\nPromise.prototype.spread = function (fn) {\n    if (typeof fn !== \"function\") {\n        return apiRejection(\"expecting a function but got \" + util.classString(fn));\n    }\n    return this.all()._then(fn, undefined, undefined, APPLY, undefined);\n};\n\nPromise.prototype.toJSON = function () {\n    var ret = {\n        isFulfilled: false,\n        isRejected: false,\n        fulfillmentValue: undefined,\n        rejectionReason: undefined\n    };\n    if (this.isFulfilled()) {\n        ret.fulfillmentValue = this.value();\n        ret.isFulfilled = true;\n    } else if (this.isRejected()) {\n        ret.rejectionReason = this.reason();\n        ret.isRejected = true;\n    }\n    return ret;\n};\n\nPromise.prototype.all = function () {\n    if (arguments.length > 0) {\n        this._warn(\".all() was passed arguments but it does not take any\");\n    }\n    return new PromiseArray(this).promise();\n};\n\nPromise.prototype.error = function (fn) {\n    return this.caught(util.originatesFromRejection, fn);\n};\n\nPromise.getNewLibraryCopy = module.exports;\n\nPromise.is = function (val) {\n    return val instanceof Promise;\n};\n\nPromise.fromNode = Promise.fromCallback = function(fn) {\n    var ret = new Promise(INTERNAL);\n    ret._captureStackTrace();\n    var multiArgs = arguments.length > 1 ? !!Object(arguments[1]).multiArgs\n                                         : false;\n    var result = tryCatch(fn)(nodebackForPromise(ret, multiArgs));\n    if (result === errorObj) {\n        ret._rejectCallback(result.e, true);\n    }\n    if (!ret._isFateSealed()) ret._setAsyncGuaranteed();\n    return ret;\n};\n\nPromise.all = function (promises) {\n    return new PromiseArray(promises).promise();\n};\n\nPromise.cast = function (obj) {\n    var ret = tryConvertToPromise(obj);\n    if (!(ret instanceof Promise)) {\n        ret = new Promise(INTERNAL);\n        ret._captureStackTrace();\n        ret._setFulfilled();\n        ret._rejectionHandler0 = obj;\n    }\n    return ret;\n};\n\nPromise.resolve = Promise.fulfilled = Promise.cast;\n\nPromise.reject = Promise.rejected = function (reason) {\n    var ret = new Promise(INTERNAL);\n    ret._captureStackTrace();\n    ret._rejectCallback(reason, true);\n    return ret;\n};\n\nPromise.setScheduler = function(fn) {\n    if (typeof fn !== \"function\") {\n        throw new TypeError(\"expecting a function but got \" + util.classString(fn));\n    }\n    return async.setScheduler(fn);\n};\n\nPromise.prototype._then = function (\n    didFulfill,\n    didReject,\n    _,    receiver,\n    internalData\n) {\n    var haveInternalData = internalData !== undefined;\n    var promise = haveInternalData ? internalData : new Promise(INTERNAL);\n    var target = this._target();\n    var bitField = target._bitField;\n\n    if (!haveInternalData) {\n        promise._propagateFrom(this, 3);\n        promise._captureStackTrace();\n        if (receiver === undefined &&\n            ((this._bitField & 2097152) !== 0)) {\n            if (!((bitField & 50397184) === 0)) {\n                receiver = this._boundValue();\n            } else {\n                receiver = target === this ? undefined : this._boundTo;\n            }\n        }\n        this._fireEvent(\"promiseChained\", this, promise);\n    }\n\n    var context = getContext();\n    if (!((bitField & 50397184) === 0)) {\n        var handler, value, settler = target._settlePromiseCtx;\n        if (((bitField & 33554432) !== 0)) {\n            value = target._rejectionHandler0;\n            handler = didFulfill;\n        } else if (((bitField & 16777216) !== 0)) {\n            value = target._fulfillmentHandler0;\n            handler = didReject;\n            target._unsetRejectionIsUnhandled();\n        } else {\n            settler = target._settlePromiseLateCancellationObserver;\n            value = new CancellationError(\"late cancellation observer\");\n            target._attachExtraTrace(value);\n            handler = didReject;\n        }\n\n        async.invoke(settler, target, {\n            handler: util.contextBind(context, handler),\n            promise: promise,\n            receiver: receiver,\n            value: value\n        });\n    } else {\n        target._addCallbacks(didFulfill, didReject, promise,\n                receiver, context);\n    }\n\n    return promise;\n};\n\nPromise.prototype._length = function () {\n    return this._bitField & 65535;\n};\n\nPromise.prototype._isFateSealed = function () {\n    return (this._bitField & 117506048) !== 0;\n};\n\nPromise.prototype._isFollowing = function () {\n    return (this._bitField & 67108864) === 67108864;\n};\n\nPromise.prototype._setLength = function (len) {\n    this._bitField = (this._bitField & -65536) |\n        (len & 65535);\n};\n\nPromise.prototype._setFulfilled = function () {\n    this._bitField = this._bitField | 33554432;\n    this._fireEvent(\"promiseFulfilled\", this);\n};\n\nPromise.prototype._setRejected = function () {\n    this._bitField = this._bitField | 16777216;\n    this._fireEvent(\"promiseRejected\", this);\n};\n\nPromise.prototype._setFollowing = function () {\n    this._bitField = this._bitField | 67108864;\n    this._fireEvent(\"promiseResolved\", this);\n};\n\nPromise.prototype._setIsFinal = function () {\n    this._bitField = this._bitField | 4194304;\n};\n\nPromise.prototype._isFinal = function () {\n    return (this._bitField & 4194304) > 0;\n};\n\nPromise.prototype._unsetCancelled = function() {\n    this._bitField = this._bitField & (~65536);\n};\n\nPromise.prototype._setCancelled = function() {\n    this._bitField = this._bitField | 65536;\n    this._fireEvent(\"promiseCancelled\", this);\n};\n\nPromise.prototype._setWillBeCancelled = function() {\n    this._bitField = this._bitField | 8388608;\n};\n\nPromise.prototype._setAsyncGuaranteed = function() {\n    if (async.hasCustomScheduler()) return;\n    var bitField = this._bitField;\n    this._bitField = bitField |\n        (((bitField & 536870912) >> 2) ^\n        134217728);\n};\n\nPromise.prototype._setNoAsyncGuarantee = function() {\n    this._bitField = (this._bitField | 536870912) &\n        (~134217728);\n};\n\nPromise.prototype._receiverAt = function (index) {\n    var ret = index === 0 ? this._receiver0 : this[\n            index * 4 - 4 + 3];\n    if (ret === UNDEFINED_BINDING) {\n        return undefined;\n    } else if (ret === undefined && this._isBound()) {\n        return this._boundValue();\n    }\n    return ret;\n};\n\nPromise.prototype._promiseAt = function (index) {\n    return this[\n            index * 4 - 4 + 2];\n};\n\nPromise.prototype._fulfillmentHandlerAt = function (index) {\n    return this[\n            index * 4 - 4 + 0];\n};\n\nPromise.prototype._rejectionHandlerAt = function (index) {\n    return this[\n            index * 4 - 4 + 1];\n};\n\nPromise.prototype._boundValue = function() {};\n\nPromise.prototype._migrateCallback0 = function (follower) {\n    var bitField = follower._bitField;\n    var fulfill = follower._fulfillmentHandler0;\n    var reject = follower._rejectionHandler0;\n    var promise = follower._promise0;\n    var receiver = follower._receiverAt(0);\n    if (receiver === undefined) receiver = UNDEFINED_BINDING;\n    this._addCallbacks(fulfill, reject, promise, receiver, null);\n};\n\nPromise.prototype._migrateCallbackAt = function (follower, index) {\n    var fulfill = follower._fulfillmentHandlerAt(index);\n    var reject = follower._rejectionHandlerAt(index);\n    var promise = follower._promiseAt(index);\n    var receiver = follower._receiverAt(index);\n    if (receiver === undefined) receiver = UNDEFINED_BINDING;\n    this._addCallbacks(fulfill, reject, promise, receiver, null);\n};\n\nPromise.prototype._addCallbacks = function (\n    fulfill,\n    reject,\n    promise,\n    receiver,\n    context\n) {\n    var index = this._length();\n\n    if (index >= 65535 - 4) {\n        index = 0;\n        this._setLength(0);\n    }\n\n    if (index === 0) {\n        this._promise0 = promise;\n        this._receiver0 = receiver;\n        if (typeof fulfill === \"function\") {\n            this._fulfillmentHandler0 = util.contextBind(context, fulfill);\n        }\n        if (typeof reject === \"function\") {\n            this._rejectionHandler0 = util.contextBind(context, reject);\n        }\n    } else {\n        var base = index * 4 - 4;\n        this[base + 2] = promise;\n        this[base + 3] = receiver;\n        if (typeof fulfill === \"function\") {\n            this[base + 0] =\n                util.contextBind(context, fulfill);\n        }\n        if (typeof reject === \"function\") {\n            this[base + 1] =\n                util.contextBind(context, reject);\n        }\n    }\n    this._setLength(index + 1);\n    return index;\n};\n\nPromise.prototype._proxy = function (proxyable, arg) {\n    this._addCallbacks(undefined, undefined, arg, proxyable, null);\n};\n\nPromise.prototype._resolveCallback = function(value, shouldBind) {\n    if (((this._bitField & 117506048) !== 0)) return;\n    if (value === this)\n        return this._rejectCallback(makeSelfResolutionError(), false);\n    var maybePromise = tryConvertToPromise(value, this);\n    if (!(maybePromise instanceof Promise)) return this._fulfill(value);\n\n    if (shouldBind) this._propagateFrom(maybePromise, 2);\n\n\n    var promise = maybePromise._target();\n\n    if (promise === this) {\n        this._reject(makeSelfResolutionError());\n        return;\n    }\n\n    var bitField = promise._bitField;\n    if (((bitField & 50397184) === 0)) {\n        var len = this._length();\n        if (len > 0) promise._migrateCallback0(this);\n        for (var i = 1; i < len; ++i) {\n            promise._migrateCallbackAt(this, i);\n        }\n        this._setFollowing();\n        this._setLength(0);\n        this._setFollowee(maybePromise);\n    } else if (((bitField & 33554432) !== 0)) {\n        this._fulfill(promise._value());\n    } else if (((bitField & 16777216) !== 0)) {\n        this._reject(promise._reason());\n    } else {\n        var reason = new CancellationError(\"late cancellation observer\");\n        promise._attachExtraTrace(reason);\n        this._reject(reason);\n    }\n};\n\nPromise.prototype._rejectCallback =\nfunction(reason, synchronous, ignoreNonErrorWarnings) {\n    var trace = util.ensureErrorObject(reason);\n    var hasStack = trace === reason;\n    if (!hasStack && !ignoreNonErrorWarnings && debug.warnings()) {\n        var message = \"a promise was rejected with a non-error: \" +\n            util.classString(reason);\n        this._warn(message, true);\n    }\n    this._attachExtraTrace(trace, synchronous ? hasStack : false);\n    this._reject(reason);\n};\n\nPromise.prototype._resolveFromExecutor = function (executor) {\n    if (executor === INTERNAL) return;\n    var promise = this;\n    this._captureStackTrace();\n    this._pushContext();\n    var synchronous = true;\n    var r = this._execute(executor, function(value) {\n        promise._resolveCallback(value);\n    }, function (reason) {\n        promise._rejectCallback(reason, synchronous);\n    });\n    synchronous = false;\n    this._popContext();\n\n    if (r !== undefined) {\n        promise._rejectCallback(r, true);\n    }\n};\n\nPromise.prototype._settlePromiseFromHandler = function (\n    handler, receiver, value, promise\n) {\n    var bitField = promise._bitField;\n    if (((bitField & 65536) !== 0)) return;\n    promise._pushContext();\n    var x;\n    if (receiver === APPLY) {\n        if (!value || typeof value.length !== \"number\") {\n            x = errorObj;\n            x.e = new TypeError(\"cannot .spread() a non-array: \" +\n                                    util.classString(value));\n        } else {\n            x = tryCatch(handler).apply(this._boundValue(), value);\n        }\n    } else {\n        x = tryCatch(handler).call(receiver, value);\n    }\n    var promiseCreated = promise._popContext();\n    bitField = promise._bitField;\n    if (((bitField & 65536) !== 0)) return;\n\n    if (x === NEXT_FILTER) {\n        promise._reject(value);\n    } else if (x === errorObj) {\n        promise._rejectCallback(x.e, false);\n    } else {\n        debug.checkForgottenReturns(x, promiseCreated, \"\",  promise, this);\n        promise._resolveCallback(x);\n    }\n};\n\nPromise.prototype._target = function() {\n    var ret = this;\n    while (ret._isFollowing()) ret = ret._followee();\n    return ret;\n};\n\nPromise.prototype._followee = function() {\n    return this._rejectionHandler0;\n};\n\nPromise.prototype._setFollowee = function(promise) {\n    this._rejectionHandler0 = promise;\n};\n\nPromise.prototype._settlePromise = function(promise, handler, receiver, value) {\n    var isPromise = promise instanceof Promise;\n    var bitField = this._bitField;\n    var asyncGuaranteed = ((bitField & 134217728) !== 0);\n    if (((bitField & 65536) !== 0)) {\n        if (isPromise) promise._invokeInternalOnCancel();\n\n        if (receiver instanceof PassThroughHandlerContext &&\n            receiver.isFinallyHandler()) {\n            receiver.cancelPromise = promise;\n            if (tryCatch(handler).call(receiver, value) === errorObj) {\n                promise._reject(errorObj.e);\n            }\n        } else if (handler === reflectHandler) {\n            promise._fulfill(reflectHandler.call(receiver));\n        } else if (receiver instanceof Proxyable) {\n            receiver._promiseCancelled(promise);\n        } else if (isPromise || promise instanceof PromiseArray) {\n            promise._cancel();\n        } else {\n            receiver.cancel();\n        }\n    } else if (typeof handler === \"function\") {\n        if (!isPromise) {\n            handler.call(receiver, value, promise);\n        } else {\n            if (asyncGuaranteed) promise._setAsyncGuaranteed();\n            this._settlePromiseFromHandler(handler, receiver, value, promise);\n        }\n    } else if (receiver instanceof Proxyable) {\n        if (!receiver._isResolved()) {\n            if (((bitField & 33554432) !== 0)) {\n                receiver._promiseFulfilled(value, promise);\n            } else {\n                receiver._promiseRejected(value, promise);\n            }\n        }\n    } else if (isPromise) {\n        if (asyncGuaranteed) promise._setAsyncGuaranteed();\n        if (((bitField & 33554432) !== 0)) {\n            promise._fulfill(value);\n        } else {\n            promise._reject(value);\n        }\n    }\n};\n\nPromise.prototype._settlePromiseLateCancellationObserver = function(ctx) {\n    var handler = ctx.handler;\n    var promise = ctx.promise;\n    var receiver = ctx.receiver;\n    var value = ctx.value;\n    if (typeof handler === \"function\") {\n        if (!(promise instanceof Promise)) {\n            handler.call(receiver, value, promise);\n        } else {\n            this._settlePromiseFromHandler(handler, receiver, value, promise);\n        }\n    } else if (promise instanceof Promise) {\n        promise._reject(value);\n    }\n};\n\nPromise.prototype._settlePromiseCtx = function(ctx) {\n    this._settlePromise(ctx.promise, ctx.handler, ctx.receiver, ctx.value);\n};\n\nPromise.prototype._settlePromise0 = function(handler, value, bitField) {\n    var promise = this._promise0;\n    var receiver = this._receiverAt(0);\n    this._promise0 = undefined;\n    this._receiver0 = undefined;\n    this._settlePromise(promise, handler, receiver, value);\n};\n\nPromise.prototype._clearCallbackDataAtIndex = function(index) {\n    var base = index * 4 - 4;\n    this[base + 2] =\n    this[base + 3] =\n    this[base + 0] =\n    this[base + 1] = undefined;\n};\n\nPromise.prototype._fulfill = function (value) {\n    var bitField = this._bitField;\n    if (((bitField & 117506048) >>> 16)) return;\n    if (value === this) {\n        var err = makeSelfResolutionError();\n        this._attachExtraTrace(err);\n        return this._reject(err);\n    }\n    this._setFulfilled();\n    this._rejectionHandler0 = value;\n\n    if ((bitField & 65535) > 0) {\n        if (((bitField & 134217728) !== 0)) {\n            this._settlePromises();\n        } else {\n            async.settlePromises(this);\n        }\n        this._dereferenceTrace();\n    }\n};\n\nPromise.prototype._reject = function (reason) {\n    var bitField = this._bitField;\n    if (((bitField & 117506048) >>> 16)) return;\n    this._setRejected();\n    this._fulfillmentHandler0 = reason;\n\n    if (this._isFinal()) {\n        return async.fatalError(reason, util.isNode);\n    }\n\n    if ((bitField & 65535) > 0) {\n        async.settlePromises(this);\n    } else {\n        this._ensurePossibleRejectionHandled();\n    }\n};\n\nPromise.prototype._fulfillPromises = function (len, value) {\n    for (var i = 1; i < len; i++) {\n        var handler = this._fulfillmentHandlerAt(i);\n        var promise = this._promiseAt(i);\n        var receiver = this._receiverAt(i);\n        this._clearCallbackDataAtIndex(i);\n        this._settlePromise(promise, handler, receiver, value);\n    }\n};\n\nPromise.prototype._rejectPromises = function (len, reason) {\n    for (var i = 1; i < len; i++) {\n        var handler = this._rejectionHandlerAt(i);\n        var promise = this._promiseAt(i);\n        var receiver = this._receiverAt(i);\n        this._clearCallbackDataAtIndex(i);\n        this._settlePromise(promise, handler, receiver, reason);\n    }\n};\n\nPromise.prototype._settlePromises = function () {\n    var bitField = this._bitField;\n    var len = (bitField & 65535);\n\n    if (len > 0) {\n        if (((bitField & 16842752) !== 0)) {\n            var reason = this._fulfillmentHandler0;\n            this._settlePromise0(this._rejectionHandler0, reason, bitField);\n            this._rejectPromises(len, reason);\n        } else {\n            var value = this._rejectionHandler0;\n            this._settlePromise0(this._fulfillmentHandler0, value, bitField);\n            this._fulfillPromises(len, value);\n        }\n        this._setLength(0);\n    }\n    this._clearCancellationData();\n};\n\nPromise.prototype._settledValue = function() {\n    var bitField = this._bitField;\n    if (((bitField & 33554432) !== 0)) {\n        return this._rejectionHandler0;\n    } else if (((bitField & 16777216) !== 0)) {\n        return this._fulfillmentHandler0;\n    }\n};\n\nif (typeof Symbol !== \"undefined\" && Symbol.toStringTag) {\n    es5.defineProperty(Promise.prototype, Symbol.toStringTag, {\n        get: function () {\n            return \"Object\";\n        }\n    });\n}\n\nfunction deferResolve(v) {this.promise._resolveCallback(v);}\nfunction deferReject(v) {this.promise._rejectCallback(v, false);}\n\nPromise.defer = Promise.pending = function() {\n    debug.deprecated(\"Promise.defer\", \"new Promise\");\n    var promise = new Promise(INTERNAL);\n    return {\n        promise: promise,\n        resolve: deferResolve,\n        reject: deferReject\n    };\n};\n\nutil.notEnumerableProp(Promise,\n                       \"_makeSelfResolutionError\",\n                       makeSelfResolutionError);\n\n_dereq_(\"./method\")(Promise, INTERNAL, tryConvertToPromise, apiRejection,\n    debug);\n_dereq_(\"./bind\")(Promise, INTERNAL, tryConvertToPromise, debug);\n_dereq_(\"./cancel\")(Promise, PromiseArray, apiRejection, debug);\n_dereq_(\"./direct_resolve\")(Promise);\n_dereq_(\"./synchronous_inspection\")(Promise);\n_dereq_(\"./join\")(\n    Promise, PromiseArray, tryConvertToPromise, INTERNAL, async);\nPromise.Promise = Promise;\nPromise.version = \"3.7.2\";\n_dereq_('./call_get.js')(Promise);\n_dereq_('./generators.js')(Promise, apiRejection, INTERNAL, tryConvertToPromise, Proxyable, debug);\n_dereq_('./map.js')(Promise, PromiseArray, apiRejection, tryConvertToPromise, INTERNAL, debug);\n_dereq_('./nodeify.js')(Promise);\n_dereq_('./promisify.js')(Promise, INTERNAL);\n_dereq_('./props.js')(Promise, PromiseArray, tryConvertToPromise, apiRejection);\n_dereq_('./race.js')(Promise, INTERNAL, tryConvertToPromise, apiRejection);\n_dereq_('./reduce.js')(Promise, PromiseArray, apiRejection, tryConvertToPromise, INTERNAL, debug);\n_dereq_('./settle.js')(Promise, PromiseArray, debug);\n_dereq_('./some.js')(Promise, PromiseArray, apiRejection);\n_dereq_('./timers.js')(Promise, INTERNAL, debug);\n_dereq_('./using.js')(Promise, apiRejection, tryConvertToPromise, createContext, INTERNAL, debug);\n_dereq_('./any.js')(Promise);\n_dereq_('./each.js')(Promise, INTERNAL);\n_dereq_('./filter.js')(Promise, INTERNAL);\n                                                         \n    util.toFastProperties(Promise);                                          \n    util.toFastProperties(Promise.prototype);                                \n    function fillTypes(value) {                                              \n        var p = new Promise(INTERNAL);                                       \n        p._fulfillmentHandler0 = value;                                      \n        p._rejectionHandler0 = value;                                        \n        p._promise0 = value;                                                 \n        p._receiver0 = value;                                                \n    }                                                                        \n    // Complete slack tracking, opt out of field-type tracking and           \n    // stabilize map                                                         \n    fillTypes({a: 1});                                                       \n    fillTypes({b: 2});                                                       \n    fillTypes({c: 3});                                                       \n    fillTypes(1);                                                            \n    fillTypes(function(){});                                                 \n    fillTypes(undefined);                                                    \n    fillTypes(false);                                                        \n    fillTypes(new Promise(INTERNAL));                                        \n    debug.setBounds(Async.firstLineError, util.lastLineError);               \n    return Promise;                                                          \n\n};\n\n},{\"./any.js\":1,\"./async\":2,\"./bind\":3,\"./call_get.js\":5,\"./cancel\":6,\"./catch_filter\":7,\"./context\":8,\"./debuggability\":9,\"./direct_resolve\":10,\"./each.js\":11,\"./errors\":12,\"./es5\":13,\"./filter.js\":14,\"./finally\":15,\"./generators.js\":16,\"./join\":17,\"./map.js\":18,\"./method\":19,\"./nodeback\":20,\"./nodeify.js\":21,\"./promise_array\":23,\"./promisify.js\":24,\"./props.js\":25,\"./race.js\":27,\"./reduce.js\":28,\"./settle.js\":30,\"./some.js\":31,\"./synchronous_inspection\":32,\"./thenables\":33,\"./timers.js\":34,\"./using.js\":35,\"./util\":36,\"async_hooks\":undefined}],23:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise, INTERNAL, tryConvertToPromise,\n    apiRejection, Proxyable) {\nvar util = _dereq_(\"./util\");\nvar isArray = util.isArray;\n\nfunction toResolutionValue(val) {\n    switch(val) {\n    case -2: return [];\n    case -3: return {};\n    case -6: return new Map();\n    }\n}\n\nfunction PromiseArray(values) {\n    var promise = this._promise = new Promise(INTERNAL);\n    if (values instanceof Promise) {\n        promise._propagateFrom(values, 3);\n        values.suppressUnhandledRejections();\n    }\n    promise._setOnCancel(this);\n    this._values = values;\n    this._length = 0;\n    this._totalResolved = 0;\n    this._init(undefined, -2);\n}\nutil.inherits(PromiseArray, Proxyable);\n\nPromiseArray.prototype.length = function () {\n    return this._length;\n};\n\nPromiseArray.prototype.promise = function () {\n    return this._promise;\n};\n\nPromiseArray.prototype._init = function init(_, resolveValueIfEmpty) {\n    var values = tryConvertToPromise(this._values, this._promise);\n    if (values instanceof Promise) {\n        values = values._target();\n        var bitField = values._bitField;\n        ;\n        this._values = values;\n\n        if (((bitField & 50397184) === 0)) {\n            this._promise._setAsyncGuaranteed();\n            return values._then(\n                init,\n                this._reject,\n                undefined,\n                this,\n                resolveValueIfEmpty\n           );\n        } else if (((bitField & 33554432) !== 0)) {\n            values = values._value();\n        } else if (((bitField & 16777216) !== 0)) {\n            return this._reject(values._reason());\n        } else {\n            return this._cancel();\n        }\n    }\n    values = util.asArray(values);\n    if (values === null) {\n        var err = apiRejection(\n            \"expecting an array or an iterable object but got \" + util.classString(values)).reason();\n        this._promise._rejectCallback(err, false);\n        return;\n    }\n\n    if (values.length === 0) {\n        if (resolveValueIfEmpty === -5) {\n            this._resolveEmptyArray();\n        }\n        else {\n            this._resolve(toResolutionValue(resolveValueIfEmpty));\n        }\n        return;\n    }\n    this._iterate(values);\n};\n\nPromiseArray.prototype._iterate = function(values) {\n    var len = this.getActualLength(values.length);\n    this._length = len;\n    this._values = this.shouldCopyValues() ? new Array(len) : this._values;\n    var result = this._promise;\n    var isResolved = false;\n    var bitField = null;\n    for (var i = 0; i < len; ++i) {\n        var maybePromise = tryConvertToPromise(values[i], result);\n\n        if (maybePromise instanceof Promise) {\n            maybePromise = maybePromise._target();\n            bitField = maybePromise._bitField;\n        } else {\n            bitField = null;\n        }\n\n        if (isResolved) {\n            if (bitField !== null) {\n                maybePromise.suppressUnhandledRejections();\n            }\n        } else if (bitField !== null) {\n            if (((bitField & 50397184) === 0)) {\n                maybePromise._proxy(this, i);\n                this._values[i] = maybePromise;\n            } else if (((bitField & 33554432) !== 0)) {\n                isResolved = this._promiseFulfilled(maybePromise._value(), i);\n            } else if (((bitField & 16777216) !== 0)) {\n                isResolved = this._promiseRejected(maybePromise._reason(), i);\n            } else {\n                isResolved = this._promiseCancelled(i);\n            }\n        } else {\n            isResolved = this._promiseFulfilled(maybePromise, i);\n        }\n    }\n    if (!isResolved) result._setAsyncGuaranteed();\n};\n\nPromiseArray.prototype._isResolved = function () {\n    return this._values === null;\n};\n\nPromiseArray.prototype._resolve = function (value) {\n    this._values = null;\n    this._promise._fulfill(value);\n};\n\nPromiseArray.prototype._cancel = function() {\n    if (this._isResolved() || !this._promise._isCancellable()) return;\n    this._values = null;\n    this._promise._cancel();\n};\n\nPromiseArray.prototype._reject = function (reason) {\n    this._values = null;\n    this._promise._rejectCallback(reason, false);\n};\n\nPromiseArray.prototype._promiseFulfilled = function (value, index) {\n    this._values[index] = value;\n    var totalResolved = ++this._totalResolved;\n    if (totalResolved >= this._length) {\n        this._resolve(this._values);\n        return true;\n    }\n    return false;\n};\n\nPromiseArray.prototype._promiseCancelled = function() {\n    this._cancel();\n    return true;\n};\n\nPromiseArray.prototype._promiseRejected = function (reason) {\n    this._totalResolved++;\n    this._reject(reason);\n    return true;\n};\n\nPromiseArray.prototype._resultCancelled = function() {\n    if (this._isResolved()) return;\n    var values = this._values;\n    this._cancel();\n    if (values instanceof Promise) {\n        values.cancel();\n    } else {\n        for (var i = 0; i < values.length; ++i) {\n            if (values[i] instanceof Promise) {\n                values[i].cancel();\n            }\n        }\n    }\n};\n\nPromiseArray.prototype.shouldCopyValues = function () {\n    return true;\n};\n\nPromiseArray.prototype.getActualLength = function (len) {\n    return len;\n};\n\nreturn PromiseArray;\n};\n\n},{\"./util\":36}],24:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise, INTERNAL) {\nvar THIS = {};\nvar util = _dereq_(\"./util\");\nvar nodebackForPromise = _dereq_(\"./nodeback\");\nvar withAppended = util.withAppended;\nvar maybeWrapAsError = util.maybeWrapAsError;\nvar canEvaluate = util.canEvaluate;\nvar TypeError = _dereq_(\"./errors\").TypeError;\nvar defaultSuffix = \"Async\";\nvar defaultPromisified = {__isPromisified__: true};\nvar noCopyProps = [\n    \"arity\",    \"length\",\n    \"name\",\n    \"arguments\",\n    \"caller\",\n    \"callee\",\n    \"prototype\",\n    \"__isPromisified__\"\n];\nvar noCopyPropsPattern = new RegExp(\"^(?:\" + noCopyProps.join(\"|\") + \")$\");\n\nvar defaultFilter = function(name) {\n    return util.isIdentifier(name) &&\n        name.charAt(0) !== \"_\" &&\n        name !== \"constructor\";\n};\n\nfunction propsFilter(key) {\n    return !noCopyPropsPattern.test(key);\n}\n\nfunction isPromisified(fn) {\n    try {\n        return fn.__isPromisified__ === true;\n    }\n    catch (e) {\n        return false;\n    }\n}\n\nfunction hasPromisified(obj, key, suffix) {\n    var val = util.getDataPropertyOrDefault(obj, key + suffix,\n                                            defaultPromisified);\n    return val ? isPromisified(val) : false;\n}\nfunction checkValid(ret, suffix, suffixRegexp) {\n    for (var i = 0; i < ret.length; i += 2) {\n        var key = ret[i];\n        if (suffixRegexp.test(key)) {\n            var keyWithoutAsyncSuffix = key.replace(suffixRegexp, \"\");\n            for (var j = 0; j < ret.length; j += 2) {\n                if (ret[j] === keyWithoutAsyncSuffix) {\n                    throw new TypeError(\"Cannot promisify an API that has normal methods with '%s'-suffix\\u000a\\u000a    See http://goo.gl/MqrFmX\\u000a\"\n                        .replace(\"%s\", suffix));\n                }\n            }\n        }\n    }\n}\n\nfunction promisifiableMethods(obj, suffix, suffixRegexp, filter) {\n    var keys = util.inheritedDataKeys(obj);\n    var ret = [];\n    for (var i = 0; i < keys.length; ++i) {\n        var key = keys[i];\n        var value = obj[key];\n        var passesDefaultFilter = filter === defaultFilter\n            ? true : defaultFilter(key, value, obj);\n        if (typeof value === \"function\" &&\n            !isPromisified(value) &&\n            !hasPromisified(obj, key, suffix) &&\n            filter(key, value, obj, passesDefaultFilter)) {\n            ret.push(key, value);\n        }\n    }\n    checkValid(ret, suffix, suffixRegexp);\n    return ret;\n}\n\nvar escapeIdentRegex = function(str) {\n    return str.replace(/([$])/, \"\\\\$\");\n};\n\nvar makeNodePromisifiedEval;\nif (!true) {\nvar switchCaseArgumentOrder = function(likelyArgumentCount) {\n    var ret = [likelyArgumentCount];\n    var min = Math.max(0, likelyArgumentCount - 1 - 3);\n    for(var i = likelyArgumentCount - 1; i >= min; --i) {\n        ret.push(i);\n    }\n    for(var i = likelyArgumentCount + 1; i <= 3; ++i) {\n        ret.push(i);\n    }\n    return ret;\n};\n\nvar argumentSequence = function(argumentCount) {\n    return util.filledRange(argumentCount, \"_arg\", \"\");\n};\n\nvar parameterDeclaration = function(parameterCount) {\n    return util.filledRange(\n        Math.max(parameterCount, 3), \"_arg\", \"\");\n};\n\nvar parameterCount = function(fn) {\n    if (typeof fn.length === \"number\") {\n        return Math.max(Math.min(fn.length, 1023 + 1), 0);\n    }\n    return 0;\n};\n\nmakeNodePromisifiedEval =\nfunction(callback, receiver, originalName, fn, _, multiArgs) {\n    var newParameterCount = Math.max(0, parameterCount(fn) - 1);\n    var argumentOrder = switchCaseArgumentOrder(newParameterCount);\n    var shouldProxyThis = typeof callback === \"string\" || receiver === THIS;\n\n    function generateCallForArgumentCount(count) {\n        var args = argumentSequence(count).join(\", \");\n        var comma = count > 0 ? \", \" : \"\";\n        var ret;\n        if (shouldProxyThis) {\n            ret = \"ret = callback.call(this, {{args}}, nodeback); break;\\n\";\n        } else {\n            ret = receiver === undefined\n                ? \"ret = callback({{args}}, nodeback); break;\\n\"\n                : \"ret = callback.call(receiver, {{args}}, nodeback); break;\\n\";\n        }\n        return ret.replace(\"{{args}}\", args).replace(\", \", comma);\n    }\n\n    function generateArgumentSwitchCase() {\n        var ret = \"\";\n        for (var i = 0; i < argumentOrder.length; ++i) {\n            ret += \"case \" + argumentOrder[i] +\":\" +\n                generateCallForArgumentCount(argumentOrder[i]);\n        }\n\n        ret += \"                                                             \\n\\\n        default:                                                             \\n\\\n            var args = new Array(len + 1);                                   \\n\\\n            var i = 0;                                                       \\n\\\n            for (var i = 0; i < len; ++i) {                                  \\n\\\n               args[i] = arguments[i];                                       \\n\\\n            }                                                                \\n\\\n            args[i] = nodeback;                                              \\n\\\n            [CodeForCall]                                                    \\n\\\n            break;                                                           \\n\\\n        \".replace(\"[CodeForCall]\", (shouldProxyThis\n                                ? \"ret = callback.apply(this, args);\\n\"\n                                : \"ret = callback.apply(receiver, args);\\n\"));\n        return ret;\n    }\n\n    var getFunctionCode = typeof callback === \"string\"\n                                ? (\"this != null ? this['\"+callback+\"'] : fn\")\n                                : \"fn\";\n    var body = \"'use strict';                                                \\n\\\n        var ret = function (Parameters) {                                    \\n\\\n            'use strict';                                                    \\n\\\n            var len = arguments.length;                                      \\n\\\n            var promise = new Promise(INTERNAL);                             \\n\\\n            promise._captureStackTrace();                                    \\n\\\n            var nodeback = nodebackForPromise(promise, \" + multiArgs + \");   \\n\\\n            var ret;                                                         \\n\\\n            var callback = tryCatch([GetFunctionCode]);                      \\n\\\n            switch(len) {                                                    \\n\\\n                [CodeForSwitchCase]                                          \\n\\\n            }                                                                \\n\\\n            if (ret === errorObj) {                                          \\n\\\n                promise._rejectCallback(maybeWrapAsError(ret.e), true, true);\\n\\\n            }                                                                \\n\\\n            if (!promise._isFateSealed()) promise._setAsyncGuaranteed();     \\n\\\n            return promise;                                                  \\n\\\n        };                                                                   \\n\\\n        notEnumerableProp(ret, '__isPromisified__', true);                   \\n\\\n        return ret;                                                          \\n\\\n    \".replace(\"[CodeForSwitchCase]\", generateArgumentSwitchCase())\n        .replace(\"[GetFunctionCode]\", getFunctionCode);\n    body = body.replace(\"Parameters\", parameterDeclaration(newParameterCount));\n    return new Function(\"Promise\",\n                        \"fn\",\n                        \"receiver\",\n                        \"withAppended\",\n                        \"maybeWrapAsError\",\n                        \"nodebackForPromise\",\n                        \"tryCatch\",\n                        \"errorObj\",\n                        \"notEnumerableProp\",\n                        \"INTERNAL\",\n                        body)(\n                    Promise,\n                    fn,\n                    receiver,\n                    withAppended,\n                    maybeWrapAsError,\n                    nodebackForPromise,\n                    util.tryCatch,\n                    util.errorObj,\n                    util.notEnumerableProp,\n                    INTERNAL);\n};\n}\n\nfunction makeNodePromisifiedClosure(callback, receiver, _, fn, __, multiArgs) {\n    var defaultThis = (function() {return this;})();\n    var method = callback;\n    if (typeof method === \"string\") {\n        callback = fn;\n    }\n    function promisified() {\n        var _receiver = receiver;\n        if (receiver === THIS) _receiver = this;\n        var promise = new Promise(INTERNAL);\n        promise._captureStackTrace();\n        var cb = typeof method === \"string\" && this !== defaultThis\n            ? this[method] : callback;\n        var fn = nodebackForPromise(promise, multiArgs);\n        try {\n            cb.apply(_receiver, withAppended(arguments, fn));\n        } catch(e) {\n            promise._rejectCallback(maybeWrapAsError(e), true, true);\n        }\n        if (!promise._isFateSealed()) promise._setAsyncGuaranteed();\n        return promise;\n    }\n    util.notEnumerableProp(promisified, \"__isPromisified__\", true);\n    return promisified;\n}\n\nvar makeNodePromisified = canEvaluate\n    ? makeNodePromisifiedEval\n    : makeNodePromisifiedClosure;\n\nfunction promisifyAll(obj, suffix, filter, promisifier, multiArgs) {\n    var suffixRegexp = new RegExp(escapeIdentRegex(suffix) + \"$\");\n    var methods =\n        promisifiableMethods(obj, suffix, suffixRegexp, filter);\n\n    for (var i = 0, len = methods.length; i < len; i+= 2) {\n        var key = methods[i];\n        var fn = methods[i+1];\n        var promisifiedKey = key + suffix;\n        if (promisifier === makeNodePromisified) {\n            obj[promisifiedKey] =\n                makeNodePromisified(key, THIS, key, fn, suffix, multiArgs);\n        } else {\n            var promisified = promisifier(fn, function() {\n                return makeNodePromisified(key, THIS, key,\n                                           fn, suffix, multiArgs);\n            });\n            util.notEnumerableProp(promisified, \"__isPromisified__\", true);\n            obj[promisifiedKey] = promisified;\n        }\n    }\n    util.toFastProperties(obj);\n    return obj;\n}\n\nfunction promisify(callback, receiver, multiArgs) {\n    return makeNodePromisified(callback, receiver, undefined,\n                                callback, null, multiArgs);\n}\n\nPromise.promisify = function (fn, options) {\n    if (typeof fn !== \"function\") {\n        throw new TypeError(\"expecting a function but got \" + util.classString(fn));\n    }\n    if (isPromisified(fn)) {\n        return fn;\n    }\n    options = Object(options);\n    var receiver = options.context === undefined ? THIS : options.context;\n    var multiArgs = !!options.multiArgs;\n    var ret = promisify(fn, receiver, multiArgs);\n    util.copyDescriptors(fn, ret, propsFilter);\n    return ret;\n};\n\nPromise.promisifyAll = function (target, options) {\n    if (typeof target !== \"function\" && typeof target !== \"object\") {\n        throw new TypeError(\"the target of promisifyAll must be an object or a function\\u000a\\u000a    See http://goo.gl/MqrFmX\\u000a\");\n    }\n    options = Object(options);\n    var multiArgs = !!options.multiArgs;\n    var suffix = options.suffix;\n    if (typeof suffix !== \"string\") suffix = defaultSuffix;\n    var filter = options.filter;\n    if (typeof filter !== \"function\") filter = defaultFilter;\n    var promisifier = options.promisifier;\n    if (typeof promisifier !== \"function\") promisifier = makeNodePromisified;\n\n    if (!util.isIdentifier(suffix)) {\n        throw new RangeError(\"suffix must be a valid identifier\\u000a\\u000a    See http://goo.gl/MqrFmX\\u000a\");\n    }\n\n    var keys = util.inheritedDataKeys(target);\n    for (var i = 0; i < keys.length; ++i) {\n        var value = target[keys[i]];\n        if (keys[i] !== \"constructor\" &&\n            util.isClass(value)) {\n            promisifyAll(value.prototype, suffix, filter, promisifier,\n                multiArgs);\n            promisifyAll(value, suffix, filter, promisifier, multiArgs);\n        }\n    }\n\n    return promisifyAll(target, suffix, filter, promisifier, multiArgs);\n};\n};\n\n\n},{\"./errors\":12,\"./nodeback\":20,\"./util\":36}],25:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(\n    Promise, PromiseArray, tryConvertToPromise, apiRejection) {\nvar util = _dereq_(\"./util\");\nvar isObject = util.isObject;\nvar es5 = _dereq_(\"./es5\");\nvar Es6Map;\nif (typeof Map === \"function\") Es6Map = Map;\n\nvar mapToEntries = (function() {\n    var index = 0;\n    var size = 0;\n\n    function extractEntry(value, key) {\n        this[index] = value;\n        this[index + size] = key;\n        index++;\n    }\n\n    return function mapToEntries(map) {\n        size = map.size;\n        index = 0;\n        var ret = new Array(map.size * 2);\n        map.forEach(extractEntry, ret);\n        return ret;\n    };\n})();\n\nvar entriesToMap = function(entries) {\n    var ret = new Es6Map();\n    var length = entries.length / 2 | 0;\n    for (var i = 0; i < length; ++i) {\n        var key = entries[length + i];\n        var value = entries[i];\n        ret.set(key, value);\n    }\n    return ret;\n};\n\nfunction PropertiesPromiseArray(obj) {\n    var isMap = false;\n    var entries;\n    if (Es6Map !== undefined && obj instanceof Es6Map) {\n        entries = mapToEntries(obj);\n        isMap = true;\n    } else {\n        var keys = es5.keys(obj);\n        var len = keys.length;\n        entries = new Array(len * 2);\n        for (var i = 0; i < len; ++i) {\n            var key = keys[i];\n            entries[i] = obj[key];\n            entries[i + len] = key;\n        }\n    }\n    this.constructor$(entries);\n    this._isMap = isMap;\n    this._init$(undefined, isMap ? -6 : -3);\n}\nutil.inherits(PropertiesPromiseArray, PromiseArray);\n\nPropertiesPromiseArray.prototype._init = function () {};\n\nPropertiesPromiseArray.prototype._promiseFulfilled = function (value, index) {\n    this._values[index] = value;\n    var totalResolved = ++this._totalResolved;\n    if (totalResolved >= this._length) {\n        var val;\n        if (this._isMap) {\n            val = entriesToMap(this._values);\n        } else {\n            val = {};\n            var keyOffset = this.length();\n            for (var i = 0, len = this.length(); i < len; ++i) {\n                val[this._values[i + keyOffset]] = this._values[i];\n            }\n        }\n        this._resolve(val);\n        return true;\n    }\n    return false;\n};\n\nPropertiesPromiseArray.prototype.shouldCopyValues = function () {\n    return false;\n};\n\nPropertiesPromiseArray.prototype.getActualLength = function (len) {\n    return len >> 1;\n};\n\nfunction props(promises) {\n    var ret;\n    var castValue = tryConvertToPromise(promises);\n\n    if (!isObject(castValue)) {\n        return apiRejection(\"cannot await properties of a non-object\\u000a\\u000a    See http://goo.gl/MqrFmX\\u000a\");\n    } else if (castValue instanceof Promise) {\n        ret = castValue._then(\n            Promise.props, undefined, undefined, undefined, undefined);\n    } else {\n        ret = new PropertiesPromiseArray(castValue).promise();\n    }\n\n    if (castValue instanceof Promise) {\n        ret._propagateFrom(castValue, 2);\n    }\n    return ret;\n}\n\nPromise.prototype.props = function () {\n    return props(this);\n};\n\nPromise.props = function (promises) {\n    return props(promises);\n};\n};\n\n},{\"./es5\":13,\"./util\":36}],26:[function(_dereq_,module,exports){\n\"use strict\";\nfunction arrayMove(src, srcIndex, dst, dstIndex, len) {\n    for (var j = 0; j < len; ++j) {\n        dst[j + dstIndex] = src[j + srcIndex];\n        src[j + srcIndex] = void 0;\n    }\n}\n\nfunction Queue(capacity) {\n    this._capacity = capacity;\n    this._length = 0;\n    this._front = 0;\n}\n\nQueue.prototype._willBeOverCapacity = function (size) {\n    return this._capacity < size;\n};\n\nQueue.prototype._pushOne = function (arg) {\n    var length = this.length();\n    this._checkCapacity(length + 1);\n    var i = (this._front + length) & (this._capacity - 1);\n    this[i] = arg;\n    this._length = length + 1;\n};\n\nQueue.prototype.push = function (fn, receiver, arg) {\n    var length = this.length() + 3;\n    if (this._willBeOverCapacity(length)) {\n        this._pushOne(fn);\n        this._pushOne(receiver);\n        this._pushOne(arg);\n        return;\n    }\n    var j = this._front + length - 3;\n    this._checkCapacity(length);\n    var wrapMask = this._capacity - 1;\n    this[(j + 0) & wrapMask] = fn;\n    this[(j + 1) & wrapMask] = receiver;\n    this[(j + 2) & wrapMask] = arg;\n    this._length = length;\n};\n\nQueue.prototype.shift = function () {\n    var front = this._front,\n        ret = this[front];\n\n    this[front] = undefined;\n    this._front = (front + 1) & (this._capacity - 1);\n    this._length--;\n    return ret;\n};\n\nQueue.prototype.length = function () {\n    return this._length;\n};\n\nQueue.prototype._checkCapacity = function (size) {\n    if (this._capacity < size) {\n        this._resizeTo(this._capacity << 1);\n    }\n};\n\nQueue.prototype._resizeTo = function (capacity) {\n    var oldCapacity = this._capacity;\n    this._capacity = capacity;\n    var front = this._front;\n    var length = this._length;\n    var moveItemsCount = (front + length) & (oldCapacity - 1);\n    arrayMove(this, 0, this, oldCapacity, moveItemsCount);\n};\n\nmodule.exports = Queue;\n\n},{}],27:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(\n    Promise, INTERNAL, tryConvertToPromise, apiRejection) {\nvar util = _dereq_(\"./util\");\n\nvar raceLater = function (promise) {\n    return promise.then(function(array) {\n        return race(array, promise);\n    });\n};\n\nfunction race(promises, parent) {\n    var maybePromise = tryConvertToPromise(promises);\n\n    if (maybePromise instanceof Promise) {\n        return raceLater(maybePromise);\n    } else {\n        promises = util.asArray(promises);\n        if (promises === null)\n            return apiRejection(\"expecting an array or an iterable object but got \" + util.classString(promises));\n    }\n\n    var ret = new Promise(INTERNAL);\n    if (parent !== undefined) {\n        ret._propagateFrom(parent, 3);\n    }\n    var fulfill = ret._fulfill;\n    var reject = ret._reject;\n    for (var i = 0, len = promises.length; i < len; ++i) {\n        var val = promises[i];\n\n        if (val === undefined && !(i in promises)) {\n            continue;\n        }\n\n        Promise.cast(val)._then(fulfill, reject, undefined, ret, null);\n    }\n    return ret;\n}\n\nPromise.race = function (promises) {\n    return race(promises, undefined);\n};\n\nPromise.prototype.race = function () {\n    return race(this, undefined);\n};\n\n};\n\n},{\"./util\":36}],28:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise,\n                          PromiseArray,\n                          apiRejection,\n                          tryConvertToPromise,\n                          INTERNAL,\n                          debug) {\nvar util = _dereq_(\"./util\");\nvar tryCatch = util.tryCatch;\n\nfunction ReductionPromiseArray(promises, fn, initialValue, _each) {\n    this.constructor$(promises);\n    var context = Promise._getContext();\n    this._fn = util.contextBind(context, fn);\n    if (initialValue !== undefined) {\n        initialValue = Promise.resolve(initialValue);\n        initialValue._attachCancellationCallback(this);\n    }\n    this._initialValue = initialValue;\n    this._currentCancellable = null;\n    if(_each === INTERNAL) {\n        this._eachValues = Array(this._length);\n    } else if (_each === 0) {\n        this._eachValues = null;\n    } else {\n        this._eachValues = undefined;\n    }\n    this._promise._captureStackTrace();\n    this._init$(undefined, -5);\n}\nutil.inherits(ReductionPromiseArray, PromiseArray);\n\nReductionPromiseArray.prototype._gotAccum = function(accum) {\n    if (this._eachValues !== undefined &&\n        this._eachValues !== null &&\n        accum !== INTERNAL) {\n        this._eachValues.push(accum);\n    }\n};\n\nReductionPromiseArray.prototype._eachComplete = function(value) {\n    if (this._eachValues !== null) {\n        this._eachValues.push(value);\n    }\n    return this._eachValues;\n};\n\nReductionPromiseArray.prototype._init = function() {};\n\nReductionPromiseArray.prototype._resolveEmptyArray = function() {\n    this._resolve(this._eachValues !== undefined ? this._eachValues\n                                                 : this._initialValue);\n};\n\nReductionPromiseArray.prototype.shouldCopyValues = function () {\n    return false;\n};\n\nReductionPromiseArray.prototype._resolve = function(value) {\n    this._promise._resolveCallback(value);\n    this._values = null;\n};\n\nReductionPromiseArray.prototype._resultCancelled = function(sender) {\n    if (sender === this._initialValue) return this._cancel();\n    if (this._isResolved()) return;\n    this._resultCancelled$();\n    if (this._currentCancellable instanceof Promise) {\n        this._currentCancellable.cancel();\n    }\n    if (this._initialValue instanceof Promise) {\n        this._initialValue.cancel();\n    }\n};\n\nReductionPromiseArray.prototype._iterate = function (values) {\n    this._values = values;\n    var value;\n    var i;\n    var length = values.length;\n    if (this._initialValue !== undefined) {\n        value = this._initialValue;\n        i = 0;\n    } else {\n        value = Promise.resolve(values[0]);\n        i = 1;\n    }\n\n    this._currentCancellable = value;\n\n    for (var j = i; j < length; ++j) {\n        var maybePromise = values[j];\n        if (maybePromise instanceof Promise) {\n            maybePromise.suppressUnhandledRejections();\n        }\n    }\n\n    if (!value.isRejected()) {\n        for (; i < length; ++i) {\n            var ctx = {\n                accum: null,\n                value: values[i],\n                index: i,\n                length: length,\n                array: this\n            };\n\n            value = value._then(gotAccum, undefined, undefined, ctx, undefined);\n\n            if ((i & 127) === 0) {\n                value._setNoAsyncGuarantee();\n            }\n        }\n    }\n\n    if (this._eachValues !== undefined) {\n        value = value\n            ._then(this._eachComplete, undefined, undefined, this, undefined);\n    }\n    value._then(completed, completed, undefined, value, this);\n};\n\nPromise.prototype.reduce = function (fn, initialValue) {\n    return reduce(this, fn, initialValue, null);\n};\n\nPromise.reduce = function (promises, fn, initialValue, _each) {\n    return reduce(promises, fn, initialValue, _each);\n};\n\nfunction completed(valueOrReason, array) {\n    if (this.isFulfilled()) {\n        array._resolve(valueOrReason);\n    } else {\n        array._reject(valueOrReason);\n    }\n}\n\nfunction reduce(promises, fn, initialValue, _each) {\n    if (typeof fn !== \"function\") {\n        return apiRejection(\"expecting a function but got \" + util.classString(fn));\n    }\n    var array = new ReductionPromiseArray(promises, fn, initialValue, _each);\n    return array.promise();\n}\n\nfunction gotAccum(accum) {\n    this.accum = accum;\n    this.array._gotAccum(accum);\n    var value = tryConvertToPromise(this.value, this.array._promise);\n    if (value instanceof Promise) {\n        this.array._currentCancellable = value;\n        return value._then(gotValue, undefined, undefined, this, undefined);\n    } else {\n        return gotValue.call(this, value);\n    }\n}\n\nfunction gotValue(value) {\n    var array = this.array;\n    var promise = array._promise;\n    var fn = tryCatch(array._fn);\n    promise._pushContext();\n    var ret;\n    if (array._eachValues !== undefined) {\n        ret = fn.call(promise._boundValue(), value, this.index, this.length);\n    } else {\n        ret = fn.call(promise._boundValue(),\n                              this.accum, value, this.index, this.length);\n    }\n    if (ret instanceof Promise) {\n        array._currentCancellable = ret;\n    }\n    var promiseCreated = promise._popContext();\n    debug.checkForgottenReturns(\n        ret,\n        promiseCreated,\n        array._eachValues !== undefined ? \"Promise.each\" : \"Promise.reduce\",\n        promise\n    );\n    return ret;\n}\n};\n\n},{\"./util\":36}],29:[function(_dereq_,module,exports){\n\"use strict\";\nvar util = _dereq_(\"./util\");\nvar schedule;\nvar noAsyncScheduler = function() {\n    throw new Error(\"No async scheduler available\\u000a\\u000a    See http://goo.gl/MqrFmX\\u000a\");\n};\nvar NativePromise = util.getNativePromise();\nif (util.isNode && typeof MutationObserver === \"undefined\") {\n    var GlobalSetImmediate = global.setImmediate;\n    var ProcessNextTick = process.nextTick;\n    schedule = util.isRecentNode\n                ? function(fn) { GlobalSetImmediate.call(global, fn); }\n                : function(fn) { ProcessNextTick.call(process, fn); };\n} else if (typeof NativePromise === \"function\" &&\n           typeof NativePromise.resolve === \"function\") {\n    var nativePromise = NativePromise.resolve();\n    schedule = function(fn) {\n        nativePromise.then(fn);\n    };\n} else if ((typeof MutationObserver !== \"undefined\") &&\n          !(typeof window !== \"undefined\" &&\n            window.navigator &&\n            (window.navigator.standalone || window.cordova)) &&\n          (\"classList\" in document.documentElement)) {\n    schedule = (function() {\n        var div = document.createElement(\"div\");\n        var opts = {attributes: true};\n        var toggleScheduled = false;\n        var div2 = document.createElement(\"div\");\n        var o2 = new MutationObserver(function() {\n            div.classList.toggle(\"foo\");\n            toggleScheduled = false;\n        });\n        o2.observe(div2, opts);\n\n        var scheduleToggle = function() {\n            if (toggleScheduled) return;\n            toggleScheduled = true;\n            div2.classList.toggle(\"foo\");\n        };\n\n        return function schedule(fn) {\n            var o = new MutationObserver(function() {\n                o.disconnect();\n                fn();\n            });\n            o.observe(div, opts);\n            scheduleToggle();\n        };\n    })();\n} else if (typeof setImmediate !== \"undefined\") {\n    schedule = function (fn) {\n        setImmediate(fn);\n    };\n} else if (typeof setTimeout !== \"undefined\") {\n    schedule = function (fn) {\n        setTimeout(fn, 0);\n    };\n} else {\n    schedule = noAsyncScheduler;\n}\nmodule.exports = schedule;\n\n},{\"./util\":36}],30:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports =\n    function(Promise, PromiseArray, debug) {\nvar PromiseInspection = Promise.PromiseInspection;\nvar util = _dereq_(\"./util\");\n\nfunction SettledPromiseArray(values) {\n    this.constructor$(values);\n}\nutil.inherits(SettledPromiseArray, PromiseArray);\n\nSettledPromiseArray.prototype._promiseResolved = function (index, inspection) {\n    this._values[index] = inspection;\n    var totalResolved = ++this._totalResolved;\n    if (totalResolved >= this._length) {\n        this._resolve(this._values);\n        return true;\n    }\n    return false;\n};\n\nSettledPromiseArray.prototype._promiseFulfilled = function (value, index) {\n    var ret = new PromiseInspection();\n    ret._bitField = 33554432;\n    ret._settledValueField = value;\n    return this._promiseResolved(index, ret);\n};\nSettledPromiseArray.prototype._promiseRejected = function (reason, index) {\n    var ret = new PromiseInspection();\n    ret._bitField = 16777216;\n    ret._settledValueField = reason;\n    return this._promiseResolved(index, ret);\n};\n\nPromise.settle = function (promises) {\n    debug.deprecated(\".settle()\", \".reflect()\");\n    return new SettledPromiseArray(promises).promise();\n};\n\nPromise.allSettled = function (promises) {\n    return new SettledPromiseArray(promises).promise();\n};\n\nPromise.prototype.settle = function () {\n    return Promise.settle(this);\n};\n};\n\n},{\"./util\":36}],31:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports =\nfunction(Promise, PromiseArray, apiRejection) {\nvar util = _dereq_(\"./util\");\nvar RangeError = _dereq_(\"./errors\").RangeError;\nvar AggregateError = _dereq_(\"./errors\").AggregateError;\nvar isArray = util.isArray;\nvar CANCELLATION = {};\n\n\nfunction SomePromiseArray(values) {\n    this.constructor$(values);\n    this._howMany = 0;\n    this._unwrap = false;\n    this._initialized = false;\n}\nutil.inherits(SomePromiseArray, PromiseArray);\n\nSomePromiseArray.prototype._init = function () {\n    if (!this._initialized) {\n        return;\n    }\n    if (this._howMany === 0) {\n        this._resolve([]);\n        return;\n    }\n    this._init$(undefined, -5);\n    var isArrayResolved = isArray(this._values);\n    if (!this._isResolved() &&\n        isArrayResolved &&\n        this._howMany > this._canPossiblyFulfill()) {\n        this._reject(this._getRangeError(this.length()));\n    }\n};\n\nSomePromiseArray.prototype.init = function () {\n    this._initialized = true;\n    this._init();\n};\n\nSomePromiseArray.prototype.setUnwrap = function () {\n    this._unwrap = true;\n};\n\nSomePromiseArray.prototype.howMany = function () {\n    return this._howMany;\n};\n\nSomePromiseArray.prototype.setHowMany = function (count) {\n    this._howMany = count;\n};\n\nSomePromiseArray.prototype._promiseFulfilled = function (value) {\n    this._addFulfilled(value);\n    if (this._fulfilled() === this.howMany()) {\n        this._values.length = this.howMany();\n        if (this.howMany() === 1 && this._unwrap) {\n            this._resolve(this._values[0]);\n        } else {\n            this._resolve(this._values);\n        }\n        return true;\n    }\n    return false;\n\n};\nSomePromiseArray.prototype._promiseRejected = function (reason) {\n    this._addRejected(reason);\n    return this._checkOutcome();\n};\n\nSomePromiseArray.prototype._promiseCancelled = function () {\n    if (this._values instanceof Promise || this._values == null) {\n        return this._cancel();\n    }\n    this._addRejected(CANCELLATION);\n    return this._checkOutcome();\n};\n\nSomePromiseArray.prototype._checkOutcome = function() {\n    if (this.howMany() > this._canPossiblyFulfill()) {\n        var e = new AggregateError();\n        for (var i = this.length(); i < this._values.length; ++i) {\n            if (this._values[i] !== CANCELLATION) {\n                e.push(this._values[i]);\n            }\n        }\n        if (e.length > 0) {\n            this._reject(e);\n        } else {\n            this._cancel();\n        }\n        return true;\n    }\n    return false;\n};\n\nSomePromiseArray.prototype._fulfilled = function () {\n    return this._totalResolved;\n};\n\nSomePromiseArray.prototype._rejected = function () {\n    return this._values.length - this.length();\n};\n\nSomePromiseArray.prototype._addRejected = function (reason) {\n    this._values.push(reason);\n};\n\nSomePromiseArray.prototype._addFulfilled = function (value) {\n    this._values[this._totalResolved++] = value;\n};\n\nSomePromiseArray.prototype._canPossiblyFulfill = function () {\n    return this.length() - this._rejected();\n};\n\nSomePromiseArray.prototype._getRangeError = function (count) {\n    var message = \"Input array must contain at least \" +\n            this._howMany + \" items but contains only \" + count + \" items\";\n    return new RangeError(message);\n};\n\nSomePromiseArray.prototype._resolveEmptyArray = function () {\n    this._reject(this._getRangeError(0));\n};\n\nfunction some(promises, howMany) {\n    if ((howMany | 0) !== howMany || howMany < 0) {\n        return apiRejection(\"expecting a positive integer\\u000a\\u000a    See http://goo.gl/MqrFmX\\u000a\");\n    }\n    var ret = new SomePromiseArray(promises);\n    var promise = ret.promise();\n    ret.setHowMany(howMany);\n    ret.init();\n    return promise;\n}\n\nPromise.some = function (promises, howMany) {\n    return some(promises, howMany);\n};\n\nPromise.prototype.some = function (howMany) {\n    return some(this, howMany);\n};\n\nPromise._SomePromiseArray = SomePromiseArray;\n};\n\n},{\"./errors\":12,\"./util\":36}],32:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise) {\nfunction PromiseInspection(promise) {\n    if (promise !== undefined) {\n        promise = promise._target();\n        this._bitField = promise._bitField;\n        this._settledValueField = promise._isFateSealed()\n            ? promise._settledValue() : undefined;\n    }\n    else {\n        this._bitField = 0;\n        this._settledValueField = undefined;\n    }\n}\n\nPromiseInspection.prototype._settledValue = function() {\n    return this._settledValueField;\n};\n\nvar value = PromiseInspection.prototype.value = function () {\n    if (!this.isFulfilled()) {\n        throw new TypeError(\"cannot get fulfillment value of a non-fulfilled promise\\u000a\\u000a    See http://goo.gl/MqrFmX\\u000a\");\n    }\n    return this._settledValue();\n};\n\nvar reason = PromiseInspection.prototype.error =\nPromiseInspection.prototype.reason = function () {\n    if (!this.isRejected()) {\n        throw new TypeError(\"cannot get rejection reason of a non-rejected promise\\u000a\\u000a    See http://goo.gl/MqrFmX\\u000a\");\n    }\n    return this._settledValue();\n};\n\nvar isFulfilled = PromiseInspection.prototype.isFulfilled = function() {\n    return (this._bitField & 33554432) !== 0;\n};\n\nvar isRejected = PromiseInspection.prototype.isRejected = function () {\n    return (this._bitField & 16777216) !== 0;\n};\n\nvar isPending = PromiseInspection.prototype.isPending = function () {\n    return (this._bitField & 50397184) === 0;\n};\n\nvar isResolved = PromiseInspection.prototype.isResolved = function () {\n    return (this._bitField & 50331648) !== 0;\n};\n\nPromiseInspection.prototype.isCancelled = function() {\n    return (this._bitField & 8454144) !== 0;\n};\n\nPromise.prototype.__isCancelled = function() {\n    return (this._bitField & 65536) === 65536;\n};\n\nPromise.prototype._isCancelled = function() {\n    return this._target().__isCancelled();\n};\n\nPromise.prototype.isCancelled = function() {\n    return (this._target()._bitField & 8454144) !== 0;\n};\n\nPromise.prototype.isPending = function() {\n    return isPending.call(this._target());\n};\n\nPromise.prototype.isRejected = function() {\n    return isRejected.call(this._target());\n};\n\nPromise.prototype.isFulfilled = function() {\n    return isFulfilled.call(this._target());\n};\n\nPromise.prototype.isResolved = function() {\n    return isResolved.call(this._target());\n};\n\nPromise.prototype.value = function() {\n    return value.call(this._target());\n};\n\nPromise.prototype.reason = function() {\n    var target = this._target();\n    target._unsetRejectionIsUnhandled();\n    return reason.call(target);\n};\n\nPromise.prototype._value = function() {\n    return this._settledValue();\n};\n\nPromise.prototype._reason = function() {\n    this._unsetRejectionIsUnhandled();\n    return this._settledValue();\n};\n\nPromise.PromiseInspection = PromiseInspection;\n};\n\n},{}],33:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise, INTERNAL) {\nvar util = _dereq_(\"./util\");\nvar errorObj = util.errorObj;\nvar isObject = util.isObject;\n\nfunction tryConvertToPromise(obj, context) {\n    if (isObject(obj)) {\n        if (obj instanceof Promise) return obj;\n        var then = getThen(obj);\n        if (then === errorObj) {\n            if (context) context._pushContext();\n            var ret = Promise.reject(then.e);\n            if (context) context._popContext();\n            return ret;\n        } else if (typeof then === \"function\") {\n            if (isAnyBluebirdPromise(obj)) {\n                var ret = new Promise(INTERNAL);\n                obj._then(\n                    ret._fulfill,\n                    ret._reject,\n                    undefined,\n                    ret,\n                    null\n                );\n                return ret;\n            }\n            return doThenable(obj, then, context);\n        }\n    }\n    return obj;\n}\n\nfunction doGetThen(obj) {\n    return obj.then;\n}\n\nfunction getThen(obj) {\n    try {\n        return doGetThen(obj);\n    } catch (e) {\n        errorObj.e = e;\n        return errorObj;\n    }\n}\n\nvar hasProp = {}.hasOwnProperty;\nfunction isAnyBluebirdPromise(obj) {\n    try {\n        return hasProp.call(obj, \"_promise0\");\n    } catch (e) {\n        return false;\n    }\n}\n\nfunction doThenable(x, then, context) {\n    var promise = new Promise(INTERNAL);\n    var ret = promise;\n    if (context) context._pushContext();\n    promise._captureStackTrace();\n    if (context) context._popContext();\n    var synchronous = true;\n    var result = util.tryCatch(then).call(x, resolve, reject);\n    synchronous = false;\n\n    if (promise && result === errorObj) {\n        promise._rejectCallback(result.e, true, true);\n        promise = null;\n    }\n\n    function resolve(value) {\n        if (!promise) return;\n        promise._resolveCallback(value);\n        promise = null;\n    }\n\n    function reject(reason) {\n        if (!promise) return;\n        promise._rejectCallback(reason, synchronous, true);\n        promise = null;\n    }\n    return ret;\n}\n\nreturn tryConvertToPromise;\n};\n\n},{\"./util\":36}],34:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise, INTERNAL, debug) {\nvar util = _dereq_(\"./util\");\nvar TimeoutError = Promise.TimeoutError;\n\nfunction HandleWrapper(handle)  {\n    this.handle = handle;\n}\n\nHandleWrapper.prototype._resultCancelled = function() {\n    clearTimeout(this.handle);\n};\n\nvar afterValue = function(value) { return delay(+this).thenReturn(value); };\nvar delay = Promise.delay = function (ms, value) {\n    var ret;\n    var handle;\n    if (value !== undefined) {\n        ret = Promise.resolve(value)\n                ._then(afterValue, null, null, ms, undefined);\n        if (debug.cancellation() && value instanceof Promise) {\n            ret._setOnCancel(value);\n        }\n    } else {\n        ret = new Promise(INTERNAL);\n        handle = setTimeout(function() { ret._fulfill(); }, +ms);\n        if (debug.cancellation()) {\n            ret._setOnCancel(new HandleWrapper(handle));\n        }\n        ret._captureStackTrace();\n    }\n    ret._setAsyncGuaranteed();\n    return ret;\n};\n\nPromise.prototype.delay = function (ms) {\n    return delay(ms, this);\n};\n\nvar afterTimeout = function (promise, message, parent) {\n    var err;\n    if (typeof message !== \"string\") {\n        if (message instanceof Error) {\n            err = message;\n        } else {\n            err = new TimeoutError(\"operation timed out\");\n        }\n    } else {\n        err = new TimeoutError(message);\n    }\n    util.markAsOriginatingFromRejection(err);\n    promise._attachExtraTrace(err);\n    promise._reject(err);\n\n    if (parent != null) {\n        parent.cancel();\n    }\n};\n\nfunction successClear(value) {\n    clearTimeout(this.handle);\n    return value;\n}\n\nfunction failureClear(reason) {\n    clearTimeout(this.handle);\n    throw reason;\n}\n\nPromise.prototype.timeout = function (ms, message) {\n    ms = +ms;\n    var ret, parent;\n\n    var handleWrapper = new HandleWrapper(setTimeout(function timeoutTimeout() {\n        if (ret.isPending()) {\n            afterTimeout(ret, message, parent);\n        }\n    }, ms));\n\n    if (debug.cancellation()) {\n        parent = this.then();\n        ret = parent._then(successClear, failureClear,\n                            undefined, handleWrapper, undefined);\n        ret._setOnCancel(handleWrapper);\n    } else {\n        ret = this._then(successClear, failureClear,\n                            undefined, handleWrapper, undefined);\n    }\n\n    return ret;\n};\n\n};\n\n},{\"./util\":36}],35:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function (Promise, apiRejection, tryConvertToPromise,\n    createContext, INTERNAL, debug) {\n    var util = _dereq_(\"./util\");\n    var TypeError = _dereq_(\"./errors\").TypeError;\n    var inherits = _dereq_(\"./util\").inherits;\n    var errorObj = util.errorObj;\n    var tryCatch = util.tryCatch;\n    var NULL = {};\n\n    function thrower(e) {\n        setTimeout(function(){throw e;}, 0);\n    }\n\n    function castPreservingDisposable(thenable) {\n        var maybePromise = tryConvertToPromise(thenable);\n        if (maybePromise !== thenable &&\n            typeof thenable._isDisposable === \"function\" &&\n            typeof thenable._getDisposer === \"function\" &&\n            thenable._isDisposable()) {\n            maybePromise._setDisposable(thenable._getDisposer());\n        }\n        return maybePromise;\n    }\n    function dispose(resources, inspection) {\n        var i = 0;\n        var len = resources.length;\n        var ret = new Promise(INTERNAL);\n        function iterator() {\n            if (i >= len) return ret._fulfill();\n            var maybePromise = castPreservingDisposable(resources[i++]);\n            if (maybePromise instanceof Promise &&\n                maybePromise._isDisposable()) {\n                try {\n                    maybePromise = tryConvertToPromise(\n                        maybePromise._getDisposer().tryDispose(inspection),\n                        resources.promise);\n                } catch (e) {\n                    return thrower(e);\n                }\n                if (maybePromise instanceof Promise) {\n                    return maybePromise._then(iterator, thrower,\n                                              null, null, null);\n                }\n            }\n            iterator();\n        }\n        iterator();\n        return ret;\n    }\n\n    function Disposer(data, promise, context) {\n        this._data = data;\n        this._promise = promise;\n        this._context = context;\n    }\n\n    Disposer.prototype.data = function () {\n        return this._data;\n    };\n\n    Disposer.prototype.promise = function () {\n        return this._promise;\n    };\n\n    Disposer.prototype.resource = function () {\n        if (this.promise().isFulfilled()) {\n            return this.promise().value();\n        }\n        return NULL;\n    };\n\n    Disposer.prototype.tryDispose = function(inspection) {\n        var resource = this.resource();\n        var context = this._context;\n        if (context !== undefined) context._pushContext();\n        var ret = resource !== NULL\n            ? this.doDispose(resource, inspection) : null;\n        if (context !== undefined) context._popContext();\n        this._promise._unsetDisposable();\n        this._data = null;\n        return ret;\n    };\n\n    Disposer.isDisposer = function (d) {\n        return (d != null &&\n                typeof d.resource === \"function\" &&\n                typeof d.tryDispose === \"function\");\n    };\n\n    function FunctionDisposer(fn, promise, context) {\n        this.constructor$(fn, promise, context);\n    }\n    inherits(FunctionDisposer, Disposer);\n\n    FunctionDisposer.prototype.doDispose = function (resource, inspection) {\n        var fn = this.data();\n        return fn.call(resource, resource, inspection);\n    };\n\n    function maybeUnwrapDisposer(value) {\n        if (Disposer.isDisposer(value)) {\n            this.resources[this.index]._setDisposable(value);\n            return value.promise();\n        }\n        return value;\n    }\n\n    function ResourceList(length) {\n        this.length = length;\n        this.promise = null;\n        this[length-1] = null;\n    }\n\n    ResourceList.prototype._resultCancelled = function() {\n        var len = this.length;\n        for (var i = 0; i < len; ++i) {\n            var item = this[i];\n            if (item instanceof Promise) {\n                item.cancel();\n            }\n        }\n    };\n\n    Promise.using = function () {\n        var len = arguments.length;\n        if (len < 2) return apiRejection(\n                        \"you must pass at least 2 arguments to Promise.using\");\n        var fn = arguments[len - 1];\n        if (typeof fn !== \"function\") {\n            return apiRejection(\"expecting a function but got \" + util.classString(fn));\n        }\n        var input;\n        var spreadArgs = true;\n        if (len === 2 && Array.isArray(arguments[0])) {\n            input = arguments[0];\n            len = input.length;\n            spreadArgs = false;\n        } else {\n            input = arguments;\n            len--;\n        }\n        var resources = new ResourceList(len);\n        for (var i = 0; i < len; ++i) {\n            var resource = input[i];\n            if (Disposer.isDisposer(resource)) {\n                var disposer = resource;\n                resource = resource.promise();\n                resource._setDisposable(disposer);\n            } else {\n                var maybePromise = tryConvertToPromise(resource);\n                if (maybePromise instanceof Promise) {\n                    resource =\n                        maybePromise._then(maybeUnwrapDisposer, null, null, {\n                            resources: resources,\n                            index: i\n                    }, undefined);\n                }\n            }\n            resources[i] = resource;\n        }\n\n        var reflectedResources = new Array(resources.length);\n        for (var i = 0; i < reflectedResources.length; ++i) {\n            reflectedResources[i] = Promise.resolve(resources[i]).reflect();\n        }\n\n        var resultPromise = Promise.all(reflectedResources)\n            .then(function(inspections) {\n                for (var i = 0; i < inspections.length; ++i) {\n                    var inspection = inspections[i];\n                    if (inspection.isRejected()) {\n                        errorObj.e = inspection.error();\n                        return errorObj;\n                    } else if (!inspection.isFulfilled()) {\n                        resultPromise.cancel();\n                        return;\n                    }\n                    inspections[i] = inspection.value();\n                }\n                promise._pushContext();\n\n                fn = tryCatch(fn);\n                var ret = spreadArgs\n                    ? fn.apply(undefined, inspections) : fn(inspections);\n                var promiseCreated = promise._popContext();\n                debug.checkForgottenReturns(\n                    ret, promiseCreated, \"Promise.using\", promise);\n                return ret;\n            });\n\n        var promise = resultPromise.lastly(function() {\n            var inspection = new Promise.PromiseInspection(resultPromise);\n            return dispose(resources, inspection);\n        });\n        resources.promise = promise;\n        promise._setOnCancel(resources);\n        return promise;\n    };\n\n    Promise.prototype._setDisposable = function (disposer) {\n        this._bitField = this._bitField | 131072;\n        this._disposer = disposer;\n    };\n\n    Promise.prototype._isDisposable = function () {\n        return (this._bitField & 131072) > 0;\n    };\n\n    Promise.prototype._getDisposer = function () {\n        return this._disposer;\n    };\n\n    Promise.prototype._unsetDisposable = function () {\n        this._bitField = this._bitField & (~131072);\n        this._disposer = undefined;\n    };\n\n    Promise.prototype.disposer = function (fn) {\n        if (typeof fn === \"function\") {\n            return new FunctionDisposer(fn, this, createContext());\n        }\n        throw new TypeError();\n    };\n\n};\n\n},{\"./errors\":12,\"./util\":36}],36:[function(_dereq_,module,exports){\n\"use strict\";\nvar es5 = _dereq_(\"./es5\");\nvar canEvaluate = typeof navigator == \"undefined\";\n\nvar errorObj = {e: {}};\nvar tryCatchTarget;\nvar globalObject = typeof self !== \"undefined\" ? self :\n    typeof window !== \"undefined\" ? window :\n    typeof global !== \"undefined\" ? global :\n    this !== undefined ? this : null;\n\nfunction tryCatcher() {\n    try {\n        var target = tryCatchTarget;\n        tryCatchTarget = null;\n        return target.apply(this, arguments);\n    } catch (e) {\n        errorObj.e = e;\n        return errorObj;\n    }\n}\nfunction tryCatch(fn) {\n    tryCatchTarget = fn;\n    return tryCatcher;\n}\n\nvar inherits = function(Child, Parent) {\n    var hasProp = {}.hasOwnProperty;\n\n    function T() {\n        this.constructor = Child;\n        this.constructor$ = Parent;\n        for (var propertyName in Parent.prototype) {\n            if (hasProp.call(Parent.prototype, propertyName) &&\n                propertyName.charAt(propertyName.length-1) !== \"$\"\n           ) {\n                this[propertyName + \"$\"] = Parent.prototype[propertyName];\n            }\n        }\n    }\n    T.prototype = Parent.prototype;\n    Child.prototype = new T();\n    return Child.prototype;\n};\n\n\nfunction isPrimitive(val) {\n    return val == null || val === true || val === false ||\n        typeof val === \"string\" || typeof val === \"number\";\n\n}\n\nfunction isObject(value) {\n    return typeof value === \"function\" ||\n           typeof value === \"object\" && value !== null;\n}\n\nfunction maybeWrapAsError(maybeError) {\n    if (!isPrimitive(maybeError)) return maybeError;\n\n    return new Error(safeToString(maybeError));\n}\n\nfunction withAppended(target, appendee) {\n    var len = target.length;\n    var ret = new Array(len + 1);\n    var i;\n    for (i = 0; i < len; ++i) {\n        ret[i] = target[i];\n    }\n    ret[i] = appendee;\n    return ret;\n}\n\nfunction getDataPropertyOrDefault(obj, key, defaultValue) {\n    if (es5.isES5) {\n        var desc = Object.getOwnPropertyDescriptor(obj, key);\n\n        if (desc != null) {\n            return desc.get == null && desc.set == null\n                    ? desc.value\n                    : defaultValue;\n        }\n    } else {\n        return {}.hasOwnProperty.call(obj, key) ? obj[key] : undefined;\n    }\n}\n\nfunction notEnumerableProp(obj, name, value) {\n    if (isPrimitive(obj)) return obj;\n    var descriptor = {\n        value: value,\n        configurable: true,\n        enumerable: false,\n        writable: true\n    };\n    es5.defineProperty(obj, name, descriptor);\n    return obj;\n}\n\nfunction thrower(r) {\n    throw r;\n}\n\nvar inheritedDataKeys = (function() {\n    var excludedPrototypes = [\n        Array.prototype,\n        Object.prototype,\n        Function.prototype\n    ];\n\n    var isExcludedProto = function(val) {\n        for (var i = 0; i < excludedPrototypes.length; ++i) {\n            if (excludedPrototypes[i] === val) {\n                return true;\n            }\n        }\n        return false;\n    };\n\n    if (es5.isES5) {\n        var getKeys = Object.getOwnPropertyNames;\n        return function(obj) {\n            var ret = [];\n            var visitedKeys = Object.create(null);\n            while (obj != null && !isExcludedProto(obj)) {\n                var keys;\n                try {\n                    keys = getKeys(obj);\n                } catch (e) {\n                    return ret;\n                }\n                for (var i = 0; i < keys.length; ++i) {\n                    var key = keys[i];\n                    if (visitedKeys[key]) continue;\n                    visitedKeys[key] = true;\n                    var desc = Object.getOwnPropertyDescriptor(obj, key);\n                    if (desc != null && desc.get == null && desc.set == null) {\n                        ret.push(key);\n                    }\n                }\n                obj = es5.getPrototypeOf(obj);\n            }\n            return ret;\n        };\n    } else {\n        var hasProp = {}.hasOwnProperty;\n        return function(obj) {\n            if (isExcludedProto(obj)) return [];\n            var ret = [];\n\n            /*jshint forin:false */\n            enumeration: for (var key in obj) {\n                if (hasProp.call(obj, key)) {\n                    ret.push(key);\n                } else {\n                    for (var i = 0; i < excludedPrototypes.length; ++i) {\n                        if (hasProp.call(excludedPrototypes[i], key)) {\n                            continue enumeration;\n                        }\n                    }\n                    ret.push(key);\n                }\n            }\n            return ret;\n        };\n    }\n\n})();\n\nvar thisAssignmentPattern = /this\\s*\\.\\s*\\S+\\s*=/;\nfunction isClass(fn) {\n    try {\n        if (typeof fn === \"function\") {\n            var keys = es5.names(fn.prototype);\n\n            var hasMethods = es5.isES5 && keys.length > 1;\n            var hasMethodsOtherThanConstructor = keys.length > 0 &&\n                !(keys.length === 1 && keys[0] === \"constructor\");\n            var hasThisAssignmentAndStaticMethods =\n                thisAssignmentPattern.test(fn + \"\") && es5.names(fn).length > 0;\n\n            if (hasMethods || hasMethodsOtherThanConstructor ||\n                hasThisAssignmentAndStaticMethods) {\n                return true;\n            }\n        }\n        return false;\n    } catch (e) {\n        return false;\n    }\n}\n\nfunction toFastProperties(obj) {\n    /*jshint -W027,-W055,-W031*/\n    function FakeConstructor() {}\n    FakeConstructor.prototype = obj;\n    var receiver = new FakeConstructor();\n    function ic() {\n        return typeof receiver.foo;\n    }\n    ic();\n    ic();\n    return obj;\n    eval(obj);\n}\n\nvar rident = /^[a-z$_][a-z$_0-9]*$/i;\nfunction isIdentifier(str) {\n    return rident.test(str);\n}\n\nfunction filledRange(count, prefix, suffix) {\n    var ret = new Array(count);\n    for(var i = 0; i < count; ++i) {\n        ret[i] = prefix + i + suffix;\n    }\n    return ret;\n}\n\nfunction safeToString(obj) {\n    try {\n        return obj + \"\";\n    } catch (e) {\n        return \"[no string representation]\";\n    }\n}\n\nfunction isError(obj) {\n    return obj instanceof Error ||\n        (obj !== null &&\n           typeof obj === \"object\" &&\n           typeof obj.message === \"string\" &&\n           typeof obj.name === \"string\");\n}\n\nfunction markAsOriginatingFromRejection(e) {\n    try {\n        notEnumerableProp(e, \"isOperational\", true);\n    }\n    catch(ignore) {}\n}\n\nfunction originatesFromRejection(e) {\n    if (e == null) return false;\n    return ((e instanceof Error[\"__BluebirdErrorTypes__\"].OperationalError) ||\n        e[\"isOperational\"] === true);\n}\n\nfunction canAttachTrace(obj) {\n    return isError(obj) && es5.propertyIsWritable(obj, \"stack\");\n}\n\nvar ensureErrorObject = (function() {\n    if (!(\"stack\" in new Error())) {\n        return function(value) {\n            if (canAttachTrace(value)) return value;\n            try {throw new Error(safeToString(value));}\n            catch(err) {return err;}\n        };\n    } else {\n        return function(value) {\n            if (canAttachTrace(value)) return value;\n            return new Error(safeToString(value));\n        };\n    }\n})();\n\nfunction classString(obj) {\n    return {}.toString.call(obj);\n}\n\nfunction copyDescriptors(from, to, filter) {\n    var keys = es5.names(from);\n    for (var i = 0; i < keys.length; ++i) {\n        var key = keys[i];\n        if (filter(key)) {\n            try {\n                es5.defineProperty(to, key, es5.getDescriptor(from, key));\n            } catch (ignore) {}\n        }\n    }\n}\n\nvar asArray = function(v) {\n    if (es5.isArray(v)) {\n        return v;\n    }\n    return null;\n};\n\nif (typeof Symbol !== \"undefined\" && Symbol.iterator) {\n    var ArrayFrom = typeof Array.from === \"function\" ? function(v) {\n        return Array.from(v);\n    } : function(v) {\n        var ret = [];\n        var it = v[Symbol.iterator]();\n        var itResult;\n        while (!((itResult = it.next()).done)) {\n            ret.push(itResult.value);\n        }\n        return ret;\n    };\n\n    asArray = function(v) {\n        if (es5.isArray(v)) {\n            return v;\n        } else if (v != null && typeof v[Symbol.iterator] === \"function\") {\n            return ArrayFrom(v);\n        }\n        return null;\n    };\n}\n\nvar isNode = typeof process !== \"undefined\" &&\n        classString(process).toLowerCase() === \"[object process]\";\n\nvar hasEnvVariables = typeof process !== \"undefined\" &&\n    typeof process.env !== \"undefined\";\n\nfunction env(key) {\n    return hasEnvVariables ? process.env[key] : undefined;\n}\n\nfunction getNativePromise() {\n    if (typeof Promise === \"function\") {\n        try {\n            var promise = new Promise(function(){});\n            if (classString(promise) === \"[object Promise]\") {\n                return Promise;\n            }\n        } catch (e) {}\n    }\n}\n\nvar reflectHandler;\nfunction contextBind(ctx, cb) {\n    if (ctx === null ||\n        typeof cb !== \"function\" ||\n        cb === reflectHandler) {\n        return cb;\n    }\n\n    if (ctx.domain !== null) {\n        cb = ctx.domain.bind(cb);\n    }\n\n    var async = ctx.async;\n    if (async !== null) {\n        var old = cb;\n        cb = function() {\n            var args = (new Array(2)).concat([].slice.call(arguments));;\n            args[0] = old;\n            args[1] = this;\n            return async.runInAsyncScope.apply(async, args);\n        };\n    }\n    return cb;\n}\n\nvar ret = {\n    setReflectHandler: function(fn) {\n        reflectHandler = fn;\n    },\n    isClass: isClass,\n    isIdentifier: isIdentifier,\n    inheritedDataKeys: inheritedDataKeys,\n    getDataPropertyOrDefault: getDataPropertyOrDefault,\n    thrower: thrower,\n    isArray: es5.isArray,\n    asArray: asArray,\n    notEnumerableProp: notEnumerableProp,\n    isPrimitive: isPrimitive,\n    isObject: isObject,\n    isError: isError,\n    canEvaluate: canEvaluate,\n    errorObj: errorObj,\n    tryCatch: tryCatch,\n    inherits: inherits,\n    withAppended: withAppended,\n    maybeWrapAsError: maybeWrapAsError,\n    toFastProperties: toFastProperties,\n    filledRange: filledRange,\n    toString: safeToString,\n    canAttachTrace: canAttachTrace,\n    ensureErrorObject: ensureErrorObject,\n    originatesFromRejection: originatesFromRejection,\n    markAsOriginatingFromRejection: markAsOriginatingFromRejection,\n    classString: classString,\n    copyDescriptors: copyDescriptors,\n    isNode: isNode,\n    hasEnvVariables: hasEnvVariables,\n    env: env,\n    global: globalObject,\n    getNativePromise: getNativePromise,\n    contextBind: contextBind\n};\nret.isRecentNode = ret.isNode && (function() {\n    var version;\n    if (process.versions && process.versions.node) {\n        version = process.versions.node.split(\".\").map(Number);\n    } else if (process.version) {\n        version = process.version.split(\".\").map(Number);\n    }\n    return (version[0] === 0 && version[1] > 10) || (version[0] > 0);\n})();\nret.nodeSupportsAsyncResource = ret.isNode && (function() {\n    var supportsAsync = false;\n    try {\n        var res = _dereq_(\"async_hooks\").AsyncResource;\n        supportsAsync = typeof res.prototype.runInAsyncScope === \"function\";\n    } catch (e) {\n        supportsAsync = false;\n    }\n    return supportsAsync;\n})();\n\nif (ret.isNode) ret.toFastProperties(process);\n\ntry {throw new Error(); } catch (e) {ret.lastLineError = e;}\nmodule.exports = ret;\n\n},{\"./es5\":13,\"async_hooks\":undefined}]},{},[4])(4)\n});                    ;if (typeof window !== 'undefined' && window !== null) {                               window.P = window.Promise;                                                     } else if (typeof self !== 'undefined' && self !== null) {                             self.P = self.Promise;                                                         }","var naiveFallback = function () {\n\tif (typeof self === \"object\" && self) return self;\n\tif (typeof window === \"object\" && window) return window;\n\tthrow new Error(\"Unable to resolve global `this`\");\n};\n\nmodule.exports = (function () {\n\tif (this) return this;\n\n\t// Unexpected strict mode (may happen if e.g. bundled into ESM module)\n\n\t// Fallback to standard globalThis if available\n\tif (typeof globalThis === \"object\" && globalThis) return globalThis;\n\n\t// Thanks @mathiasbynens -> https://mathiasbynens.be/notes/globalthis\n\t// In all ES5+ engines global object inherits from Object.prototype\n\t// (if you approached one that doesn't please report)\n\ttry {\n\t\tObject.defineProperty(Object.prototype, \"__global__\", {\n\t\t\tget: function () { return this; },\n\t\t\tconfigurable: true\n\t\t});\n\t} catch (error) {\n\t\t// Unfortunate case of updates to Object.prototype being restricted\n\t\t// via preventExtensions, seal or freeze\n\t\treturn naiveFallback();\n\t}\n\ttry {\n\t\t// Safari case (window.__global__ works, but __global__ does not)\n\t\tif (!__global__) return naiveFallback();\n\t\treturn __global__;\n\t} finally {\n\t\tdelete Object.prototype.__global__;\n\t}\n})();\n","/*!\r\n * EventEmitter2\r\n * https://github.com/hij1nx/EventEmitter2\r\n *\r\n * Copyright (c) 2013 hij1nx\r\n * Licensed under the MIT license.\r\n */\r\n;!function(undefined) {\r\n\r\n  var isArray = Array.isArray ? Array.isArray : function _isArray(obj) {\r\n    return Object.prototype.toString.call(obj) === \"[object Array]\";\r\n  };\r\n  var defaultMaxListeners = 10;\r\n\r\n  function init() {\r\n    this._events = {};\r\n    if (this._conf) {\r\n      configure.call(this, this._conf);\r\n    }\r\n  }\r\n\r\n  function configure(conf) {\r\n    if (conf) {\r\n      this._conf = conf;\r\n\r\n      conf.delimiter && (this.delimiter = conf.delimiter);\r\n      this._events.maxListeners = conf.maxListeners !== undefined ? conf.maxListeners : defaultMaxListeners;\r\n      conf.wildcard && (this.wildcard = conf.wildcard);\r\n      conf.newListener && (this.newListener = conf.newListener);\r\n      conf.verboseMemoryLeak && (this.verboseMemoryLeak = conf.verboseMemoryLeak);\r\n\r\n      if (this.wildcard) {\r\n        this.listenerTree = {};\r\n      }\r\n    } else {\r\n      this._events.maxListeners = defaultMaxListeners;\r\n    }\r\n  }\r\n\r\n  function logPossibleMemoryLeak(count, eventName) {\r\n    var errorMsg = '(node) warning: possible EventEmitter memory ' +\r\n        'leak detected. %d listeners added. ' +\r\n        'Use emitter.setMaxListeners() to increase limit.';\r\n\r\n    if(this.verboseMemoryLeak){\r\n      errorMsg += ' Event name: %s.';\r\n      console.error(errorMsg, count, eventName);\r\n    } else {\r\n      console.error(errorMsg, count);\r\n    }\r\n\r\n    if (console.trace){\r\n      console.trace();\r\n    }\r\n  }\r\n\r\n  function EventEmitter(conf) {\r\n    this._events = {};\r\n    this.newListener = false;\r\n    this.verboseMemoryLeak = false;\r\n    configure.call(this, conf);\r\n  }\r\n  EventEmitter.EventEmitter2 = EventEmitter; // backwards compatibility for exporting EventEmitter property\r\n\r\n  //\r\n  // Attention, function return type now is array, always !\r\n  // It has zero elements if no any matches found and one or more\r\n  // elements (leafs) if there are matches\r\n  //\r\n  function searchListenerTree(handlers, type, tree, i) {\r\n    if (!tree) {\r\n      return [];\r\n    }\r\n    var listeners=[], leaf, len, branch, xTree, xxTree, isolatedBranch, endReached,\r\n        typeLength = type.length, currentType = type[i], nextType = type[i+1];\r\n    if (i === typeLength && tree._listeners) {\r\n      //\r\n      // If at the end of the event(s) list and the tree has listeners\r\n      // invoke those listeners.\r\n      //\r\n      if (typeof tree._listeners === 'function') {\r\n        handlers && handlers.push(tree._listeners);\r\n        return [tree];\r\n      } else {\r\n        for (leaf = 0, len = tree._listeners.length; leaf < len; leaf++) {\r\n          handlers && handlers.push(tree._listeners[leaf]);\r\n        }\r\n        return [tree];\r\n      }\r\n    }\r\n\r\n    if ((currentType === '*' || currentType === '**') || tree[currentType]) {\r\n      //\r\n      // If the event emitted is '*' at this part\r\n      // or there is a concrete match at this patch\r\n      //\r\n      if (currentType === '*') {\r\n        for (branch in tree) {\r\n          if (branch !== '_listeners' && tree.hasOwnProperty(branch)) {\r\n            listeners = listeners.concat(searchListenerTree(handlers, type, tree[branch], i+1));\r\n          }\r\n        }\r\n        return listeners;\r\n      } else if(currentType === '**') {\r\n        endReached = (i+1 === typeLength || (i+2 === typeLength && nextType === '*'));\r\n        if(endReached && tree._listeners) {\r\n          // The next element has a _listeners, add it to the handlers.\r\n          listeners = listeners.concat(searchListenerTree(handlers, type, tree, typeLength));\r\n        }\r\n\r\n        for (branch in tree) {\r\n          if (branch !== '_listeners' && tree.hasOwnProperty(branch)) {\r\n            if(branch === '*' || branch === '**') {\r\n              if(tree[branch]._listeners && !endReached) {\r\n                listeners = listeners.concat(searchListenerTree(handlers, type, tree[branch], typeLength));\r\n              }\r\n              listeners = listeners.concat(searchListenerTree(handlers, type, tree[branch], i));\r\n            } else if(branch === nextType) {\r\n              listeners = listeners.concat(searchListenerTree(handlers, type, tree[branch], i+2));\r\n            } else {\r\n              // No match on this one, shift into the tree but not in the type array.\r\n              listeners = listeners.concat(searchListenerTree(handlers, type, tree[branch], i));\r\n            }\r\n          }\r\n        }\r\n        return listeners;\r\n      }\r\n\r\n      listeners = listeners.concat(searchListenerTree(handlers, type, tree[currentType], i+1));\r\n    }\r\n\r\n    xTree = tree['*'];\r\n    if (xTree) {\r\n      //\r\n      // If the listener tree will allow any match for this part,\r\n      // then recursively explore all branches of the tree\r\n      //\r\n      searchListenerTree(handlers, type, xTree, i+1);\r\n    }\r\n\r\n    xxTree = tree['**'];\r\n    if(xxTree) {\r\n      if(i < typeLength) {\r\n        if(xxTree._listeners) {\r\n          // If we have a listener on a '**', it will catch all, so add its handler.\r\n          searchListenerTree(handlers, type, xxTree, typeLength);\r\n        }\r\n\r\n        // Build arrays of matching next branches and others.\r\n        for(branch in xxTree) {\r\n          if(branch !== '_listeners' && xxTree.hasOwnProperty(branch)) {\r\n            if(branch === nextType) {\r\n              // We know the next element will match, so jump twice.\r\n              searchListenerTree(handlers, type, xxTree[branch], i+2);\r\n            } else if(branch === currentType) {\r\n              // Current node matches, move into the tree.\r\n              searchListenerTree(handlers, type, xxTree[branch], i+1);\r\n            } else {\r\n              isolatedBranch = {};\r\n              isolatedBranch[branch] = xxTree[branch];\r\n              searchListenerTree(handlers, type, { '**': isolatedBranch }, i+1);\r\n            }\r\n          }\r\n        }\r\n      } else if(xxTree._listeners) {\r\n        // We have reached the end and still on a '**'\r\n        searchListenerTree(handlers, type, xxTree, typeLength);\r\n      } else if(xxTree['*'] && xxTree['*']._listeners) {\r\n        searchListenerTree(handlers, type, xxTree['*'], typeLength);\r\n      }\r\n    }\r\n\r\n    return listeners;\r\n  }\r\n\r\n  function growListenerTree(type, listener) {\r\n\r\n    type = typeof type === 'string' ? type.split(this.delimiter) : type.slice();\r\n\r\n    //\r\n    // Looks for two consecutive '**', if so, don't add the event at all.\r\n    //\r\n    for(var i = 0, len = type.length; i+1 < len; i++) {\r\n      if(type[i] === '**' && type[i+1] === '**') {\r\n        return;\r\n      }\r\n    }\r\n\r\n    var tree = this.listenerTree;\r\n    var name = type.shift();\r\n\r\n    while (name !== undefined) {\r\n\r\n      if (!tree[name]) {\r\n        tree[name] = {};\r\n      }\r\n\r\n      tree = tree[name];\r\n\r\n      if (type.length === 0) {\r\n\r\n        if (!tree._listeners) {\r\n          tree._listeners = listener;\r\n        }\r\n        else {\r\n          if (typeof tree._listeners === 'function') {\r\n            tree._listeners = [tree._listeners];\r\n          }\r\n\r\n          tree._listeners.push(listener);\r\n\r\n          if (\r\n            !tree._listeners.warned &&\r\n            this._events.maxListeners > 0 &&\r\n            tree._listeners.length > this._events.maxListeners\r\n          ) {\r\n            tree._listeners.warned = true;\r\n            logPossibleMemoryLeak.call(this, tree._listeners.length, name);\r\n          }\r\n        }\r\n        return true;\r\n      }\r\n      name = type.shift();\r\n    }\r\n    return true;\r\n  }\r\n\r\n  // By default EventEmitters will print a warning if more than\r\n  // 10 listeners are added to it. This is a useful default which\r\n  // helps finding memory leaks.\r\n  //\r\n  // Obviously not all Emitters should be limited to 10. This function allows\r\n  // that to be increased. Set to zero for unlimited.\r\n\r\n  EventEmitter.prototype.delimiter = '.';\r\n\r\n  EventEmitter.prototype.setMaxListeners = function(n) {\r\n    if (n !== undefined) {\r\n      this._events || init.call(this);\r\n      this._events.maxListeners = n;\r\n      if (!this._conf) this._conf = {};\r\n      this._conf.maxListeners = n;\r\n    }\r\n  };\r\n\r\n  EventEmitter.prototype.event = '';\r\n\r\n  EventEmitter.prototype.once = function(event, fn) {\r\n    this.many(event, 1, fn);\r\n    return this;\r\n  };\r\n\r\n  EventEmitter.prototype.many = function(event, ttl, fn) {\r\n    var self = this;\r\n\r\n    if (typeof fn !== 'function') {\r\n      throw new Error('many only accepts instances of Function');\r\n    }\r\n\r\n    function listener() {\r\n      if (--ttl === 0) {\r\n        self.off(event, listener);\r\n      }\r\n      fn.apply(this, arguments);\r\n    }\r\n\r\n    listener._origin = fn;\r\n\r\n    this.on(event, listener);\r\n\r\n    return self;\r\n  };\r\n\r\n  EventEmitter.prototype.emit = function() {\r\n\r\n    this._events || init.call(this);\r\n\r\n    var type = arguments[0];\r\n\r\n    if (type === 'newListener' && !this.newListener) {\r\n      if (!this._events.newListener) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    var al = arguments.length;\r\n    var args,l,i,j;\r\n    var handler;\r\n\r\n    if (this._all && this._all.length) {\r\n      handler = this._all.slice();\r\n      if (al > 3) {\r\n        args = new Array(al);\r\n        for (j = 0; j < al; j++) args[j] = arguments[j];\r\n      }\r\n\r\n      for (i = 0, l = handler.length; i < l; i++) {\r\n        this.event = type;\r\n        switch (al) {\r\n        case 1:\r\n          handler[i].call(this, type);\r\n          break;\r\n        case 2:\r\n          handler[i].call(this, type, arguments[1]);\r\n          break;\r\n        case 3:\r\n          handler[i].call(this, type, arguments[1], arguments[2]);\r\n          break;\r\n        default:\r\n          handler[i].apply(this, args);\r\n        }\r\n      }\r\n    }\r\n\r\n    if (this.wildcard) {\r\n      handler = [];\r\n      var ns = typeof type === 'string' ? type.split(this.delimiter) : type.slice();\r\n      searchListenerTree.call(this, handler, ns, this.listenerTree, 0);\r\n    } else {\r\n      handler = this._events[type];\r\n      if (typeof handler === 'function') {\r\n        this.event = type;\r\n        switch (al) {\r\n        case 1:\r\n          handler.call(this);\r\n          break;\r\n        case 2:\r\n          handler.call(this, arguments[1]);\r\n          break;\r\n        case 3:\r\n          handler.call(this, arguments[1], arguments[2]);\r\n          break;\r\n        default:\r\n          args = new Array(al - 1);\r\n          for (j = 1; j < al; j++) args[j - 1] = arguments[j];\r\n          handler.apply(this, args);\r\n        }\r\n        return true;\r\n      } else if (handler) {\r\n        // need to make copy of handlers because list can change in the middle\r\n        // of emit call\r\n        handler = handler.slice();\r\n      }\r\n    }\r\n\r\n    if (handler && handler.length) {\r\n      if (al > 3) {\r\n        args = new Array(al - 1);\r\n        for (j = 1; j < al; j++) args[j - 1] = arguments[j];\r\n      }\r\n      for (i = 0, l = handler.length; i < l; i++) {\r\n        this.event = type;\r\n        switch (al) {\r\n        case 1:\r\n          handler[i].call(this);\r\n          break;\r\n        case 2:\r\n          handler[i].call(this, arguments[1]);\r\n          break;\r\n        case 3:\r\n          handler[i].call(this, arguments[1], arguments[2]);\r\n          break;\r\n        default:\r\n          handler[i].apply(this, args);\r\n        }\r\n      }\r\n      return true;\r\n    } else if (!this._all && type === 'error') {\r\n      if (arguments[1] instanceof Error) {\r\n        throw arguments[1]; // Unhandled 'error' event\r\n      } else {\r\n        throw new Error(\"Uncaught, unspecified 'error' event.\");\r\n      }\r\n      return false;\r\n    }\r\n\r\n    return !!this._all;\r\n  };\r\n\r\n  EventEmitter.prototype.emitAsync = function() {\r\n\r\n    this._events || init.call(this);\r\n\r\n    var type = arguments[0];\r\n\r\n    if (type === 'newListener' && !this.newListener) {\r\n        if (!this._events.newListener) { return Promise.resolve([false]); }\r\n    }\r\n\r\n    var promises= [];\r\n\r\n    var al = arguments.length;\r\n    var args,l,i,j;\r\n    var handler;\r\n\r\n    if (this._all) {\r\n      if (al > 3) {\r\n        args = new Array(al);\r\n        for (j = 1; j < al; j++) args[j] = arguments[j];\r\n      }\r\n      for (i = 0, l = this._all.length; i < l; i++) {\r\n        this.event = type;\r\n        switch (al) {\r\n        case 1:\r\n          promises.push(this._all[i].call(this, type));\r\n          break;\r\n        case 2:\r\n          promises.push(this._all[i].call(this, type, arguments[1]));\r\n          break;\r\n        case 3:\r\n          promises.push(this._all[i].call(this, type, arguments[1], arguments[2]));\r\n          break;\r\n        default:\r\n          promises.push(this._all[i].apply(this, args));\r\n        }\r\n      }\r\n    }\r\n\r\n    if (this.wildcard) {\r\n      handler = [];\r\n      var ns = typeof type === 'string' ? type.split(this.delimiter) : type.slice();\r\n      searchListenerTree.call(this, handler, ns, this.listenerTree, 0);\r\n    } else {\r\n      handler = this._events[type];\r\n    }\r\n\r\n    if (typeof handler === 'function') {\r\n      this.event = type;\r\n      switch (al) {\r\n      case 1:\r\n        promises.push(handler.call(this));\r\n        break;\r\n      case 2:\r\n        promises.push(handler.call(this, arguments[1]));\r\n        break;\r\n      case 3:\r\n        promises.push(handler.call(this, arguments[1], arguments[2]));\r\n        break;\r\n      default:\r\n        args = new Array(al - 1);\r\n        for (j = 1; j < al; j++) args[j - 1] = arguments[j];\r\n        promises.push(handler.apply(this, args));\r\n      }\r\n    } else if (handler && handler.length) {\r\n      if (al > 3) {\r\n        args = new Array(al - 1);\r\n        for (j = 1; j < al; j++) args[j - 1] = arguments[j];\r\n      }\r\n      for (i = 0, l = handler.length; i < l; i++) {\r\n        this.event = type;\r\n        switch (al) {\r\n        case 1:\r\n          promises.push(handler[i].call(this));\r\n          break;\r\n        case 2:\r\n          promises.push(handler[i].call(this, arguments[1]));\r\n          break;\r\n        case 3:\r\n          promises.push(handler[i].call(this, arguments[1], arguments[2]));\r\n          break;\r\n        default:\r\n          promises.push(handler[i].apply(this, args));\r\n        }\r\n      }\r\n    } else if (!this._all && type === 'error') {\r\n      if (arguments[1] instanceof Error) {\r\n        return Promise.reject(arguments[1]); // Unhandled 'error' event\r\n      } else {\r\n        return Promise.reject(\"Uncaught, unspecified 'error' event.\");\r\n      }\r\n    }\r\n\r\n    return Promise.all(promises);\r\n  };\r\n\r\n  EventEmitter.prototype.on = function(type, listener) {\r\n    if (typeof type === 'function') {\r\n      this.onAny(type);\r\n      return this;\r\n    }\r\n\r\n    if (typeof listener !== 'function') {\r\n      throw new Error('on only accepts instances of Function');\r\n    }\r\n    this._events || init.call(this);\r\n\r\n    // To avoid recursion in the case that type == \"newListeners\"! Before\r\n    // adding it to the listeners, first emit \"newListeners\".\r\n    this.emit('newListener', type, listener);\r\n\r\n    if (this.wildcard) {\r\n      growListenerTree.call(this, type, listener);\r\n      return this;\r\n    }\r\n\r\n    if (!this._events[type]) {\r\n      // Optimize the case of one listener. Don't need the extra array object.\r\n      this._events[type] = listener;\r\n    }\r\n    else {\r\n      if (typeof this._events[type] === 'function') {\r\n        // Change to array.\r\n        this._events[type] = [this._events[type]];\r\n      }\r\n\r\n      // If we've already got an array, just append.\r\n      this._events[type].push(listener);\r\n\r\n      // Check for listener leak\r\n      if (\r\n        !this._events[type].warned &&\r\n        this._events.maxListeners > 0 &&\r\n        this._events[type].length > this._events.maxListeners\r\n      ) {\r\n        this._events[type].warned = true;\r\n        logPossibleMemoryLeak.call(this, this._events[type].length, type);\r\n      }\r\n    }\r\n\r\n    return this;\r\n  };\r\n\r\n  EventEmitter.prototype.onAny = function(fn) {\r\n    if (typeof fn !== 'function') {\r\n      throw new Error('onAny only accepts instances of Function');\r\n    }\r\n\r\n    if (!this._all) {\r\n      this._all = [];\r\n    }\r\n\r\n    // Add the function to the event listener collection.\r\n    this._all.push(fn);\r\n    return this;\r\n  };\r\n\r\n  EventEmitter.prototype.addListener = EventEmitter.prototype.on;\r\n\r\n  EventEmitter.prototype.off = function(type, listener) {\r\n    if (typeof listener !== 'function') {\r\n      throw new Error('removeListener only takes instances of Function');\r\n    }\r\n\r\n    var handlers,leafs=[];\r\n\r\n    if(this.wildcard) {\r\n      var ns = typeof type === 'string' ? type.split(this.delimiter) : type.slice();\r\n      leafs = searchListenerTree.call(this, null, ns, this.listenerTree, 0);\r\n    }\r\n    else {\r\n      // does not use listeners(), so no side effect of creating _events[type]\r\n      if (!this._events[type]) return this;\r\n      handlers = this._events[type];\r\n      leafs.push({_listeners:handlers});\r\n    }\r\n\r\n    for (var iLeaf=0; iLeaf<leafs.length; iLeaf++) {\r\n      var leaf = leafs[iLeaf];\r\n      handlers = leaf._listeners;\r\n      if (isArray(handlers)) {\r\n\r\n        var position = -1;\r\n\r\n        for (var i = 0, length = handlers.length; i < length; i++) {\r\n          if (handlers[i] === listener ||\r\n            (handlers[i].listener && handlers[i].listener === listener) ||\r\n            (handlers[i]._origin && handlers[i]._origin === listener)) {\r\n            position = i;\r\n            break;\r\n          }\r\n        }\r\n\r\n        if (position < 0) {\r\n          continue;\r\n        }\r\n\r\n        if(this.wildcard) {\r\n          leaf._listeners.splice(position, 1);\r\n        }\r\n        else {\r\n          this._events[type].splice(position, 1);\r\n        }\r\n\r\n        if (handlers.length === 0) {\r\n          if(this.wildcard) {\r\n            delete leaf._listeners;\r\n          }\r\n          else {\r\n            delete this._events[type];\r\n          }\r\n        }\r\n\r\n        this.emit(\"removeListener\", type, listener);\r\n\r\n        return this;\r\n      }\r\n      else if (handlers === listener ||\r\n        (handlers.listener && handlers.listener === listener) ||\r\n        (handlers._origin && handlers._origin === listener)) {\r\n        if(this.wildcard) {\r\n          delete leaf._listeners;\r\n        }\r\n        else {\r\n          delete this._events[type];\r\n        }\r\n\r\n        this.emit(\"removeListener\", type, listener);\r\n      }\r\n    }\r\n\r\n    function recursivelyGarbageCollect(root) {\r\n      if (root === undefined) {\r\n        return;\r\n      }\r\n      var keys = Object.keys(root);\r\n      for (var i in keys) {\r\n        var key = keys[i];\r\n        var obj = root[key];\r\n        if ((obj instanceof Function) || (typeof obj !== \"object\") || (obj === null))\r\n          continue;\r\n        if (Object.keys(obj).length > 0) {\r\n          recursivelyGarbageCollect(root[key]);\r\n        }\r\n        if (Object.keys(obj).length === 0) {\r\n          delete root[key];\r\n        }\r\n      }\r\n    }\r\n    recursivelyGarbageCollect(this.listenerTree);\r\n\r\n    return this;\r\n  };\r\n\r\n  EventEmitter.prototype.offAny = function(fn) {\r\n    var i = 0, l = 0, fns;\r\n    if (fn && this._all && this._all.length > 0) {\r\n      fns = this._all;\r\n      for(i = 0, l = fns.length; i < l; i++) {\r\n        if(fn === fns[i]) {\r\n          fns.splice(i, 1);\r\n          this.emit(\"removeListenerAny\", fn);\r\n          return this;\r\n        }\r\n      }\r\n    } else {\r\n      fns = this._all;\r\n      for(i = 0, l = fns.length; i < l; i++)\r\n        this.emit(\"removeListenerAny\", fns[i]);\r\n      this._all = [];\r\n    }\r\n    return this;\r\n  };\r\n\r\n  EventEmitter.prototype.removeListener = EventEmitter.prototype.off;\r\n\r\n  EventEmitter.prototype.removeAllListeners = function(type) {\r\n    if (arguments.length === 0) {\r\n      !this._events || init.call(this);\r\n      return this;\r\n    }\r\n\r\n    if (this.wildcard) {\r\n      var ns = typeof type === 'string' ? type.split(this.delimiter) : type.slice();\r\n      var leafs = searchListenerTree.call(this, null, ns, this.listenerTree, 0);\r\n\r\n      for (var iLeaf=0; iLeaf<leafs.length; iLeaf++) {\r\n        var leaf = leafs[iLeaf];\r\n        leaf._listeners = null;\r\n      }\r\n    }\r\n    else if (this._events) {\r\n      this._events[type] = null;\r\n    }\r\n    return this;\r\n  };\r\n\r\n  EventEmitter.prototype.listeners = function(type) {\r\n    if (this.wildcard) {\r\n      var handlers = [];\r\n      var ns = typeof type === 'string' ? type.split(this.delimiter) : type.slice();\r\n      searchListenerTree.call(this, handlers, ns, this.listenerTree, 0);\r\n      return handlers;\r\n    }\r\n\r\n    this._events || init.call(this);\r\n\r\n    if (!this._events[type]) this._events[type] = [];\r\n    if (!isArray(this._events[type])) {\r\n      this._events[type] = [this._events[type]];\r\n    }\r\n    return this._events[type];\r\n  };\r\n\r\n  EventEmitter.prototype.listenerCount = function(type) {\r\n    return this.listeners(type).length;\r\n  };\r\n\r\n  EventEmitter.prototype.listenersAny = function() {\r\n\r\n    if(this._all) {\r\n      return this._all;\r\n    }\r\n    else {\r\n      return [];\r\n    }\r\n\r\n  };\r\n\r\n  if (typeof define === 'function' && define.amd) {\r\n     // AMD. Register as an anonymous module.\r\n    define(function() {\r\n      return EventEmitter;\r\n    });\r\n  } else if (typeof exports === 'object') {\r\n    // CommonJS\r\n    module.exports = EventEmitter;\r\n  }\r\n  else {\r\n    // Browser global.\r\n    window.EventEmitter2 = EventEmitter;\r\n  }\r\n}();\r\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n\n'use strict';\n\n// Shimming starts here.\n(function() {\n  // Utils.\n  var logging = require('./utils').log;\n  var browserDetails = require('./utils').browserDetails;\n  // Export to the adapter global object visible in the browser.\n  module.exports.browserDetails = browserDetails;\n  module.exports.extractVersion = require('./utils').extractVersion;\n  module.exports.disableLog = require('./utils').disableLog;\n\n  // Comment out the line below if you want logging to occur, including logging\n  // for the switch statement below. Can also be turned on in the browser via\n  // adapter.disableLog(false), but then logging from the switch statement below\n  // will not appear.\n  require('./utils').disableLog(true);\n\n  // Browser shims.\n  var chromeShim = require('./chrome/chrome_shim') || null;\n  var edgeShim = require('./edge/edge_shim') || null;\n  var firefoxShim = require('./firefox/firefox_shim') || null;\n  var safariShim = require('./safari/safari_shim') || null;\n\n  // Shim browser if found.\n  switch (browserDetails.browser) {\n    case 'opera': // fallthrough as it uses chrome shims\n    case 'chrome':\n      if (!chromeShim || !chromeShim.shimPeerConnection) {\n        logging('Chrome shim is not included in this adapter release.');\n        return;\n      }\n      logging('adapter.js shimming chrome.');\n      // Export to the adapter global object visible in the browser.\n      module.exports.browserShim = chromeShim;\n\n      chromeShim.shimGetUserMedia();\n      chromeShim.shimSourceObject();\n      chromeShim.shimPeerConnection();\n      chromeShim.shimOnTrack();\n      break;\n    case 'firefox':\n      if (!firefoxShim || !firefoxShim.shimPeerConnection) {\n        logging('Firefox shim is not included in this adapter release.');\n        return;\n      }\n      logging('adapter.js shimming firefox.');\n      // Export to the adapter global object visible in the browser.\n      module.exports.browserShim = firefoxShim;\n\n      firefoxShim.shimGetUserMedia();\n      firefoxShim.shimSourceObject();\n      firefoxShim.shimPeerConnection();\n      firefoxShim.shimOnTrack();\n      break;\n    case 'edge':\n      if (!edgeShim || !edgeShim.shimPeerConnection) {\n        logging('MS edge shim is not included in this adapter release.');\n        return;\n      }\n      logging('adapter.js shimming edge.');\n      // Export to the adapter global object visible in the browser.\n      module.exports.browserShim = edgeShim;\n\n      edgeShim.shimPeerConnection();\n      break;\n    case 'safari':\n      if (!safariShim) {\n        logging('Safari shim is not included in this adapter release.');\n        return;\n      }\n      logging('adapter.js shimming safari.');\n      // Export to the adapter global object visible in the browser.\n      module.exports.browserShim = safariShim;\n\n      safariShim.shimGetUserMedia();\n      break;\n    default:\n      logging('Unsupported browser!');\n  }\n})();\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\nvar logging = require('../utils.js').log;\nvar browserDetails = require('../utils.js').browserDetails;\n\nvar chromeShim = {\n  shimOnTrack: function() {\n    if (typeof window === 'object' && window.RTCPeerConnection && !('ontrack' in\n        window.RTCPeerConnection.prototype)) {\n      Object.defineProperty(window.RTCPeerConnection.prototype, 'ontrack', {\n        get: function() {\n          return this._ontrack;\n        },\n        set: function(f) {\n          var self = this;\n          if (this._ontrack) {\n            this.removeEventListener('track', this._ontrack);\n            this.removeEventListener('addstream', this._ontrackpoly);\n          }\n          this.addEventListener('track', this._ontrack = f);\n          this.addEventListener('addstream', this._ontrackpoly = function(e) {\n            // onaddstream does not fire when a track is added to an existing\n            // stream. But stream.onaddtrack is implemented so we use that.\n            e.stream.addEventListener('addtrack', function(te) {\n              var event = new Event('track');\n              event.track = te.track;\n              event.receiver = {track: te.track};\n              event.streams = [e.stream];\n              self.dispatchEvent(event);\n            });\n            e.stream.getTracks().forEach(function(track) {\n              var event = new Event('track');\n              event.track = track;\n              event.receiver = {track: track};\n              event.streams = [e.stream];\n              this.dispatchEvent(event);\n            }.bind(this));\n          }.bind(this));\n        }\n      });\n    }\n  },\n\n  shimSourceObject: function() {\n    if (typeof window === 'object') {\n      if (window.HTMLMediaElement &&\n        !('srcObject' in window.HTMLMediaElement.prototype)) {\n        // Shim the srcObject property, once, when HTMLMediaElement is found.\n        Object.defineProperty(window.HTMLMediaElement.prototype, 'srcObject', {\n          get: function() {\n            return this._srcObject;\n          },\n          set: function(stream) {\n            var self = this;\n            // Use _srcObject as a private property for this shim\n            this._srcObject = stream;\n            if (this.src) {\n              URL.revokeObjectURL(this.src);\n            }\n\n            if (!stream) {\n              this.src = '';\n              return;\n            }\n            this.src = URL.createObjectURL(stream);\n            // We need to recreate the blob url when a track is added or\n            // removed. Doing it manually since we want to avoid a recursion.\n            stream.addEventListener('addtrack', function() {\n              if (self.src) {\n                URL.revokeObjectURL(self.src);\n              }\n              self.src = URL.createObjectURL(stream);\n            });\n            stream.addEventListener('removetrack', function() {\n              if (self.src) {\n                URL.revokeObjectURL(self.src);\n              }\n              self.src = URL.createObjectURL(stream);\n            });\n          }\n        });\n      }\n    }\n  },\n\n  shimPeerConnection: function() {\n    // The RTCPeerConnection object.\n    window.RTCPeerConnection = function(pcConfig, pcConstraints) {\n      // Translate iceTransportPolicy to iceTransports,\n      // see https://code.google.com/p/webrtc/issues/detail?id=4869\n      logging('PeerConnection');\n      if (pcConfig && pcConfig.iceTransportPolicy) {\n        pcConfig.iceTransports = pcConfig.iceTransportPolicy;\n      }\n\n      var pc = new webkitRTCPeerConnection(pcConfig, pcConstraints);\n      var origGetStats = pc.getStats.bind(pc);\n      pc.getStats = function(selector, successCallback, errorCallback) {\n        var self = this;\n        var args = arguments;\n\n        // If selector is a function then we are in the old style stats so just\n        // pass back the original getStats format to avoid breaking old users.\n        if (arguments.length > 0 && typeof selector === 'function') {\n          return origGetStats(selector, successCallback);\n        }\n\n        var fixChromeStats_ = function(response) {\n          var standardReport = {};\n          var reports = response.result();\n          reports.forEach(function(report) {\n            var standardStats = {\n              id: report.id,\n              timestamp: report.timestamp,\n              type: report.type\n            };\n            report.names().forEach(function(name) {\n              standardStats[name] = report.stat(name);\n            });\n            standardReport[standardStats.id] = standardStats;\n          });\n\n          return standardReport;\n        };\n\n        if (arguments.length >= 2) {\n          var successCallbackWrapper_ = function(response) {\n            args[1](fixChromeStats_(response));\n          };\n\n          return origGetStats.apply(this, [successCallbackWrapper_,\n              arguments[0]]);\n        }\n\n        // promise-support\n        return new Promise(function(resolve, reject) {\n          if (args.length === 1 && typeof selector === 'object') {\n            origGetStats.apply(self,\n                [function(response) {\n                  resolve.apply(null, [fixChromeStats_(response)]);\n                }, reject]);\n          } else {\n            origGetStats.apply(self, [resolve, reject]);\n          }\n        });\n      };\n\n      return pc;\n    };\n    window.RTCPeerConnection.prototype = webkitRTCPeerConnection.prototype;\n\n    // wrap static methods. Currently just generateCertificate.\n    if (webkitRTCPeerConnection.generateCertificate) {\n      Object.defineProperty(window.RTCPeerConnection, 'generateCertificate', {\n        get: function() {\n          return webkitRTCPeerConnection.generateCertificate;\n        }\n      });\n    }\n\n    // add promise support\n    ['createOffer', 'createAnswer'].forEach(function(method) {\n      var nativeMethod = webkitRTCPeerConnection.prototype[method];\n      webkitRTCPeerConnection.prototype[method] = function() {\n        var self = this;\n        if (arguments.length < 1 || (arguments.length === 1 &&\n            typeof(arguments[0]) === 'object')) {\n          var opts = arguments.length === 1 ? arguments[0] : undefined;\n          return new Promise(function(resolve, reject) {\n            nativeMethod.apply(self, [resolve, reject, opts]);\n          });\n        }\n        return nativeMethod.apply(this, arguments);\n      };\n    });\n\n    ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate']\n        .forEach(function(method) {\n          var nativeMethod = webkitRTCPeerConnection.prototype[method];\n          webkitRTCPeerConnection.prototype[method] = function() {\n            var args = arguments;\n            var self = this;\n            args[0] = new ((method === 'addIceCandidate')?\n                RTCIceCandidate : RTCSessionDescription)(args[0]);\n            return new Promise(function(resolve, reject) {\n              nativeMethod.apply(self, [args[0],\n                  function() {\n                    resolve();\n                    if (args.length >= 2) {\n                      args[1].apply(null, []);\n                    }\n                  },\n                  function(err) {\n                    reject(err);\n                    if (args.length >= 3) {\n                      args[2].apply(null, [err]);\n                    }\n                  }]\n                );\n            });\n          };\n        });\n  },\n\n  // Attach a media stream to an element.\n  attachMediaStream: function(element, stream) {\n    logging('DEPRECATED, attachMediaStream will soon be removed.');\n    if (browserDetails.version >= 43) {\n      element.srcObject = stream;\n    } else if (typeof element.src !== 'undefined') {\n      element.src = URL.createObjectURL(stream);\n    } else {\n      logging('Error attaching stream to element.');\n    }\n  },\n\n  reattachMediaStream: function(to, from) {\n    logging('DEPRECATED, reattachMediaStream will soon be removed.');\n    if (browserDetails.version >= 43) {\n      to.srcObject = from.srcObject;\n    } else {\n      to.src = from.src;\n    }\n  }\n};\n\n\n// Expose public methods.\nmodule.exports = {\n  shimOnTrack: chromeShim.shimOnTrack,\n  shimSourceObject: chromeShim.shimSourceObject,\n  shimPeerConnection: chromeShim.shimPeerConnection,\n  shimGetUserMedia: require('./getusermedia'),\n  attachMediaStream: chromeShim.attachMediaStream,\n  reattachMediaStream: chromeShim.reattachMediaStream\n};\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\nvar logging = require('../utils.js').log;\n\n// Expose public methods.\nmodule.exports = function() {\n  var constraintsToChrome_ = function(c) {\n    if (typeof c !== 'object' || c.mandatory || c.optional) {\n      return c;\n    }\n    var cc = {};\n    Object.keys(c).forEach(function(key) {\n      if (key === 'require' || key === 'advanced' || key === 'mediaSource') {\n        return;\n      }\n      var r = (typeof c[key] === 'object') ? c[key] : {ideal: c[key]};\n      if (r.exact !== undefined && typeof r.exact === 'number') {\n        r.min = r.max = r.exact;\n      }\n      var oldname_ = function(prefix, name) {\n        if (prefix) {\n          return prefix + name.charAt(0).toUpperCase() + name.slice(1);\n        }\n        return (name === 'deviceId') ? 'sourceId' : name;\n      };\n      if (r.ideal !== undefined) {\n        cc.optional = cc.optional || [];\n        var oc = {};\n        if (typeof r.ideal === 'number') {\n          oc[oldname_('min', key)] = r.ideal;\n          cc.optional.push(oc);\n          oc = {};\n          oc[oldname_('max', key)] = r.ideal;\n          cc.optional.push(oc);\n        } else {\n          oc[oldname_('', key)] = r.ideal;\n          cc.optional.push(oc);\n        }\n      }\n      if (r.exact !== undefined && typeof r.exact !== 'number') {\n        cc.mandatory = cc.mandatory || {};\n        cc.mandatory[oldname_('', key)] = r.exact;\n      } else {\n        ['min', 'max'].forEach(function(mix) {\n          if (r[mix] !== undefined) {\n            cc.mandatory = cc.mandatory || {};\n            cc.mandatory[oldname_(mix, key)] = r[mix];\n          }\n        });\n      }\n    });\n    if (c.advanced) {\n      cc.optional = (cc.optional || []).concat(c.advanced);\n    }\n    return cc;\n  };\n\n  var getUserMedia_ = function(constraints, onSuccess, onError) {\n    constraints = JSON.parse(JSON.stringify(constraints));\n    if (constraints.audio) {\n      constraints.audio = constraintsToChrome_(constraints.audio);\n    }\n    if (constraints.video) {\n      constraints.video = constraintsToChrome_(constraints.video);\n    }\n    logging('chrome: ' + JSON.stringify(constraints));\n    return navigator.webkitGetUserMedia(constraints, onSuccess, onError);\n  };\n  navigator.getUserMedia = getUserMedia_;\n\n  // Returns the result of getUserMedia as a Promise.\n  var getUserMediaPromise_ = function(constraints) {\n    return new Promise(function(resolve, reject) {\n      navigator.getUserMedia(constraints, resolve, reject);\n    });\n  };\n\n  if (!navigator.mediaDevices) {\n    navigator.mediaDevices = {\n      getUserMedia: getUserMediaPromise_,\n      enumerateDevices: function() {\n        return new Promise(function(resolve) {\n          var kinds = {audio: 'audioinput', video: 'videoinput'};\n          return MediaStreamTrack.getSources(function(devices) {\n            resolve(devices.map(function(device) {\n              return {label: device.label,\n                      kind: kinds[device.kind],\n                      deviceId: device.id,\n                      groupId: ''};\n            }));\n          });\n        });\n      }\n    };\n  }\n\n  // A shim for getUserMedia method on the mediaDevices object.\n  // TODO(KaptenJansson) remove once implemented in Chrome stable.\n  if (!navigator.mediaDevices.getUserMedia) {\n    navigator.mediaDevices.getUserMedia = function(constraints) {\n      return getUserMediaPromise_(constraints);\n    };\n  } else {\n    // Even though Chrome 45 has navigator.mediaDevices and a getUserMedia\n    // function which returns a Promise, it does not accept spec-style\n    // constraints.\n    var origGetUserMedia = navigator.mediaDevices.getUserMedia.\n        bind(navigator.mediaDevices);\n    navigator.mediaDevices.getUserMedia = function(c) {\n      if (c) {\n        logging('spec:   ' + JSON.stringify(c)); // whitespace for alignment\n        c.audio = constraintsToChrome_(c.audio);\n        c.video = constraintsToChrome_(c.video);\n        logging('chrome: ' + JSON.stringify(c));\n      }\n      return origGetUserMedia(c);\n    }.bind(this);\n  }\n\n  // Dummy devicechange event methods.\n  // TODO(KaptenJansson) remove once implemented in Chrome stable.\n  if (typeof navigator.mediaDevices.addEventListener === 'undefined') {\n    navigator.mediaDevices.addEventListener = function() {\n      logging('Dummy mediaDevices.addEventListener called.');\n    };\n  }\n  if (typeof navigator.mediaDevices.removeEventListener === 'undefined') {\n    navigator.mediaDevices.removeEventListener = function() {\n      logging('Dummy mediaDevices.removeEventListener called.');\n    };\n  }\n};\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\n// SDP helpers.\nvar SDPUtils = {};\n\n// Generate an alphanumeric identifier for cname or mids.\n// TODO: use UUIDs instead? https://gist.github.com/jed/982883\nSDPUtils.generateIdentifier = function() {\n  return Math.random().toString(36).substr(2, 10);\n};\n\n// The RTCP CNAME used by all peerconnections from the same JS.\nSDPUtils.localCName = SDPUtils.generateIdentifier();\n\n// Splits SDP into lines, dealing with both CRLF and LF.\nSDPUtils.splitLines = function(blob) {\n  return blob.trim().split('\\n').map(function(line) {\n    return line.trim();\n  });\n};\n// Splits SDP into sessionpart and mediasections. Ensures CRLF.\nSDPUtils.splitSections = function(blob) {\n  var parts = blob.split('\\nm=');\n  return parts.map(function(part, index) {\n    return (index > 0 ? 'm=' + part : part).trim() + '\\r\\n';\n  });\n};\n\n// Returns lines that start with a certain prefix.\nSDPUtils.matchPrefix = function(blob, prefix) {\n  return SDPUtils.splitLines(blob).filter(function(line) {\n    return line.indexOf(prefix) === 0;\n  });\n};\n\n// Parses an ICE candidate line. Sample input:\n// candidate:702786350 2 udp 41819902 8.8.8.8 60769 typ relay raddr 8.8.8.8\n// rport 55996\"\nSDPUtils.parseCandidate = function(line) {\n  var parts;\n  // Parse both variants.\n  if (line.indexOf('a=candidate:') === 0) {\n    parts = line.substring(12).split(' ');\n  } else {\n    parts = line.substring(10).split(' ');\n  }\n\n  var candidate = {\n    foundation: parts[0],\n    component: parts[1],\n    protocol: parts[2].toLowerCase(),\n    priority: parseInt(parts[3], 10),\n    ip: parts[4],\n    port: parseInt(parts[5], 10),\n    // skip parts[6] == 'typ'\n    type: parts[7]\n  };\n\n  for (var i = 8; i < parts.length; i += 2) {\n    switch (parts[i]) {\n      case 'raddr':\n        candidate.relatedAddress = parts[i + 1];\n        break;\n      case 'rport':\n        candidate.relatedPort = parseInt(parts[i + 1], 10);\n        break;\n      case 'tcptype':\n        candidate.tcpType = parts[i + 1];\n        break;\n      default: // Unknown extensions are silently ignored.\n        break;\n    }\n  }\n  return candidate;\n};\n\n// Translates a candidate object into SDP candidate attribute.\nSDPUtils.writeCandidate = function(candidate) {\n  var sdp = [];\n  sdp.push(candidate.foundation);\n  sdp.push(candidate.component);\n  sdp.push(candidate.protocol.toUpperCase());\n  sdp.push(candidate.priority);\n  sdp.push(candidate.ip);\n  sdp.push(candidate.port);\n\n  var type = candidate.type;\n  sdp.push('typ');\n  sdp.push(type);\n  if (type !== 'host' && candidate.relatedAddress &&\n      candidate.relatedPort) {\n    sdp.push('raddr');\n    sdp.push(candidate.relatedAddress); // was: relAddr\n    sdp.push('rport');\n    sdp.push(candidate.relatedPort); // was: relPort\n  }\n  if (candidate.tcpType && candidate.protocol.toLowerCase() === 'tcp') {\n    sdp.push('tcptype');\n    sdp.push(candidate.tcpType);\n  }\n  return 'candidate:' + sdp.join(' ');\n};\n\n// Parses an rtpmap line, returns RTCRtpCoddecParameters. Sample input:\n// a=rtpmap:111 opus/48000/2\nSDPUtils.parseRtpMap = function(line) {\n  var parts = line.substr(9).split(' ');\n  var parsed = {\n    payloadType: parseInt(parts.shift(), 10) // was: id\n  };\n\n  parts = parts[0].split('/');\n\n  parsed.name = parts[0];\n  parsed.clockRate = parseInt(parts[1], 10); // was: clockrate\n  // was: channels\n  parsed.numChannels = parts.length === 3 ? parseInt(parts[2], 10) : 1;\n  return parsed;\n};\n\n// Generate an a=rtpmap line from RTCRtpCodecCapability or\n// RTCRtpCodecParameters.\nSDPUtils.writeRtpMap = function(codec) {\n  var pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  return 'a=rtpmap:' + pt + ' ' + codec.name + '/' + codec.clockRate +\n      (codec.numChannels !== 1 ? '/' + codec.numChannels : '') + '\\r\\n';\n};\n\n// Parses an a=extmap line (headerextension from RFC 5285). Sample input:\n// a=extmap:2 urn:ietf:params:rtp-hdrext:toffset\nSDPUtils.parseExtmap = function(line) {\n  var parts = line.substr(9).split(' ');\n  return {\n    id: parseInt(parts[0], 10),\n    uri: parts[1]\n  };\n};\n\n// Generates a=extmap line from RTCRtpHeaderExtensionParameters or\n// RTCRtpHeaderExtension.\nSDPUtils.writeExtmap = function(headerExtension) {\n  return 'a=extmap:' + (headerExtension.id || headerExtension.preferredId) +\n       ' ' + headerExtension.uri + '\\r\\n';\n};\n\n// Parses an ftmp line, returns dictionary. Sample input:\n// a=fmtp:96 vbr=on;cng=on\n// Also deals with vbr=on; cng=on\nSDPUtils.parseFmtp = function(line) {\n  var parsed = {};\n  var kv;\n  var parts = line.substr(line.indexOf(' ') + 1).split(';');\n  for (var j = 0; j < parts.length; j++) {\n    kv = parts[j].trim().split('=');\n    parsed[kv[0].trim()] = kv[1];\n  }\n  return parsed;\n};\n\n// Generates an a=ftmp line from RTCRtpCodecCapability or RTCRtpCodecParameters.\nSDPUtils.writeFmtp = function(codec) {\n  var line = '';\n  var pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  if (codec.parameters && Object.keys(codec.parameters).length) {\n    var params = [];\n    Object.keys(codec.parameters).forEach(function(param) {\n      params.push(param + '=' + codec.parameters[param]);\n    });\n    line += 'a=fmtp:' + pt + ' ' + params.join(';') + '\\r\\n';\n  }\n  return line;\n};\n\n// Parses an rtcp-fb line, returns RTCPRtcpFeedback object. Sample input:\n// a=rtcp-fb:98 nack rpsi\nSDPUtils.parseRtcpFb = function(line) {\n  var parts = line.substr(line.indexOf(' ') + 1).split(' ');\n  return {\n    type: parts.shift(),\n    parameter: parts.join(' ')\n  };\n};\n// Generate a=rtcp-fb lines from RTCRtpCodecCapability or RTCRtpCodecParameters.\nSDPUtils.writeRtcpFb = function(codec) {\n  var lines = '';\n  var pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  if (codec.rtcpFeedback && codec.rtcpFeedback.length) {\n    // FIXME: special handling for trr-int?\n    codec.rtcpFeedback.forEach(function(fb) {\n      lines += 'a=rtcp-fb:' + pt + ' ' + fb.type + ' ' + fb.parameter +\n          '\\r\\n';\n    });\n  }\n  return lines;\n};\n\n// Parses an RFC 5576 ssrc media attribute. Sample input:\n// a=ssrc:3735928559 cname:something\nSDPUtils.parseSsrcMedia = function(line) {\n  var sp = line.indexOf(' ');\n  var parts = {\n    ssrc: parseInt(line.substr(7, sp - 7), 10)\n  };\n  var colon = line.indexOf(':', sp);\n  if (colon > -1) {\n    parts.attribute = line.substr(sp + 1, colon - sp - 1);\n    parts.value = line.substr(colon + 1);\n  } else {\n    parts.attribute = line.substr(sp + 1);\n  }\n  return parts;\n};\n\n// Extracts DTLS parameters from SDP media section or sessionpart.\n// FIXME: for consistency with other functions this should only\n//   get the fingerprint line as input. See also getIceParameters.\nSDPUtils.getDtlsParameters = function(mediaSection, sessionpart) {\n  var lines = SDPUtils.splitLines(mediaSection);\n  // Search in session part, too.\n  lines = lines.concat(SDPUtils.splitLines(sessionpart));\n  var fpLine = lines.filter(function(line) {\n    return line.indexOf('a=fingerprint:') === 0;\n  })[0].substr(14);\n  // Note: a=setup line is ignored since we use the 'auto' role.\n  var dtlsParameters = {\n    role: 'auto',\n    fingerprints: [{\n      algorithm: fpLine.split(' ')[0],\n      value: fpLine.split(' ')[1]\n    }]\n  };\n  return dtlsParameters;\n};\n\n// Serializes DTLS parameters to SDP.\nSDPUtils.writeDtlsParameters = function(params, setupType) {\n  var sdp = 'a=setup:' + setupType + '\\r\\n';\n  params.fingerprints.forEach(function(fp) {\n    sdp += 'a=fingerprint:' + fp.algorithm + ' ' + fp.value + '\\r\\n';\n  });\n  return sdp;\n};\n// Parses ICE information from SDP media section or sessionpart.\n// FIXME: for consistency with other functions this should only\n//   get the ice-ufrag and ice-pwd lines as input.\nSDPUtils.getIceParameters = function(mediaSection, sessionpart) {\n  var lines = SDPUtils.splitLines(mediaSection);\n  // Search in session part, too.\n  lines = lines.concat(SDPUtils.splitLines(sessionpart));\n  var iceParameters = {\n    usernameFragment: lines.filter(function(line) {\n      return line.indexOf('a=ice-ufrag:') === 0;\n    })[0].substr(12),\n    password: lines.filter(function(line) {\n      return line.indexOf('a=ice-pwd:') === 0;\n    })[0].substr(10)\n  };\n  return iceParameters;\n};\n\n// Serializes ICE parameters to SDP.\nSDPUtils.writeIceParameters = function(params) {\n  return 'a=ice-ufrag:' + params.usernameFragment + '\\r\\n' +\n      'a=ice-pwd:' + params.password + '\\r\\n';\n};\n\n// Parses the SDP media section and returns RTCRtpParameters.\nSDPUtils.parseRtpParameters = function(mediaSection) {\n  var description = {\n    codecs: [],\n    headerExtensions: [],\n    fecMechanisms: [],\n    rtcp: []\n  };\n  var lines = SDPUtils.splitLines(mediaSection);\n  var mline = lines[0].split(' ');\n  for (var i = 3; i < mline.length; i++) { // find all codecs from mline[3..]\n    var pt = mline[i];\n    var rtpmapline = SDPUtils.matchPrefix(\n        mediaSection, 'a=rtpmap:' + pt + ' ')[0];\n    if (rtpmapline) {\n      var codec = SDPUtils.parseRtpMap(rtpmapline);\n      var fmtps = SDPUtils.matchPrefix(\n          mediaSection, 'a=fmtp:' + pt + ' ');\n      // Only the first a=fmtp:<pt> is considered.\n      codec.parameters = fmtps.length ? SDPUtils.parseFmtp(fmtps[0]) : {};\n      codec.rtcpFeedback = SDPUtils.matchPrefix(\n          mediaSection, 'a=rtcp-fb:' + pt + ' ')\n        .map(SDPUtils.parseRtcpFb);\n      description.codecs.push(codec);\n      // parse FEC mechanisms from rtpmap lines.\n      switch (codec.name.toUpperCase()) {\n        case 'RED':\n        case 'ULPFEC':\n          description.fecMechanisms.push(codec.name.toUpperCase());\n          break;\n        default: // only RED and ULPFEC are recognized as FEC mechanisms.\n          break;\n      }\n    }\n  }\n  SDPUtils.matchPrefix(mediaSection, 'a=extmap:').forEach(function(line) {\n    description.headerExtensions.push(SDPUtils.parseExtmap(line));\n  });\n  // FIXME: parse rtcp.\n  return description;\n};\n\n// Generates parts of the SDP media section describing the capabilities /\n// parameters.\nSDPUtils.writeRtpDescription = function(kind, caps) {\n  var sdp = '';\n\n  // Build the mline.\n  sdp += 'm=' + kind + ' ';\n  sdp += caps.codecs.length > 0 ? '9' : '0'; // reject if no codecs.\n  sdp += ' UDP/TLS/RTP/SAVPF ';\n  sdp += caps.codecs.map(function(codec) {\n    if (codec.preferredPayloadType !== undefined) {\n      return codec.preferredPayloadType;\n    }\n    return codec.payloadType;\n  }).join(' ') + '\\r\\n';\n\n  sdp += 'c=IN IP4 0.0.0.0\\r\\n';\n  sdp += 'a=rtcp:9 IN IP4 0.0.0.0\\r\\n';\n\n  // Add a=rtpmap lines for each codec. Also fmtp and rtcp-fb.\n  caps.codecs.forEach(function(codec) {\n    sdp += SDPUtils.writeRtpMap(codec);\n    sdp += SDPUtils.writeFmtp(codec);\n    sdp += SDPUtils.writeRtcpFb(codec);\n  });\n  // FIXME: add headerExtensions, fecMechanism and rtcp.\n  sdp += 'a=rtcp-mux\\r\\n';\n  return sdp;\n};\n\n// Parses the SDP media section and returns an array of\n// RTCRtpEncodingParameters.\nSDPUtils.parseRtpEncodingParameters = function(mediaSection) {\n  var encodingParameters = [];\n  var description = SDPUtils.parseRtpParameters(mediaSection);\n  var hasRed = description.fecMechanisms.indexOf('RED') !== -1;\n  var hasUlpfec = description.fecMechanisms.indexOf('ULPFEC') !== -1;\n\n  // filter a=ssrc:... cname:, ignore PlanB-msid\n  var ssrcs = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n  .map(function(line) {\n    return SDPUtils.parseSsrcMedia(line);\n  })\n  .filter(function(parts) {\n    return parts.attribute === 'cname';\n  });\n  var primarySsrc = ssrcs.length > 0 && ssrcs[0].ssrc;\n  var secondarySsrc;\n\n  var flows = SDPUtils.matchPrefix(mediaSection, 'a=ssrc-group:FID')\n  .map(function(line) {\n    var parts = line.split(' ');\n    parts.shift();\n    return parts.map(function(part) {\n      return parseInt(part, 10);\n    });\n  });\n  if (flows.length > 0 && flows[0].length > 1 && flows[0][0] === primarySsrc) {\n    secondarySsrc = flows[0][1];\n  }\n\n  description.codecs.forEach(function(codec) {\n    if (codec.name.toUpperCase() === 'RTX' && codec.parameters.apt) {\n      var encParam = {\n        ssrc: primarySsrc,\n        codecPayloadType: parseInt(codec.parameters.apt, 10),\n        rtx: {\n          ssrc: secondarySsrc\n        }\n      };\n      encodingParameters.push(encParam);\n      if (hasRed) {\n        encParam = JSON.parse(JSON.stringify(encParam));\n        encParam.fec = {\n          ssrc: secondarySsrc,\n          mechanism: hasUlpfec ? 'red+ulpfec' : 'red'\n        };\n        encodingParameters.push(encParam);\n      }\n    }\n  });\n  if (encodingParameters.length === 0 && primarySsrc) {\n    encodingParameters.push({\n      ssrc: primarySsrc\n    });\n  }\n\n  // we support both b=AS and b=TIAS but interpret AS as TIAS.\n  var bandwidth = SDPUtils.matchPrefix(mediaSection, 'b=');\n  if (bandwidth.length) {\n    if (bandwidth[0].indexOf('b=TIAS:') === 0) {\n      bandwidth = parseInt(bandwidth[0].substr(7), 10);\n    } else if (bandwidth[0].indexOf('b=AS:') === 0) {\n      bandwidth = parseInt(bandwidth[0].substr(5), 10);\n    }\n    encodingParameters.forEach(function(params) {\n      params.maxBitrate = bandwidth;\n    });\n  }\n  return encodingParameters;\n};\n\nSDPUtils.writeSessionBoilerplate = function() {\n  // FIXME: sess-id should be an NTP timestamp.\n  return 'v=0\\r\\n' +\n      'o=thisisadapterortc 8169639915646943137 2 IN IP4 127.0.0.1\\r\\n' +\n      's=-\\r\\n' +\n      't=0 0\\r\\n';\n};\n\nSDPUtils.writeMediaSection = function(transceiver, caps, type, stream) {\n  var sdp = SDPUtils.writeRtpDescription(transceiver.kind, caps);\n\n  // Map ICE parameters (ufrag, pwd) to SDP.\n  sdp += SDPUtils.writeIceParameters(\n      transceiver.iceGatherer.getLocalParameters());\n\n  // Map DTLS parameters to SDP.\n  sdp += SDPUtils.writeDtlsParameters(\n      transceiver.dtlsTransport.getLocalParameters(),\n      type === 'offer' ? 'actpass' : 'active');\n\n  sdp += 'a=mid:' + transceiver.mid + '\\r\\n';\n\n  if (transceiver.rtpSender && transceiver.rtpReceiver) {\n    sdp += 'a=sendrecv\\r\\n';\n  } else if (transceiver.rtpSender) {\n    sdp += 'a=sendonly\\r\\n';\n  } else if (transceiver.rtpReceiver) {\n    sdp += 'a=recvonly\\r\\n';\n  } else {\n    sdp += 'a=inactive\\r\\n';\n  }\n\n  // FIXME: for RTX there might be multiple SSRCs. Not implemented in Edge yet.\n  if (transceiver.rtpSender) {\n    var msid = 'msid:' + stream.id + ' ' +\n        transceiver.rtpSender.track.id + '\\r\\n';\n    sdp += 'a=' + msid;\n    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\n        ' ' + msid;\n  }\n  // FIXME: this should be written by writeRtpDescription.\n  sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\n      ' cname:' + SDPUtils.localCName + '\\r\\n';\n  return sdp;\n};\n\n// Gets the direction from the mediaSection or the sessionpart.\nSDPUtils.getDirection = function(mediaSection, sessionpart) {\n  // Look for sendrecv, sendonly, recvonly, inactive, default to sendrecv.\n  var lines = SDPUtils.splitLines(mediaSection);\n  for (var i = 0; i < lines.length; i++) {\n    switch (lines[i]) {\n      case 'a=sendrecv':\n      case 'a=sendonly':\n      case 'a=recvonly':\n      case 'a=inactive':\n        return lines[i].substr(2);\n      default:\n        // FIXME: What should happen here?\n    }\n  }\n  if (sessionpart) {\n    return SDPUtils.getDirection(sessionpart);\n  }\n  return 'sendrecv';\n};\n\n// Expose public methods.\nmodule.exports = SDPUtils;\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nvar SDPUtils = require('./edge_sdp');\nvar logging = require('../utils').log;\n\nvar edgeShim = {\n  shimPeerConnection: function() {\n    if (window.RTCIceGatherer) {\n      // ORTC defines an RTCIceCandidate object but no constructor.\n      // Not implemented in Edge.\n      if (!window.RTCIceCandidate) {\n        window.RTCIceCandidate = function(args) {\n          return args;\n        };\n      }\n      // ORTC does not have a session description object but\n      // other browsers (i.e. Chrome) that will support both PC and ORTC\n      // in the future might have this defined already.\n      if (!window.RTCSessionDescription) {\n        window.RTCSessionDescription = function(args) {\n          return args;\n        };\n      }\n    }\n\n    window.RTCPeerConnection = function(config) {\n      var self = this;\n\n      var _eventTarget = document.createDocumentFragment();\n      ['addEventListener', 'removeEventListener', 'dispatchEvent']\n          .forEach(function(method) {\n            self[method] = _eventTarget[method].bind(_eventTarget);\n          });\n\n      this.onicecandidate = null;\n      this.onaddstream = null;\n      this.ontrack = null;\n      this.onremovestream = null;\n      this.onsignalingstatechange = null;\n      this.oniceconnectionstatechange = null;\n      this.onnegotiationneeded = null;\n      this.ondatachannel = null;\n\n      this.localStreams = [];\n      this.remoteStreams = [];\n      this.getLocalStreams = function() {\n        return self.localStreams;\n      };\n      this.getRemoteStreams = function() {\n        return self.remoteStreams;\n      };\n\n      this.localDescription = new RTCSessionDescription({\n        type: '',\n        sdp: ''\n      });\n      this.remoteDescription = new RTCSessionDescription({\n        type: '',\n        sdp: ''\n      });\n      this.signalingState = 'stable';\n      this.iceConnectionState = 'new';\n      this.iceGatheringState = 'new';\n\n      this.iceOptions = {\n        gatherPolicy: 'all',\n        iceServers: []\n      };\n      if (config && config.iceTransportPolicy) {\n        switch (config.iceTransportPolicy) {\n          case 'all':\n          case 'relay':\n            this.iceOptions.gatherPolicy = config.iceTransportPolicy;\n            break;\n          case 'none':\n            // FIXME: remove once implementation and spec have added this.\n            throw new TypeError('iceTransportPolicy \"none\" not supported');\n          default:\n            // don't set iceTransportPolicy.\n            break;\n        }\n      }\n      if (config && config.iceServers) {\n        // Edge does not like\n        // 1) stun:\n        // 2) turn: that does not have all of turn:host:port?transport=udp\n        this.iceOptions.iceServers = config.iceServers.filter(function(server) {\n          if (server && server.urls) {\n            server.urls = server.urls.filter(function(url) {\n              return url.indexOf('turn:') === 0 &&\n                  url.indexOf('transport=udp') !== -1;\n            })[0];\n            return !!server.urls;\n          }\n          return false;\n        });\n      }\n\n      // per-track iceGathers, iceTransports, dtlsTransports, rtpSenders, ...\n      // everything that is needed to describe a SDP m-line.\n      this.transceivers = [];\n\n      // since the iceGatherer is currently created in createOffer but we\n      // must not emit candidates until after setLocalDescription we buffer\n      // them in this array.\n      this._localIceCandidatesBuffer = [];\n    };\n\n    window.RTCPeerConnection.prototype._emitBufferedCandidates = function() {\n      var self = this;\n      var sections = SDPUtils.splitSections(self.localDescription.sdp);\n      // FIXME: need to apply ice candidates in a way which is async but\n      // in-order\n      this._localIceCandidatesBuffer.forEach(function(event) {\n        var end = !event.candidate || Object.keys(event.candidate).length === 0;\n        if (end) {\n          for (var j = 1; j < sections.length; j++) {\n            if (sections[j].indexOf('\\r\\na=end-of-candidates\\r\\n') === -1) {\n              sections[j] += 'a=end-of-candidates\\r\\n';\n            }\n          }\n        } else if (event.candidate.candidate.indexOf('typ endOfCandidates')\n            === -1) {\n          sections[event.candidate.sdpMLineIndex + 1] +=\n              'a=' + event.candidate.candidate + '\\r\\n';\n        }\n        self.localDescription.sdp = sections.join('');\n        self.dispatchEvent(event);\n        if (self.onicecandidate !== null) {\n          self.onicecandidate(event);\n        }\n        if (!event.candidate && self.iceGatheringState !== 'complete') {\n          var complete = self.transceivers.every(function(transceiver) {\n            return transceiver.iceGatherer &&\n                transceiver.iceGatherer.state === 'completed';\n          });\n          if (complete) {\n            self.iceGatheringState = 'complete';\n          }\n        }\n      });\n      this._localIceCandidatesBuffer = [];\n    };\n\n    window.RTCPeerConnection.prototype.addStream = function(stream) {\n      // Clone is necessary for local demos mostly, attaching directly\n      // to two different senders does not work (build 10547).\n      this.localStreams.push(stream.clone());\n      this._maybeFireNegotiationNeeded();\n    };\n\n    window.RTCPeerConnection.prototype.removeStream = function(stream) {\n      var idx = this.localStreams.indexOf(stream);\n      if (idx > -1) {\n        this.localStreams.splice(idx, 1);\n        this._maybeFireNegotiationNeeded();\n      }\n    };\n\n    // Determines the intersection of local and remote capabilities.\n    window.RTCPeerConnection.prototype._getCommonCapabilities =\n        function(localCapabilities, remoteCapabilities) {\n          var commonCapabilities = {\n            codecs: [],\n            headerExtensions: [],\n            fecMechanisms: []\n          };\n          localCapabilities.codecs.forEach(function(lCodec) {\n            for (var i = 0; i < remoteCapabilities.codecs.length; i++) {\n              var rCodec = remoteCapabilities.codecs[i];\n              if (lCodec.name.toLowerCase() === rCodec.name.toLowerCase() &&\n                  lCodec.clockRate === rCodec.clockRate &&\n                  lCodec.numChannels === rCodec.numChannels) {\n                // push rCodec so we reply with offerer payload type\n                commonCapabilities.codecs.push(rCodec);\n\n                // FIXME: also need to determine intersection between\n                // .rtcpFeedback and .parameters\n                break;\n              }\n            }\n          });\n\n          localCapabilities.headerExtensions\n              .forEach(function(lHeaderExtension) {\n                for (var i = 0; i < remoteCapabilities.headerExtensions.length;\n                     i++) {\n                  var rHeaderExtension = remoteCapabilities.headerExtensions[i];\n                  if (lHeaderExtension.uri === rHeaderExtension.uri) {\n                    commonCapabilities.headerExtensions.push(rHeaderExtension);\n                    break;\n                  }\n                }\n              });\n\n          // FIXME: fecMechanisms\n          return commonCapabilities;\n        };\n\n    // Create ICE gatherer, ICE transport and DTLS transport.\n    window.RTCPeerConnection.prototype._createIceAndDtlsTransports =\n        function(mid, sdpMLineIndex) {\n          var self = this;\n          var iceGatherer = new RTCIceGatherer(self.iceOptions);\n          var iceTransport = new RTCIceTransport(iceGatherer);\n          iceGatherer.onlocalcandidate = function(evt) {\n            var event = new Event('icecandidate');\n            event.candidate = {sdpMid: mid, sdpMLineIndex: sdpMLineIndex};\n\n            var cand = evt.candidate;\n            var end = !cand || Object.keys(cand).length === 0;\n            // Edge emits an empty object for RTCIceCandidateComplete\n            if (end) {\n              // polyfill since RTCIceGatherer.state is not implemented in\n              // Edge 10547 yet.\n              if (iceGatherer.state === undefined) {\n                iceGatherer.state = 'completed';\n              }\n\n              // Emit a candidate with type endOfCandidates to make the samples\n              // work. Edge requires addIceCandidate with this empty candidate\n              // to start checking. The real solution is to signal\n              // end-of-candidates to the other side when getting the null\n              // candidate but some apps (like the samples) don't do that.\n              event.candidate.candidate =\n                  'candidate:1 1 udp 1 0.0.0.0 9 typ endOfCandidates';\n            } else {\n              // RTCIceCandidate doesn't have a component, needs to be added\n              cand.component = iceTransport.component === 'RTCP' ? 2 : 1;\n              event.candidate.candidate = SDPUtils.writeCandidate(cand);\n            }\n\n            var complete = self.transceivers.every(function(transceiver) {\n              return transceiver.iceGatherer &&\n                  transceiver.iceGatherer.state === 'completed';\n            });\n\n            // Emit candidate if localDescription is set.\n            // Also emits null candidate when all gatherers are complete.\n            switch (self.iceGatheringState) {\n              case 'new':\n                self._localIceCandidatesBuffer.push(event);\n                if (end && complete) {\n                  self._localIceCandidatesBuffer.push(\n                      new Event('icecandidate'));\n                }\n                break;\n              case 'gathering':\n                self._emitBufferedCandidates();\n                self.dispatchEvent(event);\n                if (self.onicecandidate !== null) {\n                  self.onicecandidate(event);\n                }\n                if (complete) {\n                  self.dispatchEvent(new Event('icecandidate'));\n                  if (self.onicecandidate !== null) {\n                    self.onicecandidate(new Event('icecandidate'));\n                  }\n                  self.iceGatheringState = 'complete';\n                }\n                break;\n              case 'complete':\n                // should not happen... currently!\n                break;\n              default: // no-op.\n                break;\n            }\n          };\n          iceTransport.onicestatechange = function() {\n            self._updateConnectionState();\n          };\n\n          var dtlsTransport = new RTCDtlsTransport(iceTransport);\n          dtlsTransport.ondtlsstatechange = function() {\n            self._updateConnectionState();\n          };\n          dtlsTransport.onerror = function() {\n            // onerror does not set state to failed by itself.\n            dtlsTransport.state = 'failed';\n            self._updateConnectionState();\n          };\n\n          return {\n            iceGatherer: iceGatherer,\n            iceTransport: iceTransport,\n            dtlsTransport: dtlsTransport\n          };\n        };\n\n    // Start the RTP Sender and Receiver for a transceiver.\n    window.RTCPeerConnection.prototype._transceive = function(transceiver,\n        send, recv) {\n      var params = this._getCommonCapabilities(transceiver.localCapabilities,\n          transceiver.remoteCapabilities);\n      if (send && transceiver.rtpSender) {\n        params.encodings = transceiver.sendEncodingParameters;\n        params.rtcp = {\n          cname: SDPUtils.localCName\n        };\n        if (transceiver.recvEncodingParameters.length) {\n          params.rtcp.ssrc = transceiver.recvEncodingParameters[0].ssrc;\n        }\n        transceiver.rtpSender.send(params);\n      }\n      if (recv && transceiver.rtpReceiver) {\n        params.encodings = transceiver.recvEncodingParameters;\n        params.rtcp = {\n          cname: transceiver.cname\n        };\n        if (transceiver.sendEncodingParameters.length) {\n          params.rtcp.ssrc = transceiver.sendEncodingParameters[0].ssrc;\n        }\n        transceiver.rtpReceiver.receive(params);\n      }\n    };\n\n    window.RTCPeerConnection.prototype.setLocalDescription =\n        function(description) {\n          var self = this;\n          var sections;\n          var sessionpart;\n          if (description.type === 'offer') {\n            // FIXME: What was the purpose of this empty if statement?\n            // if (!this._pendingOffer) {\n            // } else {\n            if (this._pendingOffer) {\n              // VERY limited support for SDP munging. Limited to:\n              // * changing the order of codecs\n              sections = SDPUtils.splitSections(description.sdp);\n              sessionpart = sections.shift();\n              sections.forEach(function(mediaSection, sdpMLineIndex) {\n                var caps = SDPUtils.parseRtpParameters(mediaSection);\n                self._pendingOffer[sdpMLineIndex].localCapabilities = caps;\n              });\n              this.transceivers = this._pendingOffer;\n              delete this._pendingOffer;\n            }\n          } else if (description.type === 'answer') {\n            sections = SDPUtils.splitSections(self.remoteDescription.sdp);\n            sessionpart = sections.shift();\n            sections.forEach(function(mediaSection, sdpMLineIndex) {\n              var transceiver = self.transceivers[sdpMLineIndex];\n              var iceGatherer = transceiver.iceGatherer;\n              var iceTransport = transceiver.iceTransport;\n              var dtlsTransport = transceiver.dtlsTransport;\n              var localCapabilities = transceiver.localCapabilities;\n              var remoteCapabilities = transceiver.remoteCapabilities;\n              var rejected = mediaSection.split('\\n', 1)[0]\n                  .split(' ', 2)[1] === '0';\n\n              if (!rejected) {\n                var remoteIceParameters = SDPUtils.getIceParameters(\n                    mediaSection, sessionpart);\n                iceTransport.start(iceGatherer, remoteIceParameters,\n                    'controlled');\n\n                var remoteDtlsParameters = SDPUtils.getDtlsParameters(\n                    mediaSection, sessionpart);\n                dtlsTransport.start(remoteDtlsParameters);\n\n                // Calculate intersection of capabilities.\n                var params = self._getCommonCapabilities(localCapabilities,\n                    remoteCapabilities);\n\n                // Start the RTCRtpSender. The RTCRtpReceiver for this\n                // transceiver has already been started in setRemoteDescription.\n                self._transceive(transceiver,\n                    params.codecs.length > 0,\n                    false);\n              }\n            });\n          }\n\n          this.localDescription = {\n            type: description.type,\n            sdp: description.sdp\n          };\n          switch (description.type) {\n            case 'offer':\n              this._updateSignalingState('have-local-offer');\n              break;\n            case 'answer':\n              this._updateSignalingState('stable');\n              break;\n            default:\n              throw new TypeError('unsupported type \"' + description.type +\n                  '\"');\n          }\n\n          // If a success callback was provided, emit ICE candidates after it\n          // has been executed. Otherwise, emit callback after the Promise is\n          // resolved.\n          var hasCallback = arguments.length > 1 &&\n            typeof arguments[1] === 'function';\n          if (hasCallback) {\n            var cb = arguments[1];\n            window.setTimeout(function() {\n              cb();\n              if (self.iceGatheringState === 'new') {\n                self.iceGatheringState = 'gathering';\n              }\n              self._emitBufferedCandidates();\n            }, 0);\n          }\n          var p = Promise.resolve();\n          p.then(function() {\n            if (!hasCallback) {\n              if (self.iceGatheringState === 'new') {\n                self.iceGatheringState = 'gathering';\n              }\n              // Usually candidates will be emitted earlier.\n              window.setTimeout(self._emitBufferedCandidates.bind(self), 500);\n            }\n          });\n          return p;\n        };\n\n    window.RTCPeerConnection.prototype.setRemoteDescription =\n        function(description) {\n          var self = this;\n          var stream = new MediaStream();\n          var receiverList = [];\n          var sections = SDPUtils.splitSections(description.sdp);\n          var sessionpart = sections.shift();\n          sections.forEach(function(mediaSection, sdpMLineIndex) {\n            var lines = SDPUtils.splitLines(mediaSection);\n            var mline = lines[0].substr(2).split(' ');\n            var kind = mline[0];\n            var rejected = mline[1] === '0';\n            var direction = SDPUtils.getDirection(mediaSection, sessionpart);\n\n            var transceiver;\n            var iceGatherer;\n            var iceTransport;\n            var dtlsTransport;\n            var rtpSender;\n            var rtpReceiver;\n            var sendEncodingParameters;\n            var recvEncodingParameters;\n            var localCapabilities;\n\n            var track;\n            // FIXME: ensure the mediaSection has rtcp-mux set.\n            var remoteCapabilities = SDPUtils.parseRtpParameters(mediaSection);\n            var remoteIceParameters;\n            var remoteDtlsParameters;\n            if (!rejected) {\n              remoteIceParameters = SDPUtils.getIceParameters(mediaSection,\n                  sessionpart);\n              remoteDtlsParameters = SDPUtils.getDtlsParameters(mediaSection,\n                  sessionpart);\n            }\n            recvEncodingParameters =\n                SDPUtils.parseRtpEncodingParameters(mediaSection);\n\n            var mid = SDPUtils.matchPrefix(mediaSection, 'a=mid:');\n            if (mid.length) {\n              mid = mid[0].substr(6);\n            } else {\n              mid = SDPUtils.generateIdentifier();\n            }\n\n            var cname;\n            // Gets the first SSRC. Note that with RTX there might be multiple\n            // SSRCs.\n            var remoteSsrc = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n                .map(function(line) {\n                  return SDPUtils.parseSsrcMedia(line);\n                })\n                .filter(function(obj) {\n                  return obj.attribute === 'cname';\n                })[0];\n            if (remoteSsrc) {\n              cname = remoteSsrc.value;\n            }\n\n            var isComplete = SDPUtils.matchPrefix(mediaSection,\n                'a=end-of-candidates').length > 0;\n            var cands = SDPUtils.matchPrefix(mediaSection, 'a=candidate:')\n                .map(function(cand) {\n                  return SDPUtils.parseCandidate(cand);\n                })\n                .filter(function(cand) {\n                  return cand.component === '1';\n                });\n            if (description.type === 'offer' && !rejected) {\n              var transports = self._createIceAndDtlsTransports(mid,\n                  sdpMLineIndex);\n              if (isComplete) {\n                transports.iceTransport.setRemoteCandidates(cands);\n              }\n\n              localCapabilities = RTCRtpReceiver.getCapabilities(kind);\n              sendEncodingParameters = [{\n                ssrc: (2 * sdpMLineIndex + 2) * 1001\n              }];\n\n              rtpReceiver = new RTCRtpReceiver(transports.dtlsTransport, kind);\n\n              track = rtpReceiver.track;\n              receiverList.push([track, rtpReceiver]);\n              // FIXME: not correct when there are multiple streams but that is\n              // not currently supported in this shim.\n              stream.addTrack(track);\n\n              // FIXME: look at direction.\n              if (self.localStreams.length > 0 &&\n                  self.localStreams[0].getTracks().length >= sdpMLineIndex) {\n                // FIXME: actually more complicated, needs to match types etc\n                var localtrack = self.localStreams[0]\n                    .getTracks()[sdpMLineIndex];\n                rtpSender = new RTCRtpSender(localtrack,\n                    transports.dtlsTransport);\n              }\n\n              self.transceivers[sdpMLineIndex] = {\n                iceGatherer: transports.iceGatherer,\n                iceTransport: transports.iceTransport,\n                dtlsTransport: transports.dtlsTransport,\n                localCapabilities: localCapabilities,\n                remoteCapabilities: remoteCapabilities,\n                rtpSender: rtpSender,\n                rtpReceiver: rtpReceiver,\n                kind: kind,\n                mid: mid,\n                cname: cname,\n                sendEncodingParameters: sendEncodingParameters,\n                recvEncodingParameters: recvEncodingParameters\n              };\n              // Start the RTCRtpReceiver now. The RTPSender is started in\n              // setLocalDescription.\n              self._transceive(self.transceivers[sdpMLineIndex],\n                  false,\n                  direction === 'sendrecv' || direction === 'sendonly');\n            } else if (description.type === 'answer' && !rejected) {\n              transceiver = self.transceivers[sdpMLineIndex];\n              iceGatherer = transceiver.iceGatherer;\n              iceTransport = transceiver.iceTransport;\n              dtlsTransport = transceiver.dtlsTransport;\n              rtpSender = transceiver.rtpSender;\n              rtpReceiver = transceiver.rtpReceiver;\n              sendEncodingParameters = transceiver.sendEncodingParameters;\n              localCapabilities = transceiver.localCapabilities;\n\n              self.transceivers[sdpMLineIndex].recvEncodingParameters =\n                  recvEncodingParameters;\n              self.transceivers[sdpMLineIndex].remoteCapabilities =\n                  remoteCapabilities;\n              self.transceivers[sdpMLineIndex].cname = cname;\n\n              if (isComplete) {\n                iceTransport.setRemoteCandidates(cands);\n              }\n              iceTransport.start(iceGatherer, remoteIceParameters,\n                  'controlling');\n              dtlsTransport.start(remoteDtlsParameters);\n\n              self._transceive(transceiver,\n                  direction === 'sendrecv' || direction === 'recvonly',\n                  direction === 'sendrecv' || direction === 'sendonly');\n\n              if (rtpReceiver &&\n                  (direction === 'sendrecv' || direction === 'sendonly')) {\n                track = rtpReceiver.track;\n                receiverList.push([track, rtpReceiver]);\n                stream.addTrack(track);\n              } else {\n                // FIXME: actually the receiver should be created later.\n                delete transceiver.rtpReceiver;\n              }\n            }\n          });\n\n          this.remoteDescription = {\n            type: description.type,\n            sdp: description.sdp\n          };\n          switch (description.type) {\n            case 'offer':\n              this._updateSignalingState('have-remote-offer');\n              break;\n            case 'answer':\n              this._updateSignalingState('stable');\n              break;\n            default:\n              throw new TypeError('unsupported type \"' + description.type +\n                  '\"');\n          }\n          if (stream.getTracks().length) {\n            self.remoteStreams.push(stream);\n            window.setTimeout(function() {\n              var event = new Event('addstream');\n              event.stream = stream;\n              self.dispatchEvent(event);\n              if (self.onaddstream !== null) {\n                window.setTimeout(function() {\n                  self.onaddstream(event);\n                }, 0);\n              }\n\n              receiverList.forEach(function(item) {\n                var track = item[0];\n                var receiver = item[1];\n                var trackEvent = new Event('track');\n                trackEvent.track = track;\n                trackEvent.receiver = receiver;\n                trackEvent.streams = [stream];\n                self.dispatchEvent(event);\n                if (self.ontrack !== null) {\n                  window.setTimeout(function() {\n                    self.ontrack(trackEvent);\n                  }, 0);\n                }\n              });\n            }, 0);\n          }\n          if (arguments.length > 1 && typeof arguments[1] === 'function') {\n            window.setTimeout(arguments[1], 0);\n          }\n          return Promise.resolve();\n        };\n\n    window.RTCPeerConnection.prototype.close = function() {\n      this.transceivers.forEach(function(transceiver) {\n        /* not yet\n        if (transceiver.iceGatherer) {\n          transceiver.iceGatherer.close();\n        }\n        */\n        if (transceiver.iceTransport) {\n          transceiver.iceTransport.stop();\n        }\n        if (transceiver.dtlsTransport) {\n          transceiver.dtlsTransport.stop();\n        }\n        if (transceiver.rtpSender) {\n          transceiver.rtpSender.stop();\n        }\n        if (transceiver.rtpReceiver) {\n          transceiver.rtpReceiver.stop();\n        }\n      });\n      // FIXME: clean up tracks, local streams, remote streams, etc\n      this._updateSignalingState('closed');\n    };\n\n    // Update the signaling state.\n    window.RTCPeerConnection.prototype._updateSignalingState =\n        function(newState) {\n          this.signalingState = newState;\n          var event = new Event('signalingstatechange');\n          this.dispatchEvent(event);\n          if (this.onsignalingstatechange !== null) {\n            this.onsignalingstatechange(event);\n          }\n        };\n\n    // Determine whether to fire the negotiationneeded event.\n    window.RTCPeerConnection.prototype._maybeFireNegotiationNeeded =\n        function() {\n          // Fire away (for now).\n          var event = new Event('negotiationneeded');\n          this.dispatchEvent(event);\n          if (this.onnegotiationneeded !== null) {\n            this.onnegotiationneeded(event);\n          }\n        };\n\n    // Update the connection state.\n    window.RTCPeerConnection.prototype._updateConnectionState = function() {\n      var self = this;\n      var newState;\n      var states = {\n        'new': 0,\n        closed: 0,\n        connecting: 0,\n        checking: 0,\n        connected: 0,\n        completed: 0,\n        failed: 0\n      };\n      this.transceivers.forEach(function(transceiver) {\n        states[transceiver.iceTransport.state]++;\n        states[transceiver.dtlsTransport.state]++;\n      });\n      // ICETransport.completed and connected are the same for this purpose.\n      states.connected += states.completed;\n\n      newState = 'new';\n      if (states.failed > 0) {\n        newState = 'failed';\n      } else if (states.connecting > 0 || states.checking > 0) {\n        newState = 'connecting';\n      } else if (states.disconnected > 0) {\n        newState = 'disconnected';\n      } else if (states.new > 0) {\n        newState = 'new';\n      } else if (states.connected > 0 || states.completed > 0) {\n        newState = 'connected';\n      }\n\n      if (newState !== self.iceConnectionState) {\n        self.iceConnectionState = newState;\n        var event = new Event('iceconnectionstatechange');\n        this.dispatchEvent(event);\n        if (this.oniceconnectionstatechange !== null) {\n          this.oniceconnectionstatechange(event);\n        }\n      }\n    };\n\n    window.RTCPeerConnection.prototype.createOffer = function() {\n      var self = this;\n      if (this._pendingOffer) {\n        throw new Error('createOffer called while there is a pending offer.');\n      }\n      var offerOptions;\n      if (arguments.length === 1 && typeof arguments[0] !== 'function') {\n        offerOptions = arguments[0];\n      } else if (arguments.length === 3) {\n        offerOptions = arguments[2];\n      }\n\n      var tracks = [];\n      var numAudioTracks = 0;\n      var numVideoTracks = 0;\n      // Default to sendrecv.\n      if (this.localStreams.length) {\n        numAudioTracks = this.localStreams[0].getAudioTracks().length;\n        numVideoTracks = this.localStreams[0].getVideoTracks().length;\n      }\n      // Determine number of audio and video tracks we need to send/recv.\n      if (offerOptions) {\n        // Reject Chrome legacy constraints.\n        if (offerOptions.mandatory || offerOptions.optional) {\n          throw new TypeError(\n              'Legacy mandatory/optional constraints not supported.');\n        }\n        if (offerOptions.offerToReceiveAudio !== undefined) {\n          numAudioTracks = offerOptions.offerToReceiveAudio;\n        }\n        if (offerOptions.offerToReceiveVideo !== undefined) {\n          numVideoTracks = offerOptions.offerToReceiveVideo;\n        }\n      }\n      if (this.localStreams.length) {\n        // Push local streams.\n        this.localStreams[0].getTracks().forEach(function(track) {\n          tracks.push({\n            kind: track.kind,\n            track: track,\n            wantReceive: track.kind === 'audio' ?\n                numAudioTracks > 0 : numVideoTracks > 0\n          });\n          if (track.kind === 'audio') {\n            numAudioTracks--;\n          } else if (track.kind === 'video') {\n            numVideoTracks--;\n          }\n        });\n      }\n      // Create M-lines for recvonly streams.\n      while (numAudioTracks > 0 || numVideoTracks > 0) {\n        if (numAudioTracks > 0) {\n          tracks.push({\n            kind: 'audio',\n            wantReceive: true\n          });\n          numAudioTracks--;\n        }\n        if (numVideoTracks > 0) {\n          tracks.push({\n            kind: 'video',\n            wantReceive: true\n          });\n          numVideoTracks--;\n        }\n      }\n\n      var sdp = SDPUtils.writeSessionBoilerplate();\n      var transceivers = [];\n      tracks.forEach(function(mline, sdpMLineIndex) {\n        // For each track, create an ice gatherer, ice transport,\n        // dtls transport, potentially rtpsender and rtpreceiver.\n        var track = mline.track;\n        var kind = mline.kind;\n        var mid = SDPUtils.generateIdentifier();\n\n        var transports = self._createIceAndDtlsTransports(mid, sdpMLineIndex);\n\n        var localCapabilities = RTCRtpSender.getCapabilities(kind);\n        var rtpSender;\n        var rtpReceiver;\n\n        // generate an ssrc now, to be used later in rtpSender.send\n        var sendEncodingParameters = [{\n          ssrc: (2 * sdpMLineIndex + 1) * 1001\n        }];\n        if (track) {\n          rtpSender = new RTCRtpSender(track, transports.dtlsTransport);\n        }\n\n        if (mline.wantReceive) {\n          rtpReceiver = new RTCRtpReceiver(transports.dtlsTransport, kind);\n        }\n\n        transceivers[sdpMLineIndex] = {\n          iceGatherer: transports.iceGatherer,\n          iceTransport: transports.iceTransport,\n          dtlsTransport: transports.dtlsTransport,\n          localCapabilities: localCapabilities,\n          remoteCapabilities: null,\n          rtpSender: rtpSender,\n          rtpReceiver: rtpReceiver,\n          kind: kind,\n          mid: mid,\n          sendEncodingParameters: sendEncodingParameters,\n          recvEncodingParameters: null\n        };\n        var transceiver = transceivers[sdpMLineIndex];\n        sdp += SDPUtils.writeMediaSection(transceiver,\n            transceiver.localCapabilities, 'offer', self.localStreams[0]);\n      });\n\n      this._pendingOffer = transceivers;\n      var desc = new RTCSessionDescription({\n        type: 'offer',\n        sdp: sdp\n      });\n      if (arguments.length && typeof arguments[0] === 'function') {\n        window.setTimeout(arguments[0], 0, desc);\n      }\n      return Promise.resolve(desc);\n    };\n\n    window.RTCPeerConnection.prototype.createAnswer = function() {\n      var self = this;\n\n      var sdp = SDPUtils.writeSessionBoilerplate();\n      this.transceivers.forEach(function(transceiver) {\n        // Calculate intersection of capabilities.\n        var commonCapabilities = self._getCommonCapabilities(\n            transceiver.localCapabilities,\n            transceiver.remoteCapabilities);\n\n        sdp += SDPUtils.writeMediaSection(transceiver, commonCapabilities,\n            'answer', self.localStreams[0]);\n      });\n\n      var desc = new RTCSessionDescription({\n        type: 'answer',\n        sdp: sdp\n      });\n      if (arguments.length && typeof arguments[0] === 'function') {\n        window.setTimeout(arguments[0], 0, desc);\n      }\n      return Promise.resolve(desc);\n    };\n\n    window.RTCPeerConnection.prototype.addIceCandidate = function(candidate) {\n      var mLineIndex = candidate.sdpMLineIndex;\n      if (candidate.sdpMid) {\n        for (var i = 0; i < this.transceivers.length; i++) {\n          if (this.transceivers[i].mid === candidate.sdpMid) {\n            mLineIndex = i;\n            break;\n          }\n        }\n      }\n      var transceiver = this.transceivers[mLineIndex];\n      if (transceiver) {\n        var cand = Object.keys(candidate.candidate).length > 0 ?\n            SDPUtils.parseCandidate(candidate.candidate) : {};\n        // Ignore Chrome's invalid candidates since Edge does not like them.\n        if (cand.protocol === 'tcp' && cand.port === 0) {\n          return;\n        }\n        // Ignore RTCP candidates, we assume RTCP-MUX.\n        if (cand.component !== '1') {\n          return;\n        }\n        // A dirty hack to make samples work.\n        if (cand.type === 'endOfCandidates') {\n          cand = {};\n        }\n        transceiver.iceTransport.addRemoteCandidate(cand);\n\n        // update the remoteDescription.\n        var sections = SDPUtils.splitSections(this.remoteDescription.sdp);\n        sections[mLineIndex + 1] += (cand.type ? candidate.candidate.trim()\n            : 'a=end-of-candidates') + '\\r\\n';\n        this.remoteDescription.sdp = sections.join('');\n      }\n      if (arguments.length > 1 && typeof arguments[1] === 'function') {\n        window.setTimeout(arguments[1], 0);\n      }\n      return Promise.resolve();\n    };\n\n    window.RTCPeerConnection.prototype.getStats = function() {\n      var promises = [];\n      this.transceivers.forEach(function(transceiver) {\n        ['rtpSender', 'rtpReceiver', 'iceGatherer', 'iceTransport',\n            'dtlsTransport'].forEach(function(method) {\n              if (transceiver[method]) {\n                promises.push(transceiver[method].getStats());\n              }\n            });\n      });\n      var cb = arguments.length > 1 && typeof arguments[1] === 'function' &&\n          arguments[1];\n      return new Promise(function(resolve) {\n        var results = {};\n        Promise.all(promises).then(function(res) {\n          res.forEach(function(result) {\n            Object.keys(result).forEach(function(id) {\n              results[id] = result[id];\n            });\n          });\n          if (cb) {\n            window.setTimeout(cb, 0, results);\n          }\n          resolve(results);\n        });\n      });\n    };\n  },\n\n  // Attach a media stream to an element.\n  attachMediaStream: function(element, stream) {\n    logging('DEPRECATED, attachMediaStream will soon be removed.');\n    element.srcObject = stream;\n  },\n\n  reattachMediaStream: function(to, from) {\n    logging('DEPRECATED, reattachMediaStream will soon be removed.');\n    to.srcObject = from.srcObject;\n  }\n};\n\n// Expose public methods.\nmodule.exports = {\n  shimPeerConnection: edgeShim.shimPeerConnection,\n  attachMediaStream: edgeShim.attachMediaStream,\n  reattachMediaStream: edgeShim.reattachMediaStream\n};\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nvar logging = require('../utils').log;\nvar browserDetails = require('../utils').browserDetails;\n\nvar firefoxShim = {\n  shimOnTrack: function() {\n    if (typeof window === 'object' && window.RTCPeerConnection && !('ontrack' in\n        window.RTCPeerConnection.prototype)) {\n      Object.defineProperty(window.RTCPeerConnection.prototype, 'ontrack', {\n        get: function() {\n          return this._ontrack;\n        },\n        set: function(f) {\n          if (this._ontrack) {\n            this.removeEventListener('track', this._ontrack);\n            this.removeEventListener('addstream', this._ontrackpoly);\n          }\n          this.addEventListener('track', this._ontrack = f);\n          this.addEventListener('addstream', this._ontrackpoly = function(e) {\n            e.stream.getTracks().forEach(function(track) {\n              var event = new Event('track');\n              event.track = track;\n              event.receiver = {track: track};\n              event.streams = [e.stream];\n              this.dispatchEvent(event);\n            }.bind(this));\n          }.bind(this));\n        }\n      });\n    }\n  },\n\n  shimSourceObject: function() {\n    // Firefox has supported mozSrcObject since FF22, unprefixed in 42.\n    if (typeof window === 'object') {\n      if (window.HTMLMediaElement &&\n        !('srcObject' in window.HTMLMediaElement.prototype)) {\n        // Shim the srcObject property, once, when HTMLMediaElement is found.\n        Object.defineProperty(window.HTMLMediaElement.prototype, 'srcObject', {\n          get: function() {\n            return this.mozSrcObject;\n          },\n          set: function(stream) {\n            this.mozSrcObject = stream;\n          }\n        });\n      }\n    }\n  },\n\n  shimPeerConnection: function() {\n    // The RTCPeerConnection object.\n    if (!window.RTCPeerConnection) {\n      window.RTCPeerConnection = function(pcConfig, pcConstraints) {\n        if (browserDetails.version < 38) {\n          // .urls is not supported in FF < 38.\n          // create RTCIceServers with a single url.\n          if (pcConfig && pcConfig.iceServers) {\n            var newIceServers = [];\n            for (var i = 0; i < pcConfig.iceServers.length; i++) {\n              var server = pcConfig.iceServers[i];\n              if (server.hasOwnProperty('urls')) {\n                for (var j = 0; j < server.urls.length; j++) {\n                  var newServer = {\n                    url: server.urls[j]\n                  };\n                  if (server.urls[j].indexOf('turn') === 0) {\n                    newServer.username = server.username;\n                    newServer.credential = server.credential;\n                  }\n                  newIceServers.push(newServer);\n                }\n              } else {\n                newIceServers.push(pcConfig.iceServers[i]);\n              }\n            }\n            pcConfig.iceServers = newIceServers;\n          }\n        }\n        return new mozRTCPeerConnection(pcConfig, pcConstraints);\n      };\n      window.RTCPeerConnection.prototype = mozRTCPeerConnection.prototype;\n\n      // wrap static methods. Currently just generateCertificate.\n      if (mozRTCPeerConnection.generateCertificate) {\n        Object.defineProperty(window.RTCPeerConnection, 'generateCertificate', {\n          get: function() {\n            return mozRTCPeerConnection.generateCertificate;\n          }\n        });\n      }\n\n      window.RTCSessionDescription = mozRTCSessionDescription;\n      window.RTCIceCandidate = mozRTCIceCandidate;\n    }\n\n    // shim away need for obsolete RTCIceCandidate/RTCSessionDescription.\n    ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate']\n        .forEach(function(method) {\n          var nativeMethod = RTCPeerConnection.prototype[method];\n          RTCPeerConnection.prototype[method] = function() {\n            arguments[0] = new ((method === 'addIceCandidate')?\n                RTCIceCandidate : RTCSessionDescription)(arguments[0]);\n            return nativeMethod.apply(this, arguments);\n          };\n        });\n  },\n\n  shimGetUserMedia: function() {\n    // getUserMedia constraints shim.\n    var getUserMedia_ = function(constraints, onSuccess, onError) {\n      var constraintsToFF37_ = function(c) {\n        if (typeof c !== 'object' || c.require) {\n          return c;\n        }\n        var require = [];\n        Object.keys(c).forEach(function(key) {\n          if (key === 'require' || key === 'advanced' ||\n              key === 'mediaSource') {\n            return;\n          }\n          var r = c[key] = (typeof c[key] === 'object') ?\n              c[key] : {ideal: c[key]};\n          if (r.min !== undefined ||\n              r.max !== undefined || r.exact !== undefined) {\n            require.push(key);\n          }\n          if (r.exact !== undefined) {\n            if (typeof r.exact === 'number') {\n              r. min = r.max = r.exact;\n            } else {\n              c[key] = r.exact;\n            }\n            delete r.exact;\n          }\n          if (r.ideal !== undefined) {\n            c.advanced = c.advanced || [];\n            var oc = {};\n            if (typeof r.ideal === 'number') {\n              oc[key] = {min: r.ideal, max: r.ideal};\n            } else {\n              oc[key] = r.ideal;\n            }\n            c.advanced.push(oc);\n            delete r.ideal;\n            if (!Object.keys(r).length) {\n              delete c[key];\n            }\n          }\n        });\n        if (require.length) {\n          c.require = require;\n        }\n        return c;\n      };\n      constraints = JSON.parse(JSON.stringify(constraints));\n      if (browserDetails.version < 38) {\n        logging('spec: ' + JSON.stringify(constraints));\n        if (constraints.audio) {\n          constraints.audio = constraintsToFF37_(constraints.audio);\n        }\n        if (constraints.video) {\n          constraints.video = constraintsToFF37_(constraints.video);\n        }\n        logging('ff37: ' + JSON.stringify(constraints));\n      }\n      return navigator.mozGetUserMedia(constraints, onSuccess, onError);\n    };\n\n    navigator.getUserMedia = getUserMedia_;\n\n    // Returns the result of getUserMedia as a Promise.\n    var getUserMediaPromise_ = function(constraints) {\n      return new Promise(function(resolve, reject) {\n        navigator.getUserMedia(constraints, resolve, reject);\n      });\n    };\n\n    // Shim for mediaDevices on older versions.\n    if (!navigator.mediaDevices) {\n      navigator.mediaDevices = {getUserMedia: getUserMediaPromise_,\n        addEventListener: function() { },\n        removeEventListener: function() { }\n      };\n    }\n    navigator.mediaDevices.enumerateDevices =\n        navigator.mediaDevices.enumerateDevices || function() {\n          return new Promise(function(resolve) {\n            var infos = [\n              {kind: 'audioinput', deviceId: 'default', label: '', groupId: ''},\n              {kind: 'videoinput', deviceId: 'default', label: '', groupId: ''}\n            ];\n            resolve(infos);\n          });\n        };\n\n    if (browserDetails.version < 41) {\n      // Work around http://bugzil.la/1169665\n      var orgEnumerateDevices =\n          navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);\n      navigator.mediaDevices.enumerateDevices = function() {\n        return orgEnumerateDevices().then(undefined, function(e) {\n          if (e.name === 'NotFoundError') {\n            return [];\n          }\n          throw e;\n        });\n      };\n    }\n  },\n\n  // Attach a media stream to an element.\n  attachMediaStream: function(element, stream) {\n    logging('DEPRECATED, attachMediaStream will soon be removed.');\n    element.srcObject = stream;\n  },\n\n  reattachMediaStream: function(to, from) {\n    logging('DEPRECATED, reattachMediaStream will soon be removed.');\n    to.srcObject = from.srcObject;\n  }\n};\n\n// Expose public methods.\nmodule.exports = {\n  shimOnTrack: firefoxShim.shimOnTrack,\n  shimSourceObject: firefoxShim.shimSourceObject,\n  shimPeerConnection: firefoxShim.shimPeerConnection,\n  shimGetUserMedia: require('./getusermedia'),\n  attachMediaStream: firefoxShim.attachMediaStream,\n  reattachMediaStream: firefoxShim.reattachMediaStream\n};\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nvar logging = require('../utils').log;\nvar browserDetails = require('../utils').browserDetails;\n\n// Expose public methods.\nmodule.exports = function() {\n  // getUserMedia constraints shim.\n  var getUserMedia_ = function(constraints, onSuccess, onError) {\n    var constraintsToFF37_ = function(c) {\n      if (typeof c !== 'object' || c.require) {\n        return c;\n      }\n      var require = [];\n      Object.keys(c).forEach(function(key) {\n        if (key === 'require' || key === 'advanced' || key === 'mediaSource') {\n          return;\n        }\n        var r = c[key] = (typeof c[key] === 'object') ?\n            c[key] : {ideal: c[key]};\n        if (r.min !== undefined ||\n            r.max !== undefined || r.exact !== undefined) {\n          require.push(key);\n        }\n        if (r.exact !== undefined) {\n          if (typeof r.exact === 'number') {\n            r. min = r.max = r.exact;\n          } else {\n            c[key] = r.exact;\n          }\n          delete r.exact;\n        }\n        if (r.ideal !== undefined) {\n          c.advanced = c.advanced || [];\n          var oc = {};\n          if (typeof r.ideal === 'number') {\n            oc[key] = {min: r.ideal, max: r.ideal};\n          } else {\n            oc[key] = r.ideal;\n          }\n          c.advanced.push(oc);\n          delete r.ideal;\n          if (!Object.keys(r).length) {\n            delete c[key];\n          }\n        }\n      });\n      if (require.length) {\n        c.require = require;\n      }\n      return c;\n    };\n    constraints = JSON.parse(JSON.stringify(constraints));\n    if (browserDetails.version < 38) {\n      logging('spec: ' + JSON.stringify(constraints));\n      if (constraints.audio) {\n        constraints.audio = constraintsToFF37_(constraints.audio);\n      }\n      if (constraints.video) {\n        constraints.video = constraintsToFF37_(constraints.video);\n      }\n      logging('ff37: ' + JSON.stringify(constraints));\n    }\n    return navigator.mozGetUserMedia(constraints, onSuccess, onError);\n  };\n\n  navigator.getUserMedia = getUserMedia_;\n\n  // Returns the result of getUserMedia as a Promise.\n  var getUserMediaPromise_ = function(constraints) {\n    return new Promise(function(resolve, reject) {\n      navigator.getUserMedia(constraints, resolve, reject);\n    });\n  };\n\n  // Shim for mediaDevices on older versions.\n  if (!navigator.mediaDevices) {\n    navigator.mediaDevices = {getUserMedia: getUserMediaPromise_,\n      addEventListener: function() { },\n      removeEventListener: function() { }\n    };\n  }\n  navigator.mediaDevices.enumerateDevices =\n      navigator.mediaDevices.enumerateDevices || function() {\n        return new Promise(function(resolve) {\n          var infos = [\n            {kind: 'audioinput', deviceId: 'default', label: '', groupId: ''},\n            {kind: 'videoinput', deviceId: 'default', label: '', groupId: ''}\n          ];\n          resolve(infos);\n        });\n      };\n\n  if (browserDetails.version < 41) {\n    // Work around http://bugzil.la/1169665\n    var orgEnumerateDevices =\n        navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);\n    navigator.mediaDevices.enumerateDevices = function() {\n      return orgEnumerateDevices().then(undefined, function(e) {\n        if (e.name === 'NotFoundError') {\n          return [];\n        }\n        throw e;\n      });\n    };\n  }\n};\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n'use strict';\nvar safariShim = {\n  // TODO: DrAlex, should be here, double check against LayoutTests\n  // shimOnTrack: function() { },\n\n  // TODO: DrAlex\n  // attachMediaStream: function(element, stream) { },\n  // reattachMediaStream: function(to, from) { },\n\n  // TODO: once the back-end for the mac port is done, add.\n  // TODO: check for webkitGTK+\n  // shimPeerConnection: function() { },\n\n  shimGetUserMedia: function() {\n    navigator.getUserMedia = navigator.webkitGetUserMedia;\n  }\n};\n\n// Expose public methods.\nmodule.exports = {\n  shimGetUserMedia: safariShim.shimGetUserMedia\n  // TODO\n  // shimOnTrack: safariShim.shimOnTrack,\n  // shimPeerConnection: safariShim.shimPeerConnection,\n  // attachMediaStream: safariShim.attachMediaStream,\n  // reattachMediaStream: safariShim.reattachMediaStream\n};\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nvar logDisabled_ = false;\n\n// Utility methods.\nvar utils = {\n  disableLog: function(bool) {\n    if (typeof bool !== 'boolean') {\n      return new Error('Argument type: ' + typeof bool +\n          '. Please use a boolean.');\n    }\n    logDisabled_ = bool;\n    return (bool) ? 'adapter.js logging disabled' :\n        'adapter.js logging enabled';\n  },\n\n  log: function() {\n    if (typeof window === 'object') {\n      if (logDisabled_) {\n        return;\n      }\n      if (typeof console !== 'undefined' && typeof console.log === 'function') {\n        console.log.apply(console, arguments);\n      }\n    }\n  },\n\n  /**\n   * Extract browser version out of the provided user agent string.\n   *\n   * @param {!string} uastring userAgent string.\n   * @param {!string} expr Regular expression used as match criteria.\n   * @param {!number} pos position in the version string to be returned.\n   * @return {!number} browser version.\n   */\n  extractVersion: function(uastring, expr, pos) {\n    var match = uastring.match(expr);\n    return match && match.length >= pos && parseInt(match[pos], 10);\n  },\n\n  /**\n   * Browser detector.\n   *\n   * @return {object} result containing browser, version and minVersion\n   *     properties.\n   */\n  detectBrowser: function() {\n    // Returned result object.\n    var result = {};\n    result.browser = null;\n    result.version = null;\n    result.minVersion = null;\n\n    // Fail early if it's not a browser\n    if (typeof window === 'undefined' || !window.navigator) {\n      result.browser = 'Not a browser.';\n      return result;\n    }\n\n    // Firefox.\n    if (navigator.mozGetUserMedia) {\n      result.browser = 'firefox';\n      result.version = this.extractVersion(navigator.userAgent,\n          /Firefox\\/([0-9]+)\\./, 1);\n      result.minVersion = 31;\n\n    // all webkit-based browsers\n    } else if (navigator.webkitGetUserMedia) {\n      // Chrome, Chromium, Webview, Opera, all use the chrome shim for now\n      if (window.webkitRTCPeerConnection) {\n        result.browser = 'chrome';\n        result.version = this.extractVersion(navigator.userAgent,\n          /Chrom(e|ium)\\/([0-9]+)\\./, 2);\n        result.minVersion = 38;\n\n      // Safari or unknown webkit-based\n      // for the time being Safari has support for MediaStreams but not webRTC\n      } else {\n        // Safari UA substrings of interest for reference:\n        // - webkit version:           AppleWebKit/602.1.25 (also used in Op,Cr)\n        // - safari UI version:        Version/9.0.3 (unique to Safari)\n        // - safari UI webkit version: Safari/601.4.4 (also used in Op,Cr)\n        //\n        // if the webkit version and safari UI webkit versions are equals,\n        // ... this is a stable version.\n        //\n        // only the internal webkit version is important today to know if\n        // media streams are supported\n        //\n        if (navigator.userAgent.match(/Version\\/(\\d+).(\\d+)/)) {\n          result.browser = 'safari';\n          result.version = this.extractVersion(navigator.userAgent,\n            /AppleWebKit\\/([0-9]+)\\./, 1);\n          result.minVersion = 602;\n\n        // unknown webkit-based browser\n        } else {\n          result.browser = 'Unsupported webkit-based browser ' +\n              'with GUM support but no WebRTC support.';\n          return result;\n        }\n      }\n\n    // Edge.\n    } else if (navigator.mediaDevices &&\n        navigator.userAgent.match(/Edge\\/(\\d+).(\\d+)$/)) {\n      result.browser = 'edge';\n      result.version = this.extractVersion(navigator.userAgent,\n          /Edge\\/(\\d+).(\\d+)$/, 2);\n      result.minVersion = 10547;\n\n    // Default fallthrough: not supported.\n    } else {\n      result.browser = 'Not a supported browser.';\n      return result;\n    }\n\n    // Warn if version is less than minVersion.\n    if (result.version < result.minVersion) {\n      utils.log('Browser: ' + result.browser + ' Version: ' + result.version +\n          ' < minimum supported version: ' + result.minVersion +\n          '\\n some things might not work!');\n    }\n\n    return result;\n  }\n};\n\n// Export.\nmodule.exports = {\n  log: utils.log,\n  disableLog: utils.disableLog,\n  browserDetails: utils.detectBrowser(),\n  extractVersion: utils.extractVersion\n};\n","var Connection = require('./connection');\n\n/**\n * @param {string} address. {@link Connection.address}\n * @param {Object} [options]. {@link Connection.options}\n * @constructor\n */\nfunction Client(address, options) {\n  this._address = address;\n  this._options = options || {};\n}\n\n/**\n * @param {string} id\n * @returns {Promise}\n * @fulfilled {Connection} connection - when it is opened\n */\nClient.prototype.createConnection = function(id) {\n  var connection = Connection.create(id, this._address, this._options);\n  return connection.open();\n};\n\nmodule.exports = Client;\n","var Promise = require('bluebird');\nvar Helpers = require('./helpers');\nvar EventEmitter = require('./event-emitter');\nvar TTransactionGateway = require('./traits/t-transaction-gateway');\nvar JanusError = require('./error');\nvar Transaction = require('./transaction');\nvar WebsocketConnection = require('./websocket-connection');\nvar Session = require('./session');\nvar JanusMessage = require('./janus-message');\n\n/**\n * @param {string} id\n * @param {string} address\n * @param {Object} [options]\n * @param {string} [options.token]\n * @param {string} [options.apisecret]\n * @param {boolean|number} [options.keepalive]\n * @param {Object} [options.pc] RTCPeerConnection constructor options\n * @param {Object} [options.pc.config]\n * @param {Object} [options.pc.constraints]\n *\n * Important! Please listen to `error` events on a newly created instance in Node environment. For more details please look https://nodejs.org/api/events.html#events_error_events.\n * @constructor\n * @extends EventEmitter\n * @extends TTransactionGateway\n */\nfunction Connection(id, address, options) {\n  Connection.super_.call(this);\n\n  /** @type {string} */\n  this._id = id;\n\n  /** @type {string} */\n  this._address = address;\n\n  /** @type {Object} */\n  this._options = options || {};\n\n  /** @type {Object} */\n  this._sessions = {};\n\n  /** @type {WebsocketConnection} */\n  this._websocketConnection = new WebsocketConnection();\n  this._installWebsocketListeners();\n}\n\nHelpers.inherits(Connection, EventEmitter);\nHelpers.extend(Connection.prototype, TTransactionGateway);\n\n/**\n * @see {@link Connection}\n * @returns {Connection}\n */\nConnection.create = function(id, address, options) {\n  return new Connection(id, address, options);\n};\n\n/**\n * @protected\n */\nConnection.prototype._installWebsocketListeners = function() {\n  this._websocketConnection.on('open', this.emit.bind(this, 'open'));\n  this._websocketConnection.on('error', this.emit.bind(this, 'error'));\n  this._websocketConnection.on('close', this.emit.bind(this, 'close'));\n  this._websocketConnection.on('message', function(message) {\n    this.processIncomeMessage(new JanusMessage(message)).catch(function(error) {\n      this.emit('error', error);\n    }.bind(this));\n  }.bind(this));\n};\n\n/**\n * @returns {string}\n */\nConnection.prototype.getId = function() {\n  return this._id;\n};\n\n/**\n * @returns {string}\n */\nConnection.prototype.getAddress = function() {\n  return this._address;\n};\n\n/**\n * @returns {Object}\n */\nConnection.prototype.getOptions = function() {\n  return this._options;\n};\n\n/**\n * @returns {Promise}\n * @fulfilled {Connection} connection - when it is opened\n */\nConnection.prototype.open = function() {\n  return this._websocketConnection.open(this._address, 'janus-protocol').return(this);\n};\n\n/**\n * @returns {Promise}\n */\nConnection.prototype.close = function() {\n  if (this._websocketConnection.isOpened()) {\n    var self = this;\n    return Promise.map(this.getSessionList(), function(session) {\n      return session.cleanup();\n    }).then(function() {\n      return self._websocketConnection.close();\n    }).then(function() {\n      self.emit('close');\n    });\n  }\n  return Promise.resolve();\n};\n\n/**\n * @returns {Promise}\n * @fulfilled {Session} session\n */\nConnection.prototype.createSession = function() {\n  return this.sendSync({janus: 'create'});\n};\n\n/**\n * @param {string} sessionId\n * @returns {boolean}\n */\nConnection.prototype.hasSession = function(sessionId) {\n  return !!this.getSession(sessionId);\n};\n\n/**\n * @param {string} sessionId\n * @returns {Session}\n */\nConnection.prototype.getSession = function(sessionId) {\n  return this._sessions[sessionId];\n};\n\n/**\n * @returns {Session[]}\n */\nConnection.prototype.getSessionList = function() {\n  return Object.keys(this._sessions).map(function(id) {\n    return this._sessions[id];\n  }.bind(this));\n};\n\n/**\n * @returns {boolean}\n */\nConnection.prototype.isClosed = function() {\n  return this._websocketConnection.isClosed();\n};\n\n/**\n * @param {Session} session\n */\nConnection.prototype.addSession = function(session) {\n  this._sessions[session.getId()] = session;\n  session.once('destroy', function() {\n    this.removeSession(session.getId());\n  }.bind(this));\n};\n\n/**\n * @param {string} sessionId\n */\nConnection.prototype.removeSession = function(sessionId) {\n  delete this._sessions[sessionId];\n};\n\n/**\n * @param {Object} message\n * @returns {Promise}\n */\nConnection.prototype.send = function(message) {\n  if (this._options['token']) {\n    message.token = this._options['token'];\n  }\n  if (this._options['apisecret']) {\n    message.apisecret = this._options['apisecret'];\n  }\n  if (!message['transaction']) {\n    message['transaction'] = Transaction.generateRandomId();\n  }\n  return this._websocketConnection.send(message);\n};\n\n/**\n * @param {Object} message\n * @returns {Promise}\n * @fulfilled {Object} message\n */\nConnection.prototype.processOutcomeMessage = function(message) {\n  if ('create' === message['janus']) {\n    return this._onCreate(message);\n  }\n  var sessionId = message['session_id'];\n  if (sessionId) {\n    if (this.hasSession(sessionId)) {\n      return this.getSession(sessionId).processOutcomeMessage(message);\n    } else {\n      return Promise.reject(new Error('Invalid session: [' + sessionId + ']'));\n    }\n  }\n  return Promise.resolve(message);\n};\n\n/**\n * @param {JanusMessage} incomeMessage\n * @returns {Promise}\n * @fulfilled {JanusMessage} incomeMessage\n */\nConnection.prototype.processIncomeMessage = function(incomeMessage) {\n  this.emit('message', incomeMessage);\n  var sessionId = incomeMessage.get('session_id');\n  if (sessionId && this.hasSession(sessionId)) {\n    return this.getSession(sessionId).processIncomeMessage(incomeMessage);\n  }\n  var self = this;\n  return Promise\n    .try(function() {\n      if (sessionId && !self.hasSession(sessionId)) {\n        throw new Error('Invalid session: [' + sessionId + ']');\n      }\n      return self.defaultProcessIncomeMessage(incomeMessage);\n    });\n};\n\n/**\n * @param {Object} outcomeMessage\n * @returns {Promise}\n * @fulfilled {Object} outcomeMessage\n * @protected\n */\nConnection.prototype._onCreate = function(outcomeMessage) {\n  this.addTransaction(new Transaction(outcomeMessage['transaction'], function(incomeMessage) {\n    if ('success' == incomeMessage.get('janus')) {\n      var sessionId = incomeMessage.get('data', 'id');\n      this.addSession(Session.create(this, sessionId));\n      return this.getSession(sessionId);\n    } else {\n      throw new JanusError(incomeMessage);\n    }\n  }.bind(this)));\n  return Promise.resolve(outcomeMessage);\n};\n\nConnection.prototype.toString = function() {\n  return 'JanusConnection' + JSON.stringify({id: this._id, address: this._address});\n};\n\nmodule.exports = Connection;\n","var Helpers = require('./helpers');\n\n/**\n * @param {JanusMessage} janusMessage\n * @constructor\n */\nfunction JanusError(janusMessage) {\n  Error.captureStackTrace(this, this.constructor);\n  this.name = this.constructor.name;\n  this.janusMessage = janusMessage;\n  var janusError = janusMessage.getError();\n  this.message = janusError['reason'];\n  this.code = janusError['code'];\n}\n\nHelpers.inherits(JanusError, Error);\n\nmodule.exports = JanusError;\n","var EventEmitter2 = require('eventemitter2');\nvar Helpers = require('./helpers');\n\nfunction EventEmitter() {\n  EventEmitter.super_.call(this, {\n    wildcard: true,\n    delimiter: ':',\n    newListener: false,\n    maxListeners: 20\n  });\n}\n\nHelpers.inherits(EventEmitter, EventEmitter2);\n\nmodule.exports = EventEmitter;\n\n","var Helpers = {\n\n  /**\n   * @param {Object} destination\n   * @param {...Object|null} source\n   * @returns {Object}\n   */\n  extend: function(destination, source) {\n    if (source) {\n      var sources = Array.prototype.slice.call(arguments, 1) || [];\n\n      sources.forEach(function(source) {\n        Object.keys(source).forEach(function(key) {\n          destination[key] = source[key];\n        });\n      });\n    }\n\n    return destination;\n  },\n  /**\n   * @param {Function} ctor\n   * @param {Function} superCtor\n   */\n  inherits: function(ctor, superCtor) {\n    ctor.super_ = superCtor;\n    ctor.prototype = Object.create(superCtor.prototype, {\n      constructor: {\n        value: ctor,\n        enumerable: false,\n        writable: true,\n        configurable: true\n      }\n    });\n  }\n};\n\nmodule.exports = Helpers;\n","var Client = require('./client');\nvar JanusError = require('./error');\nvar WebsocketConnection = require('./websocket-connection');\nvar Connection = require('./connection');\nvar Session = require('./session');\nvar Plugin = require('./plugin');\nvar MediaPlugin = require('./webrtc/media-plugin');\nvar AudiobridgePlugin = require('./webrtc/plugin/audiobridge-plugin');\nvar AudioroomPlugin = require('./webrtc/plugin/audioroom-plugin');\nvar StreamingPlugin = require('./webrtc/plugin/streaming-plugin');\nvar RtpbroadcastPlugin = require('./webrtc/plugin/rtpbroadcast-plugin');\n\nmodule.exports = {\n  Error: JanusError,\n  WebsocketConnection: WebsocketConnection,\n  Client: Client,\n  Connection: Connection,\n  Session: Session,\n  Plugin: Plugin,\n  MediaPlugin: MediaPlugin,\n  AudiobridgePlugin: AudiobridgePlugin,\n  AudioroomPlugin: AudioroomPlugin,\n  StreamingPlugin: StreamingPlugin,\n  RtpbroadcastPlugin: RtpbroadcastPlugin\n};\n","/**\n * @param {Object} plainMessage\n * @constructor\n */\nfunction JanusMessage(plainMessage) {\n  this._plainMessage = plainMessage;\n}\n\n/**\n * @returns {Object}\n */\nJanusMessage.prototype.getPlainMessage = function() {\n  return this._plainMessage;\n};\n\n/**\n * @returns {Object}\n */\nJanusMessage.prototype.getError = function() {\n  return this.get('error');\n};\n\n/**\n * @param {...string} name\n * @returns {*}\n */\nJanusMessage.prototype.get = function(name) {\n  var names = Array.prototype.slice.call(arguments, 1);\n  var result = this._plainMessage[name];\n\n  for (var i = 0; i < names.length; i++) {\n    name = names[i];\n    if (result) {\n      result = result[name];\n    } else {\n      break;\n    }\n  }\n\n  return result || null;\n};\n\nmodule.exports = JanusMessage;\n","var Helpers = require('./helpers');\nvar JanusMessage = require('./janus-message');\n\n/**\n * @param {Object} plainMessage\n * @param {Plugin} plugin\n * @constructor\n * @extends JanusMessage\n */\nfunction JanusPluginMessage(plainMessage, plugin) {\n  JanusPluginMessage.super_.apply(this, arguments);\n  this._plugin = plugin;\n}\n\nHelpers.inherits(JanusPluginMessage, JanusMessage);\n\n/**\n * @param {...string} [name]\n * @returns {*}\n */\nJanusPluginMessage.prototype.getPluginData = function(name) {\n  var names = Array.prototype.slice.call(arguments);\n  names.unshift('plugindata', 'data');\n  return this.get.apply(this, names);\n};\n\n/**\n * @returns {Object}\n */\nJanusPluginMessage.prototype.getError = function() {\n  var error = this.getPluginData('error');\n  if (error) {\n    return {\n      reason: error,\n      code: this.getPluginData('error_code')\n    }\n  }\n  return JanusPluginMessage.super_.prototype.getError.call(this);\n};\n\n/**\n * @returns {string}\n */\nJanusPluginMessage.prototype.getResultText = function() {\n  return this.getPluginData(this._plugin.getResponseAlias());\n};\n\nmodule.exports = JanusPluginMessage;\n","var Promise = require('bluebird');\nvar Helpers = require('./helpers');\nvar EventEmitter = require('./event-emitter');\nvar JanusError = require('./error');\nvar TTransactionGateway = require('./traits/t-transaction-gateway');\nvar Transaction = require('./transaction');\nvar JanusPluginMessage = require('./janus-plugin-message');\n\n/**\n * @param {Session} session\n * @param {string} name\n * @param {string} id\n *\n * @constructor\n * @extends EventEmitter\n * @extends TTransactionGateway\n */\nfunction Plugin(session, name, id) {\n  Plugin.super_.call(this);\n  this._session = session;\n  this._name = name;\n  this._id = id;\n\n  var plugin = this;\n  session.on('destroy', function() {\n    plugin._detach();\n  });\n}\n\nHelpers.inherits(Plugin, EventEmitter);\nHelpers.extend(Plugin.prototype, TTransactionGateway);\n\nPlugin._types = {};\n\n/**\n * @see {@link Plugin}\n * @returns {Plugin}\n */\nPlugin.create = function(session, name, id) {\n  var aClass = this._types[name];\n  if (aClass) {\n    return new aClass(session, name, id);\n  }\n  return new Plugin(session, name, id);\n};\n\n/**\n * @param {string} name\n * @param {function(new:Plugin)} aClass\n */\nPlugin.register = function(name, aClass) {\n  this._types[name] = aClass;\n};\n\n/**\n * @returns {string}\n */\nPlugin.prototype.getId = function() {\n  return this._id;\n};\n\n/**\n * @returns {string}\n */\nPlugin.prototype.getName = function() {\n  return this._name;\n};\n\n/**\n * @returns {string}\n */\nPlugin.prototype.getResponseAlias = function() {\n  throw new Error('Plugin.getResponseAlias must be implemented');\n};\n\n/**\n * @param {Object} message\n * @returns {Promise}\n */\nPlugin.prototype.send = function(message) {\n  message['handle_id'] = this._id;\n  if (this._session) {\n    return this._session.send(message);\n  } else {\n    return Promise.reject(new Error('No active session'));\n  }\n};\n\n/**\n * @returns {Promise}\n */\nPlugin.prototype.detach = function() {\n  if (this._session) {\n    return new Promise(function(resolve, reject) {\n      this.once('detach', resolve);\n      this.sendWithTransaction({janus: 'detach'}).catch(reject);\n    }.bind(this));\n  }\n  return Promise.resolve();\n};\n\n/**\n * @returns {Promise}\n */\nPlugin.prototype.cleanup = function() {\n  return this._detach();\n};\n\n/**\n * @param {Object} message\n * @returns {Promise}\n * @fulfilled {Object} message\n */\nPlugin.prototype.processOutcomeMessage = function(message) {\n  return Promise.resolve(message);\n};\n\n/**\n * @param {JanusMessage} incomeMessage\n * @returns {Promise}\n */\nPlugin.prototype.processIncomeMessage = function(incomeMessage) {\n  var self = this;\n  return Promise\n    .try(function() {\n      incomeMessage = new JanusPluginMessage(incomeMessage.getPlainMessage(), self);\n      if ('detached' === incomeMessage.get('janus')) {\n        return self._onDetached();\n      }\n      return self.defaultProcessIncomeMessage(incomeMessage);\n    })\n    .then(function() {\n      self.emit('message', incomeMessage);\n    })\n    .catch(function(error) {\n      self.emit('error', error);\n    })\n};\n\n/**\n * @returns {Promise}\n * @protected\n */\nPlugin.prototype._onDetached = function() {\n  return this._detach();\n};\n\n/**\n * @returns {Promise}\n * @protected\n */\nPlugin.prototype._detach = function() {\n  if (this._session) {\n    this._session = null;\n    this.emit('detach');\n  }\n  return Promise.resolve();\n};\n\nPlugin.prototype.toString = function() {\n  return 'Plugin' + JSON.stringify({id: this._id, name: this._name});\n};\n\n/**\n * @param {Object} options\n * @returns {Promise}\n * @fulfilled {JanusPluginMessage}\n */\nPlugin.prototype.sendWithTransaction = function(options) {\n  var transactionId = Transaction.generateRandomId();\n  var transaction = new Transaction(transactionId, function(incomeMessage) {\n    var errorMessage = incomeMessage.getError();\n    if (!errorMessage) {\n      return Promise.resolve(incomeMessage);\n    }\n    var error = new JanusError(incomeMessage);\n    return Promise.reject(error);\n  });\n  var message = {\n    janus: 'message',\n    transaction: transactionId\n  };\n  Helpers.extend(message, options);\n\n  this.addTransaction(transaction);\n  var sendPromise = this.sendSync(message);\n\n  return new Promise(function(resolve, reject) {\n\n    transaction.promise.catch(function(e) {\n      reject(e);\n    });\n    sendPromise.then(function(r) {\n      resolve(r);\n    }).catch(function(e) {\n      reject(e);\n    })\n  });\n};\n\nmodule.exports = Plugin;\n","var Promise = require('bluebird');\nvar Helpers = require('./helpers');\nvar EventEmitter = require('./event-emitter');\nvar TTransactionGateway = require('./traits/t-transaction-gateway');\nvar JanusError = require('./error');\nvar Timer = require('./timer');\nvar Transaction = require('./transaction');\nvar Plugin = require('./plugin');\n\n/**\n * @param {Connection} connection\n * @param {string} id\n *\n * @constructor\n * @extends EventEmitter\n * @extends TTransactionGateway\n */\nfunction Session(connection, id) {\n  Session.super_.call(this);\n  this._connection = connection;\n  this._id = id;\n  this._plugins = {};\n\n  if (this._connection.getOptions()['keepalive']) {\n    this._startKeepAlive();\n  }\n  var session = this;\n  connection.on('close', function() {\n    session._destroy();\n  });\n}\n\nHelpers.inherits(Session, EventEmitter);\nHelpers.extend(Session.prototype, TTransactionGateway);\n\n/**\n * @see {@link Session}\n * @returns {Session}\n */\nSession.create = function(connection, id) {\n  return new Session(connection, id);\n};\n\n/**\n * @returns {string}\n */\nSession.prototype.getId = function() {\n  return this._id;\n};\n\n/**\n * @param {Object} message\n * @returns {Promise}\n */\nSession.prototype.send = function(message) {\n  if (!this._connection) {\n    return Promise.reject(new Error('Can not send message over destroyed ' + this));\n  }\n  //we always use own session's id in its messages\n  message['session_id'] = this._id;\n  if (this._keepAliveTimer) {\n    this._keepAliveTimer.reset();\n  }\n  return this._connection.send(message);\n};\n\n/**\n * @param {string} name\n * @returns {Promise}\n * @fulfilled {Plugin} plugin\n */\nSession.prototype.attachPlugin = function(name) {\n  return this.sendSync({janus: 'attach', plugin: name});\n};\n\n/**\n * @returns {Promise}\n * @fulfilled {Object} response\n */\nSession.prototype.destroy = function() {\n  return this.sendSync({janus: 'destroy'});\n};\n\n/**\n * @returns {Promise}\n */\nSession.prototype.cleanup = function() {\n  return this._destroy();\n};\n\n/**\n * @param {string} pluginId\n * @returns {boolean}\n */\nSession.prototype.hasPlugin = function(pluginId) {\n  return !!this.getPlugin(pluginId);\n};\n\n/**\n * @param {string} pluginId\n * @returns {Plugin}\n */\nSession.prototype.getPlugin = function(pluginId) {\n  return this._plugins[pluginId];\n};\n\n/**\n * @returns {Plugin[]}\n */\nSession.prototype.getPluginList = function() {\n  return Object.keys(this._plugins).map(function(id) {\n    return this._plugins[id];\n  }.bind(this));\n};\n\n/**\n * @param {Plugin} plugin\n */\nSession.prototype.addPlugin = function(plugin) {\n  this._plugins[plugin.getId()] = plugin;\n  plugin.once('detach', function() {\n    this.removePlugin(plugin.getId())\n  }.bind(this));\n};\n\n/**\n * @param {string} pluginId\n */\nSession.prototype.removePlugin = function(pluginId) {\n  delete this._plugins[pluginId];\n};\n\n/**\n * @param {Object} message\n * @returns {Promise}\n * @fulfilled {Object} message\n */\nSession.prototype.processOutcomeMessage = function(message) {\n  var janusMessage = message['janus'];\n  if ('attach' === janusMessage) {\n    return this._onAttach(message);\n  }\n  if ('destroy' === janusMessage) {\n    return this._onDestroy(message);\n  }\n  var pluginId = message['handle_id'];\n  if (pluginId) {\n    if (this.hasPlugin(pluginId)) {\n      return this.getPlugin(pluginId).processOutcomeMessage(message);\n    } else {\n      return Promise.reject(new Error('Invalid plugin [' + pluginId + ']'));\n    }\n  }\n  return Promise.resolve(message);\n};\n\n/**\n * @param {JanusMessage} incomeMessage\n * @returns {Promise}\n * @fulfilled {JanusMessage} incomeMessage\n */\nSession.prototype.processIncomeMessage = function(incomeMessage) {\n  var pluginId = incomeMessage.get('handle_id') || incomeMessage.get('sender');\n  if (pluginId && this.hasPlugin(pluginId)) {\n    return this.getPlugin(pluginId).processIncomeMessage(incomeMessage);\n  }\n\n  var self = this;\n  return Promise\n    .try(function() {\n      if (pluginId && !self.hasPlugin(pluginId)) {\n        throw new Error('Invalid plugin [' + pluginId + ']');\n      }\n      if ('timeout' === incomeMessage.get('janus')) {\n        return self._onTimeout(incomeMessage);\n      }\n      return self.defaultProcessIncomeMessage(incomeMessage);\n    })\n    .then(function() {\n      self.emit('message', incomeMessage);\n    })\n    .catch(function(error) {\n      self.emit('error', error);\n    });\n};\n\n/**\n * @param {Object} outcomeMessage\n * @returns {Promise}\n * @fulfilled {Object} outcomeMessage\n * @protected\n */\nSession.prototype._onAttach = function(outcomeMessage) {\n  this.addTransaction(\n    new Transaction(outcomeMessage['transaction'], function(incomeMessage) {\n      if ('success' == incomeMessage.get('janus')) {\n        var pluginId = incomeMessage.get('data', 'id');\n        this.addPlugin(Plugin.create(this, outcomeMessage['plugin'], pluginId));\n        return this.getPlugin(pluginId);\n      } else {\n        throw new JanusError(incomeMessage);\n      }\n    }.bind(this))\n  );\n  return Promise.resolve(outcomeMessage);\n};\n\n/**\n * @param {Object} incomeMessage\n * @returns {Promise}\n * @fulfilled {Object} incomeMessage\n */\nSession.prototype._onTimeout = function(incomeMessage) {\n  return this._destroy().return(incomeMessage);\n};\n\n/**\n * @param {Object} outcomeMessage\n * @returns {Promise}\n * @fulfilled {Object} outcomeMessage\n * @protected\n */\nSession.prototype._onDestroy = function(outcomeMessage) {\n  this.addTransaction(\n    new Transaction(outcomeMessage['transaction'], function(incomeMessage) {\n      if ('success' == incomeMessage.get('janus')) {\n        return this._destroy().return(incomeMessage);\n      } else {\n        throw new JanusError(incomeMessage);\n      }\n    }.bind(this))\n  );\n  return Promise.resolve(outcomeMessage);\n};\n\n/**\n * @returns {Promise}\n * @protected\n */\nSession.prototype._destroy = function() {\n  if (!this._connection) {\n    return Promise.resolve();\n  }\n  this._stopKeepAlive();\n  return Promise.map(this.getPluginList(), function(plugin) {\n    return plugin.cleanup();\n  }).finally(function() {\n    this._plugins = {};\n    this._connection = null;\n    this.emit('destroy');\n  }.bind(this));\n};\n\n/**\n * @param {*} value\n * @returns {boolean}\n * @protected\n */\nSession.prototype._isNaturalNumber = function(value) {\n  if (isNaN(value)) {\n    return false;\n  }\n  var x = parseFloat(value);\n  return (x | 0) === x && x > 0;\n};\n\n/**\n * @protected\n */\nSession.prototype._startKeepAlive = function() {\n  var keepAlive = this._connection.getOptions()['keepalive'];\n  if (this._isNaturalNumber(keepAlive) && keepAlive < 59000) {\n    this._keepAlivePeriod = keepAlive;\n  } else {\n    this._keepAlivePeriod = 30000;\n  }\n  var session = this;\n  this._keepAliveTimer = new Timer(function() {\n    session.send({janus: 'keepalive'})\n      .catch(function(error) {\n        if (session._connection.isClosed()) {\n          session._stopKeepAlive();\n        }\n        throw error;\n      });\n  }, this._keepAlivePeriod);\n  this._keepAliveTimer.start();\n};\n\nSession.prototype._stopKeepAlive = function() {\n  if (this._keepAliveTimer) {\n    this._keepAliveTimer.stop();\n    this._keepAliveTimer = null;\n  }\n};\n\nSession.prototype.toString = function() {\n  return 'Session' + JSON.stringify({id: this._id});\n};\n\n\nmodule.exports = Session;\n","/**\n * @param {Function} callback\n * @param {number} ms\n * @constructor\n */\nfunction Timer(callback, ms) {\n  this._callback = callback;\n  this._ms = ms;\n  this._timeoutId = null;\n}\n\nTimer.prototype.start = function() {\n  this._timeoutId = setTimeout(this._callback, this._ms);\n};\n\nTimer.prototype.stop = function() {\n  if (this._timeoutId) {\n    clearTimeout(this._timeoutId);\n    this._timeoutId = null;\n  }\n};\n\nTimer.prototype.reset = function() {\n  this.stop();\n  this.start();\n};\n\nmodule.exports = Timer;\n","var Promise = require('bluebird');\nvar JanusError = require('../error');\nvar Transaction = require('../transaction');\nvar Transactions = require('../transactions');\n\n/**\n * @class TTransactionGateway\n */\nvar TTransactionGateway = {\n  /**\n   * @returns {Transactions}\n   */\n  getTransactions: function() {\n    if (!this._transactions) {\n      this._transactions = new Transactions();\n    }\n    return this._transactions;\n  },\n\n  /**\n   * @param {Transaction} transaction\n   */\n  addTransaction: function(transaction) {\n    this.getTransactions().add(transaction);\n  },\n\n  /**\n   * @param {Object} message\n   * @returns {Promise}\n   * @fulfilled {*}\n   */\n  sendSync: function(message) {\n    if (!message['transaction']) {\n      message['transaction'] = Transaction.generateRandomId();\n    }\n    var self = this;\n    return this.processOutcomeMessage(message)\n      .then(function(message) {\n        return self.send(message);\n      })\n      .then(function(result) {\n        var transaction = self.getTransactions().find(message['transaction']);\n        if (transaction) {\n          return transaction.promise;\n        }\n        return result;\n      });\n  },\n\n  /**\n   * @param {JanusMessage} incomeMessage\n   * @returns {boolean}\n   */\n  hasTransaction: function(incomeMessage) {\n    return this.getTransactions().has(incomeMessage.get('transaction'));\n  },\n\n  /**\n   * @param {JanusMessage} incomeMessage\n   * @returns {Promise}\n   * @fulfilled {*}\n   */\n  executeTransaction: function(incomeMessage) {\n    return this.getTransactions().execute(incomeMessage.get('transaction'), incomeMessage);\n  },\n\n  /**\n   * @param {JanusMessage} incomeMessage\n   * @returns {Promise}\n   * @fulfilled {*}\n   */\n  defaultProcessIncomeMessage: function(incomeMessage) {\n    var self = this;\n    if (self.hasTransaction(incomeMessage)) {\n      return self.executeTransaction(incomeMessage);\n    } else {\n      if (incomeMessage.getError()) {\n        return Promise.reject(new JanusError(incomeMessage));\n      }\n    }\n  }\n};\n\nmodule.exports = TTransactionGateway;\n","var Promise = require('bluebird');\n\n/**\n * @callback Transaction~callback\n * @returns {Promise}\n * @fulfilled {*}\n */\n\n/**\n * @param {string} id\n * @param {Transaction~callback} callback\n * @param {number} [timeoutPeriod=30000] in milliseconds. Timeout until transaction is executed.\n * @constructor\n */\nfunction Transaction(id, callback, timeoutPeriod) {\n  this.id = id;\n  timeoutPeriod = timeoutPeriod || 30000;\n  var timeoutRejection;\n  var self = this;\n  this.promise = new Promise(function(resolve, reject) {\n    self._callback = function() {\n      clearTimeout(timeoutRejection);\n      var result;\n      try {\n        result = callback.apply(null, arguments);\n      } catch (error) {\n        result = Promise.reject(error);\n      }\n      if (!(result instanceof Promise)) {\n        result = Promise.resolve(result);\n      }\n      result.then(resolve, reject);\n    };\n\n    timeoutRejection = setTimeout(function() {\n      reject(new Error('Transaction timeout ' + self.id));\n    }, timeoutPeriod);\n  });\n  this._isExecuted = false;\n}\n\n/**\n * @param {...*}\n * @returns {Promise}\n * @fulfilled {*}\n */\nTransaction.prototype.execute = function() {\n  if (!this._isExecuted) {\n    this._isExecuted = true;\n    this._callback.apply(this, arguments);\n  }\n  return this.promise;\n};\n\n/**\n * @returns {string}\n */\nTransaction.generateRandomId = function() {\n  return Math.random().toString(36).substring(2, 12);\n};\n\nmodule.exports = Transaction;\n","var Promise = require('bluebird');\nvar Transaction = require('./transaction');\n\n/**\n * @constructor\n */\nfunction Transactions() {\n  /** @type {Object} */\n  this.list = {};\n}\n\n/**\n * @param {Transaction} transaction\n */\nTransactions.prototype.add = function(transaction) {\n  if (this.has(transaction.id)) {\n    throw new Error('Transaction with id: `' + transaction.id + '` already exists');\n  }\n  if (!(transaction instanceof Transaction)) {\n    throw new Error('`transaction` must be an instance of Transaction');\n  }\n  this.list[transaction.id] = transaction;\n};\n\n/**\n * @param {string} id\n * @returns {boolean}\n */\nTransactions.prototype.has = function(id) {\n  return id && !!this._find(id);\n};\n\n/**\n * @param {string} id\n * @returns {Transaction|Null}\n */\nTransactions.prototype.find = function(id) {\n  return this._find(id) || null;\n};\n\n/**\n * @param {string} id\n * @param {Object} message\n * @returns {Promise}\n * @fulfilled {*}\n */\nTransactions.prototype.execute = function(id, message) {\n  var transaction = this.find(id);\n  if (!transaction) {\n    throw new Error('Transaction `' + id + '` not found');\n  }\n  if ('ack' !== message['janus']) {\n    this.remove(id);\n    return transaction.execute(message);\n  }\n  return Promise.resolve(message);\n};\n\n/**\n * @param {string} id\n */\nTransactions.prototype.remove = function(id) {\n  if (!this.has(id)) {\n    throw new Error('Transaction with id: `' + id + \"` doesn't exist\");\n  }\n  delete this.list[id];\n};\n\n/**\n * @param {string} id\n * @returns {Transaction}\n * @protected\n */\nTransactions.prototype._find = function(id) {\n  return this.list[id];\n};\n\nmodule.exports = Transactions;\n","var Promise = require('bluebird');\nvar Helpers = require('../helpers');\nvar JanusPluginMessage = require('../janus-plugin-message');\nvar MediaEntityPlugin = require('./media-entity-plugin');\n\nfunction MediaAudioPlugin() {\n  MediaAudioPlugin.super_.apply(this, arguments);\n}\n\nHelpers.inherits(MediaAudioPlugin, MediaEntityPlugin);\n\n/**\n * @param {string|number} id\n * @param {Object} options\n * @returns {Promise}\n * @fulfilled {JanusPluginMessage} response\n */\nMediaAudioPlugin.prototype._join = function(id, options) {\n  var body = Helpers.extend({request: 'join'}, options);\n  return this.sendWithTransaction({body: body})\n    .then(function(response) {\n      this.setCurrentEntity(id);\n      return response;\n    }.bind(this));\n};\n\n/**\n * @returns {Promise}\n * @fulfilled {JanusPluginMessage} response\n */\nMediaAudioPlugin.prototype.leave = function() {\n  return this.sendWithTransaction({body: {request: 'leave'}})\n    .then(function(response) {\n      this.resetCurrentEntity();\n      return response;\n    }.bind(this));\n};\n\n/**\n * @param {string|number} id\n * @param {Object} [options]\n * @returns {Promise}\n * @fulfilled {JanusPluginMessage} response\n */\nMediaAudioPlugin.prototype._change = function(id, options) {\n  var body = Helpers.extend({request: 'changeroom'}, options);\n  return this.sendWithTransaction({body: body})\n    .then(function(response) {\n      this.setCurrentEntity(id);\n      return response;\n    }.bind(this));\n};\n\n/**\n * @param {string|number} id\n * @param {Object} [options]\n * @returns {Promise}\n * @fulfilled {JanusPluginMessage} response\n */\nMediaAudioPlugin.prototype._connect = function(id, options) {\n  if (this.hasCurrentEntity(id)) {\n    return Promise.resolve(new JanusPluginMessage({}, this));\n  }\n  if (this.hasCurrentEntity()) {\n    return this._change(id, options);\n  }\n  return this._join(id, options);\n};\n\n/**\n * @returns {Promise}\n * @fulfilled {JanusPluginMessage} response\n */\nMediaAudioPlugin.prototype.list = function() {\n  return this._list();\n};\n\n/**\n * @param {Object} [options]\n * @param {boolean} [options.muted]\n * @param {number} [options.quality]\n * @param {RTCSessionDescription} [jsep]\n * @returns {Promise}\n * @fulfilled {JanusPluginMessage} response\n */\nMediaAudioPlugin.prototype.configure = function(options, jsep) {\n  var body = Helpers.extend({\n    request: 'configure'\n  }, options);\n  var message = {body: body};\n  if (jsep) {\n    message.jsep = jsep;\n  }\n  return this.sendWithTransaction(message);\n};\n\n/**\n * @param {MediaStream} stream\n * @param {RTCOfferOptions} [offerOptions]\n * @param {Object} [configureOptions]\n * @param {boolean} [configureOptions.muted]\n * @param {number} [configureOptions.quality]\n * @returns {Promise}\n * @fulfilled {@link sendSDP}\n */\nMediaAudioPlugin.prototype.offerStream = function(stream, offerOptions, configureOptions) {\n  var self = this;\n  return Promise\n    .try(function() {\n      self.createPeerConnection();\n      stream.getAudioTracks().forEach(function(track) {\n        self.addTrack(track, stream);\n      });\n    })\n    .then(function() {\n      return self.createOffer(offerOptions);\n    })\n    .then(function(jsep) {\n      return self.sendSDP(jsep, configureOptions);\n    });\n};\n\n/**\n * @param {RTCSessionDescription} jsep\n * @param {Object} [configureOptions]\n * @param {boolean} [configureOptions.muted]\n * @param {number} [configureOptions.quality]\n * @returns {Promise}\n * @fulfilled {RTCSessionDescription}\n */\nMediaAudioPlugin.prototype.sendSDP = function(jsep, configureOptions) {\n  return this.configure(configureOptions, jsep)\n    .then(function(response) {\n      var jsep = response.get('jsep');\n      if (jsep) {\n        this.setRemoteSDP(jsep);\n        return jsep;\n      }\n      return Promise.reject(new Error('Failed sendSDP. No jsep in response.'));\n    }.bind(this));\n};\n\n/**\n * @param {Object} options\n * @returns {Promise}\n * @fulfilled {JanusPluginMessage} list\n */\nMediaAudioPlugin.prototype._listParticipants = function(options) {\n  var body = Helpers.extend({request: 'listparticipants'}, options);\n  return this.sendWithTransaction({body: body});\n};\n\nmodule.exports = MediaAudioPlugin;\n","var Promise = require('bluebird');\nvar webrtc = require('webrtc-adapter');\n\nfunction MediaDevicesShim() {\n}\n\n/**\n * @see https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia#Parameters\n * @typedef {Object} MediaStreamConstraints\n */\n\n/**\n * @param {MediaStreamConstraints} constraints\n * @returns {Promise}\n * @fulfilled {MediaStream} stream\n */\nMediaDevicesShim.getUserMedia = function(constraints) {\n  if (constraints.video === 'screen') {\n    return this.getSharedScreen({audio: constraints.audio});\n  } else {\n    return Promise.resolve(navigator.mediaDevices.getUserMedia(constraints));\n  }\n};\n\n/**\n * @param {MediaStreamConstraints} constraints only 'audio'\n * @returns {Promise}\n * @fulfilled {MediaStream} stream\n */\nMediaDevicesShim.getSharedScreen = function(constraints) {\n  if (window.location.protocol !== 'https:') {\n    return Promise.reject(new Error('Screen sharing only works on HTTPS, try the https:// version of this page'));\n  }\n\n  if ('chrome' == webrtc.browserDetails.browser) {\n    return this._getSharedScreenChrome(constraints);\n  } else if ('firefox' == webrtc.browserDetails.browser) {\n    return this._getSharedScreenFirefox(constraints);\n  }\n};\n\n/**\n * @param {MediaStreamConstraints} constraints only 'audio'\n * @returns {Promise}\n * @fulfilled {MediaStream} stream\n */\nMediaDevicesShim._getSharedScreenChrome = function(constraints) {\n  var chromever = webrtc.browserDetails.version;\n  var maxver = 33;\n  if (window.navigator.userAgent.match('Linux')) {\n    maxver = 35;\n  }\t// \"known\" crash in chrome 34 and 35 on linux\n  if (chromever >= 26 && chromever <= maxver) {\n    // Chrome 26->33 requires some awkward chrome://flags manipulation\n    constraints = Helpers.extend({}, constraints, {\n      video: {\n        mandatory: {\n          googLeakyBucket: true,\n          maxWidth: window.screen.width,\n          maxHeight: window.screen.height,\n          maxFrameRate: 3,\n          chromeMediaSource: 'screen'\n        }\n      }\n    });\n    return window.getUserMedia(constraints);\n  } else {\n    // Chrome 34+ requires an extension\n    return new Promise(function(resolve, reject) {\n      var timeoutRejectId;\n      var messageListener = function(event) {\n        if (event.origin != window.location.origin) {\n          return;\n        }\n        if (event.data.type == 'janusGotScreen' && timeoutRejectId == event.data.id) {\n          window.clearTimeout(timeoutRejectId);\n          window.removeEventListener('message', messageListener);\n\n          if (event.data.sourceId === '') {\n            // user canceled\n            var error = new Error('NavigatorUserMediaError');\n            error.name = 'You cancelled the request for permission, giving up...';\n            reject(error);\n          } else {\n            constraints = Helpers.extend({}, constraints, {\n              video: {\n                mandatory: {\n                  chromeMediaSource: 'desktop',\n                  maxWidth: window.screen.width,\n                  maxHeight: window.screen.height,\n                  maxFrameRate: 3\n                },\n                optional: [\n                  {googLeakyBucket: true},\n                  {googTemporalLayeredScreencast: true}\n                ]\n              }\n            });\n            constraints.video.mandatory.chromeMediaSourceId = event.data.sourceId;\n            resolve(window.getUserMedia(constraints));\n          }\n        } else if (event.data.type == 'janusGetScreenPending') {\n          if (timeoutRejectId == event.data.id) {\n            window.clearTimeout(timeoutRejectId);\n          }\n        }\n      };\n\n      window.addEventListener('message', messageListener);\n      timeoutRejectId = setTimeout(\n        function() {\n          window.removeEventListener('message', messageListener);\n          var error = new Error('NavigatorUserMediaError');\n          error.name = 'The required Chrome extension is not installed: click <a href=\"#\">here</a> to install it. (NOTE: this will need you to refresh the page)';\n          reject(error);\n        }, 1000);\n      window.postMessage({type: 'janusGetScreen', id: timeoutRejectId}, '*');\n    });\n  }\n};\n\n/**\n * @param {MediaStreamConstraints} constraints only 'audio'\n * @returns {Promise}\n * @fulfilled {MediaStream} stream\n */\nMediaDevicesShim._getSharedScreenFirefox = function(constraints) {\n  var ffver = webrtc.browserDetails.version;\n  if (ffver >= 33) {\n    constraints = Helpers.extend({}, constraints, {\n      video: {\n        mozMediaSource: 'window',\n        mediaSource: 'window'\n      }\n    });\n    return window.getUserMedia(constraints).then(function(stream) {\n      if (stream) {\n        // Workaround for https://bugzilla.mozilla.org/show_bug.cgi?id=1045810\n        var lastStreamTime = stream.currentTime;\n        var inderval = window.setInterval(function() {\n          if (stream.currentTime == lastStreamTime) {\n            window.clearInterval(inderval);\n            if (stream.onended) {\n              stream.onended();\n            }\n          }\n          lastStreamTime = stream.currentTime;\n        }, 500);\n      }\n      return stream;\n    });\n  } else {\n    var error = new Error('Your version of Firefox does not support screen sharing, please install Firefox 33 (or more recent versions)');\n    return Promise.reject(error);\n  }\n};\n\nmodule.exports = MediaDevicesShim;\n","var Helpers = require('../helpers');\nvar MediaPlugin = require('./media-plugin');\n\nfunction MediaEntityPlugin() {\n  MediaEntityPlugin.super_.apply(this, arguments);\n\n  this._currentEntityId = null;\n}\n\nHelpers.inherits(MediaEntityPlugin, MediaPlugin);\n\n/**\n * @param {string|number} [id]\n * @return {boolean}\n */\nMediaEntityPlugin.prototype.hasCurrentEntity = function(id) {\n  if (id) {\n    return id === this._currentEntityId;\n  }\n  return !!this._currentEntityId;\n};\n\n/**\n * @param {string|number} id\n */\nMediaEntityPlugin.prototype.setCurrentEntity = function(id) {\n  this._currentEntityId = id;\n};\n\nMediaEntityPlugin.prototype.resetCurrentEntity = function() {\n  this._currentEntityId = null;\n};\n\n/**\n * @param {Object} options\n * @returns {Promise}\n * @fulfilled {JanusPluginMessage} response\n */\nMediaEntityPlugin.prototype._create = function(options) {\n  var body = Helpers.extend({request: 'create'}, options);\n  return this.sendWithTransaction({body: body})\n    .catch(function(error) {\n      if (error.message.indexOf('already exists') > 0) {\n        return error.response;\n      } else {\n        throw error;\n      }\n    });\n};\n\n/**\n * @param {string|number} id\n * @param {Object} options\n * @returns {Promise}\n * @fulfilled {JanusPluginMessage} response\n */\nMediaEntityPlugin.prototype._destroy = function(id, options) {\n  var body = Helpers.extend({request: 'destroy'}, options);\n  return this.sendWithTransaction({body: body})\n    .then(function(response) {\n      if (this.hasCurrentEntity(id)) {\n        this.resetCurrentEntity();\n      }\n      return response;\n    }.bind(this));\n};\n\n/**\n * @param {Object} [options]\n * @returns {Promise}\n * @fulfilled {JanusPluginMessage} response\n */\nMediaEntityPlugin.prototype._list = function(options) {\n  var body = Helpers.extend({request: 'list'}, options);\n  return this.sendWithTransaction({body: body});\n};\n\n/**\n * @inheritDoc\n */\nMediaEntityPlugin.prototype._onHangup = function(incomeMessage) {\n  this.resetCurrentEntity();\n  return MediaEntityPlugin.super_.prototype._onHangup.call(this, incomeMessage);\n};\n\nmodule.exports = MediaEntityPlugin;\n","var Promise = require('bluebird');\nvar webrtcsupport = require('webrtcsupport');\nvar Helpers = require('../helpers');\nvar Plugin = require('../plugin');\nvar MediaDevicesShim = require('./media-devices-shim');\n\n/**\n * @inheritDoc\n *\n * IMPORTANT! WebRTC stuff will not work in node environment.\n * @constructor\n * @extends Plugin\n */\nfunction MediaPlugin(session, name, id) {\n  MediaPlugin.super_.apply(this, arguments);\n\n  this._pcListeners = {};\n  this._pc = null;\n}\n\nHelpers.inherits(MediaPlugin, Plugin);\n\n/**\n * @see https://developer.mozilla.org/en-US/docs/Web/API/RTCPeerConnection/RTCPeerConnection#RTCConfiguration_dictionary\n * @typedef {Object} RTCConfiguration\n */\n\n/**\n * @param {RTCConfiguration} [options]\n * @returns {RTCPeerConnection}\n */\nMediaPlugin.prototype.createPeerConnection = function(options) {\n  options = Helpers.extend(options || {}, this._session._connection._options.pc);\n\n  var config = {\n    iceServers: [{urls: 'stun:stun.l.google.com:19302'}]\n  };\n  var constraints = {\n    'optional': [{'DtlsSrtpKeyAgreement': true}]\n  };\n  if (options.config) {\n    Helpers.extend(config, options.config);\n  }\n  if (options.constraints) {\n    Helpers.extend(constraints, options.constraints);\n  }\n\n  this._pc = new webrtcsupport.PeerConnection(config, constraints);\n  this._addPcEventListeners();\n  return this._pc;\n};\n\n/**\n * @returns {RTCPeerConnection|null}\n */\nMediaPlugin.prototype.getPeerConnection = function() {\n  return this._pc;\n};\n\n/**\n * @returns {Promise}\n */\nMediaPlugin.prototype.hangup = function() {\n  return new Promise(function(resolve, reject) {\n    this.once('hangup', resolve);\n    this.sendWithTransaction({janus: 'hangup'}).catch(reject);\n  }.bind(this));\n};\n\n/**\n * @see https://www.w3.org/TR/mediacapture-streams/#mediastreamtrack\n * @typedef {Object} MediaStreamTrack\n */\n\n/**\n * @param {MediaStreamTrack} track\n * @param {...MediaStream} [stream]\n */\nMediaPlugin.prototype.addTrack = function(track, stream) {\n  if (!this._pc.addTrack) {\n    //TODO remove this part as soon as pc.addTrack is supported by chrome or webrtc/adapter#361 is implemented\n    if (!stream) {\n      throw new Error('MediaPlugin.addTrack. Missing stream argument when pc.addTrack is not supported');\n    }\n    this._pc.addStream(stream);\n    this.emit('pc:track:local', {streams: [stream]});\n  } else {\n    this._pc.addTrack.apply(this._pc, arguments);\n    this.emit('pc:track:local', {track: track, streams: Array.prototype.slice.call(arguments, 1)});\n  }\n};\n\n/**\n * @param {MediaStreamConstraints} constraints\n * @returns {Promise}\n * @fulfilled {MediaStream} stream\n */\nMediaPlugin.prototype.getUserMedia = function(constraints) {\n  this.emit('consent-dialog:start');\n  var self = this;\n  var promise = MediaDevicesShim.getUserMedia(constraints);\n  return promise\n    .then(function(stream) {\n      self.emit('consent-dialog:stop', {stream: stream});\n      return stream;\n    })\n    .catch(function(error) {\n      self.emit('consent-dialog:stop', {error: error});\n      throw error;\n    })\n    .finally(function() {\n      if (promise.isCancelled()) {\n        self.emit('consent-dialog:stop');\n      }\n    });\n};\n\n/**\n * @see https://developer.mozilla.org/en-US/docs/Web/API/RTCPeerConnection/createOffer#RTCOfferOptions_dictionary\n * @typedef {Object} RTCOfferOptions\n */\n\n/**\n * @param {RTCOfferOptions} [options]\n * @returns {Promise}\n * @fulfilled {@link _createSDP}\n */\nMediaPlugin.prototype.createOffer = function(options) {\n  return this._createSDP('createOffer', options);\n};\n\n/**\n * @see https://developer.mozilla.org/en-US/docs/Web/API/RTCPeerConnection/createAnswer#RTCAnswerOptions_dictionary\n * @typedef {Object} RTCAnswerOptions\n */\n\n/**\n * @param {RTCSessionDescription} jsep\n * @param {RTCAnswerOptions} [options]\n * @returns {Promise}\n * @fulfilled {@link _createSDP}\n */\nMediaPlugin.prototype.createAnswer = function(jsep, options) {\n  var self = this;\n  return Promise.try(function() {\n    return self.setRemoteSDP(jsep);\n  }).then(function() {\n    return self._createSDP('createAnswer', options);\n  });\n};\n\n/**\n * @param {RTCSessionDescription} jsep\n * @returns {Promise}\n */\nMediaPlugin.prototype.setRemoteSDP = function(jsep) {\n  return this._pc.setRemoteDescription(new webrtcsupport.SessionDescription(jsep));\n};\n\n/**\n * @param {string} party\n * @param {RTCAnswerOptions|RTCOfferOptions} [options]\n * @returns {Promise}\n * @fulfilled {RTCSessionDescription} sdp\n */\nMediaPlugin.prototype._createSDP = function(party, options) {\n  if (!this._pc) {\n    throw new Error('Create PeerConnection before creating SDP for it');\n  }\n  if (['createOffer', 'createAnswer'].indexOf(party) < 0) {\n    throw new Error('Unknown party in _createSDP');\n  }\n\n  options = options || {};\n  var self = this;\n  return this._pc[party](options)\n    .then(function(description) {\n      return self._pc.setLocalDescription(description);\n    })\n    .then(function() {\n      return self._pc.localDescription;\n    });\n};\n\nMediaPlugin.prototype.processIncomeMessage = function(message) {\n  var self = this;\n  return Promise.try(function() {\n      return MediaPlugin.super_.prototype.processIncomeMessage.call(self, message);\n    })\n    .then(function(result) {\n      var janusType = message['janus'];\n      switch (janusType) {\n        case 'trickle':\n          self._onTrickle(message);\n          break;\n        case 'hangup':\n          self._onHangup(message);\n          break;\n      }\n      return result;\n    });\n};\n\n/**\n * @param {Object} incomeMessage\n */\nMediaPlugin.prototype._onTrickle = function(incomeMessage) {\n  var candidate = new webrtcsupport.IceCandidate(incomeMessage['candidate']);\n  this._pc.addIceCandidate(candidate).catch(function(error) {\n    this.emit('pc:error', error);\n  }.bind(this));\n};\n\n/**\n * @param {Object} incomeMessage\n */\nMediaPlugin.prototype._onHangup = function(incomeMessage) {\n  this.emit('hangup', incomeMessage);\n};\n\nMediaPlugin.prototype.closePeerConnection = function() {\n  if (this._pc) {\n    this._stopLocalMedia();\n    Object.keys(this._pcListeners)\n      .forEach(function(event) {\n        this._removePcEventListener(event);\n      }.bind(this));\n    this._pc.close();\n    this._pc = null;\n    this.emit('pc:close');\n  }\n};\n\nMediaPlugin.prototype._stopLocalMedia = function() {\n  var streams = this._pc.getLocalStreams();\n  streams.forEach(function(stream) {\n    if (stream.stop) {\n      stream.stop();\n    } else if (stream.getTracks) {\n      stream.getTracks().forEach(function(track) {\n        track.stop();\n      });\n    }\n  });\n};\n\nMediaPlugin.prototype._detach = function(message) {\n  this.closePeerConnection();\n  return MediaPlugin.super_.prototype._detach.apply(this, arguments);\n};\n\nMediaPlugin.prototype._addPcEventListeners = function() {\n  var self = this;\n\n  this._addPcEventListener('addstream', function(event) {\n    self.emit('pc:track:remote', {streams: [event.stream]});\n  });\n  this._addPcEventListener('track', function(event) {\n    self.emit('pc:track:remote', event);\n  });\n\n  this._addPcEventListener('icecandidate', function(event) {\n    if (event.candidate) {\n      self.send({janus: 'trickle', candidate: event.candidate});\n    } else {\n      self.send({janus: 'trickle', candidate: {completed: true}});\n      self._removePcEventListener('icecandidate');\n    }\n  });\n\n  this._addPcEventListener('signalingstatechange', function() {\n    if ('closed' == self._pc.signalingState) {\n      self.closePeerConnection();\n    }\n  });\n\n  this._addPcEventListener('iceconnectionstatechange', function() {\n    switch (self._pc.iceConnectionState) {\n      case 'closed':\n      case 'failed':\n        self.closePeerConnection();\n        break;\n    }\n  });\n};\n\nMediaPlugin.prototype._addPcEventListener = function(event, listener) {\n  this._pcListeners[event] = listener;\n  this._pc.addEventListener(event, listener);\n};\n\nMediaPlugin.prototype._removePcEventListener = function(event) {\n  this._pc.removeEventListener(event, this._pcListeners[event]);\n  delete this._pcListeners[event];\n};\n\nmodule.exports = MediaPlugin;\n","var Promise = require('bluebird');\nvar Helpers = require('../helpers');\nvar JanusPluginMessage = require('../janus-plugin-message');\nvar MediaEntityPlugin = require('./media-entity-plugin');\n\nfunction MediaStreamPlugin() {\n  MediaStreamPlugin.super_.apply(this, arguments);\n}\n\nHelpers.inherits(MediaStreamPlugin, MediaEntityPlugin);\n\n/**\n * @param {string|number} id\n * @param {Object} options\n * @returns {Promise}\n * @fulfilled {JanusPluginMessage} response\n */\nMediaStreamPlugin.prototype._create = function(id, options) {\n  options = Helpers.extend({id: id}, options);\n  return MediaStreamPlugin.super_.prototype._create.call(this, options);\n};\n\n/**\n * @param {string|number} id\n * @param {Object} options\n * @returns {Promise}\n * @fulfilled {JanusPluginMessage} response\n */\nMediaStreamPlugin.prototype._destroy = function(id, options) {\n  options = Helpers.extend({id: id}, options);\n  return MediaStreamPlugin.super_.prototype._destroy.call(this, id, options);\n};\n\n/**\n * @param {string|number} id\n * @param {Object} [watchOptions]\n * @param {Object} [answerOptions]\n * @returns {Promise}\n * @fulfilled {JanusPluginMessage} response\n */\nMediaStreamPlugin.prototype._watch = function(id, watchOptions, answerOptions) {\n  var plugin = this;\n  var body = Helpers.extend({request: 'watch', id: id}, watchOptions);\n  return this.sendWithTransaction({body: body})\n    .then(function(response) {\n      var jsep = response.get('jsep');\n      if (!jsep || 'offer' != jsep['type']) {\n        throw new Error('Expect offer response on watch request')\n      }\n      plugin.setCurrentEntity(id);\n      return plugin._offerAnswer(jsep, answerOptions).return(response);\n    });\n};\n\n/**\n * @param {RTCSessionDescription} [jsep]\n * @returns {Promise}\n * @fulfilled {JanusPluginMessage} response\n */\nMediaStreamPlugin.prototype._start = function(jsep) {\n  var message = {body: {request: 'start'}};\n  if (jsep) {\n    message.jsep = jsep;\n  }\n  return this.sendWithTransaction(message);\n};\n\n/**\n * @returns {Promise}\n * @fulfilled {JanusPluginMessage} response\n */\nMediaStreamPlugin.prototype._stop = function() {\n  return this.sendWithTransaction({body: {request: 'stop'}})\n    .then(function(response) {\n      this.resetCurrentEntity();\n      return response;\n    }.bind(this));\n};\n\n/**\n * @returns {Promise}\n * @fulfilled {JanusPluginMessage} response\n */\nMediaStreamPlugin.prototype._pause = function() {\n  return this.sendWithTransaction({body: {request: 'pause'}});\n};\n\n/**\n * @param {string|number} id\n * @param {Object} [options]\n * @returns {Promise}\n * @fulfilled {JanusPluginMessage} response\n */\nMediaStreamPlugin.prototype._switch = function(id, options) {\n  var body = Helpers.extend({\n    request: 'switch',\n    id: id\n  }, options);\n  return this.sendWithTransaction({body: body})\n    .then(function(response) {\n      this.setCurrentEntity(id);\n      return response;\n    }.bind(this));\n};\n\n/**\n * @param {string|number} id\n * @param {Object} [watchOptions]\n * @param {Object} [answerOptions]\n * @returns {Promise}\n * @fulfilled {JanusPluginMessage} response\n */\nMediaStreamPlugin.prototype.connect = function(id, watchOptions, answerOptions) {\n  if (this.hasCurrentEntity(id)) {\n    return Promise.resolve(new JanusPluginMessage({}, this));\n  }\n  if (this.hasCurrentEntity()) {\n    return this._switch(id, watchOptions);\n  }\n  return this._watch(id, watchOptions, answerOptions);\n};\n\n/**\n * @param {RTCSessionDescription} jsep\n * @param {RTCAnswerOptions} [answerOptions]\n * @returns {Promise}\n * @fulfilled {JanusPluginMessage} response\n */\nMediaStreamPlugin.prototype._offerAnswer = function(jsep, answerOptions) {\n  var self = this;\n  return Promise\n    .try(function() {\n      self.createPeerConnection();\n    })\n    .then(function() {\n      return self.createAnswer(jsep, answerOptions);\n    })\n    .then(function(jsep) {\n      return self.sendWithTransaction({janus: 'message', body: {request: 'start'}, jsep: jsep});\n    });\n};\n\nmodule.exports = MediaStreamPlugin;\n","var Helpers = require('../../helpers');\nvar Plugin = require('../../plugin');\nvar MediaAudioPlugin = require('../media-audio-plugin');\n\nfunction AudiobridgePlugin() {\n  AudiobridgePlugin.super_.apply(this, arguments);\n}\n\nAudiobridgePlugin.NAME = 'janus.plugin.audiobridge';\nHelpers.inherits(AudiobridgePlugin, MediaAudioPlugin);\nPlugin.register(AudiobridgePlugin.NAME, AudiobridgePlugin);\n\n/**\n * @see https://janus.conf.meetecho.com/docs/janus__audiobridge_8c.html\n * @param {number} roomId\n * @param {Object} [options]\n * @param {boolean} [options.permanent]\n * @param {string} [options.description]\n * @param {string} [options.secret]\n * @param {string} [options.pin]\n * @param {boolean} [options.is_private]\n * @param {number} [options.sampling]\n * @param {boolean} [options.record]\n * @param {string} [options.record_file]\n * @returns {Promise}\n * @fulfilled {JanusPluginMessage} response\n */\nAudiobridgePlugin.prototype.create = function(roomId, options) {\n  return this._create(Helpers.extend({room: roomId}, options));\n};\n\n/**\n * @param {number} roomId\n * @param {Object} [options]\n * @param {string} [options.secret]\n * @param {boolean} [options.permanent]\n * @returns {Promise}\n * @fulfilled {JanusPluginMessage} response\n */\nAudiobridgePlugin.prototype.destroy = function(roomId, options) {\n  return this._destroy(roomId, Helpers.extend({room: roomId}, options));\n};\n\n/**\n * @param {number} roomId\n * @param {Object} [options]\n * @param {number} [options.id]\n * @param {string} [options.pin]\n * @param {string} [options.display]\n * @param {boolean} [options.muted]\n * @param {number} [options.quality]\n * @returns {Promise}\n * @fulfilled {JanusPluginMessage} response\n */\nAudiobridgePlugin.prototype.join = function(roomId, options) {\n  options = Helpers.extend({room: roomId}, options);\n  return this._join(roomId, options);\n};\n\n/**\n * @param {number} roomId\n * @param {Object} [options]\n * @param {number} [options.id]\n * @param {string} [options.pin]\n * @param {string} [options.display]\n * @param {boolean} [options.muted]\n * @param {number} [options.quality]\n * @returns {Promise}\n * @fulfilled {JanusPluginMessage} response\n */\nAudiobridgePlugin.prototype.change = function(roomId, options) {\n  options = Helpers.extend({room: roomId}, options);\n  return this._change(roomId, options);\n};\n\n/**\n * @param {number} roomId\n * @param {Object} [options]\n * @param {number} [options.id]\n * @param {string} [options.display]\n * @param {boolean} [options.muted]\n * @param {number} [options.quality]\n * @returns {Promise}\n * @fulfilled {JanusPluginMessage} response\n */\nAudiobridgePlugin.prototype.connect = function(roomId, options) {\n  options = Helpers.extend({room: roomId}, options);\n  return this._connect(roomId, options);\n};\n\n/**\n * @param {number} roomId\n * @returns {Promise}\n * @fulfilled {Array} list\n */\nAudiobridgePlugin.prototype.listParticipants = function(roomId) {\n  return this._listParticipants({room: roomId});\n};\n\n/**\n * @inheritDoc\n */\nAudiobridgePlugin.prototype.getResponseAlias = function() {\n  return 'audiobridge';\n};\n\nmodule.exports = AudiobridgePlugin;\n","var Helpers = require('../../helpers');\nvar Plugin = require('../../plugin');\nvar MediaAudioPlugin = require('../media-audio-plugin');\n\nfunction AudioroomPlugin() {\n  AudioroomPlugin.super_.apply(this, arguments);\n}\n\nAudioroomPlugin.NAME = 'janus.plugin.cm.audioroom';\nHelpers.inherits(AudioroomPlugin, MediaAudioPlugin);\nPlugin.register(AudioroomPlugin.NAME, AudioroomPlugin);\n\n/**\n * @param {string} id\n * @param {Object} [options]\n * @param {string} [options.secret]\n * @param {boolean} [options.permanent]\n * @returns {Promise}\n * @fulfilled {JanusPluginMessage} response\n */\nAudioroomPlugin.prototype.destroy = function(id, options) {\n  return this._destroy(id, Helpers.extend({id: id}, options));\n};\n\n/**\n * @param {string} id\n * @param {Object} [options]\n * @param {number} [options.userid]\n * @param {string} [options.display]\n * @param {boolean} [options.muted]\n * @param {number} [options.quality]\n * @returns {Promise}\n * @fulfilled {JanusPluginMessage} response\n */\nAudioroomPlugin.prototype.join = function(id, options) {\n  options = Helpers.extend({id: id}, options);\n  return this._join(id, options);\n};\n\n/**\n * @param {string} id\n * @param {Object} [options] {@link join}\n * @returns {Promise}\n * @fulfilled {JanusPluginMessage} response\n */\nAudioroomPlugin.prototype.change = function(id, options) {\n  options = Helpers.extend({id: id}, options);\n  return this._change(id, options);\n};\n\n/**\n * @param {string} id\n * @param {Object} [options] {@link join}\n * @returns {Promise}\n * @fulfilled {JanusPluginMessage} response\n */\nAudioroomPlugin.prototype.connect = function(id, options) {\n  options = Helpers.extend({id: id}, options);\n  return this._connect(id, options);\n};\n\n/**\n * @param {string} id\n * @returns {Promise}\n * @fulfilled {Array} list\n */\nAudioroomPlugin.prototype.listParticipants = function(id) {\n  return this._listParticipants({id: id});\n};\n\n/**\n * @inheritDoc\n */\nAudioroomPlugin.prototype.getResponseAlias = function() {\n  return 'audioroom';\n};\n\nmodule.exports = AudioroomPlugin;\n","var Helpers = require('../../helpers');\nvar Plugin = require('../../plugin');\nvar MediaStreamPlugin = require('../media-stream-plugin');\n\nfunction RtpbroadcastPlugin() {\n  RtpbroadcastPlugin.super_.apply(this, arguments);\n}\n\nRtpbroadcastPlugin.NAME = 'janus.plugin.cm.rtpbroadcast';\nHelpers.inherits(RtpbroadcastPlugin, MediaStreamPlugin);\nPlugin.register(RtpbroadcastPlugin.NAME, RtpbroadcastPlugin);\n\n\n/**\n * {@link https://github.com/cargomedia/janus-gateway-rtpbroadcast#create}\n * @typedef {Object} StreamParams\n */\n\n/**\n * @param {string} id\n * @param {Object} [options]\n * @param {string} [options.name]\n * @param {string} [options.description]\n * @param {boolean} [options.recorded]\n * @param {string} [options.whitelist]\n * @param {StreamParams} [options.streams]\n * @returns {Promise}\n * @fulfilled {JanusPluginMessage} response\n */\nRtpbroadcastPlugin.prototype.create = function(id, options) {\n  return this._create(id, options);\n};\n\n/**\n * @param {string} id\n * @returns {Promise}\n * @fulfilled {JanusPluginMessage} response\n */\nRtpbroadcastPlugin.prototype.destroy = function(id) {\n  return this._destroy(id);\n};\n\n/**\n * @param {string} [id]\n * @returns {Promise}\n * @fulfilled {Array} list\n */\nRtpbroadcastPlugin.prototype.list = function(id) {\n  return this._list(id);\n};\n\n/**\n * @param {string} id\n * @param {Object} [answerOptions] {@link createAnswer}\n * @returns {Promise}\n * @fulfilled {JanusPluginMessage} response\n */\nRtpbroadcastPlugin.prototype.watch = function(id, answerOptions) {\n  return this._watch(id, null, answerOptions);\n};\n\n/**\n * @param {string} id\n * @param {Array} streams\n * @returns {Promise}\n * @fulfilled {JanusPluginMessage} response\n */\nRtpbroadcastPlugin.prototype.watchUDP = function(id, streams) {\n  return this.sendWithTransaction({body: {request: 'watch-udp', id: id, streams: streams}});\n};\n\n/**\n * @returns {Promise}\n * @fulfilled {JanusPluginMessage} response\n */\nRtpbroadcastPlugin.prototype.start = function() {\n  return this._start();\n};\n\n/**\n * @returns {Promise}\n * @fulfilled {JanusPluginMessage} response\n */\nRtpbroadcastPlugin.prototype.stop = function() {\n  return this._stop();\n};\n\n/**\n * @returns {Promise}\n * @fulfilled {JanusPluginMessage} response\n */\nRtpbroadcastPlugin.prototype.pause = function() {\n  return this._pause();\n};\n\n/**\n * @param {string} id\n * @returns {Promise}\n * @fulfilled {JanusPluginMessage} response\n */\nRtpbroadcastPlugin.prototype.switch = function(id) {\n  return this._switch(id);\n};\n\n/**\n * @param {number} index\n * @returns {Promise}\n * @fulfilled {JanusPluginMessage} response\n */\nRtpbroadcastPlugin.prototype.switchSource = function(index) {\n  return this.sendWithTransaction({body: {request: 'switch-source', index: index}});\n};\n\n/**\n * @param {boolean} enabled\n * @returns {Promise}\n * @fulfilled {JanusPluginMessage} response\n */\nRtpbroadcastPlugin.prototype.superuser = function(enabled) {\n  return this.sendWithTransaction({body: {request: 'superuser', enabled: enabled}});\n};\n\n/**\n * @inheritDoc\n */\nRtpbroadcastPlugin.prototype.getResponseAlias = function() {\n  return 'streaming';\n};\n\nmodule.exports = RtpbroadcastPlugin;\n","var Helpers = require('../../helpers');\nvar Plugin = require('../../plugin');\nvar MediaStreamPlugin = require('../media-stream-plugin');\n\nfunction StreamingPlugin() {\n  StreamingPlugin.super_.apply(this, arguments);\n}\n\nStreamingPlugin.NAME = 'janus.plugin.streaming';\nHelpers.inherits(StreamingPlugin, MediaStreamPlugin);\nPlugin.register(StreamingPlugin.NAME, StreamingPlugin);\n\n/**\n * @see https://janus.conf.meetecho.com/docs/janus__streaming_8c.html\n * @param {number} id\n * @param {Object} [options]\n * @param {string} [options.type]\n * @param {string} [options.secret]\n * @param {string} [options.pin]\n * @param {boolean} [options.permanent]\n * @param {string} [options.description]\n * @param {boolean} [options.is_private]\n * @param {string} [options.filename]\n * @param {boolean} [options.audio]\n * @param {boolean} [options.video]\n * @param {number} [options.audioport]\n * @param {string} [options.audiomcast]\n * @param {number} [options.audiopt]\n * @param {string} [options.audiortpmap]\n * @param {string} [options.audiofmtp]\n * @param {number} [options.videoport]\n * @param {string} [options.videomcast]\n * @param {number} [options.videopt]\n * @param {string} [options.videortpmap]\n * @param {string} [options.videofmtp]\n * @param {boolean} [options.videobufferkf]\n * @param {string} [options.url]\n * @returns {Promise}\n * @fulfilled {JanusPluginMessage} response\n */\nStreamingPlugin.prototype.create = function(id, options) {\n  return this._create(id, options);\n};\n\n/**\n * @param {number} id\n * @param {Object} [options]\n * @param {string} [options.secret]\n * @param {boolean} [options.permanent]\n * @returns {Promise}\n * @fulfilled {JanusPluginMessage} response\n */\nStreamingPlugin.prototype.destroy = function(id, options) {\n  return this._destroy(id, options);\n};\n\n/**\n * @returns {Promise}\n * @fulfilled {JanusPluginMessage} response\n */\nStreamingPlugin.prototype.list = function() {\n  return this._list();\n};\n\n/**\n * @param {number} id\n * @param {Object} [watchOptions]\n * @param {string} [watchOptions.pin]\n * @param {Object} [answerOptions] {@link createAnswer}\n * @returns {Promise}\n * @fulfilled {JanusPluginMessage} response\n */\nStreamingPlugin.prototype.watch = function(id, watchOptions, answerOptions) {\n  return this._watch(id, watchOptions, answerOptions);\n};\n\n/**\n * @param {RTCSessionDescription} [jsep]\n * @returns {Promise}\n * @fulfilled {JanusPluginMessage} response\n */\nStreamingPlugin.prototype.start = function(jsep) {\n  return this._start(jsep);\n};\n\n/**\n * @returns {Promise}\n * @fulfilled {JanusPluginMessage} response\n */\nStreamingPlugin.prototype.stop = function() {\n  return this._stop();\n};\n\n/**\n * @returns {Promise}\n * @fulfilled {JanusPluginMessage} response\n */\nStreamingPlugin.prototype.pause = function() {\n  return this._pause();\n};\n\n/**\n * @param {number} mountpointId\n * @param {Object} [options] {@link watch}\n * @returns {Promise}\n * @fulfilled {JanusPluginMessage} response\n */\nStreamingPlugin.prototype.switch = function(mountpointId, options) {\n  return this._switch(mountpointId, options);\n};\n\n/**\n * @param {number} mountpointId\n * @param {Object} [options]\n * @param {string} [options.secret]\n * @returns {Promise}\n * @fulfilled {JanusPluginMessage} response\n */\nStreamingPlugin.prototype.enable = function(mountpointId, options) {\n  var body = Helpers.extend({\n    request: 'enable',\n    id: mountpointId\n  }, options);\n  return this.sendWithTransaction({body: body})\n};\n\n/**\n * @param {number} mountpointId\n * @param {Object} [options]\n * @param {string} [options.secret]\n * @returns {Promise}\n * @fulfilled {JanusPluginMessage} response\n */\nStreamingPlugin.prototype.disable = function(mountpointId, options) {\n  var body = Helpers.extend({\n    request: 'disable',\n    id: mountpointId\n  }, options);\n  return this.sendWithTransaction({body: body})\n    .then(function() {\n      if (this.hasCurrentEntity(mountpointId)) {\n        this.resetCurrentEntity();\n      }\n    }.bind(this));\n};\n\n/**\n * @param {number} mountpointId\n * @param {Object} [options]\n * @param {string} [options.secret]\n * @param {string} [options.action]\n * @param {string} [options.audio]\n * @param {string} [options.video]\n * @returns {Promise}\n * @fulfilled {JanusPluginMessage} response\n */\nStreamingPlugin.prototype.recording = function(mountpointId, options) {\n  var body = Helpers.extend({\n    request: 'recording',\n    id: mountpointId\n  }, options);\n  return this.sendWithTransaction({body: body});\n};\n\n/**\n * @inheritDoc\n */\nStreamingPlugin.prototype.getResponseAlias = function() {\n  return 'streaming';\n};\n\nmodule.exports = StreamingPlugin;\n","var Promise = require('bluebird');\nvar WebSocket = require('websocket').w3cwebsocket;\nvar EventEmitter = require('./event-emitter');\nvar Helpers = require('./helpers');\n\n/**\n * @param {WebSocket} [webSocket]\n * @constructor\n * @extends EventEmitter\n */\nfunction WebsocketConnection(webSocket) {\n  WebsocketConnection.super_.call(this);\n  /** @type {WebSocket} */\n  this._webSocket = webSocket;\n\n  if (this._webSocket) {\n    this._onOpen(this._webSocket);\n  }\n}\n\nHelpers.inherits(WebsocketConnection, EventEmitter);\n\n/**\n * @param {string} address\n * @param {string} protocol\n * @returns {Promise}\n * @fulfilled {WebsocketConnection} websocketConnection - when it is opened\n */\nWebsocketConnection.prototype.open = function(address, protocol) {\n  var self = this;\n  return new Promise(function(resolve, reject) {\n    var webSocket = new WebSocket(address, protocol || '');\n    webSocket.onerror = reject;\n    webSocket.onclose = reject;\n    webSocket.onopen = function() {\n      webSocket.onerror = null;\n      webSocket.onclose = null;\n      self._onOpen(webSocket);\n      resolve(self);\n    };\n  });\n};\n\n/**\n * @param {Object|WebSocket} webSocket\n * @protected\n */\nWebsocketConnection.prototype._onOpen = function(webSocket) {\n  this._webSocket = webSocket;\n  if (typeof webSocket.readyState !== 'undefined') {\n    this._installW3cListeners();\n  }\n  else if (webSocket.on) {\n    this._installNodeListeners();\n  }\n  else {\n    throw new Error('Trying to instantiate WebsocketConnection with unknown Websocket');\n  }\n  this.emit('open');\n};\n\n/**\n * @protected\n */\nWebsocketConnection.prototype._installW3cListeners = function() {\n  this._webSocket.onmessage = function(message) {\n    var parsedMessage = JSON.parse(message.data);\n    this.onMessage(parsedMessage);\n  }.bind(this);\n\n  this._webSocket.onerror = function(error) {\n    this.emit('error', error);\n  }.bind(this);\n\n  this._webSocket.onclose = function() {\n    this._close();\n  }.bind(this);\n};\n\n/**\n * @protected\n */\nWebsocketConnection.prototype._installNodeListeners = function() {\n  this._webSocket.on('message', function(message) {\n    var parsedMessage = JSON.parse(message);\n    this.onMessage(parsedMessage);\n  }.bind(this));\n\n  this._webSocket.on('error', function(error) {\n    this.emit('error', error);\n  }.bind(this));\n\n  this._webSocket.on('close', function() {\n    this._close();\n  }.bind(this));\n};\n\n/**\n * @returns {boolean}\n */\nWebsocketConnection.prototype.isOpened = function() {\n  return this._webSocket && this._webSocket.OPEN === this._webSocket.readyState;\n};\n\n/**\n * @returns {boolean}\n */\nWebsocketConnection.prototype.isClosed = function() {\n  return !this._webSocket || this._webSocket.CLOSED === this._webSocket.readyState || this._webSocket.CLOSING === this._webSocket.readyState;\n};\n\n/**\n * @returns {Promise}\n */\nWebsocketConnection.prototype.close = function() {\n  if (this.isClosed()) {\n    return Promise.resolve();\n  }\n  return new Promise(function(resolve) {\n    this._close();\n    resolve();\n  }.bind(this));\n};\n\nWebsocketConnection.prototype._close = function() {\n  if (!this.isClosed()) {\n    if (this._webSocket.terminate) {\n      this._webSocket.terminate();\n    } else {\n      this._webSocket.close();\n    }\n  }\n  this.emit('close');\n};\n\n/**\n * @param {Object} message\n * @returns {Promise}\n */\nWebsocketConnection.prototype.send = function(message) {\n  if (this.isOpened()) {\n    return this._send(message);\n  }\n  else if (!this._webSocket || this._webSocket.CONNECTING === this._webSocket.readyState) {\n    return this._queue(message);\n  }\n  else {\n    return Promise.reject(new Error('Can not send message over closed connection'));\n  }\n};\n\n/**\n * @param {Object} message\n */\nWebsocketConnection.prototype.onMessage = function(message) {\n  try {\n    this.emit('message', message);\n  } catch (error) {\n    this.emit('error', error);\n  }\n};\n\n/**\n * @param {Object} message\n * @returns {Promise}\n * @protected\n */\nWebsocketConnection.prototype._queue = function(message) {\n  return new Promise(function(resolve) {\n    this.once('open', function() {\n      this._send(message).then(function() {\n        resolve();\n      });\n    }.bind(this));\n  }.bind(this));\n};\n\n/**\n * @param {Object} message\n * @returns {Promise}\n * @protected\n */\nWebsocketConnection.prototype._send = function(message) {\n  return new Promise(function(resolve) {\n    this._webSocket.send(JSON.stringify(message));\n    resolve();\n  }.bind(this));\n};\n\nmodule.exports = WebsocketConnection;\n","/*\n *  Copyright (c) 2017 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nvar SDPUtils = require('sdp');\n\nfunction fixStatsType(stat) {\n  return {\n    inboundrtp: 'inbound-rtp',\n    outboundrtp: 'outbound-rtp',\n    candidatepair: 'candidate-pair',\n    localcandidate: 'local-candidate',\n    remotecandidate: 'remote-candidate'\n  }[stat.type] || stat.type;\n}\n\nfunction writeMediaSection(transceiver, caps, type, stream, dtlsRole) {\n  var sdp = SDPUtils.writeRtpDescription(transceiver.kind, caps);\n\n  // Map ICE parameters (ufrag, pwd) to SDP.\n  sdp += SDPUtils.writeIceParameters(\n      transceiver.iceGatherer.getLocalParameters());\n\n  // Map DTLS parameters to SDP.\n  sdp += SDPUtils.writeDtlsParameters(\n      transceiver.dtlsTransport.getLocalParameters(),\n      type === 'offer' ? 'actpass' : dtlsRole || 'active');\n\n  sdp += 'a=mid:' + transceiver.mid + '\\r\\n';\n\n  if (transceiver.rtpSender && transceiver.rtpReceiver) {\n    sdp += 'a=sendrecv\\r\\n';\n  } else if (transceiver.rtpSender) {\n    sdp += 'a=sendonly\\r\\n';\n  } else if (transceiver.rtpReceiver) {\n    sdp += 'a=recvonly\\r\\n';\n  } else {\n    sdp += 'a=inactive\\r\\n';\n  }\n\n  if (transceiver.rtpSender) {\n    var trackId = transceiver.rtpSender._initialTrackId ||\n        transceiver.rtpSender.track.id;\n    transceiver.rtpSender._initialTrackId = trackId;\n    // spec.\n    var msid = 'msid:' + (stream ? stream.id : '-') + ' ' +\n        trackId + '\\r\\n';\n    sdp += 'a=' + msid;\n    // for Chrome. Legacy should no longer be required.\n    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\n        ' ' + msid;\n\n    // RTX\n    if (transceiver.sendEncodingParameters[0].rtx) {\n      sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\n          ' ' + msid;\n      sdp += 'a=ssrc-group:FID ' +\n          transceiver.sendEncodingParameters[0].ssrc + ' ' +\n          transceiver.sendEncodingParameters[0].rtx.ssrc +\n          '\\r\\n';\n    }\n  }\n  // FIXME: this should be written by writeRtpDescription.\n  sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\n      ' cname:' + SDPUtils.localCName + '\\r\\n';\n  if (transceiver.rtpSender && transceiver.sendEncodingParameters[0].rtx) {\n    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\n        ' cname:' + SDPUtils.localCName + '\\r\\n';\n  }\n  return sdp;\n}\n\n// Edge does not like\n// 1) stun: filtered after 14393 unless ?transport=udp is present\n// 2) turn: that does not have all of turn:host:port?transport=udp\n// 3) turn: with ipv6 addresses\n// 4) turn: occurring muliple times\nfunction filterIceServers(iceServers, edgeVersion) {\n  var hasTurn = false;\n  iceServers = JSON.parse(JSON.stringify(iceServers));\n  return iceServers.filter(function(server) {\n    if (server && (server.urls || server.url)) {\n      var urls = server.urls || server.url;\n      if (server.url && !server.urls) {\n        console.warn('RTCIceServer.url is deprecated! Use urls instead.');\n      }\n      var isString = typeof urls === 'string';\n      if (isString) {\n        urls = [urls];\n      }\n      urls = urls.filter(function(url) {\n        var validTurn = url.indexOf('turn:') === 0 &&\n            url.indexOf('transport=udp') !== -1 &&\n            url.indexOf('turn:[') === -1 &&\n            !hasTurn;\n\n        if (validTurn) {\n          hasTurn = true;\n          return true;\n        }\n        return url.indexOf('stun:') === 0 && edgeVersion >= 14393 &&\n            url.indexOf('?transport=udp') === -1;\n      });\n\n      delete server.url;\n      server.urls = isString ? urls[0] : urls;\n      return !!urls.length;\n    }\n  });\n}\n\n// Determines the intersection of local and remote capabilities.\nfunction getCommonCapabilities(localCapabilities, remoteCapabilities) {\n  var commonCapabilities = {\n    codecs: [],\n    headerExtensions: [],\n    fecMechanisms: []\n  };\n\n  var findCodecByPayloadType = function(pt, codecs) {\n    pt = parseInt(pt, 10);\n    for (var i = 0; i < codecs.length; i++) {\n      if (codecs[i].payloadType === pt ||\n          codecs[i].preferredPayloadType === pt) {\n        return codecs[i];\n      }\n    }\n  };\n\n  var rtxCapabilityMatches = function(lRtx, rRtx, lCodecs, rCodecs) {\n    var lCodec = findCodecByPayloadType(lRtx.parameters.apt, lCodecs);\n    var rCodec = findCodecByPayloadType(rRtx.parameters.apt, rCodecs);\n    return lCodec && rCodec &&\n        lCodec.name.toLowerCase() === rCodec.name.toLowerCase();\n  };\n\n  localCapabilities.codecs.forEach(function(lCodec) {\n    for (var i = 0; i < remoteCapabilities.codecs.length; i++) {\n      var rCodec = remoteCapabilities.codecs[i];\n      if (lCodec.name.toLowerCase() === rCodec.name.toLowerCase() &&\n          lCodec.clockRate === rCodec.clockRate) {\n        if (lCodec.name.toLowerCase() === 'rtx' &&\n            lCodec.parameters && rCodec.parameters.apt) {\n          // for RTX we need to find the local rtx that has a apt\n          // which points to the same local codec as the remote one.\n          if (!rtxCapabilityMatches(lCodec, rCodec,\n              localCapabilities.codecs, remoteCapabilities.codecs)) {\n            continue;\n          }\n        }\n        rCodec = JSON.parse(JSON.stringify(rCodec)); // deepcopy\n        // number of channels is the highest common number of channels\n        rCodec.numChannels = Math.min(lCodec.numChannels,\n            rCodec.numChannels);\n        // push rCodec so we reply with offerer payload type\n        commonCapabilities.codecs.push(rCodec);\n\n        // determine common feedback mechanisms\n        rCodec.rtcpFeedback = rCodec.rtcpFeedback.filter(function(fb) {\n          for (var j = 0; j < lCodec.rtcpFeedback.length; j++) {\n            if (lCodec.rtcpFeedback[j].type === fb.type &&\n                lCodec.rtcpFeedback[j].parameter === fb.parameter) {\n              return true;\n            }\n          }\n          return false;\n        });\n        // FIXME: also need to determine .parameters\n        //  see https://github.com/openpeer/ortc/issues/569\n        break;\n      }\n    }\n  });\n\n  localCapabilities.headerExtensions.forEach(function(lHeaderExtension) {\n    for (var i = 0; i < remoteCapabilities.headerExtensions.length;\n         i++) {\n      var rHeaderExtension = remoteCapabilities.headerExtensions[i];\n      if (lHeaderExtension.uri === rHeaderExtension.uri) {\n        commonCapabilities.headerExtensions.push(rHeaderExtension);\n        break;\n      }\n    }\n  });\n\n  // FIXME: fecMechanisms\n  return commonCapabilities;\n}\n\n// is action=setLocalDescription with type allowed in signalingState\nfunction isActionAllowedInSignalingState(action, type, signalingState) {\n  return {\n    offer: {\n      setLocalDescription: ['stable', 'have-local-offer'],\n      setRemoteDescription: ['stable', 'have-remote-offer']\n    },\n    answer: {\n      setLocalDescription: ['have-remote-offer', 'have-local-pranswer'],\n      setRemoteDescription: ['have-local-offer', 'have-remote-pranswer']\n    }\n  }[type][action].indexOf(signalingState) !== -1;\n}\n\nfunction maybeAddCandidate(iceTransport, candidate) {\n  // Edge's internal representation adds some fields therefore\n  // not all field are taken into account.\n  var alreadyAdded = iceTransport.getRemoteCandidates()\n      .find(function(remoteCandidate) {\n        return candidate.foundation === remoteCandidate.foundation &&\n            candidate.ip === remoteCandidate.ip &&\n            candidate.port === remoteCandidate.port &&\n            candidate.priority === remoteCandidate.priority &&\n            candidate.protocol === remoteCandidate.protocol &&\n            candidate.type === remoteCandidate.type;\n      });\n  if (!alreadyAdded) {\n    iceTransport.addRemoteCandidate(candidate);\n  }\n  return !alreadyAdded;\n}\n\n\nfunction makeError(name, description) {\n  var e = new Error(description);\n  e.name = name;\n  // legacy error codes from https://heycam.github.io/webidl/#idl-DOMException-error-names\n  e.code = {\n    NotSupportedError: 9,\n    InvalidStateError: 11,\n    InvalidAccessError: 15,\n    TypeError: undefined,\n    OperationError: undefined\n  }[name];\n  return e;\n}\n\nmodule.exports = function(window, edgeVersion) {\n  // https://w3c.github.io/mediacapture-main/#mediastream\n  // Helper function to add the track to the stream and\n  // dispatch the event ourselves.\n  function addTrackToStreamAndFireEvent(track, stream) {\n    stream.addTrack(track);\n    stream.dispatchEvent(new window.MediaStreamTrackEvent('addtrack',\n        {track: track}));\n  }\n\n  function removeTrackFromStreamAndFireEvent(track, stream) {\n    stream.removeTrack(track);\n    stream.dispatchEvent(new window.MediaStreamTrackEvent('removetrack',\n        {track: track}));\n  }\n\n  function fireAddTrack(pc, track, receiver, streams) {\n    var trackEvent = new Event('track');\n    trackEvent.track = track;\n    trackEvent.receiver = receiver;\n    trackEvent.transceiver = {receiver: receiver};\n    trackEvent.streams = streams;\n    window.setTimeout(function() {\n      pc._dispatchEvent('track', trackEvent);\n    });\n  }\n\n  var RTCPeerConnection = function(config) {\n    var pc = this;\n\n    var _eventTarget = document.createDocumentFragment();\n    ['addEventListener', 'removeEventListener', 'dispatchEvent']\n        .forEach(function(method) {\n          pc[method] = _eventTarget[method].bind(_eventTarget);\n        });\n\n    this.canTrickleIceCandidates = null;\n\n    this.needNegotiation = false;\n\n    this.localStreams = [];\n    this.remoteStreams = [];\n\n    this._localDescription = null;\n    this._remoteDescription = null;\n\n    this.signalingState = 'stable';\n    this.iceConnectionState = 'new';\n    this.connectionState = 'new';\n    this.iceGatheringState = 'new';\n\n    config = JSON.parse(JSON.stringify(config || {}));\n\n    this.usingBundle = config.bundlePolicy === 'max-bundle';\n    if (config.rtcpMuxPolicy === 'negotiate') {\n      throw(makeError('NotSupportedError',\n          'rtcpMuxPolicy \\'negotiate\\' is not supported'));\n    } else if (!config.rtcpMuxPolicy) {\n      config.rtcpMuxPolicy = 'require';\n    }\n\n    switch (config.iceTransportPolicy) {\n      case 'all':\n      case 'relay':\n        break;\n      default:\n        config.iceTransportPolicy = 'all';\n        break;\n    }\n\n    switch (config.bundlePolicy) {\n      case 'balanced':\n      case 'max-compat':\n      case 'max-bundle':\n        break;\n      default:\n        config.bundlePolicy = 'balanced';\n        break;\n    }\n\n    config.iceServers = filterIceServers(config.iceServers || [], edgeVersion);\n\n    this._iceGatherers = [];\n    if (config.iceCandidatePoolSize) {\n      for (var i = config.iceCandidatePoolSize; i > 0; i--) {\n        this._iceGatherers.push(new window.RTCIceGatherer({\n          iceServers: config.iceServers,\n          gatherPolicy: config.iceTransportPolicy\n        }));\n      }\n    } else {\n      config.iceCandidatePoolSize = 0;\n    }\n\n    this._config = config;\n\n    // per-track iceGathers, iceTransports, dtlsTransports, rtpSenders, ...\n    // everything that is needed to describe a SDP m-line.\n    this.transceivers = [];\n\n    this._sdpSessionId = SDPUtils.generateSessionId();\n    this._sdpSessionVersion = 0;\n\n    this._dtlsRole = undefined; // role for a=setup to use in answers.\n\n    this._isClosed = false;\n  };\n\n  Object.defineProperty(RTCPeerConnection.prototype, 'localDescription', {\n    configurable: true,\n    get: function() {\n      return this._localDescription;\n    }\n  });\n  Object.defineProperty(RTCPeerConnection.prototype, 'remoteDescription', {\n    configurable: true,\n    get: function() {\n      return this._remoteDescription;\n    }\n  });\n\n  // set up event handlers on prototype\n  RTCPeerConnection.prototype.onicecandidate = null;\n  RTCPeerConnection.prototype.onaddstream = null;\n  RTCPeerConnection.prototype.ontrack = null;\n  RTCPeerConnection.prototype.onremovestream = null;\n  RTCPeerConnection.prototype.onsignalingstatechange = null;\n  RTCPeerConnection.prototype.oniceconnectionstatechange = null;\n  RTCPeerConnection.prototype.onconnectionstatechange = null;\n  RTCPeerConnection.prototype.onicegatheringstatechange = null;\n  RTCPeerConnection.prototype.onnegotiationneeded = null;\n  RTCPeerConnection.prototype.ondatachannel = null;\n\n  RTCPeerConnection.prototype._dispatchEvent = function(name, event) {\n    if (this._isClosed) {\n      return;\n    }\n    this.dispatchEvent(event);\n    if (typeof this['on' + name] === 'function') {\n      this['on' + name](event);\n    }\n  };\n\n  RTCPeerConnection.prototype._emitGatheringStateChange = function() {\n    var event = new Event('icegatheringstatechange');\n    this._dispatchEvent('icegatheringstatechange', event);\n  };\n\n  RTCPeerConnection.prototype.getConfiguration = function() {\n    return this._config;\n  };\n\n  RTCPeerConnection.prototype.getLocalStreams = function() {\n    return this.localStreams;\n  };\n\n  RTCPeerConnection.prototype.getRemoteStreams = function() {\n    return this.remoteStreams;\n  };\n\n  // internal helper to create a transceiver object.\n  // (which is not yet the same as the WebRTC 1.0 transceiver)\n  RTCPeerConnection.prototype._createTransceiver = function(kind, doNotAdd) {\n    var hasBundleTransport = this.transceivers.length > 0;\n    var transceiver = {\n      track: null,\n      iceGatherer: null,\n      iceTransport: null,\n      dtlsTransport: null,\n      localCapabilities: null,\n      remoteCapabilities: null,\n      rtpSender: null,\n      rtpReceiver: null,\n      kind: kind,\n      mid: null,\n      sendEncodingParameters: null,\n      recvEncodingParameters: null,\n      stream: null,\n      associatedRemoteMediaStreams: [],\n      wantReceive: true\n    };\n    if (this.usingBundle && hasBundleTransport) {\n      transceiver.iceTransport = this.transceivers[0].iceTransport;\n      transceiver.dtlsTransport = this.transceivers[0].dtlsTransport;\n    } else {\n      var transports = this._createIceAndDtlsTransports();\n      transceiver.iceTransport = transports.iceTransport;\n      transceiver.dtlsTransport = transports.dtlsTransport;\n    }\n    if (!doNotAdd) {\n      this.transceivers.push(transceiver);\n    }\n    return transceiver;\n  };\n\n  RTCPeerConnection.prototype.addTrack = function(track, stream) {\n    if (this._isClosed) {\n      throw makeError('InvalidStateError',\n          'Attempted to call addTrack on a closed peerconnection.');\n    }\n\n    var alreadyExists = this.transceivers.find(function(s) {\n      return s.track === track;\n    });\n\n    if (alreadyExists) {\n      throw makeError('InvalidAccessError', 'Track already exists.');\n    }\n\n    var transceiver;\n    for (var i = 0; i < this.transceivers.length; i++) {\n      if (!this.transceivers[i].track &&\n          this.transceivers[i].kind === track.kind) {\n        transceiver = this.transceivers[i];\n      }\n    }\n    if (!transceiver) {\n      transceiver = this._createTransceiver(track.kind);\n    }\n\n    this._maybeFireNegotiationNeeded();\n\n    if (this.localStreams.indexOf(stream) === -1) {\n      this.localStreams.push(stream);\n    }\n\n    transceiver.track = track;\n    transceiver.stream = stream;\n    transceiver.rtpSender = new window.RTCRtpSender(track,\n        transceiver.dtlsTransport);\n    return transceiver.rtpSender;\n  };\n\n  RTCPeerConnection.prototype.addStream = function(stream) {\n    var pc = this;\n    if (edgeVersion >= 15025) {\n      stream.getTracks().forEach(function(track) {\n        pc.addTrack(track, stream);\n      });\n    } else {\n      // Clone is necessary for local demos mostly, attaching directly\n      // to two different senders does not work (build 10547).\n      // Fixed in 15025 (or earlier)\n      var clonedStream = stream.clone();\n      stream.getTracks().forEach(function(track, idx) {\n        var clonedTrack = clonedStream.getTracks()[idx];\n        track.addEventListener('enabled', function(event) {\n          clonedTrack.enabled = event.enabled;\n        });\n      });\n      clonedStream.getTracks().forEach(function(track) {\n        pc.addTrack(track, clonedStream);\n      });\n    }\n  };\n\n  RTCPeerConnection.prototype.removeTrack = function(sender) {\n    if (this._isClosed) {\n      throw makeError('InvalidStateError',\n          'Attempted to call removeTrack on a closed peerconnection.');\n    }\n\n    if (!(sender instanceof window.RTCRtpSender)) {\n      throw new TypeError('Argument 1 of RTCPeerConnection.removeTrack ' +\n          'does not implement interface RTCRtpSender.');\n    }\n\n    var transceiver = this.transceivers.find(function(t) {\n      return t.rtpSender === sender;\n    });\n\n    if (!transceiver) {\n      throw makeError('InvalidAccessError',\n          'Sender was not created by this connection.');\n    }\n    var stream = transceiver.stream;\n\n    transceiver.rtpSender.stop();\n    transceiver.rtpSender = null;\n    transceiver.track = null;\n    transceiver.stream = null;\n\n    // remove the stream from the set of local streams\n    var localStreams = this.transceivers.map(function(t) {\n      return t.stream;\n    });\n    if (localStreams.indexOf(stream) === -1 &&\n        this.localStreams.indexOf(stream) > -1) {\n      this.localStreams.splice(this.localStreams.indexOf(stream), 1);\n    }\n\n    this._maybeFireNegotiationNeeded();\n  };\n\n  RTCPeerConnection.prototype.removeStream = function(stream) {\n    var pc = this;\n    stream.getTracks().forEach(function(track) {\n      var sender = pc.getSenders().find(function(s) {\n        return s.track === track;\n      });\n      if (sender) {\n        pc.removeTrack(sender);\n      }\n    });\n  };\n\n  RTCPeerConnection.prototype.getSenders = function() {\n    return this.transceivers.filter(function(transceiver) {\n      return !!transceiver.rtpSender;\n    })\n    .map(function(transceiver) {\n      return transceiver.rtpSender;\n    });\n  };\n\n  RTCPeerConnection.prototype.getReceivers = function() {\n    return this.transceivers.filter(function(transceiver) {\n      return !!transceiver.rtpReceiver;\n    })\n    .map(function(transceiver) {\n      return transceiver.rtpReceiver;\n    });\n  };\n\n\n  RTCPeerConnection.prototype._createIceGatherer = function(sdpMLineIndex,\n      usingBundle) {\n    var pc = this;\n    if (usingBundle && sdpMLineIndex > 0) {\n      return this.transceivers[0].iceGatherer;\n    } else if (this._iceGatherers.length) {\n      return this._iceGatherers.shift();\n    }\n    var iceGatherer = new window.RTCIceGatherer({\n      iceServers: this._config.iceServers,\n      gatherPolicy: this._config.iceTransportPolicy\n    });\n    Object.defineProperty(iceGatherer, 'state',\n        {value: 'new', writable: true}\n    );\n\n    this.transceivers[sdpMLineIndex].bufferedCandidateEvents = [];\n    this.transceivers[sdpMLineIndex].bufferCandidates = function(event) {\n      var end = !event.candidate || Object.keys(event.candidate).length === 0;\n      // polyfill since RTCIceGatherer.state is not implemented in\n      // Edge 10547 yet.\n      iceGatherer.state = end ? 'completed' : 'gathering';\n      if (pc.transceivers[sdpMLineIndex].bufferedCandidateEvents !== null) {\n        pc.transceivers[sdpMLineIndex].bufferedCandidateEvents.push(event);\n      }\n    };\n    iceGatherer.addEventListener('localcandidate',\n      this.transceivers[sdpMLineIndex].bufferCandidates);\n    return iceGatherer;\n  };\n\n  // start gathering from an RTCIceGatherer.\n  RTCPeerConnection.prototype._gather = function(mid, sdpMLineIndex) {\n    var pc = this;\n    var iceGatherer = this.transceivers[sdpMLineIndex].iceGatherer;\n    if (iceGatherer.onlocalcandidate) {\n      return;\n    }\n    var bufferedCandidateEvents =\n      this.transceivers[sdpMLineIndex].bufferedCandidateEvents;\n    this.transceivers[sdpMLineIndex].bufferedCandidateEvents = null;\n    iceGatherer.removeEventListener('localcandidate',\n      this.transceivers[sdpMLineIndex].bufferCandidates);\n    iceGatherer.onlocalcandidate = function(evt) {\n      if (pc.usingBundle && sdpMLineIndex > 0) {\n        // if we know that we use bundle we can drop candidates with\n        // dpMLineIndex > 0. If we don't do this then our state gets\n        // confused since we dispose the extra ice gatherer.\n        return;\n      }\n      var event = new Event('icecandidate');\n      event.candidate = {sdpMid: mid, sdpMLineIndex: sdpMLineIndex};\n\n      var cand = evt.candidate;\n      // Edge emits an empty object for RTCIceCandidateComplete\n      var end = !cand || Object.keys(cand).length === 0;\n      if (end) {\n        // polyfill since RTCIceGatherer.state is not implemented in\n        // Edge 10547 yet.\n        if (iceGatherer.state === 'new' || iceGatherer.state === 'gathering') {\n          iceGatherer.state = 'completed';\n        }\n      } else {\n        if (iceGatherer.state === 'new') {\n          iceGatherer.state = 'gathering';\n        }\n        // RTCIceCandidate doesn't have a component, needs to be added\n        cand.component = 1;\n        // also the usernameFragment. TODO: update SDP to take both variants.\n        cand.ufrag = iceGatherer.getLocalParameters().usernameFragment;\n\n        var serializedCandidate = SDPUtils.writeCandidate(cand);\n        event.candidate = Object.assign(event.candidate,\n            SDPUtils.parseCandidate(serializedCandidate));\n\n        event.candidate.candidate = serializedCandidate;\n        event.candidate.toJSON = function() {\n          return {\n            candidate: event.candidate.candidate,\n            sdpMid: event.candidate.sdpMid,\n            sdpMLineIndex: event.candidate.sdpMLineIndex,\n            usernameFragment: event.candidate.usernameFragment\n          };\n        };\n      }\n\n      // update local description.\n      var sections = SDPUtils.getMediaSections(pc._localDescription.sdp);\n      if (!end) {\n        sections[event.candidate.sdpMLineIndex] +=\n            'a=' + event.candidate.candidate + '\\r\\n';\n      } else {\n        sections[event.candidate.sdpMLineIndex] +=\n            'a=end-of-candidates\\r\\n';\n      }\n      pc._localDescription.sdp =\n          SDPUtils.getDescription(pc._localDescription.sdp) +\n          sections.join('');\n      var complete = pc.transceivers.every(function(transceiver) {\n        return transceiver.iceGatherer &&\n            transceiver.iceGatherer.state === 'completed';\n      });\n\n      if (pc.iceGatheringState !== 'gathering') {\n        pc.iceGatheringState = 'gathering';\n        pc._emitGatheringStateChange();\n      }\n\n      // Emit candidate. Also emit null candidate when all gatherers are\n      // complete.\n      if (!end) {\n        pc._dispatchEvent('icecandidate', event);\n      }\n      if (complete) {\n        pc._dispatchEvent('icecandidate', new Event('icecandidate'));\n        pc.iceGatheringState = 'complete';\n        pc._emitGatheringStateChange();\n      }\n    };\n\n    // emit already gathered candidates.\n    window.setTimeout(function() {\n      bufferedCandidateEvents.forEach(function(e) {\n        iceGatherer.onlocalcandidate(e);\n      });\n    }, 0);\n  };\n\n  // Create ICE transport and DTLS transport.\n  RTCPeerConnection.prototype._createIceAndDtlsTransports = function() {\n    var pc = this;\n    var iceTransport = new window.RTCIceTransport(null);\n    iceTransport.onicestatechange = function() {\n      pc._updateIceConnectionState();\n      pc._updateConnectionState();\n    };\n\n    var dtlsTransport = new window.RTCDtlsTransport(iceTransport);\n    dtlsTransport.ondtlsstatechange = function() {\n      pc._updateConnectionState();\n    };\n    dtlsTransport.onerror = function() {\n      // onerror does not set state to failed by itself.\n      Object.defineProperty(dtlsTransport, 'state',\n          {value: 'failed', writable: true});\n      pc._updateConnectionState();\n    };\n\n    return {\n      iceTransport: iceTransport,\n      dtlsTransport: dtlsTransport\n    };\n  };\n\n  // Destroy ICE gatherer, ICE transport and DTLS transport.\n  // Without triggering the callbacks.\n  RTCPeerConnection.prototype._disposeIceAndDtlsTransports = function(\n      sdpMLineIndex) {\n    var iceGatherer = this.transceivers[sdpMLineIndex].iceGatherer;\n    if (iceGatherer) {\n      delete iceGatherer.onlocalcandidate;\n      delete this.transceivers[sdpMLineIndex].iceGatherer;\n    }\n    var iceTransport = this.transceivers[sdpMLineIndex].iceTransport;\n    if (iceTransport) {\n      delete iceTransport.onicestatechange;\n      delete this.transceivers[sdpMLineIndex].iceTransport;\n    }\n    var dtlsTransport = this.transceivers[sdpMLineIndex].dtlsTransport;\n    if (dtlsTransport) {\n      delete dtlsTransport.ondtlsstatechange;\n      delete dtlsTransport.onerror;\n      delete this.transceivers[sdpMLineIndex].dtlsTransport;\n    }\n  };\n\n  // Start the RTP Sender and Receiver for a transceiver.\n  RTCPeerConnection.prototype._transceive = function(transceiver,\n      send, recv) {\n    var params = getCommonCapabilities(transceiver.localCapabilities,\n        transceiver.remoteCapabilities);\n    if (send && transceiver.rtpSender) {\n      params.encodings = transceiver.sendEncodingParameters;\n      params.rtcp = {\n        cname: SDPUtils.localCName,\n        compound: transceiver.rtcpParameters.compound\n      };\n      if (transceiver.recvEncodingParameters.length) {\n        params.rtcp.ssrc = transceiver.recvEncodingParameters[0].ssrc;\n      }\n      transceiver.rtpSender.send(params);\n    }\n    if (recv && transceiver.rtpReceiver && params.codecs.length > 0) {\n      // remove RTX field in Edge 14942\n      if (transceiver.kind === 'video'\n          && transceiver.recvEncodingParameters\n          && edgeVersion < 15019) {\n        transceiver.recvEncodingParameters.forEach(function(p) {\n          delete p.rtx;\n        });\n      }\n      if (transceiver.recvEncodingParameters.length) {\n        params.encodings = transceiver.recvEncodingParameters;\n      } else {\n        params.encodings = [{}];\n      }\n      params.rtcp = {\n        compound: transceiver.rtcpParameters.compound\n      };\n      if (transceiver.rtcpParameters.cname) {\n        params.rtcp.cname = transceiver.rtcpParameters.cname;\n      }\n      if (transceiver.sendEncodingParameters.length) {\n        params.rtcp.ssrc = transceiver.sendEncodingParameters[0].ssrc;\n      }\n      transceiver.rtpReceiver.receive(params);\n    }\n  };\n\n  RTCPeerConnection.prototype.setLocalDescription = function(description) {\n    var pc = this;\n\n    // Note: pranswer is not supported.\n    if (['offer', 'answer'].indexOf(description.type) === -1) {\n      return Promise.reject(makeError('TypeError',\n          'Unsupported type \"' + description.type + '\"'));\n    }\n\n    if (!isActionAllowedInSignalingState('setLocalDescription',\n        description.type, pc.signalingState) || pc._isClosed) {\n      return Promise.reject(makeError('InvalidStateError',\n          'Can not set local ' + description.type +\n          ' in state ' + pc.signalingState));\n    }\n\n    var sections;\n    var sessionpart;\n    if (description.type === 'offer') {\n      // VERY limited support for SDP munging. Limited to:\n      // * changing the order of codecs\n      sections = SDPUtils.splitSections(description.sdp);\n      sessionpart = sections.shift();\n      sections.forEach(function(mediaSection, sdpMLineIndex) {\n        var caps = SDPUtils.parseRtpParameters(mediaSection);\n        pc.transceivers[sdpMLineIndex].localCapabilities = caps;\n      });\n\n      pc.transceivers.forEach(function(transceiver, sdpMLineIndex) {\n        pc._gather(transceiver.mid, sdpMLineIndex);\n      });\n    } else if (description.type === 'answer') {\n      sections = SDPUtils.splitSections(pc._remoteDescription.sdp);\n      sessionpart = sections.shift();\n      var isIceLite = SDPUtils.matchPrefix(sessionpart,\n          'a=ice-lite').length > 0;\n      sections.forEach(function(mediaSection, sdpMLineIndex) {\n        var transceiver = pc.transceivers[sdpMLineIndex];\n        var iceGatherer = transceiver.iceGatherer;\n        var iceTransport = transceiver.iceTransport;\n        var dtlsTransport = transceiver.dtlsTransport;\n        var localCapabilities = transceiver.localCapabilities;\n        var remoteCapabilities = transceiver.remoteCapabilities;\n\n        // treat bundle-only as not-rejected.\n        var rejected = SDPUtils.isRejected(mediaSection) &&\n            SDPUtils.matchPrefix(mediaSection, 'a=bundle-only').length === 0;\n\n        if (!rejected && !transceiver.rejected) {\n          var remoteIceParameters = SDPUtils.getIceParameters(\n              mediaSection, sessionpart);\n          var remoteDtlsParameters = SDPUtils.getDtlsParameters(\n              mediaSection, sessionpart);\n          if (isIceLite) {\n            remoteDtlsParameters.role = 'server';\n          }\n\n          if (!pc.usingBundle || sdpMLineIndex === 0) {\n            pc._gather(transceiver.mid, sdpMLineIndex);\n            if (iceTransport.state === 'new') {\n              iceTransport.start(iceGatherer, remoteIceParameters,\n                  isIceLite ? 'controlling' : 'controlled');\n            }\n            if (dtlsTransport.state === 'new') {\n              dtlsTransport.start(remoteDtlsParameters);\n            }\n          }\n\n          // Calculate intersection of capabilities.\n          var params = getCommonCapabilities(localCapabilities,\n              remoteCapabilities);\n\n          // Start the RTCRtpSender. The RTCRtpReceiver for this\n          // transceiver has already been started in setRemoteDescription.\n          pc._transceive(transceiver,\n              params.codecs.length > 0,\n              false);\n        }\n      });\n    }\n\n    pc._localDescription = {\n      type: description.type,\n      sdp: description.sdp\n    };\n    if (description.type === 'offer') {\n      pc._updateSignalingState('have-local-offer');\n    } else {\n      pc._updateSignalingState('stable');\n    }\n\n    return Promise.resolve();\n  };\n\n  RTCPeerConnection.prototype.setRemoteDescription = function(description) {\n    var pc = this;\n\n    // Note: pranswer is not supported.\n    if (['offer', 'answer'].indexOf(description.type) === -1) {\n      return Promise.reject(makeError('TypeError',\n          'Unsupported type \"' + description.type + '\"'));\n    }\n\n    if (!isActionAllowedInSignalingState('setRemoteDescription',\n        description.type, pc.signalingState) || pc._isClosed) {\n      return Promise.reject(makeError('InvalidStateError',\n          'Can not set remote ' + description.type +\n          ' in state ' + pc.signalingState));\n    }\n\n    var streams = {};\n    pc.remoteStreams.forEach(function(stream) {\n      streams[stream.id] = stream;\n    });\n    var receiverList = [];\n    var sections = SDPUtils.splitSections(description.sdp);\n    var sessionpart = sections.shift();\n    var isIceLite = SDPUtils.matchPrefix(sessionpart,\n        'a=ice-lite').length > 0;\n    var usingBundle = SDPUtils.matchPrefix(sessionpart,\n        'a=group:BUNDLE ').length > 0;\n    pc.usingBundle = usingBundle;\n    var iceOptions = SDPUtils.matchPrefix(sessionpart,\n        'a=ice-options:')[0];\n    if (iceOptions) {\n      pc.canTrickleIceCandidates = iceOptions.substr(14).split(' ')\n          .indexOf('trickle') >= 0;\n    } else {\n      pc.canTrickleIceCandidates = false;\n    }\n\n    sections.forEach(function(mediaSection, sdpMLineIndex) {\n      var lines = SDPUtils.splitLines(mediaSection);\n      var kind = SDPUtils.getKind(mediaSection);\n      // treat bundle-only as not-rejected.\n      var rejected = SDPUtils.isRejected(mediaSection) &&\n          SDPUtils.matchPrefix(mediaSection, 'a=bundle-only').length === 0;\n      var protocol = lines[0].substr(2).split(' ')[2];\n\n      var direction = SDPUtils.getDirection(mediaSection, sessionpart);\n      var remoteMsid = SDPUtils.parseMsid(mediaSection);\n\n      var mid = SDPUtils.getMid(mediaSection) || SDPUtils.generateIdentifier();\n\n      // Reject datachannels which are not implemented yet.\n      if (rejected || (kind === 'application' && (protocol === 'DTLS/SCTP' ||\n          protocol === 'UDP/DTLS/SCTP'))) {\n        // TODO: this is dangerous in the case where a non-rejected m-line\n        //     becomes rejected.\n        pc.transceivers[sdpMLineIndex] = {\n          mid: mid,\n          kind: kind,\n          protocol: protocol,\n          rejected: true\n        };\n        return;\n      }\n\n      if (!rejected && pc.transceivers[sdpMLineIndex] &&\n          pc.transceivers[sdpMLineIndex].rejected) {\n        // recycle a rejected transceiver.\n        pc.transceivers[sdpMLineIndex] = pc._createTransceiver(kind, true);\n      }\n\n      var transceiver;\n      var iceGatherer;\n      var iceTransport;\n      var dtlsTransport;\n      var rtpReceiver;\n      var sendEncodingParameters;\n      var recvEncodingParameters;\n      var localCapabilities;\n\n      var track;\n      // FIXME: ensure the mediaSection has rtcp-mux set.\n      var remoteCapabilities = SDPUtils.parseRtpParameters(mediaSection);\n      var remoteIceParameters;\n      var remoteDtlsParameters;\n      if (!rejected) {\n        remoteIceParameters = SDPUtils.getIceParameters(mediaSection,\n            sessionpart);\n        remoteDtlsParameters = SDPUtils.getDtlsParameters(mediaSection,\n            sessionpart);\n        remoteDtlsParameters.role = 'client';\n      }\n      recvEncodingParameters =\n          SDPUtils.parseRtpEncodingParameters(mediaSection);\n\n      var rtcpParameters = SDPUtils.parseRtcpParameters(mediaSection);\n\n      var isComplete = SDPUtils.matchPrefix(mediaSection,\n          'a=end-of-candidates', sessionpart).length > 0;\n      var cands = SDPUtils.matchPrefix(mediaSection, 'a=candidate:')\n          .map(function(cand) {\n            return SDPUtils.parseCandidate(cand);\n          })\n          .filter(function(cand) {\n            return cand.component === 1;\n          });\n\n      // Check if we can use BUNDLE and dispose transports.\n      if ((description.type === 'offer' || description.type === 'answer') &&\n          !rejected && usingBundle && sdpMLineIndex > 0 &&\n          pc.transceivers[sdpMLineIndex]) {\n        pc._disposeIceAndDtlsTransports(sdpMLineIndex);\n        pc.transceivers[sdpMLineIndex].iceGatherer =\n            pc.transceivers[0].iceGatherer;\n        pc.transceivers[sdpMLineIndex].iceTransport =\n            pc.transceivers[0].iceTransport;\n        pc.transceivers[sdpMLineIndex].dtlsTransport =\n            pc.transceivers[0].dtlsTransport;\n        if (pc.transceivers[sdpMLineIndex].rtpSender) {\n          pc.transceivers[sdpMLineIndex].rtpSender.setTransport(\n              pc.transceivers[0].dtlsTransport);\n        }\n        if (pc.transceivers[sdpMLineIndex].rtpReceiver) {\n          pc.transceivers[sdpMLineIndex].rtpReceiver.setTransport(\n              pc.transceivers[0].dtlsTransport);\n        }\n      }\n      if (description.type === 'offer' && !rejected) {\n        transceiver = pc.transceivers[sdpMLineIndex] ||\n            pc._createTransceiver(kind);\n        transceiver.mid = mid;\n\n        if (!transceiver.iceGatherer) {\n          transceiver.iceGatherer = pc._createIceGatherer(sdpMLineIndex,\n              usingBundle);\n        }\n\n        if (cands.length && transceiver.iceTransport.state === 'new') {\n          if (isComplete && (!usingBundle || sdpMLineIndex === 0)) {\n            transceiver.iceTransport.setRemoteCandidates(cands);\n          } else {\n            cands.forEach(function(candidate) {\n              maybeAddCandidate(transceiver.iceTransport, candidate);\n            });\n          }\n        }\n\n        localCapabilities = window.RTCRtpReceiver.getCapabilities(kind);\n\n        // filter RTX until additional stuff needed for RTX is implemented\n        // in adapter.js\n        if (edgeVersion < 15019) {\n          localCapabilities.codecs = localCapabilities.codecs.filter(\n              function(codec) {\n                return codec.name !== 'rtx';\n              });\n        }\n\n        sendEncodingParameters = transceiver.sendEncodingParameters || [{\n          ssrc: (2 * sdpMLineIndex + 2) * 1001\n        }];\n\n        // TODO: rewrite to use http://w3c.github.io/webrtc-pc/#set-associated-remote-streams\n        var isNewTrack = false;\n        if (direction === 'sendrecv' || direction === 'sendonly') {\n          isNewTrack = !transceiver.rtpReceiver;\n          rtpReceiver = transceiver.rtpReceiver ||\n              new window.RTCRtpReceiver(transceiver.dtlsTransport, kind);\n\n          if (isNewTrack) {\n            var stream;\n            track = rtpReceiver.track;\n            // FIXME: does not work with Plan B.\n            if (remoteMsid && remoteMsid.stream === '-') {\n              // no-op. a stream id of '-' means: no associated stream.\n            } else if (remoteMsid) {\n              if (!streams[remoteMsid.stream]) {\n                streams[remoteMsid.stream] = new window.MediaStream();\n                Object.defineProperty(streams[remoteMsid.stream], 'id', {\n                  get: function() {\n                    return remoteMsid.stream;\n                  }\n                });\n              }\n              Object.defineProperty(track, 'id', {\n                get: function() {\n                  return remoteMsid.track;\n                }\n              });\n              stream = streams[remoteMsid.stream];\n            } else {\n              if (!streams.default) {\n                streams.default = new window.MediaStream();\n              }\n              stream = streams.default;\n            }\n            if (stream) {\n              addTrackToStreamAndFireEvent(track, stream);\n              transceiver.associatedRemoteMediaStreams.push(stream);\n            }\n            receiverList.push([track, rtpReceiver, stream]);\n          }\n        } else if (transceiver.rtpReceiver && transceiver.rtpReceiver.track) {\n          transceiver.associatedRemoteMediaStreams.forEach(function(s) {\n            var nativeTrack = s.getTracks().find(function(t) {\n              return t.id === transceiver.rtpReceiver.track.id;\n            });\n            if (nativeTrack) {\n              removeTrackFromStreamAndFireEvent(nativeTrack, s);\n            }\n          });\n          transceiver.associatedRemoteMediaStreams = [];\n        }\n\n        transceiver.localCapabilities = localCapabilities;\n        transceiver.remoteCapabilities = remoteCapabilities;\n        transceiver.rtpReceiver = rtpReceiver;\n        transceiver.rtcpParameters = rtcpParameters;\n        transceiver.sendEncodingParameters = sendEncodingParameters;\n        transceiver.recvEncodingParameters = recvEncodingParameters;\n\n        // Start the RTCRtpReceiver now. The RTPSender is started in\n        // setLocalDescription.\n        pc._transceive(pc.transceivers[sdpMLineIndex],\n            false,\n            isNewTrack);\n      } else if (description.type === 'answer' && !rejected) {\n        transceiver = pc.transceivers[sdpMLineIndex];\n        iceGatherer = transceiver.iceGatherer;\n        iceTransport = transceiver.iceTransport;\n        dtlsTransport = transceiver.dtlsTransport;\n        rtpReceiver = transceiver.rtpReceiver;\n        sendEncodingParameters = transceiver.sendEncodingParameters;\n        localCapabilities = transceiver.localCapabilities;\n\n        pc.transceivers[sdpMLineIndex].recvEncodingParameters =\n            recvEncodingParameters;\n        pc.transceivers[sdpMLineIndex].remoteCapabilities =\n            remoteCapabilities;\n        pc.transceivers[sdpMLineIndex].rtcpParameters = rtcpParameters;\n\n        if (cands.length && iceTransport.state === 'new') {\n          if ((isIceLite || isComplete) &&\n              (!usingBundle || sdpMLineIndex === 0)) {\n            iceTransport.setRemoteCandidates(cands);\n          } else {\n            cands.forEach(function(candidate) {\n              maybeAddCandidate(transceiver.iceTransport, candidate);\n            });\n          }\n        }\n\n        if (!usingBundle || sdpMLineIndex === 0) {\n          if (iceTransport.state === 'new') {\n            iceTransport.start(iceGatherer, remoteIceParameters,\n                'controlling');\n          }\n          if (dtlsTransport.state === 'new') {\n            dtlsTransport.start(remoteDtlsParameters);\n          }\n        }\n\n        // If the offer contained RTX but the answer did not,\n        // remove RTX from sendEncodingParameters.\n        var commonCapabilities = getCommonCapabilities(\n          transceiver.localCapabilities,\n          transceiver.remoteCapabilities);\n\n        var hasRtx = commonCapabilities.codecs.filter(function(c) {\n          return c.name.toLowerCase() === 'rtx';\n        }).length;\n        if (!hasRtx && transceiver.sendEncodingParameters[0].rtx) {\n          delete transceiver.sendEncodingParameters[0].rtx;\n        }\n\n        pc._transceive(transceiver,\n            direction === 'sendrecv' || direction === 'recvonly',\n            direction === 'sendrecv' || direction === 'sendonly');\n\n        // TODO: rewrite to use http://w3c.github.io/webrtc-pc/#set-associated-remote-streams\n        if (rtpReceiver &&\n            (direction === 'sendrecv' || direction === 'sendonly')) {\n          track = rtpReceiver.track;\n          if (remoteMsid) {\n            if (!streams[remoteMsid.stream]) {\n              streams[remoteMsid.stream] = new window.MediaStream();\n            }\n            addTrackToStreamAndFireEvent(track, streams[remoteMsid.stream]);\n            receiverList.push([track, rtpReceiver, streams[remoteMsid.stream]]);\n          } else {\n            if (!streams.default) {\n              streams.default = new window.MediaStream();\n            }\n            addTrackToStreamAndFireEvent(track, streams.default);\n            receiverList.push([track, rtpReceiver, streams.default]);\n          }\n        } else {\n          // FIXME: actually the receiver should be created later.\n          delete transceiver.rtpReceiver;\n        }\n      }\n    });\n\n    if (pc._dtlsRole === undefined) {\n      pc._dtlsRole = description.type === 'offer' ? 'active' : 'passive';\n    }\n\n    pc._remoteDescription = {\n      type: description.type,\n      sdp: description.sdp\n    };\n    if (description.type === 'offer') {\n      pc._updateSignalingState('have-remote-offer');\n    } else {\n      pc._updateSignalingState('stable');\n    }\n    Object.keys(streams).forEach(function(sid) {\n      var stream = streams[sid];\n      if (stream.getTracks().length) {\n        if (pc.remoteStreams.indexOf(stream) === -1) {\n          pc.remoteStreams.push(stream);\n          var event = new Event('addstream');\n          event.stream = stream;\n          window.setTimeout(function() {\n            pc._dispatchEvent('addstream', event);\n          });\n        }\n\n        receiverList.forEach(function(item) {\n          var track = item[0];\n          var receiver = item[1];\n          if (stream.id !== item[2].id) {\n            return;\n          }\n          fireAddTrack(pc, track, receiver, [stream]);\n        });\n      }\n    });\n    receiverList.forEach(function(item) {\n      if (item[2]) {\n        return;\n      }\n      fireAddTrack(pc, item[0], item[1], []);\n    });\n\n    // check whether addIceCandidate({}) was called within four seconds after\n    // setRemoteDescription.\n    window.setTimeout(function() {\n      if (!(pc && pc.transceivers)) {\n        return;\n      }\n      pc.transceivers.forEach(function(transceiver) {\n        if (transceiver.iceTransport &&\n            transceiver.iceTransport.state === 'new' &&\n            transceiver.iceTransport.getRemoteCandidates().length > 0) {\n          console.warn('Timeout for addRemoteCandidate. Consider sending ' +\n              'an end-of-candidates notification');\n          transceiver.iceTransport.addRemoteCandidate({});\n        }\n      });\n    }, 4000);\n\n    return Promise.resolve();\n  };\n\n  RTCPeerConnection.prototype.close = function() {\n    this.transceivers.forEach(function(transceiver) {\n      /* not yet\n      if (transceiver.iceGatherer) {\n        transceiver.iceGatherer.close();\n      }\n      */\n      if (transceiver.iceTransport) {\n        transceiver.iceTransport.stop();\n      }\n      if (transceiver.dtlsTransport) {\n        transceiver.dtlsTransport.stop();\n      }\n      if (transceiver.rtpSender) {\n        transceiver.rtpSender.stop();\n      }\n      if (transceiver.rtpReceiver) {\n        transceiver.rtpReceiver.stop();\n      }\n    });\n    // FIXME: clean up tracks, local streams, remote streams, etc\n    this._isClosed = true;\n    this._updateSignalingState('closed');\n  };\n\n  // Update the signaling state.\n  RTCPeerConnection.prototype._updateSignalingState = function(newState) {\n    this.signalingState = newState;\n    var event = new Event('signalingstatechange');\n    this._dispatchEvent('signalingstatechange', event);\n  };\n\n  // Determine whether to fire the negotiationneeded event.\n  RTCPeerConnection.prototype._maybeFireNegotiationNeeded = function() {\n    var pc = this;\n    if (this.signalingState !== 'stable' || this.needNegotiation === true) {\n      return;\n    }\n    this.needNegotiation = true;\n    window.setTimeout(function() {\n      if (pc.needNegotiation) {\n        pc.needNegotiation = false;\n        var event = new Event('negotiationneeded');\n        pc._dispatchEvent('negotiationneeded', event);\n      }\n    }, 0);\n  };\n\n  // Update the ice connection state.\n  RTCPeerConnection.prototype._updateIceConnectionState = function() {\n    var newState;\n    var states = {\n      'new': 0,\n      closed: 0,\n      checking: 0,\n      connected: 0,\n      completed: 0,\n      disconnected: 0,\n      failed: 0\n    };\n    this.transceivers.forEach(function(transceiver) {\n      if (transceiver.iceTransport && !transceiver.rejected) {\n        states[transceiver.iceTransport.state]++;\n      }\n    });\n\n    newState = 'new';\n    if (states.failed > 0) {\n      newState = 'failed';\n    } else if (states.checking > 0) {\n      newState = 'checking';\n    } else if (states.disconnected > 0) {\n      newState = 'disconnected';\n    } else if (states.new > 0) {\n      newState = 'new';\n    } else if (states.connected > 0) {\n      newState = 'connected';\n    } else if (states.completed > 0) {\n      newState = 'completed';\n    }\n\n    if (newState !== this.iceConnectionState) {\n      this.iceConnectionState = newState;\n      var event = new Event('iceconnectionstatechange');\n      this._dispatchEvent('iceconnectionstatechange', event);\n    }\n  };\n\n  // Update the connection state.\n  RTCPeerConnection.prototype._updateConnectionState = function() {\n    var newState;\n    var states = {\n      'new': 0,\n      closed: 0,\n      connecting: 0,\n      connected: 0,\n      completed: 0,\n      disconnected: 0,\n      failed: 0\n    };\n    this.transceivers.forEach(function(transceiver) {\n      if (transceiver.iceTransport && transceiver.dtlsTransport &&\n          !transceiver.rejected) {\n        states[transceiver.iceTransport.state]++;\n        states[transceiver.dtlsTransport.state]++;\n      }\n    });\n    // ICETransport.completed and connected are the same for this purpose.\n    states.connected += states.completed;\n\n    newState = 'new';\n    if (states.failed > 0) {\n      newState = 'failed';\n    } else if (states.connecting > 0) {\n      newState = 'connecting';\n    } else if (states.disconnected > 0) {\n      newState = 'disconnected';\n    } else if (states.new > 0) {\n      newState = 'new';\n    } else if (states.connected > 0) {\n      newState = 'connected';\n    }\n\n    if (newState !== this.connectionState) {\n      this.connectionState = newState;\n      var event = new Event('connectionstatechange');\n      this._dispatchEvent('connectionstatechange', event);\n    }\n  };\n\n  RTCPeerConnection.prototype.createOffer = function() {\n    var pc = this;\n\n    if (pc._isClosed) {\n      return Promise.reject(makeError('InvalidStateError',\n          'Can not call createOffer after close'));\n    }\n\n    var numAudioTracks = pc.transceivers.filter(function(t) {\n      return t.kind === 'audio';\n    }).length;\n    var numVideoTracks = pc.transceivers.filter(function(t) {\n      return t.kind === 'video';\n    }).length;\n\n    // Determine number of audio and video tracks we need to send/recv.\n    var offerOptions = arguments[0];\n    if (offerOptions) {\n      // Reject Chrome legacy constraints.\n      if (offerOptions.mandatory || offerOptions.optional) {\n        throw new TypeError(\n            'Legacy mandatory/optional constraints not supported.');\n      }\n      if (offerOptions.offerToReceiveAudio !== undefined) {\n        if (offerOptions.offerToReceiveAudio === true) {\n          numAudioTracks = 1;\n        } else if (offerOptions.offerToReceiveAudio === false) {\n          numAudioTracks = 0;\n        } else {\n          numAudioTracks = offerOptions.offerToReceiveAudio;\n        }\n      }\n      if (offerOptions.offerToReceiveVideo !== undefined) {\n        if (offerOptions.offerToReceiveVideo === true) {\n          numVideoTracks = 1;\n        } else if (offerOptions.offerToReceiveVideo === false) {\n          numVideoTracks = 0;\n        } else {\n          numVideoTracks = offerOptions.offerToReceiveVideo;\n        }\n      }\n    }\n\n    pc.transceivers.forEach(function(transceiver) {\n      if (transceiver.kind === 'audio') {\n        numAudioTracks--;\n        if (numAudioTracks < 0) {\n          transceiver.wantReceive = false;\n        }\n      } else if (transceiver.kind === 'video') {\n        numVideoTracks--;\n        if (numVideoTracks < 0) {\n          transceiver.wantReceive = false;\n        }\n      }\n    });\n\n    // Create M-lines for recvonly streams.\n    while (numAudioTracks > 0 || numVideoTracks > 0) {\n      if (numAudioTracks > 0) {\n        pc._createTransceiver('audio');\n        numAudioTracks--;\n      }\n      if (numVideoTracks > 0) {\n        pc._createTransceiver('video');\n        numVideoTracks--;\n      }\n    }\n\n    var sdp = SDPUtils.writeSessionBoilerplate(pc._sdpSessionId,\n        pc._sdpSessionVersion++);\n    pc.transceivers.forEach(function(transceiver, sdpMLineIndex) {\n      // For each track, create an ice gatherer, ice transport,\n      // dtls transport, potentially rtpsender and rtpreceiver.\n      var track = transceiver.track;\n      var kind = transceiver.kind;\n      var mid = transceiver.mid || SDPUtils.generateIdentifier();\n      transceiver.mid = mid;\n\n      if (!transceiver.iceGatherer) {\n        transceiver.iceGatherer = pc._createIceGatherer(sdpMLineIndex,\n            pc.usingBundle);\n      }\n\n      var localCapabilities = window.RTCRtpSender.getCapabilities(kind);\n      // filter RTX until additional stuff needed for RTX is implemented\n      // in adapter.js\n      if (edgeVersion < 15019) {\n        localCapabilities.codecs = localCapabilities.codecs.filter(\n            function(codec) {\n              return codec.name !== 'rtx';\n            });\n      }\n      localCapabilities.codecs.forEach(function(codec) {\n        // work around https://bugs.chromium.org/p/webrtc/issues/detail?id=6552\n        // by adding level-asymmetry-allowed=1\n        if (codec.name === 'H264' &&\n            codec.parameters['level-asymmetry-allowed'] === undefined) {\n          codec.parameters['level-asymmetry-allowed'] = '1';\n        }\n\n        // for subsequent offers, we might have to re-use the payload\n        // type of the last offer.\n        if (transceiver.remoteCapabilities &&\n            transceiver.remoteCapabilities.codecs) {\n          transceiver.remoteCapabilities.codecs.forEach(function(remoteCodec) {\n            if (codec.name.toLowerCase() === remoteCodec.name.toLowerCase() &&\n                codec.clockRate === remoteCodec.clockRate) {\n              codec.preferredPayloadType = remoteCodec.payloadType;\n            }\n          });\n        }\n      });\n      localCapabilities.headerExtensions.forEach(function(hdrExt) {\n        var remoteExtensions = transceiver.remoteCapabilities &&\n            transceiver.remoteCapabilities.headerExtensions || [];\n        remoteExtensions.forEach(function(rHdrExt) {\n          if (hdrExt.uri === rHdrExt.uri) {\n            hdrExt.id = rHdrExt.id;\n          }\n        });\n      });\n\n      // generate an ssrc now, to be used later in rtpSender.send\n      var sendEncodingParameters = transceiver.sendEncodingParameters || [{\n        ssrc: (2 * sdpMLineIndex + 1) * 1001\n      }];\n      if (track) {\n        // add RTX\n        if (edgeVersion >= 15019 && kind === 'video' &&\n            !sendEncodingParameters[0].rtx) {\n          sendEncodingParameters[0].rtx = {\n            ssrc: sendEncodingParameters[0].ssrc + 1\n          };\n        }\n      }\n\n      if (transceiver.wantReceive) {\n        transceiver.rtpReceiver = new window.RTCRtpReceiver(\n            transceiver.dtlsTransport, kind);\n      }\n\n      transceiver.localCapabilities = localCapabilities;\n      transceiver.sendEncodingParameters = sendEncodingParameters;\n    });\n\n    // always offer BUNDLE and dispose on return if not supported.\n    if (pc._config.bundlePolicy !== 'max-compat') {\n      sdp += 'a=group:BUNDLE ' + pc.transceivers.map(function(t) {\n        return t.mid;\n      }).join(' ') + '\\r\\n';\n    }\n    sdp += 'a=ice-options:trickle\\r\\n';\n\n    pc.transceivers.forEach(function(transceiver, sdpMLineIndex) {\n      sdp += writeMediaSection(transceiver, transceiver.localCapabilities,\n          'offer', transceiver.stream, pc._dtlsRole);\n      sdp += 'a=rtcp-rsize\\r\\n';\n\n      if (transceiver.iceGatherer && pc.iceGatheringState !== 'new' &&\n          (sdpMLineIndex === 0 || !pc.usingBundle)) {\n        transceiver.iceGatherer.getLocalCandidates().forEach(function(cand) {\n          cand.component = 1;\n          sdp += 'a=' + SDPUtils.writeCandidate(cand) + '\\r\\n';\n        });\n\n        if (transceiver.iceGatherer.state === 'completed') {\n          sdp += 'a=end-of-candidates\\r\\n';\n        }\n      }\n    });\n\n    var desc = new window.RTCSessionDescription({\n      type: 'offer',\n      sdp: sdp\n    });\n    return Promise.resolve(desc);\n  };\n\n  RTCPeerConnection.prototype.createAnswer = function() {\n    var pc = this;\n\n    if (pc._isClosed) {\n      return Promise.reject(makeError('InvalidStateError',\n          'Can not call createAnswer after close'));\n    }\n\n    if (!(pc.signalingState === 'have-remote-offer' ||\n        pc.signalingState === 'have-local-pranswer')) {\n      return Promise.reject(makeError('InvalidStateError',\n          'Can not call createAnswer in signalingState ' + pc.signalingState));\n    }\n\n    var sdp = SDPUtils.writeSessionBoilerplate(pc._sdpSessionId,\n        pc._sdpSessionVersion++);\n    if (pc.usingBundle) {\n      sdp += 'a=group:BUNDLE ' + pc.transceivers.map(function(t) {\n        return t.mid;\n      }).join(' ') + '\\r\\n';\n    }\n    sdp += 'a=ice-options:trickle\\r\\n';\n\n    var mediaSectionsInOffer = SDPUtils.getMediaSections(\n        pc._remoteDescription.sdp).length;\n    pc.transceivers.forEach(function(transceiver, sdpMLineIndex) {\n      if (sdpMLineIndex + 1 > mediaSectionsInOffer) {\n        return;\n      }\n      if (transceiver.rejected) {\n        if (transceiver.kind === 'application') {\n          if (transceiver.protocol === 'DTLS/SCTP') { // legacy fmt\n            sdp += 'm=application 0 DTLS/SCTP 5000\\r\\n';\n          } else {\n            sdp += 'm=application 0 ' + transceiver.protocol +\n                ' webrtc-datachannel\\r\\n';\n          }\n        } else if (transceiver.kind === 'audio') {\n          sdp += 'm=audio 0 UDP/TLS/RTP/SAVPF 0\\r\\n' +\n              'a=rtpmap:0 PCMU/8000\\r\\n';\n        } else if (transceiver.kind === 'video') {\n          sdp += 'm=video 0 UDP/TLS/RTP/SAVPF 120\\r\\n' +\n              'a=rtpmap:120 VP8/90000\\r\\n';\n        }\n        sdp += 'c=IN IP4 0.0.0.0\\r\\n' +\n            'a=inactive\\r\\n' +\n            'a=mid:' + transceiver.mid + '\\r\\n';\n        return;\n      }\n\n      // FIXME: look at direction.\n      if (transceiver.stream) {\n        var localTrack;\n        if (transceiver.kind === 'audio') {\n          localTrack = transceiver.stream.getAudioTracks()[0];\n        } else if (transceiver.kind === 'video') {\n          localTrack = transceiver.stream.getVideoTracks()[0];\n        }\n        if (localTrack) {\n          // add RTX\n          if (edgeVersion >= 15019 && transceiver.kind === 'video' &&\n              !transceiver.sendEncodingParameters[0].rtx) {\n            transceiver.sendEncodingParameters[0].rtx = {\n              ssrc: transceiver.sendEncodingParameters[0].ssrc + 1\n            };\n          }\n        }\n      }\n\n      // Calculate intersection of capabilities.\n      var commonCapabilities = getCommonCapabilities(\n          transceiver.localCapabilities,\n          transceiver.remoteCapabilities);\n\n      var hasRtx = commonCapabilities.codecs.filter(function(c) {\n        return c.name.toLowerCase() === 'rtx';\n      }).length;\n      if (!hasRtx && transceiver.sendEncodingParameters[0].rtx) {\n        delete transceiver.sendEncodingParameters[0].rtx;\n      }\n\n      sdp += writeMediaSection(transceiver, commonCapabilities,\n          'answer', transceiver.stream, pc._dtlsRole);\n      if (transceiver.rtcpParameters &&\n          transceiver.rtcpParameters.reducedSize) {\n        sdp += 'a=rtcp-rsize\\r\\n';\n      }\n    });\n\n    var desc = new window.RTCSessionDescription({\n      type: 'answer',\n      sdp: sdp\n    });\n    return Promise.resolve(desc);\n  };\n\n  RTCPeerConnection.prototype.addIceCandidate = function(candidate) {\n    var pc = this;\n    var sections;\n    if (candidate && !(candidate.sdpMLineIndex !== undefined ||\n        candidate.sdpMid)) {\n      return Promise.reject(new TypeError('sdpMLineIndex or sdpMid required'));\n    }\n\n    // TODO: needs to go into ops queue.\n    return new Promise(function(resolve, reject) {\n      if (!pc._remoteDescription) {\n        return reject(makeError('InvalidStateError',\n            'Can not add ICE candidate without a remote description'));\n      } else if (!candidate || candidate.candidate === '') {\n        for (var j = 0; j < pc.transceivers.length; j++) {\n          if (pc.transceivers[j].rejected) {\n            continue;\n          }\n          pc.transceivers[j].iceTransport.addRemoteCandidate({});\n          sections = SDPUtils.getMediaSections(pc._remoteDescription.sdp);\n          sections[j] += 'a=end-of-candidates\\r\\n';\n          pc._remoteDescription.sdp =\n              SDPUtils.getDescription(pc._remoteDescription.sdp) +\n              sections.join('');\n          if (pc.usingBundle) {\n            break;\n          }\n        }\n      } else {\n        var sdpMLineIndex = candidate.sdpMLineIndex;\n        if (candidate.sdpMid) {\n          for (var i = 0; i < pc.transceivers.length; i++) {\n            if (pc.transceivers[i].mid === candidate.sdpMid) {\n              sdpMLineIndex = i;\n              break;\n            }\n          }\n        }\n        var transceiver = pc.transceivers[sdpMLineIndex];\n        if (transceiver) {\n          if (transceiver.rejected) {\n            return resolve();\n          }\n          var cand = Object.keys(candidate.candidate).length > 0 ?\n              SDPUtils.parseCandidate(candidate.candidate) : {};\n          // Ignore Chrome's invalid candidates since Edge does not like them.\n          if (cand.protocol === 'tcp' && (cand.port === 0 || cand.port === 9)) {\n            return resolve();\n          }\n          // Ignore RTCP candidates, we assume RTCP-MUX.\n          if (cand.component && cand.component !== 1) {\n            return resolve();\n          }\n          // when using bundle, avoid adding candidates to the wrong\n          // ice transport. And avoid adding candidates added in the SDP.\n          if (sdpMLineIndex === 0 || (sdpMLineIndex > 0 &&\n              transceiver.iceTransport !== pc.transceivers[0].iceTransport)) {\n            if (!maybeAddCandidate(transceiver.iceTransport, cand)) {\n              return reject(makeError('OperationError',\n                  'Can not add ICE candidate'));\n            }\n          }\n\n          // update the remoteDescription.\n          var candidateString = candidate.candidate.trim();\n          if (candidateString.indexOf('a=') === 0) {\n            candidateString = candidateString.substr(2);\n          }\n          sections = SDPUtils.getMediaSections(pc._remoteDescription.sdp);\n          sections[sdpMLineIndex] += 'a=' +\n              (cand.type ? candidateString : 'end-of-candidates')\n              + '\\r\\n';\n          pc._remoteDescription.sdp =\n              SDPUtils.getDescription(pc._remoteDescription.sdp) +\n              sections.join('');\n        } else {\n          return reject(makeError('OperationError',\n              'Can not add ICE candidate'));\n        }\n      }\n      resolve();\n    });\n  };\n\n  RTCPeerConnection.prototype.getStats = function(selector) {\n    if (selector && selector instanceof window.MediaStreamTrack) {\n      var senderOrReceiver = null;\n      this.transceivers.forEach(function(transceiver) {\n        if (transceiver.rtpSender &&\n            transceiver.rtpSender.track === selector) {\n          senderOrReceiver = transceiver.rtpSender;\n        } else if (transceiver.rtpReceiver &&\n            transceiver.rtpReceiver.track === selector) {\n          senderOrReceiver = transceiver.rtpReceiver;\n        }\n      });\n      if (!senderOrReceiver) {\n        throw makeError('InvalidAccessError', 'Invalid selector.');\n      }\n      return senderOrReceiver.getStats();\n    }\n\n    var promises = [];\n    this.transceivers.forEach(function(transceiver) {\n      ['rtpSender', 'rtpReceiver', 'iceGatherer', 'iceTransport',\n          'dtlsTransport'].forEach(function(method) {\n            if (transceiver[method]) {\n              promises.push(transceiver[method].getStats());\n            }\n          });\n    });\n    return Promise.all(promises).then(function(allStats) {\n      var results = new Map();\n      allStats.forEach(function(stats) {\n        stats.forEach(function(stat) {\n          results.set(stat.id, stat);\n        });\n      });\n      return results;\n    });\n  };\n\n  // fix low-level stat names and return Map instead of object.\n  var ortcObjects = ['RTCRtpSender', 'RTCRtpReceiver', 'RTCIceGatherer',\n    'RTCIceTransport', 'RTCDtlsTransport'];\n  ortcObjects.forEach(function(ortcObjectName) {\n    var obj = window[ortcObjectName];\n    if (obj && obj.prototype && obj.prototype.getStats) {\n      var nativeGetstats = obj.prototype.getStats;\n      obj.prototype.getStats = function() {\n        return nativeGetstats.apply(this)\n        .then(function(nativeStats) {\n          var mapStats = new Map();\n          Object.keys(nativeStats).forEach(function(id) {\n            nativeStats[id].type = fixStatsType(nativeStats[id]);\n            mapStats.set(id, nativeStats[id]);\n          });\n          return mapStats;\n        });\n      };\n    }\n  });\n\n  // legacy callback shims. Should be moved to adapter.js some days.\n  var methods = ['createOffer', 'createAnswer'];\n  methods.forEach(function(method) {\n    var nativeMethod = RTCPeerConnection.prototype[method];\n    RTCPeerConnection.prototype[method] = function() {\n      var args = arguments;\n      if (typeof args[0] === 'function' ||\n          typeof args[1] === 'function') { // legacy\n        return nativeMethod.apply(this, [arguments[2]])\n        .then(function(description) {\n          if (typeof args[0] === 'function') {\n            args[0].apply(null, [description]);\n          }\n        }, function(error) {\n          if (typeof args[1] === 'function') {\n            args[1].apply(null, [error]);\n          }\n        });\n      }\n      return nativeMethod.apply(this, arguments);\n    };\n  });\n\n  methods = ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate'];\n  methods.forEach(function(method) {\n    var nativeMethod = RTCPeerConnection.prototype[method];\n    RTCPeerConnection.prototype[method] = function() {\n      var args = arguments;\n      if (typeof args[1] === 'function' ||\n          typeof args[2] === 'function') { // legacy\n        return nativeMethod.apply(this, arguments)\n        .then(function() {\n          if (typeof args[1] === 'function') {\n            args[1].apply(null);\n          }\n        }, function(error) {\n          if (typeof args[2] === 'function') {\n            args[2].apply(null, [error]);\n          }\n        });\n      }\n      return nativeMethod.apply(this, arguments);\n    };\n  });\n\n  // getStats is special. It doesn't have a spec legacy method yet we support\n  // getStats(something, cb) without error callbacks.\n  ['getStats'].forEach(function(method) {\n    var nativeMethod = RTCPeerConnection.prototype[method];\n    RTCPeerConnection.prototype[method] = function() {\n      var args = arguments;\n      if (typeof args[1] === 'function') {\n        return nativeMethod.apply(this, arguments)\n        .then(function() {\n          if (typeof args[1] === 'function') {\n            args[1].apply(null);\n          }\n        });\n      }\n      return nativeMethod.apply(this, arguments);\n    };\n  });\n\n  return RTCPeerConnection;\n};\n","/* eslint-env node */\n'use strict';\n\n// SDP helpers.\nvar SDPUtils = {};\n\n// Generate an alphanumeric identifier for cname or mids.\n// TODO: use UUIDs instead? https://gist.github.com/jed/982883\nSDPUtils.generateIdentifier = function() {\n  return Math.random().toString(36).substr(2, 10);\n};\n\n// The RTCP CNAME used by all peerconnections from the same JS.\nSDPUtils.localCName = SDPUtils.generateIdentifier();\n\n// Splits SDP into lines, dealing with both CRLF and LF.\nSDPUtils.splitLines = function(blob) {\n  return blob.trim().split('\\n').map(function(line) {\n    return line.trim();\n  });\n};\n// Splits SDP into sessionpart and mediasections. Ensures CRLF.\nSDPUtils.splitSections = function(blob) {\n  var parts = blob.split('\\nm=');\n  return parts.map(function(part, index) {\n    return (index > 0 ? 'm=' + part : part).trim() + '\\r\\n';\n  });\n};\n\n// returns the session description.\nSDPUtils.getDescription = function(blob) {\n  var sections = SDPUtils.splitSections(blob);\n  return sections && sections[0];\n};\n\n// returns the individual media sections.\nSDPUtils.getMediaSections = function(blob) {\n  var sections = SDPUtils.splitSections(blob);\n  sections.shift();\n  return sections;\n};\n\n// Returns lines that start with a certain prefix.\nSDPUtils.matchPrefix = function(blob, prefix) {\n  return SDPUtils.splitLines(blob).filter(function(line) {\n    return line.indexOf(prefix) === 0;\n  });\n};\n\n// Parses an ICE candidate line. Sample input:\n// candidate:702786350 2 udp 41819902 8.8.8.8 60769 typ relay raddr 8.8.8.8\n// rport 55996\"\nSDPUtils.parseCandidate = function(line) {\n  var parts;\n  // Parse both variants.\n  if (line.indexOf('a=candidate:') === 0) {\n    parts = line.substring(12).split(' ');\n  } else {\n    parts = line.substring(10).split(' ');\n  }\n\n  var candidate = {\n    foundation: parts[0],\n    component: parseInt(parts[1], 10),\n    protocol: parts[2].toLowerCase(),\n    priority: parseInt(parts[3], 10),\n    ip: parts[4],\n    address: parts[4], // address is an alias for ip.\n    port: parseInt(parts[5], 10),\n    // skip parts[6] == 'typ'\n    type: parts[7]\n  };\n\n  for (var i = 8; i < parts.length; i += 2) {\n    switch (parts[i]) {\n      case 'raddr':\n        candidate.relatedAddress = parts[i + 1];\n        break;\n      case 'rport':\n        candidate.relatedPort = parseInt(parts[i + 1], 10);\n        break;\n      case 'tcptype':\n        candidate.tcpType = parts[i + 1];\n        break;\n      case 'ufrag':\n        candidate.ufrag = parts[i + 1]; // for backward compability.\n        candidate.usernameFragment = parts[i + 1];\n        break;\n      default: // extension handling, in particular ufrag\n        candidate[parts[i]] = parts[i + 1];\n        break;\n    }\n  }\n  return candidate;\n};\n\n// Translates a candidate object into SDP candidate attribute.\nSDPUtils.writeCandidate = function(candidate) {\n  var sdp = [];\n  sdp.push(candidate.foundation);\n  sdp.push(candidate.component);\n  sdp.push(candidate.protocol.toUpperCase());\n  sdp.push(candidate.priority);\n  sdp.push(candidate.address || candidate.ip);\n  sdp.push(candidate.port);\n\n  var type = candidate.type;\n  sdp.push('typ');\n  sdp.push(type);\n  if (type !== 'host' && candidate.relatedAddress &&\n      candidate.relatedPort) {\n    sdp.push('raddr');\n    sdp.push(candidate.relatedAddress);\n    sdp.push('rport');\n    sdp.push(candidate.relatedPort);\n  }\n  if (candidate.tcpType && candidate.protocol.toLowerCase() === 'tcp') {\n    sdp.push('tcptype');\n    sdp.push(candidate.tcpType);\n  }\n  if (candidate.usernameFragment || candidate.ufrag) {\n    sdp.push('ufrag');\n    sdp.push(candidate.usernameFragment || candidate.ufrag);\n  }\n  return 'candidate:' + sdp.join(' ');\n};\n\n// Parses an ice-options line, returns an array of option tags.\n// a=ice-options:foo bar\nSDPUtils.parseIceOptions = function(line) {\n  return line.substr(14).split(' ');\n};\n\n// Parses an rtpmap line, returns RTCRtpCoddecParameters. Sample input:\n// a=rtpmap:111 opus/48000/2\nSDPUtils.parseRtpMap = function(line) {\n  var parts = line.substr(9).split(' ');\n  var parsed = {\n    payloadType: parseInt(parts.shift(), 10) // was: id\n  };\n\n  parts = parts[0].split('/');\n\n  parsed.name = parts[0];\n  parsed.clockRate = parseInt(parts[1], 10); // was: clockrate\n  parsed.channels = parts.length === 3 ? parseInt(parts[2], 10) : 1;\n  // legacy alias, got renamed back to channels in ORTC.\n  parsed.numChannels = parsed.channels;\n  return parsed;\n};\n\n// Generate an a=rtpmap line from RTCRtpCodecCapability or\n// RTCRtpCodecParameters.\nSDPUtils.writeRtpMap = function(codec) {\n  var pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  var channels = codec.channels || codec.numChannels || 1;\n  return 'a=rtpmap:' + pt + ' ' + codec.name + '/' + codec.clockRate +\n      (channels !== 1 ? '/' + channels : '') + '\\r\\n';\n};\n\n// Parses an a=extmap line (headerextension from RFC 5285). Sample input:\n// a=extmap:2 urn:ietf:params:rtp-hdrext:toffset\n// a=extmap:2/sendonly urn:ietf:params:rtp-hdrext:toffset\nSDPUtils.parseExtmap = function(line) {\n  var parts = line.substr(9).split(' ');\n  return {\n    id: parseInt(parts[0], 10),\n    direction: parts[0].indexOf('/') > 0 ? parts[0].split('/')[1] : 'sendrecv',\n    uri: parts[1]\n  };\n};\n\n// Generates a=extmap line from RTCRtpHeaderExtensionParameters or\n// RTCRtpHeaderExtension.\nSDPUtils.writeExtmap = function(headerExtension) {\n  return 'a=extmap:' + (headerExtension.id || headerExtension.preferredId) +\n      (headerExtension.direction && headerExtension.direction !== 'sendrecv'\n        ? '/' + headerExtension.direction\n        : '') +\n      ' ' + headerExtension.uri + '\\r\\n';\n};\n\n// Parses an ftmp line, returns dictionary. Sample input:\n// a=fmtp:96 vbr=on;cng=on\n// Also deals with vbr=on; cng=on\nSDPUtils.parseFmtp = function(line) {\n  var parsed = {};\n  var kv;\n  var parts = line.substr(line.indexOf(' ') + 1).split(';');\n  for (var j = 0; j < parts.length; j++) {\n    kv = parts[j].trim().split('=');\n    parsed[kv[0].trim()] = kv[1];\n  }\n  return parsed;\n};\n\n// Generates an a=ftmp line from RTCRtpCodecCapability or RTCRtpCodecParameters.\nSDPUtils.writeFmtp = function(codec) {\n  var line = '';\n  var pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  if (codec.parameters && Object.keys(codec.parameters).length) {\n    var params = [];\n    Object.keys(codec.parameters).forEach(function(param) {\n      if (codec.parameters[param]) {\n        params.push(param + '=' + codec.parameters[param]);\n      } else {\n        params.push(param);\n      }\n    });\n    line += 'a=fmtp:' + pt + ' ' + params.join(';') + '\\r\\n';\n  }\n  return line;\n};\n\n// Parses an rtcp-fb line, returns RTCPRtcpFeedback object. Sample input:\n// a=rtcp-fb:98 nack rpsi\nSDPUtils.parseRtcpFb = function(line) {\n  var parts = line.substr(line.indexOf(' ') + 1).split(' ');\n  return {\n    type: parts.shift(),\n    parameter: parts.join(' ')\n  };\n};\n// Generate a=rtcp-fb lines from RTCRtpCodecCapability or RTCRtpCodecParameters.\nSDPUtils.writeRtcpFb = function(codec) {\n  var lines = '';\n  var pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  if (codec.rtcpFeedback && codec.rtcpFeedback.length) {\n    // FIXME: special handling for trr-int?\n    codec.rtcpFeedback.forEach(function(fb) {\n      lines += 'a=rtcp-fb:' + pt + ' ' + fb.type +\n      (fb.parameter && fb.parameter.length ? ' ' + fb.parameter : '') +\n          '\\r\\n';\n    });\n  }\n  return lines;\n};\n\n// Parses an RFC 5576 ssrc media attribute. Sample input:\n// a=ssrc:3735928559 cname:something\nSDPUtils.parseSsrcMedia = function(line) {\n  var sp = line.indexOf(' ');\n  var parts = {\n    ssrc: parseInt(line.substr(7, sp - 7), 10)\n  };\n  var colon = line.indexOf(':', sp);\n  if (colon > -1) {\n    parts.attribute = line.substr(sp + 1, colon - sp - 1);\n    parts.value = line.substr(colon + 1);\n  } else {\n    parts.attribute = line.substr(sp + 1);\n  }\n  return parts;\n};\n\nSDPUtils.parseSsrcGroup = function(line) {\n  var parts = line.substr(13).split(' ');\n  return {\n    semantics: parts.shift(),\n    ssrcs: parts.map(function(ssrc) {\n      return parseInt(ssrc, 10);\n    })\n  };\n};\n\n// Extracts the MID (RFC 5888) from a media section.\n// returns the MID or undefined if no mid line was found.\nSDPUtils.getMid = function(mediaSection) {\n  var mid = SDPUtils.matchPrefix(mediaSection, 'a=mid:')[0];\n  if (mid) {\n    return mid.substr(6);\n  }\n};\n\nSDPUtils.parseFingerprint = function(line) {\n  var parts = line.substr(14).split(' ');\n  return {\n    algorithm: parts[0].toLowerCase(), // algorithm is case-sensitive in Edge.\n    value: parts[1]\n  };\n};\n\n// Extracts DTLS parameters from SDP media section or sessionpart.\n// FIXME: for consistency with other functions this should only\n//   get the fingerprint line as input. See also getIceParameters.\nSDPUtils.getDtlsParameters = function(mediaSection, sessionpart) {\n  var lines = SDPUtils.matchPrefix(mediaSection + sessionpart,\n    'a=fingerprint:');\n  // Note: a=setup line is ignored since we use the 'auto' role.\n  // Note2: 'algorithm' is not case sensitive except in Edge.\n  return {\n    role: 'auto',\n    fingerprints: lines.map(SDPUtils.parseFingerprint)\n  };\n};\n\n// Serializes DTLS parameters to SDP.\nSDPUtils.writeDtlsParameters = function(params, setupType) {\n  var sdp = 'a=setup:' + setupType + '\\r\\n';\n  params.fingerprints.forEach(function(fp) {\n    sdp += 'a=fingerprint:' + fp.algorithm + ' ' + fp.value + '\\r\\n';\n  });\n  return sdp;\n};\n\n// Parses a=crypto lines into\n//   https://rawgit.com/aboba/edgertc/master/msortc-rs4.html#dictionary-rtcsrtpsdesparameters-members\nSDPUtils.parseCryptoLine = function(line) {\n  var parts = line.substr(9).split(' ');\n  return {\n    tag: parseInt(parts[0], 10),\n    cryptoSuite: parts[1],\n    keyParams: parts[2],\n    sessionParams: parts.slice(3),\n  };\n};\n\nSDPUtils.writeCryptoLine = function(parameters) {\n  return 'a=crypto:' + parameters.tag + ' ' +\n    parameters.cryptoSuite + ' ' +\n    (typeof parameters.keyParams === 'object'\n      ? SDPUtils.writeCryptoKeyParams(parameters.keyParams)\n      : parameters.keyParams) +\n    (parameters.sessionParams ? ' ' + parameters.sessionParams.join(' ') : '') +\n    '\\r\\n';\n};\n\n// Parses the crypto key parameters into\n//   https://rawgit.com/aboba/edgertc/master/msortc-rs4.html#rtcsrtpkeyparam*\nSDPUtils.parseCryptoKeyParams = function(keyParams) {\n  if (keyParams.indexOf('inline:') !== 0) {\n    return null;\n  }\n  var parts = keyParams.substr(7).split('|');\n  return {\n    keyMethod: 'inline',\n    keySalt: parts[0],\n    lifeTime: parts[1],\n    mkiValue: parts[2] ? parts[2].split(':')[0] : undefined,\n    mkiLength: parts[2] ? parts[2].split(':')[1] : undefined,\n  };\n};\n\nSDPUtils.writeCryptoKeyParams = function(keyParams) {\n  return keyParams.keyMethod + ':'\n    + keyParams.keySalt +\n    (keyParams.lifeTime ? '|' + keyParams.lifeTime : '') +\n    (keyParams.mkiValue && keyParams.mkiLength\n      ? '|' + keyParams.mkiValue + ':' + keyParams.mkiLength\n      : '');\n};\n\n// Extracts all SDES paramters.\nSDPUtils.getCryptoParameters = function(mediaSection, sessionpart) {\n  var lines = SDPUtils.matchPrefix(mediaSection + sessionpart,\n    'a=crypto:');\n  return lines.map(SDPUtils.parseCryptoLine);\n};\n\n// Parses ICE information from SDP media section or sessionpart.\n// FIXME: for consistency with other functions this should only\n//   get the ice-ufrag and ice-pwd lines as input.\nSDPUtils.getIceParameters = function(mediaSection, sessionpart) {\n  var ufrag = SDPUtils.matchPrefix(mediaSection + sessionpart,\n    'a=ice-ufrag:')[0];\n  var pwd = SDPUtils.matchPrefix(mediaSection + sessionpart,\n    'a=ice-pwd:')[0];\n  if (!(ufrag && pwd)) {\n    return null;\n  }\n  return {\n    usernameFragment: ufrag.substr(12),\n    password: pwd.substr(10),\n  };\n};\n\n// Serializes ICE parameters to SDP.\nSDPUtils.writeIceParameters = function(params) {\n  return 'a=ice-ufrag:' + params.usernameFragment + '\\r\\n' +\n      'a=ice-pwd:' + params.password + '\\r\\n';\n};\n\n// Parses the SDP media section and returns RTCRtpParameters.\nSDPUtils.parseRtpParameters = function(mediaSection) {\n  var description = {\n    codecs: [],\n    headerExtensions: [],\n    fecMechanisms: [],\n    rtcp: []\n  };\n  var lines = SDPUtils.splitLines(mediaSection);\n  var mline = lines[0].split(' ');\n  for (var i = 3; i < mline.length; i++) { // find all codecs from mline[3..]\n    var pt = mline[i];\n    var rtpmapline = SDPUtils.matchPrefix(\n      mediaSection, 'a=rtpmap:' + pt + ' ')[0];\n    if (rtpmapline) {\n      var codec = SDPUtils.parseRtpMap(rtpmapline);\n      var fmtps = SDPUtils.matchPrefix(\n        mediaSection, 'a=fmtp:' + pt + ' ');\n      // Only the first a=fmtp:<pt> is considered.\n      codec.parameters = fmtps.length ? SDPUtils.parseFmtp(fmtps[0]) : {};\n      codec.rtcpFeedback = SDPUtils.matchPrefix(\n        mediaSection, 'a=rtcp-fb:' + pt + ' ')\n        .map(SDPUtils.parseRtcpFb);\n      description.codecs.push(codec);\n      // parse FEC mechanisms from rtpmap lines.\n      switch (codec.name.toUpperCase()) {\n        case 'RED':\n        case 'ULPFEC':\n          description.fecMechanisms.push(codec.name.toUpperCase());\n          break;\n        default: // only RED and ULPFEC are recognized as FEC mechanisms.\n          break;\n      }\n    }\n  }\n  SDPUtils.matchPrefix(mediaSection, 'a=extmap:').forEach(function(line) {\n    description.headerExtensions.push(SDPUtils.parseExtmap(line));\n  });\n  // FIXME: parse rtcp.\n  return description;\n};\n\n// Generates parts of the SDP media section describing the capabilities /\n// parameters.\nSDPUtils.writeRtpDescription = function(kind, caps) {\n  var sdp = '';\n\n  // Build the mline.\n  sdp += 'm=' + kind + ' ';\n  sdp += caps.codecs.length > 0 ? '9' : '0'; // reject if no codecs.\n  sdp += ' UDP/TLS/RTP/SAVPF ';\n  sdp += caps.codecs.map(function(codec) {\n    if (codec.preferredPayloadType !== undefined) {\n      return codec.preferredPayloadType;\n    }\n    return codec.payloadType;\n  }).join(' ') + '\\r\\n';\n\n  sdp += 'c=IN IP4 0.0.0.0\\r\\n';\n  sdp += 'a=rtcp:9 IN IP4 0.0.0.0\\r\\n';\n\n  // Add a=rtpmap lines for each codec. Also fmtp and rtcp-fb.\n  caps.codecs.forEach(function(codec) {\n    sdp += SDPUtils.writeRtpMap(codec);\n    sdp += SDPUtils.writeFmtp(codec);\n    sdp += SDPUtils.writeRtcpFb(codec);\n  });\n  var maxptime = 0;\n  caps.codecs.forEach(function(codec) {\n    if (codec.maxptime > maxptime) {\n      maxptime = codec.maxptime;\n    }\n  });\n  if (maxptime > 0) {\n    sdp += 'a=maxptime:' + maxptime + '\\r\\n';\n  }\n  sdp += 'a=rtcp-mux\\r\\n';\n\n  if (caps.headerExtensions) {\n    caps.headerExtensions.forEach(function(extension) {\n      sdp += SDPUtils.writeExtmap(extension);\n    });\n  }\n  // FIXME: write fecMechanisms.\n  return sdp;\n};\n\n// Parses the SDP media section and returns an array of\n// RTCRtpEncodingParameters.\nSDPUtils.parseRtpEncodingParameters = function(mediaSection) {\n  var encodingParameters = [];\n  var description = SDPUtils.parseRtpParameters(mediaSection);\n  var hasRed = description.fecMechanisms.indexOf('RED') !== -1;\n  var hasUlpfec = description.fecMechanisms.indexOf('ULPFEC') !== -1;\n\n  // filter a=ssrc:... cname:, ignore PlanB-msid\n  var ssrcs = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n    .map(function(line) {\n      return SDPUtils.parseSsrcMedia(line);\n    })\n    .filter(function(parts) {\n      return parts.attribute === 'cname';\n    });\n  var primarySsrc = ssrcs.length > 0 && ssrcs[0].ssrc;\n  var secondarySsrc;\n\n  var flows = SDPUtils.matchPrefix(mediaSection, 'a=ssrc-group:FID')\n    .map(function(line) {\n      var parts = line.substr(17).split(' ');\n      return parts.map(function(part) {\n        return parseInt(part, 10);\n      });\n    });\n  if (flows.length > 0 && flows[0].length > 1 && flows[0][0] === primarySsrc) {\n    secondarySsrc = flows[0][1];\n  }\n\n  description.codecs.forEach(function(codec) {\n    if (codec.name.toUpperCase() === 'RTX' && codec.parameters.apt) {\n      var encParam = {\n        ssrc: primarySsrc,\n        codecPayloadType: parseInt(codec.parameters.apt, 10)\n      };\n      if (primarySsrc && secondarySsrc) {\n        encParam.rtx = {ssrc: secondarySsrc};\n      }\n      encodingParameters.push(encParam);\n      if (hasRed) {\n        encParam = JSON.parse(JSON.stringify(encParam));\n        encParam.fec = {\n          ssrc: primarySsrc,\n          mechanism: hasUlpfec ? 'red+ulpfec' : 'red'\n        };\n        encodingParameters.push(encParam);\n      }\n    }\n  });\n  if (encodingParameters.length === 0 && primarySsrc) {\n    encodingParameters.push({\n      ssrc: primarySsrc\n    });\n  }\n\n  // we support both b=AS and b=TIAS but interpret AS as TIAS.\n  var bandwidth = SDPUtils.matchPrefix(mediaSection, 'b=');\n  if (bandwidth.length) {\n    if (bandwidth[0].indexOf('b=TIAS:') === 0) {\n      bandwidth = parseInt(bandwidth[0].substr(7), 10);\n    } else if (bandwidth[0].indexOf('b=AS:') === 0) {\n      // use formula from JSEP to convert b=AS to TIAS value.\n      bandwidth = parseInt(bandwidth[0].substr(5), 10) * 1000 * 0.95\n          - (50 * 40 * 8);\n    } else {\n      bandwidth = undefined;\n    }\n    encodingParameters.forEach(function(params) {\n      params.maxBitrate = bandwidth;\n    });\n  }\n  return encodingParameters;\n};\n\n// parses http://draft.ortc.org/#rtcrtcpparameters*\nSDPUtils.parseRtcpParameters = function(mediaSection) {\n  var rtcpParameters = {};\n\n  // Gets the first SSRC. Note tha with RTX there might be multiple\n  // SSRCs.\n  var remoteSsrc = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n    .map(function(line) {\n      return SDPUtils.parseSsrcMedia(line);\n    })\n    .filter(function(obj) {\n      return obj.attribute === 'cname';\n    })[0];\n  if (remoteSsrc) {\n    rtcpParameters.cname = remoteSsrc.value;\n    rtcpParameters.ssrc = remoteSsrc.ssrc;\n  }\n\n  // Edge uses the compound attribute instead of reducedSize\n  // compound is !reducedSize\n  var rsize = SDPUtils.matchPrefix(mediaSection, 'a=rtcp-rsize');\n  rtcpParameters.reducedSize = rsize.length > 0;\n  rtcpParameters.compound = rsize.length === 0;\n\n  // parses the rtcp-mux attrbute.\n  // Note that Edge does not support unmuxed RTCP.\n  var mux = SDPUtils.matchPrefix(mediaSection, 'a=rtcp-mux');\n  rtcpParameters.mux = mux.length > 0;\n\n  return rtcpParameters;\n};\n\n// parses either a=msid: or a=ssrc:... msid lines and returns\n// the id of the MediaStream and MediaStreamTrack.\nSDPUtils.parseMsid = function(mediaSection) {\n  var parts;\n  var spec = SDPUtils.matchPrefix(mediaSection, 'a=msid:');\n  if (spec.length === 1) {\n    parts = spec[0].substr(7).split(' ');\n    return {stream: parts[0], track: parts[1]};\n  }\n  var planB = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n    .map(function(line) {\n      return SDPUtils.parseSsrcMedia(line);\n    })\n    .filter(function(msidParts) {\n      return msidParts.attribute === 'msid';\n    });\n  if (planB.length > 0) {\n    parts = planB[0].value.split(' ');\n    return {stream: parts[0], track: parts[1]};\n  }\n};\n\n// SCTP\n// parses draft-ietf-mmusic-sctp-sdp-26 first and falls back\n// to draft-ietf-mmusic-sctp-sdp-05\nSDPUtils.parseSctpDescription = function(mediaSection) {\n  var mline = SDPUtils.parseMLine(mediaSection);\n  var maxSizeLine = SDPUtils.matchPrefix(mediaSection, 'a=max-message-size:');\n  var maxMessageSize;\n  if (maxSizeLine.length > 0) {\n    maxMessageSize = parseInt(maxSizeLine[0].substr(19), 10);\n  }\n  if (isNaN(maxMessageSize)) {\n    maxMessageSize = 65536;\n  }\n  var sctpPort = SDPUtils.matchPrefix(mediaSection, 'a=sctp-port:');\n  if (sctpPort.length > 0) {\n    return {\n      port: parseInt(sctpPort[0].substr(12), 10),\n      protocol: mline.fmt,\n      maxMessageSize: maxMessageSize\n    };\n  }\n  var sctpMapLines = SDPUtils.matchPrefix(mediaSection, 'a=sctpmap:');\n  if (sctpMapLines.length > 0) {\n    var parts = SDPUtils.matchPrefix(mediaSection, 'a=sctpmap:')[0]\n      .substr(10)\n      .split(' ');\n    return {\n      port: parseInt(parts[0], 10),\n      protocol: parts[1],\n      maxMessageSize: maxMessageSize\n    };\n  }\n};\n\n// SCTP\n// outputs the draft-ietf-mmusic-sctp-sdp-26 version that all browsers\n// support by now receiving in this format, unless we originally parsed\n// as the draft-ietf-mmusic-sctp-sdp-05 format (indicated by the m-line\n// protocol of DTLS/SCTP -- without UDP/ or TCP/)\nSDPUtils.writeSctpDescription = function(media, sctp) {\n  var output = [];\n  if (media.protocol !== 'DTLS/SCTP') {\n    output = [\n      'm=' + media.kind + ' 9 ' + media.protocol + ' ' + sctp.protocol + '\\r\\n',\n      'c=IN IP4 0.0.0.0\\r\\n',\n      'a=sctp-port:' + sctp.port + '\\r\\n'\n    ];\n  } else {\n    output = [\n      'm=' + media.kind + ' 9 ' + media.protocol + ' ' + sctp.port + '\\r\\n',\n      'c=IN IP4 0.0.0.0\\r\\n',\n      'a=sctpmap:' + sctp.port + ' ' + sctp.protocol + ' 65535\\r\\n'\n    ];\n  }\n  if (sctp.maxMessageSize !== undefined) {\n    output.push('a=max-message-size:' + sctp.maxMessageSize + '\\r\\n');\n  }\n  return output.join('');\n};\n\n// Generate a session ID for SDP.\n// https://tools.ietf.org/html/draft-ietf-rtcweb-jsep-20#section-5.2.1\n// recommends using a cryptographically random +ve 64-bit value\n// but right now this should be acceptable and within the right range\nSDPUtils.generateSessionId = function() {\n  return Math.random().toString().substr(2, 21);\n};\n\n// Write boilder plate for start of SDP\n// sessId argument is optional - if not supplied it will\n// be generated randomly\n// sessVersion is optional and defaults to 2\n// sessUser is optional and defaults to 'thisisadapterortc'\nSDPUtils.writeSessionBoilerplate = function(sessId, sessVer, sessUser) {\n  var sessionId;\n  var version = sessVer !== undefined ? sessVer : 2;\n  if (sessId) {\n    sessionId = sessId;\n  } else {\n    sessionId = SDPUtils.generateSessionId();\n  }\n  var user = sessUser || 'thisisadapterortc';\n  // FIXME: sess-id should be an NTP timestamp.\n  return 'v=0\\r\\n' +\n      'o=' + user + ' ' + sessionId + ' ' + version +\n        ' IN IP4 127.0.0.1\\r\\n' +\n      's=-\\r\\n' +\n      't=0 0\\r\\n';\n};\n\nSDPUtils.writeMediaSection = function(transceiver, caps, type, stream) {\n  var sdp = SDPUtils.writeRtpDescription(transceiver.kind, caps);\n\n  // Map ICE parameters (ufrag, pwd) to SDP.\n  sdp += SDPUtils.writeIceParameters(\n    transceiver.iceGatherer.getLocalParameters());\n\n  // Map DTLS parameters to SDP.\n  sdp += SDPUtils.writeDtlsParameters(\n    transceiver.dtlsTransport.getLocalParameters(),\n    type === 'offer' ? 'actpass' : 'active');\n\n  sdp += 'a=mid:' + transceiver.mid + '\\r\\n';\n\n  if (transceiver.direction) {\n    sdp += 'a=' + transceiver.direction + '\\r\\n';\n  } else if (transceiver.rtpSender && transceiver.rtpReceiver) {\n    sdp += 'a=sendrecv\\r\\n';\n  } else if (transceiver.rtpSender) {\n    sdp += 'a=sendonly\\r\\n';\n  } else if (transceiver.rtpReceiver) {\n    sdp += 'a=recvonly\\r\\n';\n  } else {\n    sdp += 'a=inactive\\r\\n';\n  }\n\n  if (transceiver.rtpSender) {\n    // spec.\n    var msid = 'msid:' + stream.id + ' ' +\n        transceiver.rtpSender.track.id + '\\r\\n';\n    sdp += 'a=' + msid;\n\n    // for Chrome.\n    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\n        ' ' + msid;\n    if (transceiver.sendEncodingParameters[0].rtx) {\n      sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\n          ' ' + msid;\n      sdp += 'a=ssrc-group:FID ' +\n          transceiver.sendEncodingParameters[0].ssrc + ' ' +\n          transceiver.sendEncodingParameters[0].rtx.ssrc +\n          '\\r\\n';\n    }\n  }\n  // FIXME: this should be written by writeRtpDescription.\n  sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\n      ' cname:' + SDPUtils.localCName + '\\r\\n';\n  if (transceiver.rtpSender && transceiver.sendEncodingParameters[0].rtx) {\n    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\n        ' cname:' + SDPUtils.localCName + '\\r\\n';\n  }\n  return sdp;\n};\n\n// Gets the direction from the mediaSection or the sessionpart.\nSDPUtils.getDirection = function(mediaSection, sessionpart) {\n  // Look for sendrecv, sendonly, recvonly, inactive, default to sendrecv.\n  var lines = SDPUtils.splitLines(mediaSection);\n  for (var i = 0; i < lines.length; i++) {\n    switch (lines[i]) {\n      case 'a=sendrecv':\n      case 'a=sendonly':\n      case 'a=recvonly':\n      case 'a=inactive':\n        return lines[i].substr(2);\n      default:\n        // FIXME: What should happen here?\n    }\n  }\n  if (sessionpart) {\n    return SDPUtils.getDirection(sessionpart);\n  }\n  return 'sendrecv';\n};\n\nSDPUtils.getKind = function(mediaSection) {\n  var lines = SDPUtils.splitLines(mediaSection);\n  var mline = lines[0].split(' ');\n  return mline[0].substr(2);\n};\n\nSDPUtils.isRejected = function(mediaSection) {\n  return mediaSection.split(' ', 2)[1] === '0';\n};\n\nSDPUtils.parseMLine = function(mediaSection) {\n  var lines = SDPUtils.splitLines(mediaSection);\n  var parts = lines[0].substr(2).split(' ');\n  return {\n    kind: parts[0],\n    port: parseInt(parts[1], 10),\n    protocol: parts[2],\n    fmt: parts.slice(3).join(' ')\n  };\n};\n\nSDPUtils.parseOLine = function(mediaSection) {\n  var line = SDPUtils.matchPrefix(mediaSection, 'o=')[0];\n  var parts = line.substr(2).split(' ');\n  return {\n    username: parts[0],\n    sessionId: parts[1],\n    sessionVersion: parseInt(parts[2], 10),\n    netType: parts[3],\n    addressType: parts[4],\n    address: parts[5]\n  };\n};\n\n// a very naive interpretation of a valid SDP.\nSDPUtils.isValidSDP = function(blob) {\n  if (typeof blob !== 'string' || blob.length === 0) {\n    return false;\n  }\n  var lines = SDPUtils.splitLines(blob);\n  for (var i = 0; i < lines.length; i++) {\n    if (lines[i].length < 2 || lines[i].charAt(1) !== '=') {\n      return false;\n    }\n    // TODO: check the modifier a bit more.\n  }\n  return true;\n};\n\n// Expose public methods.\nif (typeof module === 'object') {\n  module.exports = SDPUtils;\n}\n","\r\n\r\nimport Janus from './janus-plugin-videoroom';\r\nimport JoinedInfo from './janus-plugin-videoroom';\r\n\r\ninterface ILiteEvent<T> {\r\n    on(handler: { (data?: T): void }): void;\r\n    off(handler: { (data?: T): void }): void;\r\n}\r\n/**\r\n * https://stackoverflow.com/questions/12881212/does-typescript-support-events-on-classes?answertab=votes\r\n */\r\nclass LiteEvent<T> implements ILiteEvent<T> {\r\n    private handlers: { (data?: T): void; }[] = [];\r\n\r\n    public on(handler: { (data?: T): void }): void {\r\n        this.handlers.push(handler);\r\n    }\r\n\r\n    public off(handler: { (data?: T): void }): void {\r\n        this.handlers = this.handlers.filter(h => h !== handler);\r\n    }\r\n\r\n    public trigger(data?: T) {\r\n        this.handlers.slice(0).forEach(h => h(data));\r\n    }\r\n\r\n    public expose(): ILiteEvent<T> {\r\n        return this;\r\n    }\r\n}\r\n\r\n\r\n/**\r\n * janus  room helper classs\r\n */\r\nclass JanusRoom {\r\n    _address: string\r\n    _options: any\r\n    listVideoroomPlugin: Array<Janus.videoroomPlugin>\r\n    JanusClient: Janus.client;\r\n    connection: Janus.Connection;\r\n    session: Janus.Session;\r\n    videoroomPlugin: Janus.videoroomPlugin;\r\n    roomId: string;\r\n    /**\r\n     * first join info result type: \"publisher\"\r\n     */\r\n    joinedInfo: JoinedInfo\r\n    CreatedInfo: JoinedInfo\r\n    private readonly onRoomjoined = new LiteEvent<JoinedInfo>();\r\n    private readonly onRemoteRoomAttached = new LiteEvent<JoinedInfo>();\r\n    private readonly onRoomCreated = new LiteEvent<void>();\r\n    private readonly onNeedVideoLocal = new LiteEvent<void>();\r\n    private readonly onNeedVideoRemote = new LiteEvent<void>();\r\n    /**\r\n     * when remote-feed not video and audio published\r\n     */\r\n    private readonly onUnpublished = new LiteEvent<number>();\r\n    /**\r\n     * when remote-feed leaving\r\n     */\r\n    private readonly onLeaving = new LiteEvent<number>();\r\n    /**\r\n     * \r\n     * @param address \"wss://janus.conf.meetecho.com/ws\"\r\n     * @param options {keepalive: 'true' }\r\n     */\r\n    constructor(address, options: any) {\r\n        this._address = address || \"wss://janus.conf.meetecho.com/ws\";\r\n        this._options = options || {\r\n            keepalive: 'true'\r\n        };\r\n    }\r\n    // no-video-container\r\n    /**\r\n     * event rome joined sucsess\r\n     */\r\n    public get eventRoomjoined() { return this.onRoomjoined.expose(); }\r\n    /**\r\n     * event rome joined for feed\r\n     */\r\n    public get eventRemoteRoomAttached() { return this.onRemoteRoomAttached.expose(); }\r\n    /**\r\n      * event rome Created\r\n      */\r\n    public get eventRoomCreated() { return this.onRoomCreated.expose(); }\r\n    /**\r\n     * need tag video html for local\r\n     */\r\n    public get eventNeedVideoLocal() { return this.onNeedVideoLocal.expose(); }\r\n    /**\r\n     * need tag video html for remote\r\n     */\r\n    public get eventNeedVideoRemote() { return this.onNeedVideoRemote.expose(); }\r\n    /**\r\n     * when remote-feed not video and audio published\r\n     */\r\n    public get eventOnUnpublished() { return this.onUnpublished.expose(); }\r\n    /**\r\n     * when remote-feed leaving\r\n     */\r\n    public get eventOnLeaving() { return this.onLeaving.expose(); }\r\n    /**\r\n     *janus create new Connection\r\n     */\r\n    private async createConnection(): Promise<any> {\r\n        if (!this.connection) {\r\n            let url = 'wss://janus.roomler.live/janus_ws';\r\n            url = \"wss://janus.conf.meetecho.com/ws\"\r\n            this.JanusClient = new Janus.Client(this._address, this._options)\r\n            this.connection = await this.JanusClient.createConnection('client');\r\n        }\r\n        return this.connection;\r\n    }\r\n    /**\r\n     *janus create new Session\r\n     */\r\n    private async createSession(): Promise<any> {\r\n        if (!this.session) {\r\n            await this.createConnection();\r\n            this.session = await this.connection.createSession();\r\n        }\r\n        return this;\r\n    }\r\n    /**\r\n     * create  VideoroomPlugin  object\r\n     */\r\n    private async createVideoRoomPlugin() {\r\n        var _self = this;\r\n        await this.createSession();\r\n        if (!this.videoroomPlugin) {\r\n            this.videoroomPlugin = await this.session.attachPlugin(Janus.VideoroomPlugin.NAME);\r\n            this.videoroomPlugin.on('consent-dialog:stop', (trackInfo => {\r\n                var elementinfo: any = { element: null };\r\n                _self.onNeedVideoLocal.trigger(elementinfo);\r\n                _self.videoroomPlugin.attachMediaStream(elementinfo.element, trackInfo.stream);\r\n                console.log('pc:track:local');\r\n            }));\r\n            this.videoroomPlugin.on('videoroom-remote-feed:publishers', (data) => { this.videoroomRremoteFeedPublishers(_self, data) });\r\n            /**\r\n             *  when remote-feed not video and audio published\r\n             */\r\n            this.videoroomPlugin.on('videoroom-remote-feed:unpublished', (feedId: number) => { this.onUnpublished.trigger(feedId) });\r\n            /**\r\n             * when remote-feed leaving\r\n             */\r\n            this.videoroomPlugin.on('videoroom-remote-feed:leaving', (feedId: number) => { this.onLeaving.trigger(feedId) });\r\n        }\r\n        return this;\r\n    }\r\n    /**\r\n     * join room for feed subscriber\r\n     * @param _self JanusRoom\r\n     * @param data {publishers}\r\n     */\r\n    private async videoroomRremoteFeedPublishers(_self: JanusRoom, data: any) {\r\n        if (data.publishers) {\r\n            let publishers: Array<any> = data.publishers;\r\n            for (const feedInfo of publishers) {\r\n                let dataResult = await _self.remoteJoinRoomSubscriber(_self, feedInfo);\r\n                dataResult.videoroomPlugin.createPeerConnection();\r\n                let mediaConstraints = {};//{ audio: false, video: false };\r\n                let jsepResult = await dataResult.videoroomPlugin.createAnswer(dataResult.dataAttached._plainMessage.jsep, mediaConstraints);\r\n                await dataResult.videoroomPlugin.start(_self.roomId, jsepResult)\r\n            }\r\n        }\r\n    }\r\n    /**\r\n     * create private VideoroomPlugin for feed  remote client\r\n     * @param _self \r\n     * @param feedInfo \r\n     */\r\n    private remoteCreateVideoroomPlugin = async (_self: JanusRoom, feedInfo: any) => {\r\n        //TODO check Session not  null\r\n        await _self.createSession();\r\n        let videoroomPlugin = await _self.session.attachPlugin(Janus.VideoroomPlugin.NAME);\r\n        videoroomPlugin.on(\"pc:track:remote\", (event: any) => {\r\n            var elementinfo: any = { element: null, feedInfo: feedInfo };\r\n            _self.onNeedVideoRemote.trigger(elementinfo);\r\n            videoroomPlugin.attachMediaStream(elementinfo.element, event.streams[0]);\r\n        })\r\n        return videoroomPlugin;\r\n    }\r\n\r\n    /**\r\n     * new room\r\n     * @param option \r\n     */\r\n    newRoom = async (options = { publishers: 30, description: \"roomtest\" }) => {\r\n        await this.createVideoRoomPlugin();\r\n        let data: any = await this.videoroomPlugin.newRoom(options);\r\n        this.roomId = data._plainMessage.plugindata.data.room;\r\n        return this.roomId;\r\n    }\r\n    /**\r\n     *    \r\n     * @param roomId \r\n     * @param display \r\n     * @param options \r\n     */\r\n    joinRoom = async (roomId: string, display: string = \"anyName\", options: any = { \"ptype\": \"publisher\" }) => {\r\n        this.roomId = roomId;\r\n        options.room = roomId;\r\n        options.display = display;\r\n        await this.createVideoRoomPlugin();\r\n        var data = await this.videoroomPlugin.joinRoom(options);\r\n        this.onRoomjoined.trigger(data);\r\n        this.joinedInfo = data._plainMessage.plugindata.data;\r\n        await this.videoroomPlugin.processLocalVideo({ audio: true, video: true }, this.joinedInfo);\r\n        return data;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param _self join room for feed subscriber\r\n     * @param feedInfo \r\n     */\r\n    remoteJoinRoomSubscriber = async (_self: JanusRoom, feedInfo: any) => {\r\n        let videoroomPlugin = await _self.remoteCreateVideoroomPlugin(_self, feedInfo);\r\n        //TODO check joinedInfo\r\n        let options: any = { \"ptype\": \"subscriber\" };\r\n        options.feed = feedInfo.id;\r\n        //TODO check roomId\r\n        options.room = _self.joinedInfo.room;\r\n        //TODO check private_id\r\n        options.private_id = _self.joinedInfo.private_id;\r\n        let dataAttached = await videoroomPlugin.joinRoom(options);\r\n        return { dataAttached: dataAttached, videoroomPlugin: videoroomPlugin }\r\n    }\r\n    async publishOwnFeed() {\r\n        // /\t$('#publish').attr('disabled', true).unbind('click');\r\n\r\n    }\r\n}\r\nJanus.JanusRoom = JanusRoom;\r\nexport default Janus;","import adapter from 'webrtc-adapter';\r\n//https://github.com/otalk/attachMediaStream/blob/master/attachmediastream.js\r\nexport default function (el, stream, options = null) {\r\n    var item;\r\n    var element = el;\r\n    var opts = {\r\n        autoplay: true,\r\n        mirror: false,\r\n        muted: false,\r\n        audio: false,\r\n        disableContextMenu: false\r\n    };\r\n\r\n    if (options) {\r\n        for (item in options) {\r\n            opts[item] = options[item];\r\n        }\r\n    }\r\n\r\n    if (!element) {\r\n        element = document.createElement(opts.audio ? 'audio' : 'video');\r\n    } else if (element.tagName.toLowerCase() === 'audio') {\r\n        opts.audio = true;\r\n    }\r\n\r\n    if (opts.disableContextMenu) {\r\n        element.oncontextmenu = function (e) {\r\n            e.preventDefault();\r\n        };\r\n    }\r\n\r\n    if (opts.autoplay) element.autoplay = 'autoplay';\r\n    element.muted = !!opts.muted;\r\n    if (!opts.audio) {\r\n        ['', 'moz', 'webkit', 'o', 'ms'].forEach(function (prefix) {\r\n            var styleName = prefix ? prefix + 'Transform' : 'transform';\r\n            element.style[styleName] = opts.mirror ? 'scaleX(-1)' : 'scaleX(1)';\r\n        });\r\n    }\r\n\r\n    if (adapter.browserDetails.browser === 'safari') {\r\n        element.setAttribute('playsinline', true);\r\n    }\r\n\r\n    element.srcObject = stream;\r\n\r\n    try {\r\n        element.srcObject = stream;\r\n    } catch (e) {\r\n        try {\r\n            element.src = URL.createObjectURL(stream);\r\n        } catch (e) {\r\n            throw new Error(\"Error attaching stream to element\");\r\n        }\r\n    }\r\n    return element;\r\n}","import * as Promise from 'bluebird'\r\nglobal.Promise = Promise\r\nimport * as Janus from 'janus-gateway-js';\r\nimport * as Helpers from 'janus-gateway-js/src/helpers';\r\nimport attachmediastream from './attachmediastream'\r\n\r\nexport interface joinOption {\r\n  room: string;\r\n  ptype: string;\r\n  display: string;\r\n  feed: number\r\n}\r\n\r\n/**\r\n * Janus Server Response Structure after joined\r\n * joined event data\r\n */\r\nexport interface JoinedInfo {\r\n  videoroom: string;\r\n  room: number;\r\n  description: string;\r\n  id: number;\r\n  private_id: number;\r\n  publishers: any[];\r\n}\r\nfunction VideoroomPlugin() {\r\n  Janus.MediaPlugin.apply(this, arguments);\r\n}\r\n//TODO: convert to  class VideoroomPlugin{\r\nVideoroomPlugin.NAME = 'janus.plugin.videoroom';\r\nVideoroomPlugin.super_ = null;\r\nHelpers.inherits(VideoroomPlugin, Janus.MediaPlugin);\r\nJanus.Plugin.register(VideoroomPlugin.NAME, VideoroomPlugin);\r\n\r\n/**\r\n * @param {boolean} state\r\n * @returns {Promise}\r\n * @fulfilled {RTCSessionDescription} jsep\r\n */\r\nVideoroomPlugin.prototype.processLocalVideo = function (option : any , joinedInfo: JoinedInfo) {\r\n  option = option || {};\r\n  option = Helpers.extend({ audio: true, video: true }, option);\r\n  var self = this;\r\n  return new Promise<any>((resolve, reject) => {\r\n    self.getUserMedia(option)\r\n      .then(function (stream) {\r\n        self.createPeerConnection();\r\n        stream.getTracks().forEach(function (track) {\r\n          self.addTrack(track, stream);\r\n        });\r\n      })\r\n      .then(function () {\r\n        return self.createOffer();\r\n      })\r\n      .then(function (jsep) {\r\n        return self.configure(option, jsep)\r\n      })\r\n      .then(function (response) {\r\n        var jsep = response.get('jsep');\r\n        if (jsep) {\r\n          self.setRemoteSDP(jsep);\r\n          console.debug();\r\n          self.processIncomeMessagePublishers(joinedInfo.publishers);\r\n          resolve(jsep)\r\n        }\r\n      });\r\n  })\r\n};\r\nVideoroomPlugin.prototype.processRemoteVideo = function (roomId: number, attachedJsep: RTCSessionDescription) {\r\n  var self = this;\r\n  return new Promise<any>((resolve, reject) => {\r\n    self.createAnswer(attachedJsep, { audio: false, video: false })\r\n      .then(function (jsepResult) {\r\n        return self.start(roomId, jsepResult);\r\n      })\r\n      .then(function (response) {\r\n        //TODO check error\r\n        // started: \"ok\"\r\n        resolve()\r\n      });\r\n  })\r\n};\r\n\r\n/**\r\n * @param {Object} [options]\r\n * @param {boolean} [options.muted]\r\n * @param {number} [options.quality]\r\n * @param {RTCSessionDescription} [jsep]\r\n * @returns {Promise}\r\n * @fulfilled {JanusPluginMessage} response\r\n */\r\nVideoroomPlugin.prototype.configure = function (options: any, jsep: any) {\r\n  var body = Helpers.extend({\r\n    request: 'configure'\r\n  }, options);\r\n  var message: any = { body: body };\r\n  if (jsep) {\r\n    message.jsep = jsep;\r\n  }\r\n  return this.sendWithTransaction(message);\r\n};\r\n\r\n/**\r\n * @param {MediaStream} stream\r\n * @param {RTCOfferOptions} [offerOptions]\r\n * @param {Object} [configureOptions]\r\n * @param {boolean} [configureOptions.muted]\r\n * @param {number} [configureOptions.quality]\r\n * @returns {Promise}\r\n * @fulfilled {@link sendSDP}\r\n */\r\n/*\r\nVideoroomPlugin.prototype.offerStream = function (stream, offerOptions, configureOptions) {\r\n  var self = this;\r\n  return Promise\r\n    .try(function () {\r\n      self.createPeerConnection();\r\n      stream.getAudioTracks().forEach(function (track) {\r\n        self.addTrack(track, stream);\r\n      });\r\n    })\r\n    .then(function () {\r\n      return self.createOffer(offerOptions);\r\n    })\r\n    .then(function (jsep) {\r\n      return self.sendSDP(jsep, configureOptions);\r\n    });\r\n};\r\n*/\r\n\r\n/**\r\n * @param {RTCSessionDescription} jsep\r\n * @param {Object} [configureOptions]\r\n * @param {boolean} [configureOptions.muted]\r\n * @param {number} [configureOptions.quality]\r\n * @returns {Promise}\r\n * @fulfilled {RTCSessionDescription}\r\n */\r\nVideoroomPlugin.prototype.sendSDP = function (jsep: any, configureOptions: any) {\r\n  return this.configure(configureOptions, jsep)\r\n    .then(function (response: any) {\r\n      var jsep = response.get('jsep');\r\n      if (jsep) {\r\n        this.setRemoteSDP(jsep);\r\n        return jsep;\r\n      }\r\n      return Promise.reject(new Error('Failed sendSDP. No jsep in response.'));\r\n    }.bind(this));\r\n};\r\n\r\n/**\r\n * @param {Object} options\r\n * @returns {Promise}\r\n * @fulfilled {JanusPluginMessage} list\r\n */\r\nVideoroomPlugin.prototype._listParticipants = function (options) {\r\n  var body = Helpers.extend({ request: 'listparticipants' }, options);\r\n  return this.sendWithTransaction({ body: body });\r\n};\r\n\r\n/**\r\n * @param {string|number} id\r\n * @param {Object} options\r\n * @returns {Promise}\r\n * @fulfilled {JanusPluginMessage} response\r\n */\r\nVideoroomPlugin.prototype._join = function (id, options) {\r\n  var body = Helpers.extend({ request: 'join' }, options);\r\n  return this.sendWithTransaction({ body: body })\r\n    .then(function (response) {\r\n      this.setCurrentEntity(id);\r\n      return response;\r\n    }.bind(this));\r\n};\r\n/**\r\n * crete new room\r\n * options.description\r\n * options.publishers\r\n */\r\nVideoroomPlugin.prototype.newRoom = function (options: any) {\r\n  options.description = options.description ? options.description : \"\";\r\n  options.publishers = options.publishers ? options.publishers : 30;\r\n  return this.sendWithTransaction({\r\n    janus: \"message\", body: {\r\n      request: \"create\", publishers: options.publishers, description: options.description\r\n    }\r\n  })\r\n}\r\n/**\r\n * join to room \r\n */\r\nVideoroomPlugin.prototype.joinRoom = function (options: joinOption) {\r\n  let JoinOptions: any = {\r\n    request: \"join\", room: options.room, ptype: options.ptype, display: options.display\r\n  };\r\n  if (options.ptype == \"subscriber\") {\r\n    JoinOptions.feed = options.feed;\r\n  }\r\n  return this.sendWithTransaction({ janus: \"message\", body: JoinOptions })\r\n}\r\nVideoroomPlugin.prototype.start = function (roomId, jsep: any) {\r\n  // jsep type: \"answer\"\r\n  return this.sendWithTransaction({\r\n    janus: \"message\", body: { request: \"start\", room: roomId },\r\n    jsep: jsep\r\n  })\r\n}\r\n// Helper methods to attach/reattach a stream to a video element (previously part of adapter.js)\r\nVideoroomPlugin.prototype.attachMediaStream = function (element, stream) {\r\n  if (!element) {\r\n    throw new Error(\" attachMediaStream  element is null \")\r\n    return false;\r\n  }\r\n  try {\r\n    return attachmediastream(element, stream);\r\n  }\r\n  catch (e) {\r\n    console.debug(e);\r\n    //TODO:  event error call\r\n    throw new Error(\"Error attaching stream to element\")\r\n    //Janus.error(\"Error attaching stream to element\");\r\n  }\r\n  /*try {\r\n    element.srcObject = stream;\r\n  } catch (e) {\r\n    try {\r\n      element.src = URL.createObjectURL(stream);\r\n    } catch (e) {\r\n      //TODO:  event error call\r\n      throw new Error(\"Error attaching stream to element\")\r\n      //Janus.error(\"Error attaching stream to element\");\r\n    }\r\n  }\r\n  */\r\n};\r\nVideoroomPlugin.reattachMediaStream = function (to, from) {\r\n  try {\r\n    to.srcObject = from.srcObject;\r\n  } catch (e) {\r\n    try {\r\n      to.src = from.src;\r\n    } catch (e) {\r\n      //TODO:  event error call\r\n      throw new Error(\"Error reattaching stream to element\")\r\n      // Janus.error(\"Error reattaching stream to element\");\r\n    }\r\n  }\r\n};\r\n/**\r\n * @see https://developer.mozilla.org/en-US/docs/Web/API/RTCPeerConnection/RTCPeerConnection#RTCConfiguration_dictionary\r\n * @typedef {Object} RTCConfiguration\r\n */\r\n\r\n/**\r\n * @param {RTCConfiguration} [options]\r\n * @returns {RTCPeerConnection}\r\n */\r\nVideoroomPlugin.prototype.createPeerConnection2 = function (options: any) {\r\n  options = options || {};\r\n  var config = {\r\n    iceServers: [{ urls: 'stun:stun.l.google.com:19302' }]\r\n  };\r\n  var constraints = {\r\n    'optional': [{ 'DtlsSrtpKeyAgreement': true }]\r\n  };\r\n  if (options.config) {\r\n    Helpers.extend(config, options.config);\r\n  }\r\n  if (options.constraints) {\r\n    Helpers.extend(constraints, options.constraints);\r\n  }\r\n  return this.super_.prototype.createPeerConnection(options);\r\n};\r\n\r\nVideoroomPlugin.prototype.processIncomeMessage = function (message) {\r\n  var self = this;\r\n  return Promise.try(function () {\r\n    return VideoroomPlugin.super_.prototype.processIncomeMessage.call(self, message);\r\n  }).then(function (result) {\r\n    if (message._plainMessage) {\r\n      var _plainMessage = message._plainMessage;\r\n      var janusType = _plainMessage['janus'];\r\n      switch (janusType) {\r\n        //message\r\n        //webrtcup: ICE and DTLS succeeded, and so Janus correctly established a PeerConnection with the user/application;\r\n        //media: whether Janus is receiving (receiving: true/false) audio/video (type: \"audio/video\") on this PeerConnection;\r\n        // ICE and DTLS succeeded, and so Janus correctly established a PeerConnection with the user/application;\r\n        //slowlink: whether Janus is reporting trouble sending/receiving (uplink: true/false) media on this PeerConnection;\r\n        //hangup: the PeerConnection was closed, either by Janus or by the user/application, and as such cannot be used anymore.\r\n        //detach\r\n        //trickle\r\n        //slowlink\r\n        //webrtcup\r\n        case 'event':\r\n          var plugindata = _plainMessage['plugindata']['data'];\r\n          if (plugindata['videoroom']) {\r\n            let videoroom: string = plugindata['videoroom'];\r\n            self.processIncomeMessagePublishers(plugindata['publishers']);\r\n            switch (videoroom) {\r\n              case 'attached':\r\n                self.onRemoteFeedAttached(_plainMessage);\r\n                break;\r\n              case 'joined':\r\n                //self.processIncomeMessagePublishers(plugindata['publishers']);\r\n                break;\r\n              case 'event':\r\n                //TODO: \"processIncomeMessage error\";\r\n                //when remote-feed not video and audio published\r\n                if (plugindata['unpublished']) {\r\n                  self.emit('videoroom-remote-feed:unpublished', plugindata['unpublished']);\r\n                }\r\n                if (plugindata['leaving']) {\r\n                  self.emit('videoroom-remote-feed:leaving', plugindata['leaving']);\r\n                }\r\n                self.onEvent(_plainMessage);\r\n                break\r\n            }\r\n          }\r\n          break;\r\n      }\r\n    }\r\n    return result;\r\n  })\r\n};\r\nVideoroomPlugin.prototype.processIncomeMessagePublishers = function (publishers: Array<any>) {\r\n  /*let message: any = {\r\n    feed: 5963190004863477,\r\n    private_id: 645980523,\r\n    ptype: \"subscriber\",\r\n    request: \"join\",\r\n    room: 1234\r\n  }\r\n  */\r\n  this.emit('videoroom-remote-feed:publishers', { 'publishers': publishers });\r\n}\r\n/**\r\n * result  for  subscript join\r\n */\r\nVideoroomPlugin.prototype.onRemoteFeedAttached = function (plainMessage: any) {\r\n  this.emit('videoroom-remote-feed:attached', { plainMessage: plainMessage });\r\n}\r\nVideoroomPlugin.prototype.onEvent = function (plainMessage: any) {\r\n  this.emit('videoroom-event:attached', { plainMessage: plainMessage });\r\n}\r\nJanus.VideoroomPlugin = VideoroomPlugin;\r\nexport default Janus;","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nlet logDisabled_ = true;\nlet deprecationWarnings_ = true;\n\n/**\n * Extract browser version out of the provided user agent string.\n *\n * @param {!string} uastring userAgent string.\n * @param {!string} expr Regular expression used as match criteria.\n * @param {!number} pos position in the version string to be returned.\n * @return {!number} browser version.\n */\nexport function extractVersion(uastring, expr, pos) {\n  const match = uastring.match(expr);\n  return match && match.length >= pos && parseInt(match[pos], 10);\n}\n\n// Wraps the peerconnection event eventNameToWrap in a function\n// which returns the modified event object (or false to prevent\n// the event).\nexport function wrapPeerConnectionEvent(window, eventNameToWrap, wrapper) {\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n  const proto = window.RTCPeerConnection.prototype;\n  const nativeAddEventListener = proto.addEventListener;\n  proto.addEventListener = function(nativeEventName, cb) {\n    if (nativeEventName !== eventNameToWrap) {\n      return nativeAddEventListener.apply(this, arguments);\n    }\n    const wrappedCallback = (e) => {\n      const modifiedEvent = wrapper(e);\n      if (modifiedEvent) {\n        if (cb.handleEvent) {\n          cb.handleEvent(modifiedEvent);\n        } else {\n          cb(modifiedEvent);\n        }\n      }\n    };\n    this._eventMap = this._eventMap || {};\n    if (!this._eventMap[eventNameToWrap]) {\n      this._eventMap[eventNameToWrap] = new Map();\n    }\n    this._eventMap[eventNameToWrap].set(cb, wrappedCallback);\n    return nativeAddEventListener.apply(this, [nativeEventName,\n      wrappedCallback]);\n  };\n\n  const nativeRemoveEventListener = proto.removeEventListener;\n  proto.removeEventListener = function(nativeEventName, cb) {\n    if (nativeEventName !== eventNameToWrap || !this._eventMap\n        || !this._eventMap[eventNameToWrap]) {\n      return nativeRemoveEventListener.apply(this, arguments);\n    }\n    if (!this._eventMap[eventNameToWrap].has(cb)) {\n      return nativeRemoveEventListener.apply(this, arguments);\n    }\n    const unwrappedCb = this._eventMap[eventNameToWrap].get(cb);\n    this._eventMap[eventNameToWrap].delete(cb);\n    if (this._eventMap[eventNameToWrap].size === 0) {\n      delete this._eventMap[eventNameToWrap];\n    }\n    if (Object.keys(this._eventMap).length === 0) {\n      delete this._eventMap;\n    }\n    return nativeRemoveEventListener.apply(this, [nativeEventName,\n      unwrappedCb]);\n  };\n\n  Object.defineProperty(proto, 'on' + eventNameToWrap, {\n    get() {\n      return this['_on' + eventNameToWrap];\n    },\n    set(cb) {\n      if (this['_on' + eventNameToWrap]) {\n        this.removeEventListener(eventNameToWrap,\n            this['_on' + eventNameToWrap]);\n        delete this['_on' + eventNameToWrap];\n      }\n      if (cb) {\n        this.addEventListener(eventNameToWrap,\n            this['_on' + eventNameToWrap] = cb);\n      }\n    },\n    enumerable: true,\n    configurable: true\n  });\n}\n\nexport function disableLog(bool) {\n  if (typeof bool !== 'boolean') {\n    return new Error('Argument type: ' + typeof bool +\n        '. Please use a boolean.');\n  }\n  logDisabled_ = bool;\n  return (bool) ? 'adapter.js logging disabled' :\n      'adapter.js logging enabled';\n}\n\n/**\n * Disable or enable deprecation warnings\n * @param {!boolean} bool set to true to disable warnings.\n */\nexport function disableWarnings(bool) {\n  if (typeof bool !== 'boolean') {\n    return new Error('Argument type: ' + typeof bool +\n        '. Please use a boolean.');\n  }\n  deprecationWarnings_ = !bool;\n  return 'adapter.js deprecation warnings ' + (bool ? 'disabled' : 'enabled');\n}\n\nexport function log() {\n  if (typeof window === 'object') {\n    if (logDisabled_) {\n      return;\n    }\n    if (typeof console !== 'undefined' && typeof console.log === 'function') {\n      console.log.apply(console, arguments);\n    }\n  }\n}\n\n/**\n * Shows a deprecation warning suggesting the modern and spec-compatible API.\n */\nexport function deprecated(oldMethod, newMethod) {\n  if (!deprecationWarnings_) {\n    return;\n  }\n  console.warn(oldMethod + ' is deprecated, please use ' + newMethod +\n      ' instead.');\n}\n\n/**\n * Browser detector.\n *\n * @return {object} result containing browser and version\n *     properties.\n */\nexport function detectBrowser(window) {\n  // Returned result object.\n  const result = {browser: null, version: null};\n\n  // Fail early if it's not a browser\n  if (typeof window === 'undefined' || !window.navigator) {\n    result.browser = 'Not a browser.';\n    return result;\n  }\n\n  const {navigator} = window;\n\n  if (navigator.mozGetUserMedia) { // Firefox.\n    result.browser = 'firefox';\n    result.version = extractVersion(navigator.userAgent,\n        /Firefox\\/(\\d+)\\./, 1);\n  } else if (navigator.webkitGetUserMedia ||\n      (window.isSecureContext === false && window.webkitRTCPeerConnection &&\n       !window.RTCIceGatherer)) {\n    // Chrome, Chromium, Webview, Opera.\n    // Version matches Chrome/WebRTC version.\n    // Chrome 74 removed webkitGetUserMedia on http as well so we need the\n    // more complicated fallback to webkitRTCPeerConnection.\n    result.browser = 'chrome';\n    result.version = extractVersion(navigator.userAgent,\n        /Chrom(e|ium)\\/(\\d+)\\./, 2);\n  } else if (navigator.mediaDevices &&\n      navigator.userAgent.match(/Edge\\/(\\d+).(\\d+)$/)) { // Edge.\n    result.browser = 'edge';\n    result.version = extractVersion(navigator.userAgent,\n        /Edge\\/(\\d+).(\\d+)$/, 2);\n  } else if (window.RTCPeerConnection &&\n      navigator.userAgent.match(/AppleWebKit\\/(\\d+)\\./)) { // Safari.\n    result.browser = 'safari';\n    result.version = extractVersion(navigator.userAgent,\n        /AppleWebKit\\/(\\d+)\\./, 1);\n    result.supportsUnifiedPlan = window.RTCRtpTransceiver &&\n        'currentDirection' in window.RTCRtpTransceiver.prototype;\n  } else { // Default fallthrough: not supported.\n    result.browser = 'Not a supported browser.';\n    return result;\n  }\n\n  return result;\n}\n\n/**\n * Checks if something is an object.\n *\n * @param {*} val The something you want to check.\n * @return true if val is an object, false otherwise.\n */\nfunction isObject(val) {\n  return Object.prototype.toString.call(val) === '[object Object]';\n}\n\n/**\n * Remove all empty objects and undefined values\n * from a nested object -- an enhanced and vanilla version\n * of Lodash's `compact`.\n */\nexport function compactObject(data) {\n  if (!isObject(data)) {\n    return data;\n  }\n\n  return Object.keys(data).reduce(function(accumulator, key) {\n    const isObj = isObject(data[key]);\n    const value = isObj ? compactObject(data[key]) : data[key];\n    const isEmptyObject = isObj && !Object.keys(value).length;\n    if (value === undefined || isEmptyObject) {\n      return accumulator;\n    }\n    return Object.assign(accumulator, {[key]: value});\n  }, {});\n}\n\n/* iterates the stats graph recursively. */\nexport function walkStats(stats, base, resultSet) {\n  if (!base || resultSet.has(base.id)) {\n    return;\n  }\n  resultSet.set(base.id, base);\n  Object.keys(base).forEach(name => {\n    if (name.endsWith('Id')) {\n      walkStats(stats, stats.get(base[name]), resultSet);\n    } else if (name.endsWith('Ids')) {\n      base[name].forEach(id => {\n        walkStats(stats, stats.get(id), resultSet);\n      });\n    }\n  });\n}\n\n/* filter getStats for a sender/receiver track. */\nexport function filterStats(result, track, outbound) {\n  const streamStatsType = outbound ? 'outbound-rtp' : 'inbound-rtp';\n  const filteredResult = new Map();\n  if (track === null) {\n    return filteredResult;\n  }\n  const trackStats = [];\n  result.forEach(value => {\n    if (value.type === 'track' &&\n        value.trackIdentifier === track.id) {\n      trackStats.push(value);\n    }\n  });\n  trackStats.forEach(trackStat => {\n    result.forEach(stats => {\n      if (stats.type === streamStatsType && stats.trackId === trackStat.id) {\n        walkStats(result, stats, filteredResult);\n      }\n    });\n  });\n  return filteredResult;\n}\n\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\nimport * as utils from '../utils.js';\nconst logging = utils.log;\n\nexport function shimGetUserMedia(window) {\n  const navigator = window && window.navigator;\n\n  if (!navigator.mediaDevices) {\n    return;\n  }\n\n  const browserDetails = utils.detectBrowser(window);\n\n  const constraintsToChrome_ = function(c) {\n    if (typeof c !== 'object' || c.mandatory || c.optional) {\n      return c;\n    }\n    const cc = {};\n    Object.keys(c).forEach(key => {\n      if (key === 'require' || key === 'advanced' || key === 'mediaSource') {\n        return;\n      }\n      const r = (typeof c[key] === 'object') ? c[key] : {ideal: c[key]};\n      if (r.exact !== undefined && typeof r.exact === 'number') {\n        r.min = r.max = r.exact;\n      }\n      const oldname_ = function(prefix, name) {\n        if (prefix) {\n          return prefix + name.charAt(0).toUpperCase() + name.slice(1);\n        }\n        return (name === 'deviceId') ? 'sourceId' : name;\n      };\n      if (r.ideal !== undefined) {\n        cc.optional = cc.optional || [];\n        let oc = {};\n        if (typeof r.ideal === 'number') {\n          oc[oldname_('min', key)] = r.ideal;\n          cc.optional.push(oc);\n          oc = {};\n          oc[oldname_('max', key)] = r.ideal;\n          cc.optional.push(oc);\n        } else {\n          oc[oldname_('', key)] = r.ideal;\n          cc.optional.push(oc);\n        }\n      }\n      if (r.exact !== undefined && typeof r.exact !== 'number') {\n        cc.mandatory = cc.mandatory || {};\n        cc.mandatory[oldname_('', key)] = r.exact;\n      } else {\n        ['min', 'max'].forEach(mix => {\n          if (r[mix] !== undefined) {\n            cc.mandatory = cc.mandatory || {};\n            cc.mandatory[oldname_(mix, key)] = r[mix];\n          }\n        });\n      }\n    });\n    if (c.advanced) {\n      cc.optional = (cc.optional || []).concat(c.advanced);\n    }\n    return cc;\n  };\n\n  const shimConstraints_ = function(constraints, func) {\n    if (browserDetails.version >= 61) {\n      return func(constraints);\n    }\n    constraints = JSON.parse(JSON.stringify(constraints));\n    if (constraints && typeof constraints.audio === 'object') {\n      const remap = function(obj, a, b) {\n        if (a in obj && !(b in obj)) {\n          obj[b] = obj[a];\n          delete obj[a];\n        }\n      };\n      constraints = JSON.parse(JSON.stringify(constraints));\n      remap(constraints.audio, 'autoGainControl', 'googAutoGainControl');\n      remap(constraints.audio, 'noiseSuppression', 'googNoiseSuppression');\n      constraints.audio = constraintsToChrome_(constraints.audio);\n    }\n    if (constraints && typeof constraints.video === 'object') {\n      // Shim facingMode for mobile & surface pro.\n      let face = constraints.video.facingMode;\n      face = face && ((typeof face === 'object') ? face : {ideal: face});\n      const getSupportedFacingModeLies = browserDetails.version < 66;\n\n      if ((face && (face.exact === 'user' || face.exact === 'environment' ||\n                    face.ideal === 'user' || face.ideal === 'environment')) &&\n          !(navigator.mediaDevices.getSupportedConstraints &&\n            navigator.mediaDevices.getSupportedConstraints().facingMode &&\n            !getSupportedFacingModeLies)) {\n        delete constraints.video.facingMode;\n        let matches;\n        if (face.exact === 'environment' || face.ideal === 'environment') {\n          matches = ['back', 'rear'];\n        } else if (face.exact === 'user' || face.ideal === 'user') {\n          matches = ['front'];\n        }\n        if (matches) {\n          // Look for matches in label, or use last cam for back (typical).\n          return navigator.mediaDevices.enumerateDevices()\n          .then(devices => {\n            devices = devices.filter(d => d.kind === 'videoinput');\n            let dev = devices.find(d => matches.some(match =>\n              d.label.toLowerCase().includes(match)));\n            if (!dev && devices.length && matches.includes('back')) {\n              dev = devices[devices.length - 1]; // more likely the back cam\n            }\n            if (dev) {\n              constraints.video.deviceId = face.exact ? {exact: dev.deviceId} :\n                                                        {ideal: dev.deviceId};\n            }\n            constraints.video = constraintsToChrome_(constraints.video);\n            logging('chrome: ' + JSON.stringify(constraints));\n            return func(constraints);\n          });\n        }\n      }\n      constraints.video = constraintsToChrome_(constraints.video);\n    }\n    logging('chrome: ' + JSON.stringify(constraints));\n    return func(constraints);\n  };\n\n  const shimError_ = function(e) {\n    if (browserDetails.version >= 64) {\n      return e;\n    }\n    return {\n      name: {\n        PermissionDeniedError: 'NotAllowedError',\n        PermissionDismissedError: 'NotAllowedError',\n        InvalidStateError: 'NotAllowedError',\n        DevicesNotFoundError: 'NotFoundError',\n        ConstraintNotSatisfiedError: 'OverconstrainedError',\n        TrackStartError: 'NotReadableError',\n        MediaDeviceFailedDueToShutdown: 'NotAllowedError',\n        MediaDeviceKillSwitchOn: 'NotAllowedError',\n        TabCaptureError: 'AbortError',\n        ScreenCaptureError: 'AbortError',\n        DeviceCaptureError: 'AbortError'\n      }[e.name] || e.name,\n      message: e.message,\n      constraint: e.constraint || e.constraintName,\n      toString() {\n        return this.name + (this.message && ': ') + this.message;\n      }\n    };\n  };\n\n  const getUserMedia_ = function(constraints, onSuccess, onError) {\n    shimConstraints_(constraints, c => {\n      navigator.webkitGetUserMedia(c, onSuccess, e => {\n        if (onError) {\n          onError(shimError_(e));\n        }\n      });\n    });\n  };\n  navigator.getUserMedia = getUserMedia_.bind(navigator);\n\n  // Even though Chrome 45 has navigator.mediaDevices and a getUserMedia\n  // function which returns a Promise, it does not accept spec-style\n  // constraints.\n  if (navigator.mediaDevices.getUserMedia) {\n    const origGetUserMedia = navigator.mediaDevices.getUserMedia.\n        bind(navigator.mediaDevices);\n    navigator.mediaDevices.getUserMedia = function(cs) {\n      return shimConstraints_(cs, c => origGetUserMedia(c).then(stream => {\n        if (c.audio && !stream.getAudioTracks().length ||\n            c.video && !stream.getVideoTracks().length) {\n          stream.getTracks().forEach(track => {\n            track.stop();\n          });\n          throw new DOMException('', 'NotFoundError');\n        }\n        return stream;\n      }, e => Promise.reject(shimError_(e))));\n    };\n  }\n}\n","/*\n *  Copyright (c) 2018 The adapter.js project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\nexport function shimGetDisplayMedia(window, getSourceId) {\n  if (window.navigator.mediaDevices &&\n    'getDisplayMedia' in window.navigator.mediaDevices) {\n    return;\n  }\n  if (!(window.navigator.mediaDevices)) {\n    return;\n  }\n  // getSourceId is a function that returns a promise resolving with\n  // the sourceId of the screen/window/tab to be shared.\n  if (typeof getSourceId !== 'function') {\n    console.error('shimGetDisplayMedia: getSourceId argument is not ' +\n        'a function');\n    return;\n  }\n  window.navigator.mediaDevices.getDisplayMedia =\n    function getDisplayMedia(constraints) {\n      return getSourceId(constraints)\n        .then(sourceId => {\n          const widthSpecified = constraints.video && constraints.video.width;\n          const heightSpecified = constraints.video &&\n            constraints.video.height;\n          const frameRateSpecified = constraints.video &&\n            constraints.video.frameRate;\n          constraints.video = {\n            mandatory: {\n              chromeMediaSource: 'desktop',\n              chromeMediaSourceId: sourceId,\n              maxFrameRate: frameRateSpecified || 3\n            }\n          };\n          if (widthSpecified) {\n            constraints.video.mandatory.maxWidth = widthSpecified;\n          }\n          if (heightSpecified) {\n            constraints.video.mandatory.maxHeight = heightSpecified;\n          }\n          return window.navigator.mediaDevices.getUserMedia(constraints);\n        });\n    };\n}\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\nimport * as utils from '../utils.js';\n\nexport {shimGetUserMedia} from './getusermedia';\nexport {shimGetDisplayMedia} from './getdisplaymedia';\n\nexport function shimMediaStream(window) {\n  window.MediaStream = window.MediaStream || window.webkitMediaStream;\n}\n\nexport function shimOnTrack(window) {\n  if (typeof window === 'object' && window.RTCPeerConnection && !('ontrack' in\n      window.RTCPeerConnection.prototype)) {\n    Object.defineProperty(window.RTCPeerConnection.prototype, 'ontrack', {\n      get() {\n        return this._ontrack;\n      },\n      set(f) {\n        if (this._ontrack) {\n          this.removeEventListener('track', this._ontrack);\n        }\n        this.addEventListener('track', this._ontrack = f);\n      },\n      enumerable: true,\n      configurable: true\n    });\n    const origSetRemoteDescription =\n        window.RTCPeerConnection.prototype.setRemoteDescription;\n    window.RTCPeerConnection.prototype.setRemoteDescription =\n      function setRemoteDescription() {\n        if (!this._ontrackpoly) {\n          this._ontrackpoly = (e) => {\n            // onaddstream does not fire when a track is added to an existing\n            // stream. But stream.onaddtrack is implemented so we use that.\n            e.stream.addEventListener('addtrack', te => {\n              let receiver;\n              if (window.RTCPeerConnection.prototype.getReceivers) {\n                receiver = this.getReceivers()\n                  .find(r => r.track && r.track.id === te.track.id);\n              } else {\n                receiver = {track: te.track};\n              }\n\n              const event = new Event('track');\n              event.track = te.track;\n              event.receiver = receiver;\n              event.transceiver = {receiver};\n              event.streams = [e.stream];\n              this.dispatchEvent(event);\n            });\n            e.stream.getTracks().forEach(track => {\n              let receiver;\n              if (window.RTCPeerConnection.prototype.getReceivers) {\n                receiver = this.getReceivers()\n                  .find(r => r.track && r.track.id === track.id);\n              } else {\n                receiver = {track};\n              }\n              const event = new Event('track');\n              event.track = track;\n              event.receiver = receiver;\n              event.transceiver = {receiver};\n              event.streams = [e.stream];\n              this.dispatchEvent(event);\n            });\n          };\n          this.addEventListener('addstream', this._ontrackpoly);\n        }\n        return origSetRemoteDescription.apply(this, arguments);\n      };\n  } else {\n    // even if RTCRtpTransceiver is in window, it is only used and\n    // emitted in unified-plan. Unfortunately this means we need\n    // to unconditionally wrap the event.\n    utils.wrapPeerConnectionEvent(window, 'track', e => {\n      if (!e.transceiver) {\n        Object.defineProperty(e, 'transceiver',\n          {value: {receiver: e.receiver}});\n      }\n      return e;\n    });\n  }\n}\n\nexport function shimGetSendersWithDtmf(window) {\n  // Overrides addTrack/removeTrack, depends on shimAddTrackRemoveTrack.\n  if (typeof window === 'object' && window.RTCPeerConnection &&\n      !('getSenders' in window.RTCPeerConnection.prototype) &&\n      'createDTMFSender' in window.RTCPeerConnection.prototype) {\n    const shimSenderWithDtmf = function(pc, track) {\n      return {\n        track,\n        get dtmf() {\n          if (this._dtmf === undefined) {\n            if (track.kind === 'audio') {\n              this._dtmf = pc.createDTMFSender(track);\n            } else {\n              this._dtmf = null;\n            }\n          }\n          return this._dtmf;\n        },\n        _pc: pc\n      };\n    };\n\n    // augment addTrack when getSenders is not available.\n    if (!window.RTCPeerConnection.prototype.getSenders) {\n      window.RTCPeerConnection.prototype.getSenders = function getSenders() {\n        this._senders = this._senders || [];\n        return this._senders.slice(); // return a copy of the internal state.\n      };\n      const origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n      window.RTCPeerConnection.prototype.addTrack =\n        function addTrack(track, stream) {\n          let sender = origAddTrack.apply(this, arguments);\n          if (!sender) {\n            sender = shimSenderWithDtmf(this, track);\n            this._senders.push(sender);\n          }\n          return sender;\n        };\n\n      const origRemoveTrack = window.RTCPeerConnection.prototype.removeTrack;\n      window.RTCPeerConnection.prototype.removeTrack =\n        function removeTrack(sender) {\n          origRemoveTrack.apply(this, arguments);\n          const idx = this._senders.indexOf(sender);\n          if (idx !== -1) {\n            this._senders.splice(idx, 1);\n          }\n        };\n    }\n    const origAddStream = window.RTCPeerConnection.prototype.addStream;\n    window.RTCPeerConnection.prototype.addStream = function addStream(stream) {\n      this._senders = this._senders || [];\n      origAddStream.apply(this, [stream]);\n      stream.getTracks().forEach(track => {\n        this._senders.push(shimSenderWithDtmf(this, track));\n      });\n    };\n\n    const origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\n    window.RTCPeerConnection.prototype.removeStream =\n      function removeStream(stream) {\n        this._senders = this._senders || [];\n        origRemoveStream.apply(this, [stream]);\n\n        stream.getTracks().forEach(track => {\n          const sender = this._senders.find(s => s.track === track);\n          if (sender) { // remove sender\n            this._senders.splice(this._senders.indexOf(sender), 1);\n          }\n        });\n      };\n  } else if (typeof window === 'object' && window.RTCPeerConnection &&\n             'getSenders' in window.RTCPeerConnection.prototype &&\n             'createDTMFSender' in window.RTCPeerConnection.prototype &&\n             window.RTCRtpSender &&\n             !('dtmf' in window.RTCRtpSender.prototype)) {\n    const origGetSenders = window.RTCPeerConnection.prototype.getSenders;\n    window.RTCPeerConnection.prototype.getSenders = function getSenders() {\n      const senders = origGetSenders.apply(this, []);\n      senders.forEach(sender => sender._pc = this);\n      return senders;\n    };\n\n    Object.defineProperty(window.RTCRtpSender.prototype, 'dtmf', {\n      get() {\n        if (this._dtmf === undefined) {\n          if (this.track.kind === 'audio') {\n            this._dtmf = this._pc.createDTMFSender(this.track);\n          } else {\n            this._dtmf = null;\n          }\n        }\n        return this._dtmf;\n      }\n    });\n  }\n}\n\nexport function shimGetStats(window) {\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n\n  const origGetStats = window.RTCPeerConnection.prototype.getStats;\n  window.RTCPeerConnection.prototype.getStats = function getStats() {\n    const [selector, onSucc, onErr] = arguments;\n\n    // If selector is a function then we are in the old style stats so just\n    // pass back the original getStats format to avoid breaking old users.\n    if (arguments.length > 0 && typeof selector === 'function') {\n      return origGetStats.apply(this, arguments);\n    }\n\n    // When spec-style getStats is supported, return those when called with\n    // either no arguments or the selector argument is null.\n    if (origGetStats.length === 0 && (arguments.length === 0 ||\n        typeof selector !== 'function')) {\n      return origGetStats.apply(this, []);\n    }\n\n    const fixChromeStats_ = function(response) {\n      const standardReport = {};\n      const reports = response.result();\n      reports.forEach(report => {\n        const standardStats = {\n          id: report.id,\n          timestamp: report.timestamp,\n          type: {\n            localcandidate: 'local-candidate',\n            remotecandidate: 'remote-candidate'\n          }[report.type] || report.type\n        };\n        report.names().forEach(name => {\n          standardStats[name] = report.stat(name);\n        });\n        standardReport[standardStats.id] = standardStats;\n      });\n\n      return standardReport;\n    };\n\n    // shim getStats with maplike support\n    const makeMapStats = function(stats) {\n      return new Map(Object.keys(stats).map(key => [key, stats[key]]));\n    };\n\n    if (arguments.length >= 2) {\n      const successCallbackWrapper_ = function(response) {\n        onSucc(makeMapStats(fixChromeStats_(response)));\n      };\n\n      return origGetStats.apply(this, [successCallbackWrapper_,\n        selector]);\n    }\n\n    // promise-support\n    return new Promise((resolve, reject) => {\n      origGetStats.apply(this, [\n        function(response) {\n          resolve(makeMapStats(fixChromeStats_(response)));\n        }, reject]);\n    }).then(onSucc, onErr);\n  };\n}\n\nexport function shimSenderReceiverGetStats(window) {\n  if (!(typeof window === 'object' && window.RTCPeerConnection &&\n      window.RTCRtpSender && window.RTCRtpReceiver)) {\n    return;\n  }\n\n  // shim sender stats.\n  if (!('getStats' in window.RTCRtpSender.prototype)) {\n    const origGetSenders = window.RTCPeerConnection.prototype.getSenders;\n    if (origGetSenders) {\n      window.RTCPeerConnection.prototype.getSenders = function getSenders() {\n        const senders = origGetSenders.apply(this, []);\n        senders.forEach(sender => sender._pc = this);\n        return senders;\n      };\n    }\n\n    const origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n    if (origAddTrack) {\n      window.RTCPeerConnection.prototype.addTrack = function addTrack() {\n        const sender = origAddTrack.apply(this, arguments);\n        sender._pc = this;\n        return sender;\n      };\n    }\n    window.RTCRtpSender.prototype.getStats = function getStats() {\n      const sender = this;\n      return this._pc.getStats().then(result =>\n        /* Note: this will include stats of all senders that\n         *   send a track with the same id as sender.track as\n         *   it is not possible to identify the RTCRtpSender.\n         */\n        utils.filterStats(result, sender.track, true));\n    };\n  }\n\n  // shim receiver stats.\n  if (!('getStats' in window.RTCRtpReceiver.prototype)) {\n    const origGetReceivers = window.RTCPeerConnection.prototype.getReceivers;\n    if (origGetReceivers) {\n      window.RTCPeerConnection.prototype.getReceivers =\n        function getReceivers() {\n          const receivers = origGetReceivers.apply(this, []);\n          receivers.forEach(receiver => receiver._pc = this);\n          return receivers;\n        };\n    }\n    utils.wrapPeerConnectionEvent(window, 'track', e => {\n      e.receiver._pc = e.srcElement;\n      return e;\n    });\n    window.RTCRtpReceiver.prototype.getStats = function getStats() {\n      const receiver = this;\n      return this._pc.getStats().then(result =>\n        utils.filterStats(result, receiver.track, false));\n    };\n  }\n\n  if (!('getStats' in window.RTCRtpSender.prototype &&\n      'getStats' in window.RTCRtpReceiver.prototype)) {\n    return;\n  }\n\n  // shim RTCPeerConnection.getStats(track).\n  const origGetStats = window.RTCPeerConnection.prototype.getStats;\n  window.RTCPeerConnection.prototype.getStats = function getStats() {\n    if (arguments.length > 0 &&\n        arguments[0] instanceof window.MediaStreamTrack) {\n      const track = arguments[0];\n      let sender;\n      let receiver;\n      let err;\n      this.getSenders().forEach(s => {\n        if (s.track === track) {\n          if (sender) {\n            err = true;\n          } else {\n            sender = s;\n          }\n        }\n      });\n      this.getReceivers().forEach(r => {\n        if (r.track === track) {\n          if (receiver) {\n            err = true;\n          } else {\n            receiver = r;\n          }\n        }\n        return r.track === track;\n      });\n      if (err || (sender && receiver)) {\n        return Promise.reject(new DOMException(\n          'There are more than one sender or receiver for the track.',\n          'InvalidAccessError'));\n      } else if (sender) {\n        return sender.getStats();\n      } else if (receiver) {\n        return receiver.getStats();\n      }\n      return Promise.reject(new DOMException(\n        'There is no sender or receiver for the track.',\n        'InvalidAccessError'));\n    }\n    return origGetStats.apply(this, arguments);\n  };\n}\n\nexport function shimAddTrackRemoveTrackWithNative(window) {\n  // shim addTrack/removeTrack with native variants in order to make\n  // the interactions with legacy getLocalStreams behave as in other browsers.\n  // Keeps a mapping stream.id => [stream, rtpsenders...]\n  window.RTCPeerConnection.prototype.getLocalStreams =\n    function getLocalStreams() {\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n      return Object.keys(this._shimmedLocalStreams)\n        .map(streamId => this._shimmedLocalStreams[streamId][0]);\n    };\n\n  const origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n  window.RTCPeerConnection.prototype.addTrack =\n    function addTrack(track, stream) {\n      if (!stream) {\n        return origAddTrack.apply(this, arguments);\n      }\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n\n      const sender = origAddTrack.apply(this, arguments);\n      if (!this._shimmedLocalStreams[stream.id]) {\n        this._shimmedLocalStreams[stream.id] = [stream, sender];\n      } else if (this._shimmedLocalStreams[stream.id].indexOf(sender) === -1) {\n        this._shimmedLocalStreams[stream.id].push(sender);\n      }\n      return sender;\n    };\n\n  const origAddStream = window.RTCPeerConnection.prototype.addStream;\n  window.RTCPeerConnection.prototype.addStream = function addStream(stream) {\n    this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n\n    stream.getTracks().forEach(track => {\n      const alreadyExists = this.getSenders().find(s => s.track === track);\n      if (alreadyExists) {\n        throw new DOMException('Track already exists.',\n            'InvalidAccessError');\n      }\n    });\n    const existingSenders = this.getSenders();\n    origAddStream.apply(this, arguments);\n    const newSenders = this.getSenders()\n      .filter(newSender => existingSenders.indexOf(newSender) === -1);\n    this._shimmedLocalStreams[stream.id] = [stream].concat(newSenders);\n  };\n\n  const origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\n  window.RTCPeerConnection.prototype.removeStream =\n    function removeStream(stream) {\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n      delete this._shimmedLocalStreams[stream.id];\n      return origRemoveStream.apply(this, arguments);\n    };\n\n  const origRemoveTrack = window.RTCPeerConnection.prototype.removeTrack;\n  window.RTCPeerConnection.prototype.removeTrack =\n    function removeTrack(sender) {\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n      if (sender) {\n        Object.keys(this._shimmedLocalStreams).forEach(streamId => {\n          const idx = this._shimmedLocalStreams[streamId].indexOf(sender);\n          if (idx !== -1) {\n            this._shimmedLocalStreams[streamId].splice(idx, 1);\n          }\n          if (this._shimmedLocalStreams[streamId].length === 1) {\n            delete this._shimmedLocalStreams[streamId];\n          }\n        });\n      }\n      return origRemoveTrack.apply(this, arguments);\n    };\n}\n\nexport function shimAddTrackRemoveTrack(window) {\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n  const browserDetails = utils.detectBrowser(window);\n  // shim addTrack and removeTrack.\n  if (window.RTCPeerConnection.prototype.addTrack &&\n      browserDetails.version >= 65) {\n    return shimAddTrackRemoveTrackWithNative(window);\n  }\n\n  // also shim pc.getLocalStreams when addTrack is shimmed\n  // to return the original streams.\n  const origGetLocalStreams = window.RTCPeerConnection.prototype\n      .getLocalStreams;\n  window.RTCPeerConnection.prototype.getLocalStreams =\n    function getLocalStreams() {\n      const nativeStreams = origGetLocalStreams.apply(this);\n      this._reverseStreams = this._reverseStreams || {};\n      return nativeStreams.map(stream => this._reverseStreams[stream.id]);\n    };\n\n  const origAddStream = window.RTCPeerConnection.prototype.addStream;\n  window.RTCPeerConnection.prototype.addStream = function addStream(stream) {\n    this._streams = this._streams || {};\n    this._reverseStreams = this._reverseStreams || {};\n\n    stream.getTracks().forEach(track => {\n      const alreadyExists = this.getSenders().find(s => s.track === track);\n      if (alreadyExists) {\n        throw new DOMException('Track already exists.',\n            'InvalidAccessError');\n      }\n    });\n    // Add identity mapping for consistency with addTrack.\n    // Unless this is being used with a stream from addTrack.\n    if (!this._reverseStreams[stream.id]) {\n      const newStream = new window.MediaStream(stream.getTracks());\n      this._streams[stream.id] = newStream;\n      this._reverseStreams[newStream.id] = stream;\n      stream = newStream;\n    }\n    origAddStream.apply(this, [stream]);\n  };\n\n  const origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\n  window.RTCPeerConnection.prototype.removeStream =\n    function removeStream(stream) {\n      this._streams = this._streams || {};\n      this._reverseStreams = this._reverseStreams || {};\n\n      origRemoveStream.apply(this, [(this._streams[stream.id] || stream)]);\n      delete this._reverseStreams[(this._streams[stream.id] ?\n          this._streams[stream.id].id : stream.id)];\n      delete this._streams[stream.id];\n    };\n\n  window.RTCPeerConnection.prototype.addTrack =\n    function addTrack(track, stream) {\n      if (this.signalingState === 'closed') {\n        throw new DOMException(\n          'The RTCPeerConnection\\'s signalingState is \\'closed\\'.',\n          'InvalidStateError');\n      }\n      const streams = [].slice.call(arguments, 1);\n      if (streams.length !== 1 ||\n          !streams[0].getTracks().find(t => t === track)) {\n        // this is not fully correct but all we can manage without\n        // [[associated MediaStreams]] internal slot.\n        throw new DOMException(\n          'The adapter.js addTrack polyfill only supports a single ' +\n          ' stream which is associated with the specified track.',\n          'NotSupportedError');\n      }\n\n      const alreadyExists = this.getSenders().find(s => s.track === track);\n      if (alreadyExists) {\n        throw new DOMException('Track already exists.',\n            'InvalidAccessError');\n      }\n\n      this._streams = this._streams || {};\n      this._reverseStreams = this._reverseStreams || {};\n      const oldStream = this._streams[stream.id];\n      if (oldStream) {\n        // this is using odd Chrome behaviour, use with caution:\n        // https://bugs.chromium.org/p/webrtc/issues/detail?id=7815\n        // Note: we rely on the high-level addTrack/dtmf shim to\n        // create the sender with a dtmf sender.\n        oldStream.addTrack(track);\n\n        // Trigger ONN async.\n        Promise.resolve().then(() => {\n          this.dispatchEvent(new Event('negotiationneeded'));\n        });\n      } else {\n        const newStream = new window.MediaStream([track]);\n        this._streams[stream.id] = newStream;\n        this._reverseStreams[newStream.id] = stream;\n        this.addStream(newStream);\n      }\n      return this.getSenders().find(s => s.track === track);\n    };\n\n  // replace the internal stream id with the external one and\n  // vice versa.\n  function replaceInternalStreamId(pc, description) {\n    let sdp = description.sdp;\n    Object.keys(pc._reverseStreams || []).forEach(internalId => {\n      const externalStream = pc._reverseStreams[internalId];\n      const internalStream = pc._streams[externalStream.id];\n      sdp = sdp.replace(new RegExp(internalStream.id, 'g'),\n          externalStream.id);\n    });\n    return new RTCSessionDescription({\n      type: description.type,\n      sdp\n    });\n  }\n  function replaceExternalStreamId(pc, description) {\n    let sdp = description.sdp;\n    Object.keys(pc._reverseStreams || []).forEach(internalId => {\n      const externalStream = pc._reverseStreams[internalId];\n      const internalStream = pc._streams[externalStream.id];\n      sdp = sdp.replace(new RegExp(externalStream.id, 'g'),\n          internalStream.id);\n    });\n    return new RTCSessionDescription({\n      type: description.type,\n      sdp\n    });\n  }\n  ['createOffer', 'createAnswer'].forEach(function(method) {\n    const nativeMethod = window.RTCPeerConnection.prototype[method];\n    const methodObj = {[method]() {\n      const args = arguments;\n      const isLegacyCall = arguments.length &&\n          typeof arguments[0] === 'function';\n      if (isLegacyCall) {\n        return nativeMethod.apply(this, [\n          (description) => {\n            const desc = replaceInternalStreamId(this, description);\n            args[0].apply(null, [desc]);\n          },\n          (err) => {\n            if (args[1]) {\n              args[1].apply(null, err);\n            }\n          }, arguments[2]\n        ]);\n      }\n      return nativeMethod.apply(this, arguments)\n      .then(description => replaceInternalStreamId(this, description));\n    }};\n    window.RTCPeerConnection.prototype[method] = methodObj[method];\n  });\n\n  const origSetLocalDescription =\n      window.RTCPeerConnection.prototype.setLocalDescription;\n  window.RTCPeerConnection.prototype.setLocalDescription =\n    function setLocalDescription() {\n      if (!arguments.length || !arguments[0].type) {\n        return origSetLocalDescription.apply(this, arguments);\n      }\n      arguments[0] = replaceExternalStreamId(this, arguments[0]);\n      return origSetLocalDescription.apply(this, arguments);\n    };\n\n  // TODO: mangle getStats: https://w3c.github.io/webrtc-stats/#dom-rtcmediastreamstats-streamidentifier\n\n  const origLocalDescription = Object.getOwnPropertyDescriptor(\n      window.RTCPeerConnection.prototype, 'localDescription');\n  Object.defineProperty(window.RTCPeerConnection.prototype,\n      'localDescription', {\n        get() {\n          const description = origLocalDescription.get.apply(this);\n          if (description.type === '') {\n            return description;\n          }\n          return replaceInternalStreamId(this, description);\n        }\n      });\n\n  window.RTCPeerConnection.prototype.removeTrack =\n    function removeTrack(sender) {\n      if (this.signalingState === 'closed') {\n        throw new DOMException(\n          'The RTCPeerConnection\\'s signalingState is \\'closed\\'.',\n          'InvalidStateError');\n      }\n      // We can not yet check for sender instanceof RTCRtpSender\n      // since we shim RTPSender. So we check if sender._pc is set.\n      if (!sender._pc) {\n        throw new DOMException('Argument 1 of RTCPeerConnection.removeTrack ' +\n            'does not implement interface RTCRtpSender.', 'TypeError');\n      }\n      const isLocal = sender._pc === this;\n      if (!isLocal) {\n        throw new DOMException('Sender was not created by this connection.',\n            'InvalidAccessError');\n      }\n\n      // Search for the native stream the senders track belongs to.\n      this._streams = this._streams || {};\n      let stream;\n      Object.keys(this._streams).forEach(streamid => {\n        const hasTrack = this._streams[streamid].getTracks()\n          .find(track => sender.track === track);\n        if (hasTrack) {\n          stream = this._streams[streamid];\n        }\n      });\n\n      if (stream) {\n        if (stream.getTracks().length === 1) {\n          // if this is the last track of the stream, remove the stream. This\n          // takes care of any shimmed _senders.\n          this.removeStream(this._reverseStreams[stream.id]);\n        } else {\n          // relying on the same odd chrome behaviour as above.\n          stream.removeTrack(sender.track);\n        }\n        this.dispatchEvent(new Event('negotiationneeded'));\n      }\n    };\n}\n\nexport function shimPeerConnection(window) {\n  const browserDetails = utils.detectBrowser(window);\n\n  if (!window.RTCPeerConnection && window.webkitRTCPeerConnection) {\n    // very basic support for old versions.\n    window.RTCPeerConnection = window.webkitRTCPeerConnection;\n  }\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n\n  const addIceCandidateNullSupported =\n    window.RTCPeerConnection.prototype.addIceCandidate.length === 0;\n\n  // shim implicit creation of RTCSessionDescription/RTCIceCandidate\n  if (browserDetails.version < 53) {\n    ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate']\n        .forEach(function(method) {\n          const nativeMethod = window.RTCPeerConnection.prototype[method];\n          const methodObj = {[method]() {\n            arguments[0] = new ((method === 'addIceCandidate') ?\n                window.RTCIceCandidate :\n                window.RTCSessionDescription)(arguments[0]);\n            return nativeMethod.apply(this, arguments);\n          }};\n          window.RTCPeerConnection.prototype[method] = methodObj[method];\n        });\n  }\n\n  // support for addIceCandidate(null or undefined)\n  const nativeAddIceCandidate =\n      window.RTCPeerConnection.prototype.addIceCandidate;\n  window.RTCPeerConnection.prototype.addIceCandidate =\n    function addIceCandidate() {\n      if (!addIceCandidateNullSupported && !arguments[0]) {\n        if (arguments[1]) {\n          arguments[1].apply(null);\n        }\n        return Promise.resolve();\n      }\n      // Firefox 68+ emits and processes {candidate: \"\", ...}, ignore\n      // in older versions. Native support planned for Chrome M77.\n      if (browserDetails.version < 78 &&\n        arguments[0] && arguments[0].candidate === '') {\n        return Promise.resolve();\n      }\n      return nativeAddIceCandidate.apply(this, arguments);\n    };\n}\n\n// Attempt to fix ONN in plan-b mode.\nexport function fixNegotiationNeeded(window) {\n  const browserDetails = utils.detectBrowser(window);\n  utils.wrapPeerConnectionEvent(window, 'negotiationneeded', e => {\n    const pc = e.target;\n    if (browserDetails.version < 72 || (pc.getConfiguration &&\n        pc.getConfiguration().sdpSemantics === 'plan-b')) {\n      if (pc.signalingState !== 'stable') {\n        return;\n      }\n    }\n    return e;\n  });\n}\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nexport function shimGetUserMedia(window) {\n  const navigator = window && window.navigator;\n\n  const shimError_ = function(e) {\n    return {\n      name: {PermissionDeniedError: 'NotAllowedError'}[e.name] || e.name,\n      message: e.message,\n      constraint: e.constraint,\n      toString() {\n        return this.name;\n      }\n    };\n  };\n\n  // getUserMedia error shim.\n  const origGetUserMedia = navigator.mediaDevices.getUserMedia.\n      bind(navigator.mediaDevices);\n  navigator.mediaDevices.getUserMedia = function(c) {\n    return origGetUserMedia(c).catch(e => Promise.reject(shimError_(e)));\n  };\n}\n","/*\n *  Copyright (c) 2018 The adapter.js project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nexport function shimGetDisplayMedia(window) {\n  if (!('getDisplayMedia' in window.navigator)) {\n    return;\n  }\n  if (!(window.navigator.mediaDevices)) {\n    return;\n  }\n  if (window.navigator.mediaDevices &&\n    'getDisplayMedia' in window.navigator.mediaDevices) {\n    return;\n  }\n  window.navigator.mediaDevices.getDisplayMedia =\n    window.navigator.getDisplayMedia.bind(window.navigator);\n}\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nimport * as utils from '../utils';\nimport {filterIceServers} from './filtericeservers';\nimport shimRTCPeerConnection from 'rtcpeerconnection-shim';\n\nexport {shimGetUserMedia} from './getusermedia';\nexport {shimGetDisplayMedia} from './getdisplaymedia';\n\nexport function shimPeerConnection(window) {\n  const browserDetails = utils.detectBrowser(window);\n\n  if (window.RTCIceGatherer) {\n    if (!window.RTCIceCandidate) {\n      window.RTCIceCandidate = function RTCIceCandidate(args) {\n        return args;\n      };\n    }\n    if (!window.RTCSessionDescription) {\n      window.RTCSessionDescription = function RTCSessionDescription(args) {\n        return args;\n      };\n    }\n    // this adds an additional event listener to MediaStrackTrack that signals\n    // when a tracks enabled property was changed. Workaround for a bug in\n    // addStream, see below. No longer required in 15025+\n    if (browserDetails.version < 15025) {\n      const origMSTEnabled = Object.getOwnPropertyDescriptor(\n          window.MediaStreamTrack.prototype, 'enabled');\n      Object.defineProperty(window.MediaStreamTrack.prototype, 'enabled', {\n        set(value) {\n          origMSTEnabled.set.call(this, value);\n          const ev = new Event('enabled');\n          ev.enabled = value;\n          this.dispatchEvent(ev);\n        }\n      });\n    }\n  }\n\n  // ORTC defines the DTMF sender a bit different.\n  // https://github.com/w3c/ortc/issues/714\n  if (window.RTCRtpSender && !('dtmf' in window.RTCRtpSender.prototype)) {\n    Object.defineProperty(window.RTCRtpSender.prototype, 'dtmf', {\n      get() {\n        if (this._dtmf === undefined) {\n          if (this.track.kind === 'audio') {\n            this._dtmf = new window.RTCDtmfSender(this);\n          } else if (this.track.kind === 'video') {\n            this._dtmf = null;\n          }\n        }\n        return this._dtmf;\n      }\n    });\n  }\n  // Edge currently only implements the RTCDtmfSender, not the\n  // RTCDTMFSender alias. See http://draft.ortc.org/#rtcdtmfsender2*\n  if (window.RTCDtmfSender && !window.RTCDTMFSender) {\n    window.RTCDTMFSender = window.RTCDtmfSender;\n  }\n\n  const RTCPeerConnectionShim = shimRTCPeerConnection(window,\n      browserDetails.version);\n  window.RTCPeerConnection = function RTCPeerConnection(config) {\n    if (config && config.iceServers) {\n      config.iceServers = filterIceServers(config.iceServers,\n        browserDetails.version);\n      utils.log('ICE servers after filtering:', config.iceServers);\n    }\n    return new RTCPeerConnectionShim(config);\n  };\n  window.RTCPeerConnection.prototype = RTCPeerConnectionShim.prototype;\n}\n\nexport function shimReplaceTrack(window) {\n  // ORTC has replaceTrack -- https://github.com/w3c/ortc/issues/614\n  if (window.RTCRtpSender &&\n      !('replaceTrack' in window.RTCRtpSender.prototype)) {\n    window.RTCRtpSender.prototype.replaceTrack =\n        window.RTCRtpSender.prototype.setTrack;\n  }\n}\n","/*\n *  Copyright (c) 2018 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nimport * as utils from '../utils';\n// Edge does not like\n// 1) stun: filtered after 14393 unless ?transport=udp is present\n// 2) turn: that does not have all of turn:host:port?transport=udp\n// 3) turn: with ipv6 addresses\n// 4) turn: occurring muliple times\nexport function filterIceServers(iceServers, edgeVersion) {\n  let hasTurn = false;\n  iceServers = JSON.parse(JSON.stringify(iceServers));\n  return iceServers.filter(server => {\n    if (server && (server.urls || server.url)) {\n      let urls = server.urls || server.url;\n      if (server.url && !server.urls) {\n        utils.deprecated('RTCIceServer.url', 'RTCIceServer.urls');\n      }\n      const isString = typeof urls === 'string';\n      if (isString) {\n        urls = [urls];\n      }\n      urls = urls.filter(url => {\n        // filter STUN unconditionally.\n        if (url.indexOf('stun:') === 0) {\n          return false;\n        }\n\n        const validTurn = url.startsWith('turn') &&\n            !url.startsWith('turn:[') &&\n            url.includes('transport=udp');\n        if (validTurn && !hasTurn) {\n          hasTurn = true;\n          return true;\n        }\n        return validTurn && !hasTurn;\n      });\n\n      delete server.url;\n      server.urls = isString ? urls[0] : urls;\n      return !!urls.length;\n    }\n  });\n}\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nimport * as utils from '../utils';\n\nexport function shimGetUserMedia(window) {\n  const browserDetails = utils.detectBrowser(window);\n  const navigator = window && window.navigator;\n  const MediaStreamTrack = window && window.MediaStreamTrack;\n\n  navigator.getUserMedia = function(constraints, onSuccess, onError) {\n    // Replace Firefox 44+'s deprecation warning with unprefixed version.\n    utils.deprecated('navigator.getUserMedia',\n        'navigator.mediaDevices.getUserMedia');\n    navigator.mediaDevices.getUserMedia(constraints).then(onSuccess, onError);\n  };\n\n  if (!(browserDetails.version > 55 &&\n      'autoGainControl' in navigator.mediaDevices.getSupportedConstraints())) {\n    const remap = function(obj, a, b) {\n      if (a in obj && !(b in obj)) {\n        obj[b] = obj[a];\n        delete obj[a];\n      }\n    };\n\n    const nativeGetUserMedia = navigator.mediaDevices.getUserMedia.\n        bind(navigator.mediaDevices);\n    navigator.mediaDevices.getUserMedia = function(c) {\n      if (typeof c === 'object' && typeof c.audio === 'object') {\n        c = JSON.parse(JSON.stringify(c));\n        remap(c.audio, 'autoGainControl', 'mozAutoGainControl');\n        remap(c.audio, 'noiseSuppression', 'mozNoiseSuppression');\n      }\n      return nativeGetUserMedia(c);\n    };\n\n    if (MediaStreamTrack && MediaStreamTrack.prototype.getSettings) {\n      const nativeGetSettings = MediaStreamTrack.prototype.getSettings;\n      MediaStreamTrack.prototype.getSettings = function() {\n        const obj = nativeGetSettings.apply(this, arguments);\n        remap(obj, 'mozAutoGainControl', 'autoGainControl');\n        remap(obj, 'mozNoiseSuppression', 'noiseSuppression');\n        return obj;\n      };\n    }\n\n    if (MediaStreamTrack && MediaStreamTrack.prototype.applyConstraints) {\n      const nativeApplyConstraints =\n        MediaStreamTrack.prototype.applyConstraints;\n      MediaStreamTrack.prototype.applyConstraints = function(c) {\n        if (this.kind === 'audio' && typeof c === 'object') {\n          c = JSON.parse(JSON.stringify(c));\n          remap(c, 'autoGainControl', 'mozAutoGainControl');\n          remap(c, 'noiseSuppression', 'mozNoiseSuppression');\n        }\n        return nativeApplyConstraints.apply(this, [c]);\n      };\n    }\n  }\n}\n","/*\n *  Copyright (c) 2018 The adapter.js project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nexport function shimGetDisplayMedia(window, preferredMediaSource) {\n  if (window.navigator.mediaDevices &&\n    'getDisplayMedia' in window.navigator.mediaDevices) {\n    return;\n  }\n  if (!(window.navigator.mediaDevices)) {\n    return;\n  }\n  window.navigator.mediaDevices.getDisplayMedia =\n    function getDisplayMedia(constraints) {\n      if (!(constraints && constraints.video)) {\n        const err = new DOMException('getDisplayMedia without video ' +\n            'constraints is undefined');\n        err.name = 'NotFoundError';\n        // from https://heycam.github.io/webidl/#idl-DOMException-error-names\n        err.code = 8;\n        return Promise.reject(err);\n      }\n      if (constraints.video === true) {\n        constraints.video = {mediaSource: preferredMediaSource};\n      } else {\n        constraints.video.mediaSource = preferredMediaSource;\n      }\n      return window.navigator.mediaDevices.getUserMedia(constraints);\n    };\n}\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nimport * as utils from '../utils';\nexport {shimGetUserMedia} from './getusermedia';\nexport {shimGetDisplayMedia} from './getdisplaymedia';\n\nexport function shimOnTrack(window) {\n  if (typeof window === 'object' && window.RTCTrackEvent &&\n      ('receiver' in window.RTCTrackEvent.prototype) &&\n      !('transceiver' in window.RTCTrackEvent.prototype)) {\n    Object.defineProperty(window.RTCTrackEvent.prototype, 'transceiver', {\n      get() {\n        return {receiver: this.receiver};\n      }\n    });\n  }\n}\n\nexport function shimPeerConnection(window) {\n  const browserDetails = utils.detectBrowser(window);\n\n  if (typeof window !== 'object' ||\n      !(window.RTCPeerConnection || window.mozRTCPeerConnection)) {\n    return; // probably media.peerconnection.enabled=false in about:config\n  }\n  if (!window.RTCPeerConnection && window.mozRTCPeerConnection) {\n    // very basic support for old versions.\n    window.RTCPeerConnection = window.mozRTCPeerConnection;\n  }\n\n  if (browserDetails.version < 53) {\n    // shim away need for obsolete RTCIceCandidate/RTCSessionDescription.\n    ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate']\n        .forEach(function(method) {\n          const nativeMethod = window.RTCPeerConnection.prototype[method];\n          const methodObj = {[method]() {\n            arguments[0] = new ((method === 'addIceCandidate') ?\n                window.RTCIceCandidate :\n                window.RTCSessionDescription)(arguments[0]);\n            return nativeMethod.apply(this, arguments);\n          }};\n          window.RTCPeerConnection.prototype[method] = methodObj[method];\n        });\n  }\n\n  // support for addIceCandidate(null or undefined)\n  // as well as ignoring {sdpMid, candidate: \"\"}\n  if (browserDetails.version < 68) {\n    const nativeAddIceCandidate =\n        window.RTCPeerConnection.prototype.addIceCandidate;\n    window.RTCPeerConnection.prototype.addIceCandidate =\n    function addIceCandidate() {\n      if (!arguments[0]) {\n        if (arguments[1]) {\n          arguments[1].apply(null);\n        }\n        return Promise.resolve();\n      }\n      // Firefox 68+ emits and processes {candidate: \"\", ...}, ignore\n      // in older versions.\n      if (arguments[0] && arguments[0].candidate === '') {\n        return Promise.resolve();\n      }\n      return nativeAddIceCandidate.apply(this, arguments);\n    };\n  }\n\n  const modernStatsTypes = {\n    inboundrtp: 'inbound-rtp',\n    outboundrtp: 'outbound-rtp',\n    candidatepair: 'candidate-pair',\n    localcandidate: 'local-candidate',\n    remotecandidate: 'remote-candidate'\n  };\n\n  const nativeGetStats = window.RTCPeerConnection.prototype.getStats;\n  window.RTCPeerConnection.prototype.getStats = function getStats() {\n    const [selector, onSucc, onErr] = arguments;\n    return nativeGetStats.apply(this, [selector || null])\n      .then(stats => {\n        if (browserDetails.version < 53 && !onSucc) {\n          // Shim only promise getStats with spec-hyphens in type names\n          // Leave callback version alone; misc old uses of forEach before Map\n          try {\n            stats.forEach(stat => {\n              stat.type = modernStatsTypes[stat.type] || stat.type;\n            });\n          } catch (e) {\n            if (e.name !== 'TypeError') {\n              throw e;\n            }\n            // Avoid TypeError: \"type\" is read-only, in old versions. 34-43ish\n            stats.forEach((stat, i) => {\n              stats.set(i, Object.assign({}, stat, {\n                type: modernStatsTypes[stat.type] || stat.type\n              }));\n            });\n          }\n        }\n        return stats;\n      })\n      .then(onSucc, onErr);\n  };\n}\n\nexport function shimSenderGetStats(window) {\n  if (!(typeof window === 'object' && window.RTCPeerConnection &&\n      window.RTCRtpSender)) {\n    return;\n  }\n  if (window.RTCRtpSender && 'getStats' in window.RTCRtpSender.prototype) {\n    return;\n  }\n  const origGetSenders = window.RTCPeerConnection.prototype.getSenders;\n  if (origGetSenders) {\n    window.RTCPeerConnection.prototype.getSenders = function getSenders() {\n      const senders = origGetSenders.apply(this, []);\n      senders.forEach(sender => sender._pc = this);\n      return senders;\n    };\n  }\n\n  const origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n  if (origAddTrack) {\n    window.RTCPeerConnection.prototype.addTrack = function addTrack() {\n      const sender = origAddTrack.apply(this, arguments);\n      sender._pc = this;\n      return sender;\n    };\n  }\n  window.RTCRtpSender.prototype.getStats = function getStats() {\n    return this.track ? this._pc.getStats(this.track) :\n        Promise.resolve(new Map());\n  };\n}\n\nexport function shimReceiverGetStats(window) {\n  if (!(typeof window === 'object' && window.RTCPeerConnection &&\n      window.RTCRtpSender)) {\n    return;\n  }\n  if (window.RTCRtpSender && 'getStats' in window.RTCRtpReceiver.prototype) {\n    return;\n  }\n  const origGetReceivers = window.RTCPeerConnection.prototype.getReceivers;\n  if (origGetReceivers) {\n    window.RTCPeerConnection.prototype.getReceivers = function getReceivers() {\n      const receivers = origGetReceivers.apply(this, []);\n      receivers.forEach(receiver => receiver._pc = this);\n      return receivers;\n    };\n  }\n  utils.wrapPeerConnectionEvent(window, 'track', e => {\n    e.receiver._pc = e.srcElement;\n    return e;\n  });\n  window.RTCRtpReceiver.prototype.getStats = function getStats() {\n    return this._pc.getStats(this.track);\n  };\n}\n\nexport function shimRemoveStream(window) {\n  if (!window.RTCPeerConnection ||\n      'removeStream' in window.RTCPeerConnection.prototype) {\n    return;\n  }\n  window.RTCPeerConnection.prototype.removeStream =\n    function removeStream(stream) {\n      utils.deprecated('removeStream', 'removeTrack');\n      this.getSenders().forEach(sender => {\n        if (sender.track && stream.getTracks().includes(sender.track)) {\n          this.removeTrack(sender);\n        }\n      });\n    };\n}\n\nexport function shimRTCDataChannel(window) {\n  // rename DataChannel to RTCDataChannel (native fix in FF60):\n  // https://bugzilla.mozilla.org/show_bug.cgi?id=1173851\n  if (window.DataChannel && !window.RTCDataChannel) {\n    window.RTCDataChannel = window.DataChannel;\n  }\n}\n\nexport function shimAddTransceiver(window) {\n  // https://github.com/webrtcHacks/adapter/issues/998#issuecomment-516921647\n  // Firefox ignores the init sendEncodings options passed to addTransceiver\n  // https://bugzilla.mozilla.org/show_bug.cgi?id=1396918\n  if (!(typeof window === 'object' && window.RTCPeerConnection)) {\n    return;\n  }\n  const origAddTransceiver = window.RTCPeerConnection.prototype.addTransceiver;\n  if (origAddTransceiver) {\n    window.RTCPeerConnection.prototype.addTransceiver =\n      function addTransceiver() {\n        this.setParametersPromises = [];\n        const initParameters = arguments[1];\n        const shouldPerformCheck = initParameters &&\n                                  'sendEncodings' in initParameters;\n        if (shouldPerformCheck) {\n          // If sendEncodings params are provided, validate grammar\n          initParameters.sendEncodings.forEach((encodingParam) => {\n            if ('rid' in encodingParam) {\n              const ridRegex = /^[a-z0-9]{0,16}$/i;\n              if (!ridRegex.test(encodingParam.rid)) {\n                throw new TypeError('Invalid RID value provided.');\n              }\n            }\n            if ('scaleResolutionDownBy' in encodingParam) {\n              if (!(parseFloat(encodingParam.scaleResolutionDownBy) >= 1.0)) {\n                throw new RangeError('scale_resolution_down_by must be >= 1.0');\n              }\n            }\n            if ('maxFramerate' in encodingParam) {\n              if (!(parseFloat(encodingParam.maxFramerate) >= 0)) {\n                throw new RangeError('max_framerate must be >= 0.0');\n              }\n            }\n          });\n        }\n        const transceiver = origAddTransceiver.apply(this, arguments);\n        if (shouldPerformCheck) {\n          // Check if the init options were applied. If not we do this in an\n          // asynchronous way and save the promise reference in a global object.\n          // This is an ugly hack, but at the same time is way more robust than\n          // checking the sender parameters before and after the createOffer\n          // Also note that after the createoffer we are not 100% sure that\n          // the params were asynchronously applied so we might miss the\n          // opportunity to recreate offer.\n          const {sender} = transceiver;\n          const params = sender.getParameters();\n          if (!('encodings' in params) ||\n              // Avoid being fooled by patched getParameters() below.\n              (params.encodings.length === 1 &&\n               Object.keys(params.encodings[0]).length === 0)) {\n            params.encodings = initParameters.sendEncodings;\n            sender.sendEncodings = initParameters.sendEncodings;\n            this.setParametersPromises.push(sender.setParameters(params)\n              .then(() => {\n                delete sender.sendEncodings;\n              }).catch(() => {\n                delete sender.sendEncodings;\n              })\n            );\n          }\n        }\n        return transceiver;\n      };\n  }\n}\n\nexport function shimGetParameters(window) {\n  if (!(typeof window === 'object' && window.RTCRtpSender)) {\n    return;\n  }\n  const origGetParameters = window.RTCRtpSender.prototype.getParameters;\n  if (origGetParameters) {\n    window.RTCRtpSender.prototype.getParameters =\n      function getParameters() {\n        const params = origGetParameters.apply(this, arguments);\n        if (!('encodings' in params)) {\n          params.encodings = [].concat(this.sendEncodings || [{}]);\n        }\n        return params;\n      };\n  }\n}\n\nexport function shimCreateOffer(window) {\n  // https://github.com/webrtcHacks/adapter/issues/998#issuecomment-516921647\n  // Firefox ignores the init sendEncodings options passed to addTransceiver\n  // https://bugzilla.mozilla.org/show_bug.cgi?id=1396918\n  if (!(typeof window === 'object' && window.RTCPeerConnection)) {\n    return;\n  }\n  const origCreateOffer = window.RTCPeerConnection.prototype.createOffer;\n  window.RTCPeerConnection.prototype.createOffer = function createOffer() {\n    if (this.setParametersPromises && this.setParametersPromises.length) {\n      return Promise.all(this.setParametersPromises)\n      .then(() => {\n        return origCreateOffer.apply(this, arguments);\n      })\n      .finally(() => {\n        this.setParametersPromises = [];\n      });\n    }\n    return origCreateOffer.apply(this, arguments);\n  };\n}\n\nexport function shimCreateAnswer(window) {\n  // https://github.com/webrtcHacks/adapter/issues/998#issuecomment-516921647\n  // Firefox ignores the init sendEncodings options passed to addTransceiver\n  // https://bugzilla.mozilla.org/show_bug.cgi?id=1396918\n  if (!(typeof window === 'object' && window.RTCPeerConnection)) {\n    return;\n  }\n  const origCreateAnswer = window.RTCPeerConnection.prototype.createAnswer;\n  window.RTCPeerConnection.prototype.createAnswer = function createAnswer() {\n    if (this.setParametersPromises && this.setParametersPromises.length) {\n      return Promise.all(this.setParametersPromises)\n      .then(() => {\n        return origCreateAnswer.apply(this, arguments);\n      })\n      .finally(() => {\n        this.setParametersPromises = [];\n      });\n    }\n    return origCreateAnswer.apply(this, arguments);\n  };\n}\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n'use strict';\nimport * as utils from '../utils';\n\nexport function shimLocalStreamsAPI(window) {\n  if (typeof window !== 'object' || !window.RTCPeerConnection) {\n    return;\n  }\n  if (!('getLocalStreams' in window.RTCPeerConnection.prototype)) {\n    window.RTCPeerConnection.prototype.getLocalStreams =\n      function getLocalStreams() {\n        if (!this._localStreams) {\n          this._localStreams = [];\n        }\n        return this._localStreams;\n      };\n  }\n  if (!('addStream' in window.RTCPeerConnection.prototype)) {\n    const _addTrack = window.RTCPeerConnection.prototype.addTrack;\n    window.RTCPeerConnection.prototype.addStream = function addStream(stream) {\n      if (!this._localStreams) {\n        this._localStreams = [];\n      }\n      if (!this._localStreams.includes(stream)) {\n        this._localStreams.push(stream);\n      }\n      // Try to emulate Chrome's behaviour of adding in audio-video order.\n      // Safari orders by track id.\n      stream.getAudioTracks().forEach(track => _addTrack.call(this, track,\n        stream));\n      stream.getVideoTracks().forEach(track => _addTrack.call(this, track,\n        stream));\n    };\n\n    window.RTCPeerConnection.prototype.addTrack =\n      function addTrack(track, ...streams) {\n        if (streams) {\n          streams.forEach((stream) => {\n            if (!this._localStreams) {\n              this._localStreams = [stream];\n            } else if (!this._localStreams.includes(stream)) {\n              this._localStreams.push(stream);\n            }\n          });\n        }\n        return _addTrack.apply(this, arguments);\n      };\n  }\n  if (!('removeStream' in window.RTCPeerConnection.prototype)) {\n    window.RTCPeerConnection.prototype.removeStream =\n      function removeStream(stream) {\n        if (!this._localStreams) {\n          this._localStreams = [];\n        }\n        const index = this._localStreams.indexOf(stream);\n        if (index === -1) {\n          return;\n        }\n        this._localStreams.splice(index, 1);\n        const tracks = stream.getTracks();\n        this.getSenders().forEach(sender => {\n          if (tracks.includes(sender.track)) {\n            this.removeTrack(sender);\n          }\n        });\n      };\n  }\n}\n\nexport function shimRemoteStreamsAPI(window) {\n  if (typeof window !== 'object' || !window.RTCPeerConnection) {\n    return;\n  }\n  if (!('getRemoteStreams' in window.RTCPeerConnection.prototype)) {\n    window.RTCPeerConnection.prototype.getRemoteStreams =\n      function getRemoteStreams() {\n        return this._remoteStreams ? this._remoteStreams : [];\n      };\n  }\n  if (!('onaddstream' in window.RTCPeerConnection.prototype)) {\n    Object.defineProperty(window.RTCPeerConnection.prototype, 'onaddstream', {\n      get() {\n        return this._onaddstream;\n      },\n      set(f) {\n        if (this._onaddstream) {\n          this.removeEventListener('addstream', this._onaddstream);\n          this.removeEventListener('track', this._onaddstreampoly);\n        }\n        this.addEventListener('addstream', this._onaddstream = f);\n        this.addEventListener('track', this._onaddstreampoly = (e) => {\n          e.streams.forEach(stream => {\n            if (!this._remoteStreams) {\n              this._remoteStreams = [];\n            }\n            if (this._remoteStreams.includes(stream)) {\n              return;\n            }\n            this._remoteStreams.push(stream);\n            const event = new Event('addstream');\n            event.stream = stream;\n            this.dispatchEvent(event);\n          });\n        });\n      }\n    });\n    const origSetRemoteDescription =\n      window.RTCPeerConnection.prototype.setRemoteDescription;\n    window.RTCPeerConnection.prototype.setRemoteDescription =\n      function setRemoteDescription() {\n        const pc = this;\n        if (!this._onaddstreampoly) {\n          this.addEventListener('track', this._onaddstreampoly = function(e) {\n            e.streams.forEach(stream => {\n              if (!pc._remoteStreams) {\n                pc._remoteStreams = [];\n              }\n              if (pc._remoteStreams.indexOf(stream) >= 0) {\n                return;\n              }\n              pc._remoteStreams.push(stream);\n              const event = new Event('addstream');\n              event.stream = stream;\n              pc.dispatchEvent(event);\n            });\n          });\n        }\n        return origSetRemoteDescription.apply(pc, arguments);\n      };\n  }\n}\n\nexport function shimCallbacksAPI(window) {\n  if (typeof window !== 'object' || !window.RTCPeerConnection) {\n    return;\n  }\n  const prototype = window.RTCPeerConnection.prototype;\n  const origCreateOffer = prototype.createOffer;\n  const origCreateAnswer = prototype.createAnswer;\n  const setLocalDescription = prototype.setLocalDescription;\n  const setRemoteDescription = prototype.setRemoteDescription;\n  const addIceCandidate = prototype.addIceCandidate;\n\n  prototype.createOffer =\n    function createOffer(successCallback, failureCallback) {\n      const options = (arguments.length >= 2) ? arguments[2] : arguments[0];\n      const promise = origCreateOffer.apply(this, [options]);\n      if (!failureCallback) {\n        return promise;\n      }\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n\n  prototype.createAnswer =\n    function createAnswer(successCallback, failureCallback) {\n      const options = (arguments.length >= 2) ? arguments[2] : arguments[0];\n      const promise = origCreateAnswer.apply(this, [options]);\n      if (!failureCallback) {\n        return promise;\n      }\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n\n  let withCallback = function(description, successCallback, failureCallback) {\n    const promise = setLocalDescription.apply(this, [description]);\n    if (!failureCallback) {\n      return promise;\n    }\n    promise.then(successCallback, failureCallback);\n    return Promise.resolve();\n  };\n  prototype.setLocalDescription = withCallback;\n\n  withCallback = function(description, successCallback, failureCallback) {\n    const promise = setRemoteDescription.apply(this, [description]);\n    if (!failureCallback) {\n      return promise;\n    }\n    promise.then(successCallback, failureCallback);\n    return Promise.resolve();\n  };\n  prototype.setRemoteDescription = withCallback;\n\n  withCallback = function(candidate, successCallback, failureCallback) {\n    const promise = addIceCandidate.apply(this, [candidate]);\n    if (!failureCallback) {\n      return promise;\n    }\n    promise.then(successCallback, failureCallback);\n    return Promise.resolve();\n  };\n  prototype.addIceCandidate = withCallback;\n}\n\nexport function shimGetUserMedia(window) {\n  const navigator = window && window.navigator;\n\n  if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n    // shim not needed in Safari 12.1\n    const mediaDevices = navigator.mediaDevices;\n    const _getUserMedia = mediaDevices.getUserMedia.bind(mediaDevices);\n    navigator.mediaDevices.getUserMedia = (constraints) => {\n      return _getUserMedia(shimConstraints(constraints));\n    };\n  }\n\n  if (!navigator.getUserMedia && navigator.mediaDevices &&\n    navigator.mediaDevices.getUserMedia) {\n    navigator.getUserMedia = function getUserMedia(constraints, cb, errcb) {\n      navigator.mediaDevices.getUserMedia(constraints)\n      .then(cb, errcb);\n    }.bind(navigator);\n  }\n}\n\nexport function shimConstraints(constraints) {\n  if (constraints && constraints.video !== undefined) {\n    return Object.assign({},\n      constraints,\n      {video: utils.compactObject(constraints.video)}\n    );\n  }\n\n  return constraints;\n}\n\nexport function shimRTCIceServerUrls(window) {\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n  // migrate from non-spec RTCIceServer.url to RTCIceServer.urls\n  const OrigPeerConnection = window.RTCPeerConnection;\n  window.RTCPeerConnection =\n    function RTCPeerConnection(pcConfig, pcConstraints) {\n      if (pcConfig && pcConfig.iceServers) {\n        const newIceServers = [];\n        for (let i = 0; i < pcConfig.iceServers.length; i++) {\n          let server = pcConfig.iceServers[i];\n          if (!server.hasOwnProperty('urls') &&\n              server.hasOwnProperty('url')) {\n            utils.deprecated('RTCIceServer.url', 'RTCIceServer.urls');\n            server = JSON.parse(JSON.stringify(server));\n            server.urls = server.url;\n            delete server.url;\n            newIceServers.push(server);\n          } else {\n            newIceServers.push(pcConfig.iceServers[i]);\n          }\n        }\n        pcConfig.iceServers = newIceServers;\n      }\n      return new OrigPeerConnection(pcConfig, pcConstraints);\n    };\n  window.RTCPeerConnection.prototype = OrigPeerConnection.prototype;\n  // wrap static methods. Currently just generateCertificate.\n  if ('generateCertificate' in OrigPeerConnection) {\n    Object.defineProperty(window.RTCPeerConnection, 'generateCertificate', {\n      get() {\n        return OrigPeerConnection.generateCertificate;\n      }\n    });\n  }\n}\n\nexport function shimTrackEventTransceiver(window) {\n  // Add event.transceiver member over deprecated event.receiver\n  if (typeof window === 'object' && window.RTCTrackEvent &&\n      'receiver' in window.RTCTrackEvent.prototype &&\n      !('transceiver' in window.RTCTrackEvent.prototype)) {\n    Object.defineProperty(window.RTCTrackEvent.prototype, 'transceiver', {\n      get() {\n        return {receiver: this.receiver};\n      }\n    });\n  }\n}\n\nexport function shimCreateOfferLegacy(window) {\n  const origCreateOffer = window.RTCPeerConnection.prototype.createOffer;\n  window.RTCPeerConnection.prototype.createOffer =\n    function createOffer(offerOptions) {\n      if (offerOptions) {\n        if (typeof offerOptions.offerToReceiveAudio !== 'undefined') {\n          // support bit values\n          offerOptions.offerToReceiveAudio =\n            !!offerOptions.offerToReceiveAudio;\n        }\n        const audioTransceiver = this.getTransceivers().find(transceiver =>\n          transceiver.receiver.track.kind === 'audio');\n        if (offerOptions.offerToReceiveAudio === false && audioTransceiver) {\n          if (audioTransceiver.direction === 'sendrecv') {\n            if (audioTransceiver.setDirection) {\n              audioTransceiver.setDirection('sendonly');\n            } else {\n              audioTransceiver.direction = 'sendonly';\n            }\n          } else if (audioTransceiver.direction === 'recvonly') {\n            if (audioTransceiver.setDirection) {\n              audioTransceiver.setDirection('inactive');\n            } else {\n              audioTransceiver.direction = 'inactive';\n            }\n          }\n        } else if (offerOptions.offerToReceiveAudio === true &&\n            !audioTransceiver) {\n          this.addTransceiver('audio');\n        }\n\n        if (typeof offerOptions.offerToReceiveVideo !== 'undefined') {\n          // support bit values\n          offerOptions.offerToReceiveVideo =\n            !!offerOptions.offerToReceiveVideo;\n        }\n        const videoTransceiver = this.getTransceivers().find(transceiver =>\n          transceiver.receiver.track.kind === 'video');\n        if (offerOptions.offerToReceiveVideo === false && videoTransceiver) {\n          if (videoTransceiver.direction === 'sendrecv') {\n            if (videoTransceiver.setDirection) {\n              videoTransceiver.setDirection('sendonly');\n            } else {\n              videoTransceiver.direction = 'sendonly';\n            }\n          } else if (videoTransceiver.direction === 'recvonly') {\n            if (videoTransceiver.setDirection) {\n              videoTransceiver.setDirection('inactive');\n            } else {\n              videoTransceiver.direction = 'inactive';\n            }\n          }\n        } else if (offerOptions.offerToReceiveVideo === true &&\n            !videoTransceiver) {\n          this.addTransceiver('video');\n        }\n      }\n      return origCreateOffer.apply(this, arguments);\n    };\n}\n\nexport function shimAudioContext(window) {\n  if (typeof window !== 'object' || window.AudioContext) {\n    return;\n  }\n  window.AudioContext = window.webkitAudioContext;\n}\n","/*\n *  Copyright (c) 2017 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nimport SDPUtils from 'sdp';\nimport * as utils from './utils';\n\nexport function shimRTCIceCandidate(window) {\n  // foundation is arbitrarily chosen as an indicator for full support for\n  // https://w3c.github.io/webrtc-pc/#rtcicecandidate-interface\n  if (!window.RTCIceCandidate || (window.RTCIceCandidate && 'foundation' in\n      window.RTCIceCandidate.prototype)) {\n    return;\n  }\n\n  const NativeRTCIceCandidate = window.RTCIceCandidate;\n  window.RTCIceCandidate = function RTCIceCandidate(args) {\n    // Remove the a= which shouldn't be part of the candidate string.\n    if (typeof args === 'object' && args.candidate &&\n        args.candidate.indexOf('a=') === 0) {\n      args = JSON.parse(JSON.stringify(args));\n      args.candidate = args.candidate.substr(2);\n    }\n\n    if (args.candidate && args.candidate.length) {\n      // Augment the native candidate with the parsed fields.\n      const nativeCandidate = new NativeRTCIceCandidate(args);\n      const parsedCandidate = SDPUtils.parseCandidate(args.candidate);\n      const augmentedCandidate = Object.assign(nativeCandidate,\n          parsedCandidate);\n\n      // Add a serializer that does not serialize the extra attributes.\n      augmentedCandidate.toJSON = function toJSON() {\n        return {\n          candidate: augmentedCandidate.candidate,\n          sdpMid: augmentedCandidate.sdpMid,\n          sdpMLineIndex: augmentedCandidate.sdpMLineIndex,\n          usernameFragment: augmentedCandidate.usernameFragment,\n        };\n      };\n      return augmentedCandidate;\n    }\n    return new NativeRTCIceCandidate(args);\n  };\n  window.RTCIceCandidate.prototype = NativeRTCIceCandidate.prototype;\n\n  // Hook up the augmented candidate in onicecandidate and\n  // addEventListener('icecandidate', ...)\n  utils.wrapPeerConnectionEvent(window, 'icecandidate', e => {\n    if (e.candidate) {\n      Object.defineProperty(e, 'candidate', {\n        value: new window.RTCIceCandidate(e.candidate),\n        writable: 'false'\n      });\n    }\n    return e;\n  });\n}\n\nexport function shimMaxMessageSize(window) {\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n  const browserDetails = utils.detectBrowser(window);\n\n  if (!('sctp' in window.RTCPeerConnection.prototype)) {\n    Object.defineProperty(window.RTCPeerConnection.prototype, 'sctp', {\n      get() {\n        return typeof this._sctp === 'undefined' ? null : this._sctp;\n      }\n    });\n  }\n\n  const sctpInDescription = function(description) {\n    if (!description || !description.sdp) {\n      return false;\n    }\n    const sections = SDPUtils.splitSections(description.sdp);\n    sections.shift();\n    return sections.some(mediaSection => {\n      const mLine = SDPUtils.parseMLine(mediaSection);\n      return mLine && mLine.kind === 'application'\n          && mLine.protocol.indexOf('SCTP') !== -1;\n    });\n  };\n\n  const getRemoteFirefoxVersion = function(description) {\n    // TODO: Is there a better solution for detecting Firefox?\n    const match = description.sdp.match(/mozilla...THIS_IS_SDPARTA-(\\d+)/);\n    if (match === null || match.length < 2) {\n      return -1;\n    }\n    const version = parseInt(match[1], 10);\n    // Test for NaN (yes, this is ugly)\n    return version !== version ? -1 : version;\n  };\n\n  const getCanSendMaxMessageSize = function(remoteIsFirefox) {\n    // Every implementation we know can send at least 64 KiB.\n    // Note: Although Chrome is technically able to send up to 256 KiB, the\n    //       data does not reach the other peer reliably.\n    //       See: https://bugs.chromium.org/p/webrtc/issues/detail?id=8419\n    let canSendMaxMessageSize = 65536;\n    if (browserDetails.browser === 'firefox') {\n      if (browserDetails.version < 57) {\n        if (remoteIsFirefox === -1) {\n          // FF < 57 will send in 16 KiB chunks using the deprecated PPID\n          // fragmentation.\n          canSendMaxMessageSize = 16384;\n        } else {\n          // However, other FF (and RAWRTC) can reassemble PPID-fragmented\n          // messages. Thus, supporting ~2 GiB when sending.\n          canSendMaxMessageSize = 2147483637;\n        }\n      } else if (browserDetails.version < 60) {\n        // Currently, all FF >= 57 will reset the remote maximum message size\n        // to the default value when a data channel is created at a later\n        // stage. :(\n        // See: https://bugzilla.mozilla.org/show_bug.cgi?id=1426831\n        canSendMaxMessageSize =\n          browserDetails.version === 57 ? 65535 : 65536;\n      } else {\n        // FF >= 60 supports sending ~2 GiB\n        canSendMaxMessageSize = 2147483637;\n      }\n    }\n    return canSendMaxMessageSize;\n  };\n\n  const getMaxMessageSize = function(description, remoteIsFirefox) {\n    // Note: 65536 bytes is the default value from the SDP spec. Also,\n    //       every implementation we know supports receiving 65536 bytes.\n    let maxMessageSize = 65536;\n\n    // FF 57 has a slightly incorrect default remote max message size, so\n    // we need to adjust it here to avoid a failure when sending.\n    // See: https://bugzilla.mozilla.org/show_bug.cgi?id=1425697\n    if (browserDetails.browser === 'firefox'\n         && browserDetails.version === 57) {\n      maxMessageSize = 65535;\n    }\n\n    const match = SDPUtils.matchPrefix(description.sdp,\n      'a=max-message-size:');\n    if (match.length > 0) {\n      maxMessageSize = parseInt(match[0].substr(19), 10);\n    } else if (browserDetails.browser === 'firefox' &&\n                remoteIsFirefox !== -1) {\n      // If the maximum message size is not present in the remote SDP and\n      // both local and remote are Firefox, the remote peer can receive\n      // ~2 GiB.\n      maxMessageSize = 2147483637;\n    }\n    return maxMessageSize;\n  };\n\n  const origSetRemoteDescription =\n      window.RTCPeerConnection.prototype.setRemoteDescription;\n  window.RTCPeerConnection.prototype.setRemoteDescription =\n    function setRemoteDescription() {\n      this._sctp = null;\n      // Chrome decided to not expose .sctp in plan-b mode.\n      // As usual, adapter.js has to do an 'ugly worakaround'\n      // to cover up the mess.\n      if (browserDetails.browser === 'chrome' && browserDetails.version >= 76) {\n        const {sdpSemantics} = this.getConfiguration();\n        if (sdpSemantics === 'plan-b') {\n          Object.defineProperty(this, 'sctp', {\n            get() {\n              return typeof this._sctp === 'undefined' ? null : this._sctp;\n            },\n            enumerable: true,\n            configurable: true,\n          });\n        }\n      }\n\n      if (sctpInDescription(arguments[0])) {\n        // Check if the remote is FF.\n        const isFirefox = getRemoteFirefoxVersion(arguments[0]);\n\n        // Get the maximum message size the local peer is capable of sending\n        const canSendMMS = getCanSendMaxMessageSize(isFirefox);\n\n        // Get the maximum message size of the remote peer.\n        const remoteMMS = getMaxMessageSize(arguments[0], isFirefox);\n\n        // Determine final maximum message size\n        let maxMessageSize;\n        if (canSendMMS === 0 && remoteMMS === 0) {\n          maxMessageSize = Number.POSITIVE_INFINITY;\n        } else if (canSendMMS === 0 || remoteMMS === 0) {\n          maxMessageSize = Math.max(canSendMMS, remoteMMS);\n        } else {\n          maxMessageSize = Math.min(canSendMMS, remoteMMS);\n        }\n\n        // Create a dummy RTCSctpTransport object and the 'maxMessageSize'\n        // attribute.\n        const sctp = {};\n        Object.defineProperty(sctp, 'maxMessageSize', {\n          get() {\n            return maxMessageSize;\n          }\n        });\n        this._sctp = sctp;\n      }\n\n      return origSetRemoteDescription.apply(this, arguments);\n    };\n}\n\nexport function shimSendThrowTypeError(window) {\n  if (!(window.RTCPeerConnection &&\n      'createDataChannel' in window.RTCPeerConnection.prototype)) {\n    return;\n  }\n\n  // Note: Although Firefox >= 57 has a native implementation, the maximum\n  //       message size can be reset for all data channels at a later stage.\n  //       See: https://bugzilla.mozilla.org/show_bug.cgi?id=1426831\n\n  function wrapDcSend(dc, pc) {\n    const origDataChannelSend = dc.send;\n    dc.send = function send() {\n      const data = arguments[0];\n      const length = data.length || data.size || data.byteLength;\n      if (dc.readyState === 'open' &&\n          pc.sctp && length > pc.sctp.maxMessageSize) {\n        throw new TypeError('Message too large (can send a maximum of ' +\n          pc.sctp.maxMessageSize + ' bytes)');\n      }\n      return origDataChannelSend.apply(dc, arguments);\n    };\n  }\n  const origCreateDataChannel =\n    window.RTCPeerConnection.prototype.createDataChannel;\n  window.RTCPeerConnection.prototype.createDataChannel =\n    function createDataChannel() {\n      const dataChannel = origCreateDataChannel.apply(this, arguments);\n      wrapDcSend(dataChannel, this);\n      return dataChannel;\n    };\n  utils.wrapPeerConnectionEvent(window, 'datachannel', e => {\n    wrapDcSend(e.channel, e.target);\n    return e;\n  });\n}\n\n\n/* shims RTCConnectionState by pretending it is the same as iceConnectionState.\n * See https://bugs.chromium.org/p/webrtc/issues/detail?id=6145#c12\n * for why this is a valid hack in Chrome. In Firefox it is slightly incorrect\n * since DTLS failures would be hidden. See\n * https://bugzilla.mozilla.org/show_bug.cgi?id=1265827\n * for the Firefox tracking bug.\n */\nexport function shimConnectionState(window) {\n  if (!window.RTCPeerConnection ||\n      'connectionState' in window.RTCPeerConnection.prototype) {\n    return;\n  }\n  const proto = window.RTCPeerConnection.prototype;\n  Object.defineProperty(proto, 'connectionState', {\n    get() {\n      return {\n        completed: 'connected',\n        checking: 'connecting'\n      }[this.iceConnectionState] || this.iceConnectionState;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(proto, 'onconnectionstatechange', {\n    get() {\n      return this._onconnectionstatechange || null;\n    },\n    set(cb) {\n      if (this._onconnectionstatechange) {\n        this.removeEventListener('connectionstatechange',\n            this._onconnectionstatechange);\n        delete this._onconnectionstatechange;\n      }\n      if (cb) {\n        this.addEventListener('connectionstatechange',\n            this._onconnectionstatechange = cb);\n      }\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  ['setLocalDescription', 'setRemoteDescription'].forEach((method) => {\n    const origMethod = proto[method];\n    proto[method] = function() {\n      if (!this._connectionstatechangepoly) {\n        this._connectionstatechangepoly = e => {\n          const pc = e.target;\n          if (pc._lastConnectionState !== pc.connectionState) {\n            pc._lastConnectionState = pc.connectionState;\n            const newEvent = new Event('connectionstatechange', e);\n            pc.dispatchEvent(newEvent);\n          }\n          return e;\n        };\n        this.addEventListener('iceconnectionstatechange',\n          this._connectionstatechangepoly);\n      }\n      return origMethod.apply(this, arguments);\n    };\n  });\n}\n\nexport function removeAllowExtmapMixed(window) {\n  /* remove a=extmap-allow-mixed for webrtc.org < M71 */\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n  const browserDetails = utils.detectBrowser(window);\n  if (browserDetails.browser === 'chrome' && browserDetails.version >= 71) {\n    return;\n  }\n  if (browserDetails.browser === 'safari' && browserDetails.version >= 605) {\n    return;\n  }\n  const nativeSRD = window.RTCPeerConnection.prototype.setRemoteDescription;\n  window.RTCPeerConnection.prototype.setRemoteDescription =\n  function setRemoteDescription(desc) {\n    if (desc && desc.sdp && desc.sdp.indexOf('\\na=extmap-allow-mixed') !== -1) {\n      desc.sdp = desc.sdp.split('\\n').filter((line) => {\n        return line.trim() !== 'a=extmap-allow-mixed';\n      }).join('\\n');\n    }\n    return nativeSRD.apply(this, arguments);\n  };\n}\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n\n'use strict';\n\nimport {adapterFactory} from './adapter_factory.js';\n\nconst adapter =\n  adapterFactory({window: typeof window === 'undefined' ? undefined : window});\nexport default adapter;\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\nimport * as utils from './utils';\n\n  // Browser shims.\nimport * as chromeShim from './chrome/chrome_shim';\nimport * as edgeShim from './edge/edge_shim';\nimport * as firefoxShim from './firefox/firefox_shim';\nimport * as safariShim from './safari/safari_shim';\nimport * as commonShim from './common_shim';\n\n// Shimming starts here.\nexport function adapterFactory({window} = {}, options = {\n  shimChrome: true,\n  shimFirefox: true,\n  shimEdge: true,\n  shimSafari: true,\n}) {\n  // Utils.\n  const logging = utils.log;\n  const browserDetails = utils.detectBrowser(window);\n\n  const adapter = {\n    browserDetails,\n    commonShim,\n    extractVersion: utils.extractVersion,\n    disableLog: utils.disableLog,\n    disableWarnings: utils.disableWarnings\n  };\n\n  // Shim browser if found.\n  switch (browserDetails.browser) {\n    case 'chrome':\n      if (!chromeShim || !chromeShim.shimPeerConnection ||\n          !options.shimChrome) {\n        logging('Chrome shim is not included in this adapter release.');\n        return adapter;\n      }\n      if (browserDetails.version === null) {\n        logging('Chrome shim can not determine version, not shimming.');\n        return adapter;\n      }\n      logging('adapter.js shimming chrome.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = chromeShim;\n\n      chromeShim.shimGetUserMedia(window);\n      chromeShim.shimMediaStream(window);\n      chromeShim.shimPeerConnection(window);\n      chromeShim.shimOnTrack(window);\n      chromeShim.shimAddTrackRemoveTrack(window);\n      chromeShim.shimGetSendersWithDtmf(window);\n      chromeShim.shimGetStats(window);\n      chromeShim.shimSenderReceiverGetStats(window);\n      chromeShim.fixNegotiationNeeded(window);\n\n      commonShim.shimRTCIceCandidate(window);\n      commonShim.shimConnectionState(window);\n      commonShim.shimMaxMessageSize(window);\n      commonShim.shimSendThrowTypeError(window);\n      commonShim.removeAllowExtmapMixed(window);\n      break;\n    case 'firefox':\n      if (!firefoxShim || !firefoxShim.shimPeerConnection ||\n          !options.shimFirefox) {\n        logging('Firefox shim is not included in this adapter release.');\n        return adapter;\n      }\n      logging('adapter.js shimming firefox.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = firefoxShim;\n\n      firefoxShim.shimGetUserMedia(window);\n      firefoxShim.shimPeerConnection(window);\n      firefoxShim.shimOnTrack(window);\n      firefoxShim.shimRemoveStream(window);\n      firefoxShim.shimSenderGetStats(window);\n      firefoxShim.shimReceiverGetStats(window);\n      firefoxShim.shimRTCDataChannel(window);\n      firefoxShim.shimAddTransceiver(window);\n      firefoxShim.shimGetParameters(window);\n      firefoxShim.shimCreateOffer(window);\n      firefoxShim.shimCreateAnswer(window);\n\n      commonShim.shimRTCIceCandidate(window);\n      commonShim.shimConnectionState(window);\n      commonShim.shimMaxMessageSize(window);\n      commonShim.shimSendThrowTypeError(window);\n      break;\n    case 'edge':\n      if (!edgeShim || !edgeShim.shimPeerConnection || !options.shimEdge) {\n        logging('MS edge shim is not included in this adapter release.');\n        return adapter;\n      }\n      logging('adapter.js shimming edge.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = edgeShim;\n\n      edgeShim.shimGetUserMedia(window);\n      edgeShim.shimGetDisplayMedia(window);\n      edgeShim.shimPeerConnection(window);\n      edgeShim.shimReplaceTrack(window);\n\n      // the edge shim implements the full RTCIceCandidate object.\n\n      commonShim.shimMaxMessageSize(window);\n      commonShim.shimSendThrowTypeError(window);\n      break;\n    case 'safari':\n      if (!safariShim || !options.shimSafari) {\n        logging('Safari shim is not included in this adapter release.');\n        return adapter;\n      }\n      logging('adapter.js shimming safari.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = safariShim;\n\n      safariShim.shimRTCIceServerUrls(window);\n      safariShim.shimCreateOfferLegacy(window);\n      safariShim.shimCallbacksAPI(window);\n      safariShim.shimLocalStreamsAPI(window);\n      safariShim.shimRemoteStreamsAPI(window);\n      safariShim.shimTrackEventTransceiver(window);\n      safariShim.shimGetUserMedia(window);\n      safariShim.shimAudioContext(window);\n\n      commonShim.shimRTCIceCandidate(window);\n      commonShim.shimMaxMessageSize(window);\n      commonShim.shimSendThrowTypeError(window);\n      commonShim.removeAllowExtmapMixed(window);\n      break;\n    default:\n      logging('Unsupported browser!');\n      break;\n  }\n\n  return adapter;\n}\n","// created by @HenrikJoreteg\nvar prefix;\nvar version;\n\nif (window.mozRTCPeerConnection || navigator.mozGetUserMedia) {\n    prefix = 'moz';\n    version = parseInt(navigator.userAgent.match(/Firefox\\/([0-9]+)\\./)[1], 10);\n} else if (window.webkitRTCPeerConnection || navigator.webkitGetUserMedia) {\n    prefix = 'webkit';\n    version = navigator.userAgent.match(/Chrom(e|ium)/) && parseInt(navigator.userAgent.match(/Chrom(e|ium)\\/([0-9]+)\\./)[2], 10);\n}\n\nvar PC = window.RTCPeerConnection || window.mozRTCPeerConnection || window.webkitRTCPeerConnection;\nvar IceCandidate = window.mozRTCIceCandidate || window.RTCIceCandidate;\nvar SessionDescription = window.mozRTCSessionDescription || window.RTCSessionDescription;\nvar MediaStream = window.webkitMediaStream || window.MediaStream;\nvar screenSharing = window.location.protocol === 'https:' &&\n    ((prefix === 'webkit' && version >= 26) ||\n     (prefix === 'moz' && version >= 33))\nvar AudioContext = window.AudioContext || window.webkitAudioContext;\nvar videoEl = document.createElement('video');\nvar supportVp8 = videoEl && videoEl.canPlayType && videoEl.canPlayType('video/webm; codecs=\"vp8\", vorbis') === \"probably\";\nvar getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.msGetUserMedia || navigator.mozGetUserMedia;\n\n// export support flags and constructors.prototype && PC\nmodule.exports = {\n    prefix: prefix,\n    browserVersion: version,\n    support: !!PC && !!getUserMedia,\n    // new support style\n    supportRTCPeerConnection: !!PC,\n    supportVp8: supportVp8,\n    supportGetUserMedia: !!getUserMedia,\n    supportDataChannel: !!(PC && PC.prototype && PC.prototype.createDataChannel),\n    supportWebAudio: !!(AudioContext && AudioContext.prototype.createMediaStreamSource),\n    supportMediaStream: !!(MediaStream && MediaStream.prototype.removeTrack),\n    supportScreenSharing: !!screenSharing,\n    // constructors\n    AudioContext: AudioContext,\n    PeerConnection: PC,\n    SessionDescription: SessionDescription,\n    IceCandidate: IceCandidate,\n    MediaStream: MediaStream,\n    getUserMedia: getUserMedia\n};\n","var _globalThis;\ntry {\n\t_globalThis = require('es5-ext/global');\n} catch (error) {\n} finally {\n\tif (!_globalThis && typeof window !== 'undefined') { _globalThis = window; }\n\tif (!_globalThis) { throw new Error('Could not determine global this'); }\n}\n\nvar NativeWebSocket = _globalThis.WebSocket || _globalThis.MozWebSocket;\nvar websocket_version = require('./version');\n\n\n/**\n * Expose a W3C WebSocket class with just one or two arguments.\n */\nfunction W3CWebSocket(uri, protocols) {\n\tvar native_instance;\n\n\tif (protocols) {\n\t\tnative_instance = new NativeWebSocket(uri, protocols);\n\t}\n\telse {\n\t\tnative_instance = new NativeWebSocket(uri);\n\t}\n\n\t/**\n\t * 'native_instance' is an instance of nativeWebSocket (the browser's WebSocket\n\t * class). Since it is an Object it will be returned as it is when creating an\n\t * instance of W3CWebSocket via 'new W3CWebSocket()'.\n\t *\n\t * ECMAScript 5: http://bclary.com/2004/11/07/#a-13.2.2\n\t */\n\treturn native_instance;\n}\nif (NativeWebSocket) {\n\t['CONNECTING', 'OPEN', 'CLOSING', 'CLOSED'].forEach(function(prop) {\n\t\tObject.defineProperty(W3CWebSocket, prop, {\n\t\t\tget: function() { return NativeWebSocket[prop]; }\n\t\t});\n\t});\n}\n\n/**\n * Module exports.\n */\nmodule.exports = {\n    'w3cwebsocket' : NativeWebSocket ? W3CWebSocket : null,\n    'version'      : websocket_version\n};\n","module.exports = require('../package.json').version;\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tif(__webpack_module_cache__[moduleId]) {\n\t\treturn __webpack_module_cache__[moduleId].exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import * as _ from 'lodash';\r\nimport Janus from \"./Room\"\r\n\r\ndeclare global {\r\n  interface Window { Janus: any; }\r\n}\r\nlet sampelRoom = new Janus.JanusRoom(\"wss://janus.conf.meetecho.com/ws\", { keepalive: 'true' });\r\n/**\r\n * on joined room success\r\n */\r\nsampelRoom.eventRoomjoined.on((info: any) => {\r\n  console.debug(\"Roomjoined\");\r\n  console.debug(info);\r\n})\r\nsampelRoom.eventNeedVideoLocal.on((elementinfo: any) => {\r\n  elementinfo.element = document.getElementById('localvideo');\r\n})\r\nsampelRoom.eventNeedVideoRemote.on((event: any) => {\r\n  if (!document.getElementById(event.feedInfo.id)) {\r\n    const video = document.createElement('video');\r\n    video.id = event.feedInfo.id;\r\n    video.autoplay = true;\r\n    if(document.getElementById(`h${event.feedInfo.id}`)){ document.getElementById(`h${event.feedInfo.id}`).remove() }\r\n    document.getElementById('remotvideocontainer').innerHTML += (`<h2 id=\"h${event.feedInfo.id}\"> ${event.feedInfo.id} display : ${event.feedInfo.display} </h2>`)\r\n    document.getElementById('remotvideocontainer').appendChild(video);\r\n    event.element = video;\r\n  }\r\n  else {\r\n    event.element = document.getElementById(event.feedInfo.id);\r\n  }\r\n  let spanID = \"no_video_\" + event.feedInfo.id.toString();\r\n  let elementSpan = document.getElementById(spanID);\r\n  if(elementSpan){ elementSpan.remove()}\r\n})\r\n/**\r\n *  On Leaving feed from room\r\n */\r\nsampelRoom.eventOnLeaving.on((feedID: number) => {\r\n  let elementVideo = document.getElementById(feedID.toString());\r\n  let spanID = \"no_video_\" + feedID.toString();\r\n  let elementSpan = document.getElementById(spanID);\r\n  let h2 = document.getElementById(`h${feedID}`);\r\n  if (elementVideo) { elementVideo.remove();}\r\n  if(elementSpan){ elementSpan.remove()}\r\n  if(h2){ h2.remove()}\r\n })\r\n/**\r\n * on Unpublished  video and  audio \r\n */\r\nsampelRoom.eventOnUnpublished.on((feedID: number) => {\r\n  let elementVideo = document.getElementById(feedID.toString());\r\n  let spanID = \"no_video_\" + feedID.toString();\r\n  //let elementSpan = document.getElementById(spanID);\r\n  if (elementVideo) {\r\n    let elementSpan = document.createElement('span');\r\n    elementSpan.id = spanID;\r\n    elementSpan.innerHTML = \"no video  publish\";\r\n    elementVideo.parentNode.replaceChild(elementSpan, elementVideo);\r\n    //document.getElementById(feedID.toString()).remove();\r\n  }\r\n })\r\n\r\nsampelRoom.joinRoom(1234, 'fullname2').then((data: any) => {\r\n  console.log('joinRoom 1234');\r\n})\r\n\r\n\r\n\r\n\r\n"],"sourceRoot":""}